<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>yinwoods</title>
  <subtitle>To Be A Better Man!ğŸ˜ˆ</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.yinwoods.work/"/>
  <updated>2019-05-26T04:38:46.930Z</updated>
  <id>http://blog.yinwoods.work/</id>
  
  <author>
    <name>yinwoods</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ·±åº¦ç†è§£git rebase</title>
    <link href="http://blog.yinwoods.work/2019/05/26/%E6%B7%B1%E5%BA%A6%E7%90%86%E8%A7%A3git-rebase/"/>
    <id>http://blog.yinwoods.work/2019/05/26/æ·±åº¦ç†è§£git-rebase/</id>
    <published>2019-05-26T04:38:00.000Z</published>
    <updated>2019-05-26T04:38:46.930Z</updated>
    
    <content type="html"><![CDATA[<p>æ ¹æ®æˆ‘ä»¬çš„éœ€è¦æ”¹å˜å†å²è®°å½•æ˜¯Gitçš„ä¸€é¡¹æ ¸å¿ƒåŠŸèƒ½ï¼Œè¿™é¡¹åŠŸèƒ½ä¸ºæˆ‘ä»¬å¾ˆå¤šå¼ºå¤§çš„å·¥å…·ï¼ŒåŒæ—¶å…è®¸æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨é‡æ„æ¥å®è·µè½¯ä»¶è®¾è®¡åŸåˆ™ã€‚è¿™äº›å·¥å…·å¯¹æ–°æ‰‹ç”šè‡³ä¸­çº§gitç”¨æˆ·æ¥è¯´å¯èƒ½æœ‰ç‚¹å“äººï¼Œä½†æœ¬æ–‡å°†ä¸ºä½ æ­å¼€<code>git-rebase</code>çš„ç¥ç§˜é¢çº±ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šé€šå¸¸ä¸å»ºè®®ä¿®æ”¹å…¬å…±çš„ã€å…±äº«çš„æˆ–è€…ç¨³å®šçš„åˆ†æ”¯ã€‚å»ºè®®ç¼–è¾‘ä¸ªäººåˆ†æ”¯ä¸ç‰¹æ€§åˆ†æ”¯ä»¥åŠå°šæœªæ¨é€çš„æäº¤ã€‚git push -fåœ¨ç¼–è¾‘æäº¤åå¼ºåˆ¶å°†æ›´æ”¹æ¨é€åˆ°ä¸ªäººåˆ†æ”¯æˆ–åŠŸèƒ½åˆ†æ”¯åˆ°è¿œç¨‹åˆ†æ”¯ã€‚</p>
</blockquote>
<h2 id="æ„å»ºæ²™ç®±"><a href="#æ„å»ºæ²™ç®±" class="headerlink" title="æ„å»ºæ²™ç®±"></a>æ„å»ºæ²™ç®±</h2><p>ä¸ºäº†ä¸å½±å“åˆ°ä½ ä»»ä½•ç°æœ‰å­˜å‚¨åº“ï¼Œæœ¬æ–‡å°†ä½¿ç”¨æ²™ç®±ä»“åº“ã€‚ä»è¿è¡Œè¿™äº›å‘½ä»¤ä»¥å¼€å§‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git init /tmp/rebase-sandbox</div><div class="line">cd /tmp/rebase-sandbox</div><div class="line">git commit --allow-empty -m&quot;Initial commit&quot; # 1</div></pre></td></tr></table></figure></p>
<p>å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¿è¡Œ<code>rm -rf /tmp/rebase-sandbox</code>åˆ é™¤ç°æœ‰çš„æ²™ç®±ä»“åº“å¹¶æŒ‰ç…§ä¸Šè¿°æ­¥éª¤é‡æ–°æ„å»ºæ²™ç®±ä»“åº“å³å¯ï¼Œåç»­æ¯ä¸ªç« èŠ‚çš„å†…å®¹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå› æ­¤åœ¨æ„å»ºæ²™ç®±ä»“åº“åï¼ŒæŒ‰ç…§æŒ‡å®šç« èŠ‚å†…å®¹ç»§ç»­æ“ä½œå³å¯ï¼Œä¸éœ€è¦é‡æ–°æ‰§è¡Œæ‰€æœ‰ç« èŠ‚çš„æ“ä½œã€‚</p>
<h2 id="ä¿®æ”¹ä¸Šæ¬¡æäº¤"><a href="#ä¿®æ”¹ä¸Šæ¬¡æäº¤" class="headerlink" title="ä¿®æ”¹ä¸Šæ¬¡æäº¤"></a>ä¿®æ”¹ä¸Šæ¬¡æäº¤</h2><p>è®©æˆ‘ä»¬ä»ä»¥ä¸‹æ­¥éª¤å¼€å§‹ï¼šä¿®å¤ä½ æœ€è¿‘ä¸€æ¬¡çš„æäº¤ã€‚</p>
<p>é¦–å…ˆï¼Œæ·»åŠ ä¸€ä¸ªæ–‡ä»¶åˆ°ä»“åº“ä¸­ï¼Œå¹¶çŠ¯ä¸‹ä¸€ä¸ªé”™è¯¯(worldå•è¯æ‹¼é”™)ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">echo &quot;Hello wrold!&quot; &gt;greeting.txt</div><div class="line">git add greeting.txt</div><div class="line">git commit -m&quot;Add greeting.txt&quot;</div></pre></td></tr></table></figure></p>
<p>ä¿®å¤è¿™ä¸ªé”™è¯¯å¾ˆç®€å•ï¼Œåªéœ€è¦é‡æ–°ç¼–è¾‘æ–‡ä»¶ï¼Œå¹¶åœ¨æäº¤æ—¶å¸¦ä¸Š<code>--amend</code>å‚æ•°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">echo &quot;Hello world!&quot; &gt;greeting.txt</div><div class="line">git commit -a --amend</div></pre></td></tr></table></figure></p>
<p>æŒ‡å®š<code>-a</code>å‚æ•°è‡ªåŠ¨é‡æ–°è¿½è¸ªæ‰€æœ‰gitå·²ç»æäº¤çš„æ–‡ä»¶(åŒï¼š<code>git add&#39;s</code>)ï¼Œ<code>--amend</code>å‚æ•°å°†ä¿®æ”¹å‹ç¼©åˆ°æœ€è¿‘çš„æäº¤ä¸­ã€‚ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨ï¼ˆå¦‚æœéœ€è¦ï¼Œå¯ä»¥ä¿®æ”¹å¯¹åº”çš„æäº¤ä¿¡æ¯ï¼‰ã€‚ä¹‹åå¯ä»¥é€šè¿‡è¿è¡Œ<code>git show</code>æŸ¥çœ‹ä¿®å¤çš„æäº¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">commit f5f19fbf6d35b2db37dcac3a55289ff9602e4d00 (HEAD -&gt; master)</div><div class="line">Author: Drew DeVault </div><div class="line">Date:   Sun Apr 28 11:09:47 2019 -0400</div><div class="line"></div><div class="line">    Add greeting.txt</div><div class="line"></div><div class="line">diff --git a/greeting.txt b/greeting.txt</div><div class="line">new file mode 100644</div><div class="line">index 0000000..cd08755</div><div class="line">--- /dev/null</div><div class="line">+++ b/greeting.txt</div><div class="line">@@ -0,0 +1 @@</div><div class="line">+Hello world!</div></pre></td></tr></table></figure>
<h2 id="ä¿®å¤æ—§çš„æäº¤"><a href="#ä¿®å¤æ—§çš„æäº¤" class="headerlink" title="ä¿®å¤æ—§çš„æäº¤"></a>ä¿®å¤æ—§çš„æäº¤</h2><p>ä¸Šé¢çš„æ“ä½œåªé€‚ç”¨äºä¿®æ”¹æœ€è¿‘ä¸€æ¬¡çš„æäº¤ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹æ›´ä¹…è¿œçš„æäº¤å†å²è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿé¦–å…ˆæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤è®¾ç½®ä»“åº“ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">echo &quot;Hello!&quot; &gt;greeting.txt</div><div class="line">git add greeting.txt</div><div class="line">git commit -m&quot;Add greeting.txt&quot;</div><div class="line"></div><div class="line">echo &quot;Goodbye world!&quot; &gt;farewell.txt</div><div class="line">git add farewell.txt</div><div class="line">git commit -m&quot;Add farewell.txt&quot;</div></pre></td></tr></table></figure>
<p>çœ‹èµ·æ¥greeting.txtä¸­ç¼ºå°‘äº†å•è¯worldï¼Œè®©æˆ‘ä»¬é€šè¿‡æ­£å¸¸æäº¤ä¿®å¤ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">echo &quot;Hello world!&quot; &gt;greeting.txt</div><div class="line">git commit -a -m&quot;fixup greeting.txt&quot;</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨æ–‡ä»¶çœ‹èµ·æ¥æ˜¯å¯¹çš„äº†ï¼Œä½†æˆ‘ä»¬çš„å†å²æäº¤æ˜¾å¾—æœ‰äº›å•°å—¦ï¼Œç°åœ¨è®©æˆ‘ä»¬é€šè¿‡æ–°æäº¤æ¥ä¿®å¤ä¸Šä¸€ä¸ªæäº¤ï¼Œä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œéœ€è¦å¼•å…¥æ–°çš„å·¥å…·ï¼šäº¤äº’å¼rebaseã€‚æˆ‘ä»¬å°†ä»¥è¿™ç§æ–¹å¼ç¼–è¾‘æœ€åä¸‰ä¸ªæäº¤ï¼Œå› æ­¤æˆ‘ä»¬å°†è¿è¡Œgit rebase -i HEAD~3ï¼ˆ-iç”¨äºäº¤äº’å¼ï¼‰ã€‚è¿™ä¼šæ‰“å¼€ä½ çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">pick 8d3fc77 Add greeting.txt</div><div class="line">pick 2a73a77 Add farewell.txt</div><div class="line">pick 0b9d0bb fixup greeting.txt</div><div class="line"></div><div class="line"># Rebase f5f19fb..0b9d0bb onto f5f19fb (3 commands)</div><div class="line">#</div><div class="line"># Commands:</div><div class="line"># p, pick &lt;commit&gt; = use commit</div><div class="line"># f, fixup &lt;commit&gt; = like &quot;squash&quot;, but discard this commit&apos;s log message</div></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯rebaseè®¡åˆ’ï¼Œé€šè¿‡ç¼–è¾‘æ­¤æ–‡ä»¶ï¼Œå¯ä»¥æŒ‡ç¤ºgitå¦‚ä½•ç¼–è¾‘å†å²è®°å½•ã€‚æˆ‘å·²å°†æ‘˜è¦ä¿®æ”¹ä¸ºä¸rebaseæŒ‡å—çš„è¿™ä¸€éƒ¨åˆ†ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯ï¼Œä½†æ‚¨å¯ä»¥éšæ„æµè§ˆæ–‡æœ¬ç¼–è¾‘å™¨ä¸­çš„å®Œæ•´æ‘˜è¦ã€‚</p>
<p>å½“æˆ‘ä»¬ä¿å­˜å¹¶å…³é—­æˆ‘ä»¬çš„ç¼–è¾‘å™¨æ—¶ï¼Œgitå°†ä»å…¶å†å²è®°å½•ä¸­åˆ é™¤æ‰€æœ‰è¿™äº›æäº¤ï¼Œç„¶åä¸€æ¬¡æ‰§è¡Œæ¯ä¸€è¡Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†é€‰æ‹©æ¯ä¸ªæäº¤ï¼Œä»å †ä¸­å¬å”¤å®ƒå¹¶å°†å…¶æ·»åŠ åˆ°åˆ†æ”¯ã€‚å¦‚æœæˆ‘ä»¬æ ¹æœ¬ä¸ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šå›åˆ°æˆ‘ä»¬å¼€å§‹çš„åœ°æ–¹â€”â€”æŒ‰åŸæ ·é€‰æ‹©æ¯ä¸ªæäº¤ã€‚æˆ‘ä»¬ç°åœ¨å°†ä½¿ç”¨æˆ‘æœ€å–œæ¬¢çš„åŠŸèƒ½ä¹‹ä¸€ï¼šfixupã€‚ç¼–è¾‘ç¬¬ä¸‰è¡Œä»¥å°†æ“ä½œä»â€œpickâ€æ›´æ”¹ä¸ºâ€œfixupâ€ï¼Œå¹¶å°†è¯¥è¡Œå†…å®¹ç§»åŠ¨åˆ°æˆ‘ä»¬æƒ³è¦â€œä¿®å¤â€æäº¤çš„ä¸‹ä¸€è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pick 8d3fc77 Add greeting.txt</div><div class="line">fixup 0b9d0bb fixup greeting.txt</div><div class="line">pick 2a73a77 Add farewell.txt</div></pre></td></tr></table></figure></p>
<blockquote>
<p>æç¤ºï¼šæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å…¶ç¼©å†™ä¸ºâ€œfâ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡åŠ å¿«é€Ÿåº¦ã€‚</p>
</blockquote>
<p>ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨ - gitå°†è¿è¡Œè¿™äº›å‘½ä»¤ã€‚æˆ‘ä»¬å¯ä»¥æ£€æŸ¥æ—¥å¿—ä»¥éªŒè¯ç»“æœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git log -2 --oneline</div><div class="line">fcff6ae (HEAD -&gt; master) Add farewell.txt</div><div class="line">a479e94 Add greeting.txt</div></pre></td></tr></table></figure></p>
<h2 id="å°†å‡ ä¸ªæäº¤å‹ç¼©æˆä¸€ä¸ª"><a href="#å°†å‡ ä¸ªæäº¤å‹ç¼©æˆä¸€ä¸ª" class="headerlink" title="å°†å‡ ä¸ªæäº¤å‹ç¼©æˆä¸€ä¸ª"></a>å°†å‡ ä¸ªæäº¤å‹ç¼©æˆä¸€ä¸ª</h2><p>åœ¨ä½ å·¥ä½œæ—¶ï¼Œä½ å¯èƒ½ä¼šå‘ç°åœ¨ä½ è¾¾åˆ°å°å‹é‡Œç¨‹ç¢‘æˆ–ä¿®å¤å…ˆå‰æäº¤ä¸­çš„é”™è¯¯æ—¶ç¼–å†™å¤§é‡æäº¤å¾ˆæœ‰ç”¨ã€‚ä½†æ˜¯åœ¨åˆ°è¾¾é‡Œç¨‹ç¢‘ã€ä¿®å¤å®Œæˆåï¼Œå°†è¿™äº›æäº¤â€œå‹ç¼©â€åœ¨ä¸€èµ·å¯èƒ½ä¼šæ›´æœ‰ç”¨ï¼Œå®ƒå¯ä»¥åœ¨ä½ çš„å·¥ä½œåˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¹‹å‰ä¸ºä½ æä¾›æ›´æ¸…æ™°çš„å†å²è®°å½•ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨â€œsquashâ€æ“ä½œã€‚è®©æˆ‘ä»¬ä»å†™ä¸€å †æäº¤å¼€å§‹ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">git checkout -b squash</div><div class="line">for c in H e l l o , ' ' w o r l d; do</div><div class="line">    echo "$c" &gt;&gt;squash.txt</div><div class="line">    git add squash.txt</div><div class="line">    git commit -m"Add '$c' to squash.txt"</div><div class="line">done</div></pre></td></tr></table></figure></p>
<p>è¿™ä¼šåˆ›å»ºå¾ˆå¤šæäº¤ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†ä½¿ç”¨rebaseå°†è¿™äº›æäº¤åˆå¹¶ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬é¦–å…ˆæ£€å‡ºä¸€ä¸ªåˆ†æ”¯ä»¥å°è¯•æ­¤æ“ä½œã€‚å› ä¸ºé€šè¿‡æ£€å‡ºæ–°åˆ†æ”¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>git rebase -i master</code>ç¼–è¾‘masteråˆ†æ”¯çš„æ‰€æœ‰å†å²æäº¤ï¼Œè€Œä¸å†éœ€è¦ä½¿ç”¨<code>git rebase -i $commit</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">pick 1e85199 Add &apos;H&apos; to squash.txt</div><div class="line">pick fff6631 Add &apos;e&apos; to squash.txt</div><div class="line">pick b354c74 Add &apos;l&apos; to squash.txt</div><div class="line">pick 04aaf74 Add &apos;l&apos; to squash.txt</div><div class="line">pick 9b0f720 Add &apos;o&apos; to squash.txt</div><div class="line">pick 66b114d Add &apos;,&apos; to squash.txt</div><div class="line">pick dc158cd Add &apos; &apos; to squash.txt</div><div class="line">pick dfcf9d6 Add &apos;w&apos; to squash.txt</div><div class="line">pick 7a85f34 Add &apos;o&apos; to squash.txt</div><div class="line">pick c275c27 Add &apos;r&apos; to squash.txt</div><div class="line">pick a513fd1 Add &apos;l&apos; to squash.txt</div><div class="line">pick 6b608ae Add &apos;d&apos; to squash.txt</div><div class="line"></div><div class="line"># Rebase 1af1b46..6b608ae onto 1af1b46 (12 commands)</div><div class="line">#</div><div class="line"># Commands:</div><div class="line"># p, pick &lt;commit&gt; = use commit</div><div class="line"># s, squash &lt;commit&gt; = use commit, but meld into previous commit</div></pre></td></tr></table></figure>
<blockquote>
<p>æç¤ºï¼šä½ çš„æœ¬åœ°ä¸»åˆ†æ”¯ç‹¬ç«‹äºè¿œç¨‹ä¸»åˆ†æ”¯ï¼Œgitå°†è¿œç¨‹åˆ†æ”¯å­˜å‚¨ä¸º origin/masterã€‚ç»“åˆè¿™ä¸ªæŠ€å·§ï¼Œgit rebase -i origin/masteré€šå¸¸æ˜¯ä¸€ç§éå¸¸æ–¹ä¾¿çš„æ–¹æ³•æ¥ä¿®æ”¹å°šæœªåˆå¹¶åˆ°ä¸Šæ¸¸çš„æ‰€æœ‰æäº¤ï¼</p>
</blockquote>
<p>æˆ‘ä»¬è¦å°†æ‰€æœ‰æäº¤å‹ç¼©åˆ°ç¬¬ä¸€æ¬¡æäº¤ä¸­ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå°†æ¯ä¸ªâ€œpickâ€æ“ä½œæ›´æ”¹ä¸ºâ€œsquashâ€ï¼Œç¬¬ä¸€è¡Œé™¤å¤–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">pick 1e85199 Add &apos;H&apos; to squash.txt</div><div class="line">squash fff6631 Add &apos;e&apos; to squash.txt</div><div class="line">squash b354c74 Add &apos;l&apos; to squash.txt</div><div class="line">squash 04aaf74 Add &apos;l&apos; to squash.txt</div><div class="line">squash 9b0f720 Add &apos;o&apos; to squash.txt</div><div class="line">squash 66b114d Add &apos;,&apos; to squash.txt</div><div class="line">squash dc158cd Add &apos; &apos; to squash.txt</div><div class="line">squash dfcf9d6 Add &apos;w&apos; to squash.txt</div><div class="line">squash 7a85f34 Add &apos;o&apos; to squash.txt</div><div class="line">squash c275c27 Add &apos;r&apos; to squash.txt</div><div class="line">squash a513fd1 Add &apos;l&apos; to squash.txt</div><div class="line">squash 6b608ae Add &apos;d&apos; to squash.txt</div></pre></td></tr></table></figure></p>
<p>å½“ä½ ä¿å­˜å¹¶å…³é—­ç¼–è¾‘å™¨æ—¶ï¼Œgitä¼šæ ¹æ®ä¸Šè¿°ä¿®æ”¹é‡æ–°è®¡ç®—æäº¤ä¿¡æ¯ï¼Œç„¶åå†æ¬¡æ‰“å¼€ç¼–è¾‘å™¨ä»¥ä¾›ä½ ä¿®æ”¹æœ€ç»ˆçš„æäº¤æ¶ˆæ¯ã€‚ä½ ä¼šçœ‹åˆ°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"># This is a combination of 12 commits.</div><div class="line"># This is the 1st commit message:</div><div class="line"></div><div class="line">Add &apos;H&apos; to squash.txt</div><div class="line"></div><div class="line"># This is the commit message #2:</div><div class="line"></div><div class="line">Add &apos;e&apos; to squash.txt</div><div class="line"></div><div class="line"># This is the commit message #3:</div><div class="line"></div><div class="line">Add &apos;l&apos; to squash.txt</div><div class="line"></div><div class="line"># This is the commit message #4:</div><div class="line"></div><div class="line">Add &apos;l&apos; to squash.txt</div><div class="line"></div><div class="line"># This is the commit message #5:</div><div class="line"></div><div class="line">Add &apos;o&apos; to squash.txt</div><div class="line"></div><div class="line"># This is the commit message #6:</div><div class="line"></div><div class="line">Add &apos;,&apos; to squash.txt</div><div class="line"></div><div class="line"># This is the commit message #7:</div><div class="line"></div><div class="line">Add &apos; &apos; to squash.txt</div><div class="line"></div><div class="line"># This is the commit message #8:</div><div class="line"></div><div class="line">Add &apos;w&apos; to squash.txt</div><div class="line"></div><div class="line"># This is the commit message #9:</div><div class="line"></div><div class="line">Add &apos;o&apos; to squash.txt</div><div class="line"></div><div class="line"># This is the commit message #10:</div><div class="line"></div><div class="line">Add &apos;r&apos; to squash.txt</div><div class="line"></div><div class="line"># This is the commit message #11:</div><div class="line"></div><div class="line">Add &apos;l&apos; to squash.txt</div><div class="line"></div><div class="line"># This is the commit message #12:</div><div class="line"></div><div class="line">Add &apos;d&apos; to squash.txt</div><div class="line"></div><div class="line"># Please enter the commit message for your changes. Lines starting</div><div class="line"># with &apos;#&apos; will be ignored, and an empty message aborts the commit.</div><div class="line">#</div><div class="line"># Date:      Sun Apr 28 14:21:56 2019 -0400</div><div class="line">#</div><div class="line"># interactive rebase in progress; onto 1af1b46</div><div class="line"># Last commands done (12 commands done):</div><div class="line">#    squash a513fd1 Add &apos;l&apos; to squash.txt</div><div class="line">#    squash 6b608ae Add &apos;d&apos; to squash.txt</div><div class="line"># No commands remaining.</div><div class="line"># You are currently rebasing branch &apos;squash&apos; on &apos;1af1b46&apos;.</div><div class="line">#</div><div class="line"># Changes to be committed:</div><div class="line">#	new file:   squash.txt</div></pre></td></tr></table></figure></p>
<p>gité»˜è®¤å°†æ‰€æœ‰çš„æäº¤ä¿¡æ¯ç»„åˆï¼Œä½†æ˜¯ä¿ç•™è¿™æ ·çš„æ¶ˆæ¯ä¸å¤ªå¯èƒ½æ˜¯ä½ æƒ³è¦çš„ã€‚ä½†æ˜¯ï¼Œæ—§çš„æäº¤æ¶ˆæ¯èƒ½å¤Ÿä¸ºç¼–å†™æ–°æäº¤ä¿¡æ¯æä¾›å‚è€ƒã€‚</p>
<blockquote>
<p>æç¤ºï¼šæ‚¨åœ¨ä¸Šä¸€èŠ‚ä¸­äº†è§£åˆ°çš„â€œfixupâ€å‘½ä»¤ä¹Ÿå¯ä»¥ç”¨äºæ­¤ç›®çš„ - ä½†å®ƒä¼šä¸¢å¼ƒå‹ç¼©æäº¤çš„æ¶ˆæ¯ã€‚</p>
</blockquote>
<p>è®©æˆ‘ä»¬åˆ é™¤æ‰€æœ‰å†…å®¹å¹¶ç”¨æ›´å¥½çš„æäº¤æ¶ˆæ¯æ›¿æ¢å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Add squash.txt with contents &quot;Hello, world&quot;</div><div class="line"></div><div class="line"># Please enter the commit message for your changes. Lines starting</div><div class="line"># with &apos;#&apos; will be ignored, and an empty message aborts the commit.</div><div class="line">#</div><div class="line"># Date:      Sun Apr 28 14:21:56 2019 -0400</div><div class="line">#</div><div class="line"># interactive rebase in progress; onto 1af1b46</div><div class="line"># Last commands done (12 commands done):</div><div class="line">#    squash a513fd1 Add &apos;l&apos; to squash.txt</div><div class="line">#    squash 6b608ae Add &apos;d&apos; to squash.txt</div><div class="line"># No commands remaining.</div><div class="line"># You are currently rebasing branch &apos;squash&apos; on &apos;1af1b46&apos;.</div><div class="line">#</div><div class="line"># Changes to be committed:</div><div class="line">#	new file:   squash.txt</div></pre></td></tr></table></figure></p>
<p>ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨ï¼Œç„¶åæ£€æŸ¥ä½ çš„gitæ—¥å¿— - æˆåŠŸï¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">commit c785f476c7dff76f21ce2cad7c51cf2af00a44b6 (HEAD -&gt; squash)</div><div class="line">Author: Drew DeVault </div><div class="line">Date:   Sun Apr 28 14:21:56 2019 -0400</div><div class="line"></div><div class="line">    Add squash.txt with contents &quot;Hello, world&quot;</div></pre></td></tr></table></figure></p>
<p>åœ¨ç»§ç»­ä¸‹ä¸€æ­¥æ“ä½œä¹‹å‰ï¼Œè®©æˆ‘ä»¬å°†æˆ‘ä»¬çš„æ›´æ”¹å¹¶å…¥ä¸»åˆ†æ”¯å¹¶åˆ é™¤è¯¥åˆ†æ”¯ã€‚æˆ‘ä»¬å¯ä»¥åƒä½¿ç”¨git mergeä¸€æ ·ä½¿ç”¨git rebaseï¼Œä½†ç›¸æ¯”äºgit mergeï¼Œgit rebaseé¿å…äº†åˆå¹¶æäº¤ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git checkout master</div><div class="line">git rebase squash</div><div class="line">git branch -D squash</div></pre></td></tr></table></figure></p>
<p>é™¤éæˆ‘ä»¬å®é™…ä¸Šåˆå¹¶ä¸ç›¸å…³çš„å†å²ï¼Œå¦åˆ™æˆ‘ä»¬é€šå¸¸ä¼šé¿å…ä½¿ç”¨git mergeã€‚å¦‚æœä½ æœ‰ä¸¤ä¸ªä¸åŒçš„åˆ†æ”¯ï¼Œgit mergeå¯¹äºè®°å½•å®ƒä»¬ä½•æ—¶è¢«åˆå¹¶æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚åœ¨æ­£å¸¸å·¥ä½œè¿‡ç¨‹ä¸­ï¼Œrebaseé€šå¸¸æ›´åˆé€‚ã€‚</p>
<h1 id="å°†ä¸€ä¸ªæäº¤æ‹†åˆ†ä¸ºå¤šä¸ª"><a href="#å°†ä¸€ä¸ªæäº¤æ‹†åˆ†ä¸ºå¤šä¸ª" class="headerlink" title="å°†ä¸€ä¸ªæäº¤æ‹†åˆ†ä¸ºå¤šä¸ª"></a>å°†ä¸€ä¸ªæäº¤æ‹†åˆ†ä¸ºå¤šä¸ª</h1><p>æœ‰æ—¶ä¼šå‘ç”Ÿç›¸åçš„é—®é¢˜ - ä¸€æ¬¡æäº¤å¤ªå¤§äº†ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å°†å®ƒæ‹†åˆ†å¼€ã€‚è¿™ä¸€æ¬¡ï¼Œè®©æˆ‘ä»¬å†™ä¸€äº›å®é™…çš„ä»£ç ã€‚ä»ç®€å•çš„Cç¨‹åºå¼€å§‹ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cat &lt;&lt;EOF &gt;main.c</div><div class="line">int main(int argc, char *argv[]) &#123;</div><div class="line">    return 0;</div><div class="line">&#125;</div><div class="line">EOF</div></pre></td></tr></table></figure></p>
<p>æ¥ç€æäº¤ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git add main.c</div><div class="line">git commit -m&quot;Add C program skeleton&quot;</div></pre></td></tr></table></figure></p>
<p>ä¹‹åï¼Œå†å°è¯•æ‰©å±•ç¨‹åºï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">cat &lt;&lt;EOF &gt;main.c</div><div class="line"><span class="meta">#</span><span class="bash">include &lt;stdio.h&gt;</span></div><div class="line"></div><div class="line">const char *get_name() &#123;</div><div class="line">    static char buf[128];</div><div class="line">    scanf("%s", buf);</div><div class="line">    return buf;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int main(int argc, char *argv[]) &#123;</div><div class="line">    printf("What's your name? ");</div><div class="line">    const char *name = get_name();</div><div class="line">    printf("Hello, %s!\n", name);</div><div class="line">    return 0;</div><div class="line">&#125;</div><div class="line">EOF</div></pre></td></tr></table></figure></p>
<p>å†æ¬¡æäº¤ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git commit -a -m&quot;Flesh out C program&quot;</div></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†å°è¯•æ‹†åˆ†gitæäº¤ï¼š<br>ç¬¬ä¸€æ­¥æ˜¯å¯åŠ¨äº¤äº’å¼rebaseã€‚è®©æˆ‘ä»¬é€šè¿‡æ‰§è¡Œ<code>git rebase -i HEAD~2</code>rebaseä¸¤æ¬¡æäº¤ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">pick 237b246 Add C program skeleton</div><div class="line">pick b3f188b Flesh out C program</div><div class="line"></div><div class="line"># Rebase c785f47..b3f188b onto c785f47 (2 commands)</div><div class="line">#</div><div class="line"># Commands:</div><div class="line"># p, pick &lt;commit&gt; = use commit</div><div class="line"># e, edit &lt;commit&gt; = use commit, but stop for amending</div></pre></td></tr></table></figure></p>
<p>å°†ç¬¬äºŒä¸ªæäº¤çš„å‘½ä»¤ä»â€œpickâ€æ›´æ”¹ä¸ºâ€œeditâ€ï¼Œä¿å­˜å¹¶å…³é—­ç¼–è¾‘å™¨ã€‚Gitä¼šè®¡ç®—ä¸€ç§’ï¼Œç„¶åå±•ç¤ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Stopped at b3f188b...  Flesh out C program</div><div class="line">You can amend the commit now, with</div><div class="line"></div><div class="line">  git commit --amend</div><div class="line"></div><div class="line">Once you are satisfied with your changes, run</div><div class="line"></div><div class="line">  git rebase --continue</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸Šè¿°è¯´æ˜ä¸ºæäº¤æ·»åŠ æ–°çš„æ›´æ”¹ï¼Œä½†è¿™é‡Œæˆ‘ä»¬é€šè¿‡è¿è¡Œ<code>git reset HEAD^</code>æ¥æ‰§è¡Œâ€œè½¯é‡ç½®â€ ã€‚å¦‚æœåœ¨æ­¤ä¹‹åè¿è¡Œ<code>git status</code>ï¼Œæ‚¨å°†çœ‹åˆ°å®ƒå–æ¶ˆæœ€æ–°æäº¤å¹¶å°†å…¶æ›´æ”¹æ·»åŠ åˆ°å·¥ä½œæ ‘ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Last commands done (2 commands done):</div><div class="line">   pick 237b246 Add C program skeleton</div><div class="line">   edit b3f188b Flesh out C program</div><div class="line">No commands remaining.</div><div class="line">You are currently splitting a commit while rebasing branch &apos;master&apos; on &apos;c785f47&apos;.</div><div class="line">  (Once your working directory is clean, run &quot;git rebase --continue&quot;)</div><div class="line"></div><div class="line">Changes not staged for commit:</div><div class="line">  (use &quot;git add ...&quot; to update what will be committed)</div><div class="line">  (use &quot;git checkout -- ...&quot; to discard changes in working directory)</div><div class="line"></div><div class="line">  modified:   main.c</div><div class="line"></div><div class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</div></pre></td></tr></table></figure></p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†è¿›è¡Œäº¤äº’å¼æäº¤ã€‚è¿™å…è®¸æˆ‘ä»¬æœ‰é€‰æ‹©åœ°ä»…æäº¤å·¥ä½œæ ‘ä¸­çš„ç‰¹å®šæ›´æ”¹ã€‚è¿è¡Œgit commit -pä»¥å¯åŠ¨æ­¤è¿‡ç¨‹ï¼Œæ‚¨å°†çœ‹åˆ°ä»¥ä¸‹æç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">diff --git a/main.c b/main.c</div><div class="line">index b1d9c2c..3463610 100644</div><div class="line">--- a/main.c</div><div class="line">+++ b/main.c</div><div class="line">@@ -1,3 +1,14 @@</div><div class="line">+#include &lt;stdio.h&gt;</div><div class="line">+</div><div class="line">+const char *get_name() &#123;</div><div class="line">+    static char buf[128];</div><div class="line">+    scanf(&quot;%s&quot;, buf);</div><div class="line">+    return buf;</div><div class="line">+&#125;</div><div class="line">+</div><div class="line"> int main(int argc, char *argv[]) &#123;</div><div class="line">+    printf(&quot;What&apos;s your name? &quot;);</div><div class="line">+    const char *name = get_name();</div><div class="line">+    printf(&quot;Hello, %s!\n&quot;, name);</div><div class="line">     return 0;</div><div class="line"> &#125;</div><div class="line">Stage this hunk [y,n,q,a,d,s,e,?]?</div></pre></td></tr></table></figure>
<p>Gitä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªâ€œhunkâ€ï¼ˆå³å•ä¸ªæ›´æ”¹ï¼‰æ¥è€ƒè™‘æäº¤ã€‚ä½†æ˜¯è¿™ä¸ªå¤ªå¤§äº† - è®©æˆ‘ä»¬ä½¿ç”¨â€œsâ€å‘½ä»¤å°†å¤§å—â€œæ‹†åˆ†â€æˆæ›´å°çš„æäº¤ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Split into 2 hunks.</div><div class="line">@@ -1 +1,9 @@</div><div class="line">+#include &lt;stdio.h&gt;</div><div class="line">+</div><div class="line">+const char *get_name() &#123;</div><div class="line">+    static char buf[128];</div><div class="line">+    scanf(&quot;%s&quot;, buf);</div><div class="line">+    return buf;</div><div class="line">+&#125;</div><div class="line">+</div><div class="line"> int main(int argc, char *argv[]) &#123;</div><div class="line">Stage this hunk [y,n,q,a,d,j,J,g,/,e,?]?</div></pre></td></tr></table></figure></p>
<blockquote>
<p>æç¤ºï¼šå¦‚æœä½ å¯¹å…¶ä»–é€‰é¡¹æ„Ÿåˆ°å¥½å¥‡ï¼Œè¯·æŒ‰â€œï¼Ÿâ€ æŸ¥çœ‹ç›¸å…³è¯´æ˜ã€‚<br>Tip: If youâ€™re curious about the other options, press â€œ?â€ to summarize them.</p>
</blockquote>
<p>è¿™ä¸ªhunkä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ï¼Œè‡ªè¶³çš„å˜åŒ–ï¼Œçœ‹èµ·æ¥æ›´å¥½ã€‚è®©æˆ‘ä»¬ç‚¹å‡»â€œyâ€æ¥å›ç­”é—®é¢˜ï¼ˆä»¥åŠâ€œhunkâ€çš„é˜¶æ®µï¼‰ï¼Œç„¶åç‚¹å‡»â€œqâ€ä»¥â€œé€€å‡ºâ€äº¤äº’å¼ä¼šè¯å¹¶ç»§ç»­æäº¤ã€‚æ‚¨çš„ç¼–è¾‘å™¨ä¼šå¼¹å‡ºï¼Œè¦æ±‚æ‚¨è¾“å…¥åˆé€‚çš„æäº¤æ¶ˆæ¯ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">Add get_name function to C program</div><div class="line"></div><div class="line"># Please enter the commit message for your changes. Lines starting</div><div class="line"># with &apos;#&apos; will be ignored, and an empty message aborts the commit.</div><div class="line">#</div><div class="line"># interactive rebase in progress; onto c785f47</div><div class="line"># Last commands done (2 commands done):</div><div class="line">#    pick 237b246 Add C program skeleton</div><div class="line">#    edit b3f188b Flesh out C program</div><div class="line"># No commands remaining.</div><div class="line"># You are currently splitting a commit while rebasing branch &apos;master&apos; on &apos;c785f47&apos;.</div><div class="line">#</div><div class="line"># Changes to be committed:</div><div class="line">#	modified:   main.c</div><div class="line">#</div><div class="line"># Changes not staged for commit:</div><div class="line">#	modified:   main.c</div><div class="line">#</div></pre></td></tr></table></figure></p>
<p>ä¿å­˜å¹¶å…³é—­ç¼–è¾‘å™¨ï¼Œç„¶åæˆ‘ä»¬å°†è¿›è¡Œç¬¬äºŒæ¬¡æäº¤ã€‚æˆ‘ä»¬å¯ä»¥åšå¦ä¸€ä¸ªäº¤äº’å¼æäº¤ï¼Œä½†ç”±äºæˆ‘ä»¬åªæƒ³åœ¨æ­¤æäº¤ä¸­åŒ…å«å…¶ä½™çš„æ›´æ”¹ï¼Œæˆ‘ä»¬å°†æ‰§è¡Œæ­¤æ“ä½œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git commit -a -m&quot;Prompt user for their name&quot;</div><div class="line">git rebase --continue</div></pre></td></tr></table></figure></p>
<p>æœ€åä¸€ä¸ªå‘½ä»¤å‘Šè¯‰gitæˆ‘ä»¬å·²å®Œæˆç¼–è¾‘æ­¤æäº¤ï¼Œå¹¶ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªrebaseå‘½ä»¤ã€‚è¿è¡Œ<code>git log</code>çœ‹çœ‹ä½ çš„åŠ³åŠ¨æˆæœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ git log -3 --oneline</div><div class="line">fe19cc3 (HEAD -&gt; master) Prompt user for their name</div><div class="line">659a489 Add get_name function to C program</div><div class="line">237b246 Add C program skeleton</div></pre></td></tr></table></figure></p>
<h1 id="å¯¹æäº¤é‡æ–°æ’åº"><a href="#å¯¹æäº¤é‡æ–°æ’åº" class="headerlink" title="å¯¹æäº¤é‡æ–°æ’åº"></a>å¯¹æäº¤é‡æ–°æ’åº</h1><p>è¿™éƒ¨åˆ†æ¯”è¾ƒç®€å•ã€‚è®©æˆ‘ä»¬ä»ä»¥ä¸‹æ“ä½œå¼€å§‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">echo &quot;Goodbye now!&quot; &gt;farewell.txt</div><div class="line">git add farewell.txt</div><div class="line">git commit -m&quot;Add farewell.txt&quot;</div><div class="line"></div><div class="line">echo &quot;Hello there!&quot; &gt;greeting.txt</div><div class="line">git add greeting.txt</div><div class="line">git commit -m&quot;Add greeting.txt&quot;</div><div class="line"></div><div class="line">echo &quot;How&apos;re you doing?&quot; &gt;inquiry.txt</div><div class="line">git add inquiry.txt</div><div class="line">git commit -m&quot;Add inquiry.txt&quot;</div></pre></td></tr></table></figure>
<p>gitæ—¥å¿—ç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">f03baa5 (HEAD -&gt; master) Add inquiry.txt</div><div class="line">a4cebf7 Add greeting.txt</div><div class="line">90bb015 Add farewell.txt</div></pre></td></tr></table></figure></p>
<p>æ˜¾ç„¶ï¼Œé¡ºåºæ˜¯ä¸å¯¹çš„ã€‚è®©æˆ‘ä»¬å¯¹è¿‡å»3æ¬¡æäº¤è¿›è¡Œäº¤äº’å¼å˜æ›´ä»¥è§£å†³æ­¤é—®é¢˜ã€‚è¿è¡Œ<code>git rebase -i HEAD~3</code>ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">pick 90bb015 Add farewell.txt</div><div class="line">pick a4cebf7 Add greeting.txt</div><div class="line">pick f03baa5 Add inquiry.txt</div><div class="line"></div><div class="line"># Rebase fe19cc3..f03baa5 onto fe19cc3 (3 commands)</div><div class="line">#</div><div class="line"># Commands:</div><div class="line"># p, pick &lt;commit&gt; = use commit</div><div class="line">#</div><div class="line"># These lines can be re-ordered; they are executed from top to bottom.</div></pre></td></tr></table></figure></p>
<p>ä¿®å¤ç°åœ¨å¾ˆç®€å•ï¼šåªéœ€æŒ‰ç…§å¸Œæœ›æäº¤çš„é¡ºåºé‡æ–°æ’åˆ—è¿™äº›è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pick a4cebf7 Add greeting.txt</div><div class="line">pick f03baa5 Add inquiry.txt</div><div class="line">pick 90bb015 Add farewell.txt</div></pre></td></tr></table></figure></p>
<p>ä¿å­˜å¹¶å…³é—­æ‚¨çš„ç¼–è¾‘å™¨ï¼Œgitå°†ä¸ºæ‚¨å®Œæˆå‰©ä¸‹çš„å·¥ä½œã€‚</p>
<h2 id="git-pull-â€“rebase"><a href="#git-pull-â€“rebase" class="headerlink" title="git pull â€“rebase"></a>git pull â€“rebase</h2><p>å¦‚æœæ‚¨åœ¨å·²ç»ä¸Šæ¸¸æ›´æ–°çš„åˆ†æ”¯ä¸Šç¼–å†™äº†ä¸€äº›æäº¤ï¼Œé€šå¸¸git pullä¼šåˆ›å»ºä¸€ä¸ªåˆå¹¶æäº¤ã€‚åœ¨è¿™æ–¹é¢ï¼Œgit pullé»˜è®¤æƒ…å†µä¸‹çš„è¡Œä¸ºç›¸å½“äºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git fetch origin</div><div class="line">git merge origin/master</div></pre></td></tr></table></figure></p>
<p>è¿˜æœ‰å¦ä¸€ç§é€‰æ‹©ï¼Œä¸”å®ƒé€šå¸¸æ›´æœ‰ç”¨ï¼Œèƒ½å¤Ÿå¸¦æ¥æ›´æ¸…æ™°çš„å†å²ï¼šgit pull â€“rebaseã€‚ä¸åˆå¹¶æ–¹æ³•ä¸åŒï¼Œè¿™ç›¸å½“äºä»¥ä¸‹å†…å®¹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git fetch origin</div><div class="line">git rebase origin/master</div></pre></td></tr></table></figure></p>
<p>mergeæ–¹æ³•æ›´ç®€å•ï¼Œæ›´å®¹æ˜“ç†è§£ï¼Œä½†å¦‚æœæ‚¨äº†è§£å¦‚ä½•ä½¿ç”¨git rebaseï¼Œåˆ™rebaseæ–¹æ³•å‡ ä¹æ€»æ˜¯æ‚¨æƒ³è¦åšçš„ã€‚å¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºé»˜è®¤è¡Œä¸ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git config --global pull.rebase true</div></pre></td></tr></table></figure></p>
<p>å½“ä½ è¿™æ ·åšæ—¶ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼Œä½ æ­£åœ¨åº”ç”¨æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚è®¨è®ºçš„ç¨‹åºâ€¦â€¦æ‰€ä»¥è®©æˆ‘ä»¬è§£é‡Šä¸€ä¸‹æ•…æ„è¿™æ ·åšçš„æ„ä¹‰ã€‚</p>
<h2 id="ä½¿ç”¨git-rebaseæ¥â€¦-rebase"><a href="#ä½¿ç”¨git-rebaseæ¥â€¦-rebase" class="headerlink" title="ä½¿ç”¨git rebaseæ¥â€¦ rebase"></a>ä½¿ç”¨git rebaseæ¥â€¦ rebase</h2><p>å‡è®¾æ‚¨æœ‰ä»¥ä¸‹åˆ†æ”¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">A  -  B  -  C  -  D  - &gt;master</div><div class="line">   \  -  E  -  F  - &gt; feature-1</div><div class="line">      \  -  G  - &gt;feature-2</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹å‡ºï¼šfeature-2ä¸ä¾èµ–äºfeature-1ä¸­çš„ä»»ä½•æ›´æ”¹ï¼Œå³åœ¨æäº¤Eä¸Šï¼Œå› æ­¤æ‚¨å¯ä»¥å°†å…¶åŸºäºmasterã€‚å› æ­¤ä¿®å¤ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git rebase --onto master feature-1 feature-2</div></pre></td></tr></table></figure></p>
<p>éäº¤äº’å¼rebaseå¯¹æ‰€æœ‰æ¶‰åŠçš„æäº¤ï¼ˆâ€œpickâ€ï¼‰æ‰§è¡Œé»˜è®¤æ“ä½œï¼Œå®ƒåªæ˜¯é‡æ”¾feature-2ä¸­ä¸åœ¨masteråŸºç¡€ä¸Šçš„feature-1ä¸­çš„æäº¤ã€‚æ‚¨çš„å†å²ç°åœ¨çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">A  -  B  -  C  -  D  - &gt;master</div><div class="line">   | \  -  G  - &gt;feature-2</div><div class="line">   \  -  E  -  F  - &gt; feature-1</div></pre></td></tr></table></figure>
<h2 id="è§£å†³å†²çª"><a href="#è§£å†³å†²çª" class="headerlink" title="è§£å†³å†²çª"></a>è§£å†³å†²çª</h2><p>æœ‰å…³è§£å†³åˆå¹¶å†²çªçš„è¯¦ç»†ä¿¡æ¯è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ - è¯·ç•™æ„æœªæ¥çš„å…¶ä»–æŒ‡å—ã€‚å‡è®¾æ‚¨ç†Ÿæ‚‰ä¸€èˆ¬è§£å†³å†²çªï¼Œä»¥ä¸‹æ˜¯é€‚ç”¨äºå˜åŸºçš„ç»†èŠ‚ã€‚</p>
<p>æœ‰æ—¶ä½ åœ¨åšä¸€ä¸ªrebaseæ—¶ä¼šé‡åˆ°åˆå¹¶å†²çªï¼Œä½ å¯ä»¥åƒä»»ä½•å…¶ä»–åˆå¹¶å†²çªä¸€æ ·å¤„ç†å®ƒã€‚Gitå°†åœ¨å—å½±å“çš„æ–‡ä»¶ä¸­è®¾ç½®å†²çªæ ‡è®°ï¼Œ<code>git status</code>å‘æ‚¨æ˜¾ç¤ºéœ€è¦è§£å†³çš„å†…å®¹ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨<code>git add</code>æˆ–<code>git rm</code>æ ‡è®°å·²è§£æçš„æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œåœ¨<code>git rebaseçš„ä¸Šä¸‹æ–‡ä¸­</code>ï¼Œæ‚¨åº”è¯¥æ³¨æ„ä¸¤ä¸ªé€‰é¡¹ã€‚</p>
<p>ç¬¬ä¸€ä¸ªæ˜¯å¦‚ä½•å®Œæˆå†²çªè§£å†³ï¼Œä½¿ç”¨<code>git rebase --continue</code>ã€‚ä½†æ˜¯ï¼Œè¿˜æœ‰å¦ä¸€ç§é€‰æ‹©ï¼š<code>git rebase --skip</code>ã€‚è¿™å°†è·³è¿‡æ‚¨æ­£åœ¨å¤„ç†çš„æäº¤ï¼Œå¹¶ä¸”å®ƒä¸ä¼šåŒ…å«åœ¨rebaseä¸­ã€‚è¿™åœ¨æ‰§è¡Œéäº¤äº’å¼rebaseæ—¶æœ€å¸¸è§ï¼Œå½“gitæ²¡æœ‰æ„è¯†åˆ°å®ƒä»â€œå…¶ä»–â€åˆ†æ”¯ä¸­æå–çš„æäº¤æ˜¯å®ƒåœ¨â€œæˆ‘çš„â€åˆ†æ”¯ä¸Šä¸ä¹‹å†²çªçš„æäº¤çš„æ›´æ–°ç‰ˆæœ¬ã€‚ </p>
<h2 id="æ•‘å‘½ï¼æˆ‘æ‰“ç ´äº†å®ƒï¼"><a href="#æ•‘å‘½ï¼æˆ‘æ‰“ç ´äº†å®ƒï¼" class="headerlink" title="æ•‘å‘½ï¼æˆ‘æ‰“ç ´äº†å®ƒï¼"></a>æ•‘å‘½ï¼æˆ‘æ‰“ç ´äº†å®ƒï¼</h2><p>æ¯«æ— ç–‘é—® - æœ‰æ—¶å€™å˜åŸºå¾ˆéš¾ã€‚å¦‚æœä½ çŠ¯äº†ä¸€ä¸ªé”™è¯¯å¹¶ä¸”è¿™æ ·åšäº†ä½ éœ€è¦çš„é—å¤±ï¼Œé‚£ä¹ˆ<code>git reflog</code>å¯ä»¥æŒ½æ•‘ä½ ã€‚è¿è¡Œæ­¤å‘½ä»¤å°†æ˜¾ç¤ºæ›´æ”¹refæˆ–å¼•ç”¨çš„æ¯ä¸ªæ“ä½œ- å³åˆ†æ”¯å’Œæ ‡è®°ã€‚æ¯è¡Œæ˜¾ç¤ºæ—§å‚è€ƒçš„æŒ‡å‘ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>git cherry-pick</code>ï¼Œ<code>git checkout</code>ï¼Œ<code>git show</code>ï¼Œæˆ–ä½¿ç”¨ä»»ä½•å…¶ä»–æ“ä½œã€‚</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://git-rebase.io/" target="_blank" rel="external">git rebase in depth</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ ¹æ®æˆ‘ä»¬çš„éœ€è¦æ”¹å˜å†å²è®°å½•æ˜¯Gitçš„ä¸€é¡¹æ ¸å¿ƒåŠŸèƒ½ï¼Œè¿™é¡¹åŠŸèƒ½ä¸ºæˆ‘ä»¬å¾ˆå¤šå¼ºå¤§çš„å·¥å…·ï¼ŒåŒæ—¶å…è®¸æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨é‡æ„æ¥å®è·µè½¯ä»¶è®¾è®¡åŸåˆ™ã€‚è¿™äº›å·¥å…·å¯¹æ–°æ‰‹ç”šè‡³ä¸­çº§gitç”¨æˆ·æ¥è¯´å¯èƒ½æœ‰ç‚¹å“äººï¼Œä½†æœ¬æ–‡å°†ä¸ºä½ æ­å¼€&lt;code&gt;git-rebase&lt;/code&gt;çš„ç¥ç§˜é¢çº±ã€‚&lt;/p&gt;
&lt;blockqu
    
    </summary>
    
      <category term="tools" scheme="http://blog.yinwoods.work/categories/tools/"/>
    
    
      <category term="git" scheme="http://blog.yinwoods.work/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>Goå®ç°ä¸€ä¸ªè¯»å†™é”</title>
    <link href="http://blog.yinwoods.work/2019/05/19/Go%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%AF%BB%E5%86%99%E9%94%81/"/>
    <id>http://blog.yinwoods.work/2019/05/19/Goå®ç°ä¸€ä¸ªè¯»å†™é”/</id>
    <published>2019-05-19T05:16:00.000Z</published>
    <updated>2019-05-19T05:25:20.278Z</updated>
    
    <content type="html"><![CDATA[<p>å½“å¤„ç†å¹¶å‘æ—¶ï¼Œé”æ˜¯æœ€å¸¸ç”¨çš„ç¼–ç¨‹è¯­è¨€å·¥å…·ï¼Œå¯¹äºå¤§å¤šæ•°åº”ç”¨è€Œè¨€ï¼Œä»…åœ¨ä½¿ç”¨æ•°æ®æ—¶åŠ é”ï¼Œä½¿ç”¨åé‡Šæ”¾å³å¯ã€‚ç„¶è€Œï¼Œå¯¹äºä¸€äº›å¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜çš„å¹¶å‘å®ç°ï¼Œé”çš„ä½¿ç”¨æ–¹å¼éœ€è¦ä½œå‡ºå¯¹åº”çš„ä¼˜åŒ–ã€‚ä¾‹å¦‚é”çš„ <em>ç²’åº¦</em> ç»å¸¸ç”¨äºç¡®ä¿çº¿ç¨‹åœ¨å°½å¯èƒ½çŸ­çš„æ—¶é—´å†…ç‹¬å ã€‚</p>
<p>æ­¤å¤–ï¼Œä½¿ç”¨é”æ—¶ä¸€ä¸ªå¸¸ç”¨ä¼˜åŒ–æ–¹æ³•æ˜¯ä½¿ç”¨ <em>è¯»å†™é”</em> ï¼Œæœ¬æ–‡å³æ¢è®¨è¯»å†™é”çš„åŸç†å¹¶ç»™å‡ºç›¸å…³å®ç°ã€‚æ‰€æœ‰çš„ä»£ç éƒ½å¯ä»¥é€šè¿‡ <a href="https://github.com/eliben/code-for-blog/tree/master/2019/rwlocks" target="_blank" rel="external">on GitHub</a>è®¿é—®ã€‚åŒæ—¶ï¼Œæ–‡ç« çš„ç»“å°¾ç»™å‡ºäº†æ€§èƒ½æµ‹è¯•ç›¸å…³çš„æ–¹æ³•ã€‚</p>
<p>æœ¬æ–‡çš„æ’°å†™ç›®çš„æ˜¯ä¸ºäº†ç ”ç©¶æ¢è®¨è¯»å†™é”ï¼Œå¦‚æœéœ€è¦åœ¨ä»£ç ä¸­ä½¿ç”¨è¯»å†™é”ï¼ŒGoè¯­è¨€æœ¬èº«å·²ç»å†…ç½®äº†ä¸€ä¸ªé«˜æ€§èƒ½çš„è¯»å†™é”ï¼š<code>sync.RWMutex</code>ã€‚å®é™…ä¸Šï¼Œæœ¬æ–‡ä¹Ÿå°†æ¢ç´¢å®ƒçš„å®ç°ã€‚</p>
<p><img src="https://eli.thegreenplace.net/images/2019/rwlock.png" alt=""></p>
<h2 id="è¯»å†™é”äº§ç”Ÿçš„åŠ¨å› "><a href="#è¯»å†™é”äº§ç”Ÿçš„åŠ¨å› " class="headerlink" title="è¯»å†™é”äº§ç”Ÿçš„åŠ¨å› "></a>è¯»å†™é”äº§ç”Ÿçš„åŠ¨å› </h2><p>è¯»å†™é”äº§ç”Ÿçš„åŠ¨å› æ˜¯ä¸ºäº†åœ¨æ— çº¿ç¨‹å†™æ•°æ®çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹èƒ½å¤Ÿå¹¶å‘åœ°å…±äº«è¯¥æ•°æ®ã€‚æ™®é€šé”å¹¶ä¸ä¼šåŒºåˆ†è¯»çº¿ç¨‹æˆ–è€…å†™çº¿ç¨‹ï¼Œå› æ­¤å½“å¤šä¸ªçº¿ç¨‹éœ€è¦è¯»å–æ•°æ®æ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¿…é¡»å…ˆè¦å¯¹è¯¥æ•°æ®ä¸Šé”ï¼Œæµªè´¹äº†å¤§é‡èµ„æºã€‚</p>
<p>è¯»å†™é”ç›¸å¯¹äºæ™®é€šé”çš„å•ä¸ª <em>lock</em> æ–¹æ³•ï¼Œå®ƒæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªç”¨äºè¯»è€…ã€ä¸€ä¸ªç”¨äºå†™è€…ã€‚åªè¦å†™è€…æ²¡æœ‰æŒæœ‰é”ï¼Œå¤šä¸ªè¯»è€…å³å¯å…±äº«æ•°æ®ã€‚</p>
<h2 id="ç®€å•å®ç°"><a href="#ç®€å•å®ç°" class="headerlink" title="ç®€å•å®ç°"></a>ç®€å•å®ç°</h2><p>ä¸‹é¢å®ç°ä¸€ä¸ªç®€å•çš„è¯»å†™é”ï¼Œä½¿ç”¨counterè®°å½•è¯»è€…æ•°é‡ã€‚æœ¬æ–‡æ¥ä¸‹æ¥çš„æ‰€æœ‰è¯»å†™é”å®ç°éƒ½ä¼šå®ç°è¯¥æ¥å£ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> RWLocker <span class="keyword">interface</span> &#123;</div><div class="line">    RLock()    <span class="comment">// è¯»è€…è·å–é”</span></div><div class="line">    RUnlock()  <span class="comment">// è¯»è€…é‡Šæ”¾é”</span></div><div class="line">    WLock()    <span class="comment">// å†™è€…è·å–é”</span></div><div class="line">    WUnlock()  <span class="comment">// å†™è€…é‡Šæ”¾é”</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯¹åº”é”çš„ç»“æ„ä¸ºï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> ReaderCountRWLock <span class="keyword">struct</span> &#123;</div><div class="line">    m           sync.Mutex</div><div class="line">    readerCount <span class="keyword">int</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>counterç”¨äºè®°å½•æŒæœ‰é”çš„è¯»è€…æ•°é‡ï¼Œè¯»è€…è·å–é”ã€é‡Šæ”¾é”çš„é€»è¾‘æ¯”è¾ƒç®€å•ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *ReaderCountRWLock)</span> <span class="title">RLock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.m.Lock()</div><div class="line">    l.readerCount++</div><div class="line">    l.m.Unlock()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *ReaderCountRWLock)</span> <span class="title">RUnlock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.m.Lock()</div><div class="line">    l.readerCount--</div><div class="line">    l.m.Unlock()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å†™è€…è·å–é”ä¸é‡Šæ”¾é”çš„å®ç°åˆ™å¤æ‚ä¸€äº›ï¼Œå†™è€…åœ¨è·å–é”æ—¶å¿…é¡»ç­‰å¾…æŒæœ‰é”çš„è¯»è€…å…¨éƒ¨é‡Šæ”¾é”ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *ReaderCountRWLock)</span> <span class="title">WLock</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">for</span> &#123;</div><div class="line">        l.m.Lock()</div><div class="line">        <span class="keyword">if</span> l.readerCount &gt; <span class="number">0</span> &#123;</div><div class="line">            l.m.Unlock()</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">break</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å†™è€…å¯¹mutexä¸Šé”ï¼ŒåŒæ—¶æ£€æŸ¥æ˜¯å¦å­˜åœ¨è¯»è€…æŒæœ‰é”ï¼Œå¦‚æœå­˜åœ¨ï¼Œå†™è€…é‡Šæ”¾mutexxå¹¶å†æ¬¡å°è¯•ï¼Œè¿™ä¹Ÿå« <em>è‡ªæ—‹</em> ã€‚å¦‚æœæ²¡æœ‰æŒæœ‰é”çš„è¯»è€…ï¼ŒWLockå°†ä¼šç»“æŸï¼ŒåŒæ—¶ä¸é‡Šæ”¾é”ï¼Œä»è€Œè¯»è€…å°†æ— æ³•å†æŒæœ‰é”ï¼Œå†™è€…é‡Šæ”¾é”çš„é€»è¾‘åˆ™æ¯”è¾ƒç›´è§‚ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *ReaderCountRWLock)</span> <span class="title">WUnlock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.m.Unlock()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·çš„å®ç°æ–¹æ³•æ˜¯æˆ‘ç›®å‰èƒ½å¤Ÿæƒ³åˆ°çš„æœ€ç®€å•çš„æ–¹æ³•ï¼Œå®ƒçš„æ€§èƒ½æœ‰å¾…ä¼˜åŒ–ï¼Œä¾‹å¦‚ï¼šå½“è¯»è€…æŒæœ‰é”æ—¶ï¼Œå†™è€…è·å–é”çš„å®ç°ä¼šæŒç»­è‡ªæ—‹ï¼Œä¸æ–­çš„è·å–é”ä¸é‡Šæ”¾é”è¿™ä¸€è¿‡ç¨‹å¯¹CPUçš„è®¡ç®—èƒ½åŠ›æ¥è¯´æ˜¯ä¸€ç§é¢å¤–çš„æ¶ˆè€—ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿä½¿å†™è€…æ›´é«˜æ•ˆåœ°ç­‰å¾…ï¼Œé‚£è¯»å†™é”çš„æ€§èƒ½ä¹Ÿå°†è·å¾—æå‡ã€‚</p>
<h2 id="ä½¿ç”¨æ¡ä»¶å˜é‡å®ç°é«˜æ•ˆç­‰å¾…"><a href="#ä½¿ç”¨æ¡ä»¶å˜é‡å®ç°é«˜æ•ˆç­‰å¾…" class="headerlink" title="ä½¿ç”¨æ¡ä»¶å˜é‡å®ç°é«˜æ•ˆç­‰å¾…"></a>ä½¿ç”¨æ¡ä»¶å˜é‡å®ç°é«˜æ•ˆç­‰å¾…</h2><p>æ¡ä»¶å˜é‡çš„æ¨¡å¼æ˜¯â€œè·å–mutexï¼Œæ£€æŸ¥ï¼Œå¦‚æœæœªå‡†å¤‡å¥½åˆ™é‡Šæ”¾mutexâ€ï¼Œè€Œè¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„ã€‚å› æ­¤æ”¹è¿›åçš„è¯»å†™é”å®ç°æ˜¯ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> ReaderCountCondRWLock <span class="keyword">struct</span> &#123;</div><div class="line">    readerCount <span class="keyword">int</span></div><div class="line">    c           *sync.Cond</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¦‚æœä½ åœ¨å¥½å¥‡è¯»å†™é”ä¸­çš„mutexåœ¨å“ªé‡Œï¼Œä¸ç”¨æ‹…å¿ƒï¼ŒGoä¸­ï¼Œ<code>sync.Cond</code> å†…åµŒä¸€ä¸ªmutexï¼Œè¿™ä¸ªç»“æ„ä½“éœ€è¦ä¸€ä¸ªæ„é€ å‡½æ•°ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewReaderCountCondRWLock</span><span class="params">()</span> *<span class="title">ReaderCountCondRWLock</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> &amp;ReaderCountCondRWLock&#123;<span class="number">0</span>, sync.NewCond(<span class="built_in">new</span>(sync.Mutex))&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¸‹é¢æ˜¯è¯»è€…è·å–é”ã€é‡Šæ”¾é”çš„ç›¸å…³å®ç°ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *ReaderCountCondRWLock)</span> <span class="title">RLock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.c.L.Lock()</div><div class="line">    l.readerCount++</div><div class="line">    l.c.L.Unlock()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *ReaderCountCondRWLock)</span> <span class="title">RUnlock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.c.L.Lock()</div><div class="line">    l.readerCount--</div><div class="line">    <span class="keyword">if</span> l.readerCount == <span class="number">0</span> &#123;</div><div class="line">        l.c.Signal()</div><div class="line">    &#125;</div><div class="line">    l.c.L.Unlock()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¸ä¸Šä¸€ç‰ˆè¯»å†™é”å®ç°çš„åŒºåˆ«ä»…åœ¨äºè¿™é‡Œåœ¨æœ€åä¸€ä¸ªè¯»è€…é‡Šæ”¾é”çš„æ—¶å€™ä¼šåœ¨æ¡ä»¶å˜é‡ä¸Šå‘å‡ºä¿¡å·ã€‚å†™è€…è·å–é”çš„å®ç°æ–¹å¼ä¸ºï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *ReaderCountCondRWLock)</span> <span class="title">WLock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.c.L.Lock()</div><div class="line">    <span class="keyword">for</span> l.readerCount &gt; <span class="number">0</span> &#123;</div><div class="line">        l.c.Wait()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œçš„Waitè¿‡ç¨‹ä»ç„¶å¤„äºå¾ªç¯ä¸­ï¼Œå› ä¸ºææœ‰å¯èƒ½åœ¨è¯»è€…å‘å‡ºä¿¡å·ä¹‹åã€å†™è€…è·å–é”ä¹‹å‰ï¼Œå¦ä¸€ä¸ªè¯»è€…å…ˆæ‹¿åˆ°é”ã€‚</p>
<p>å†™è€…é‡Šæ”¾é”çš„è¿‡ç¨‹ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *ReaderCountCondRWLock)</span> <span class="title">WUnlock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.c.Signal()</div><div class="line">    l.c.L.Unlock()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä½ èƒ½ç†è§£Signalä¸ºä»€ä¹ˆæ˜¯éœ€è¦çš„å—ï¼Ÿç¼ºå°‘å®ƒï¼Œåœ¨ç‰¹å®šæƒ…å†µä¸‹å°†ä¼šå¯¼è‡´æ­»é”ï¼šå¦‚æœä¸¤ä¸ªå†™è€…éƒ½åœ¨ç­‰å¾…æ¡ä»¶å˜é‡ï¼Œåœ¨å…¶ä¸­ä¸€ä¸ªè·å–é”åï¼Œå¦ä¸€ä¸ªå°†ä¼šç»§ç»­ç­‰å¾…ï¼Œåœ¨ç¼ºå°‘åç»­è¯»è€…å‘é€ä¿¡å·çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå†™è€…å°†ä¼šæ°¸ä¹…ç­‰å¾…ï¼Œå› æ­¤æœ‰å¿…è¦åœ¨å†™ç€é‡Šæ”¾é”çš„æ—¶å€™å‘å‡ºä¿¡å·ã€‚</p>
<p>è¿™ä¸€å®ç°æ¯”ä¸Šä¸€ç‰ˆçš„è§†çº¿æ›´ä¸ºé«˜æ•ˆï¼Œå› ä¸ºé¿å…äº†è‡ªæ—‹çš„è¿‡ç¨‹ï¼Œå°½ç®¡è¿™é‡Œä»ç„¶åˆä¸€ä¸ªå¾ªç¯ï¼Œä½†å®ƒä¼šåœ¨Waitæ‰§è¡Œæ—¶é˜»å¡ï¼Œä»…å½“ç«äº‰æ—¶æ‰ä¼šå†æ¬¡æ‰§è¡Œå¾ªç¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæåˆ°çš„â€œæ›´é«˜æ•ˆâ€å¹¶æ²¡æœ‰ç›¸åº”çš„æ•°æ®æ”¯æ’‘ï¼Œå› ä¸ºå¯¹ä¸Šè¿°ä»£ç æ‰§è¡Œæ€§èƒ½æµ‹è¯•è¿‡äºå¤æ‚ï¼Œä¸”æ€§èƒ½ä¼šéšç€æµ‹è¯•æ ·ä¾‹çš„å˜åŒ–è€Œå˜åŒ–ã€‚åæ–‡å°†ä¼šé’ˆå¯¹æ€§èƒ½æµ‹è¯•ç»™å‡ºè¯´æ˜ã€‚</p>
<h2 id="Counted-ä¿¡å·é‡"><a href="#Counted-ä¿¡å·é‡" class="headerlink" title="Counted ä¿¡å·é‡"></a>Counted ä¿¡å·é‡</h2><p>å¦ä¸€ç§å®ç°è¯»å†™é”çš„ä¼˜é›…æ–¹å¼æ—¶é€šè¿‡ <em>counting ä¿¡å·é‡</em> å®ç°ã€‚åœ¨Goä¸­ï¼Œ<code>golang.org/x/sync/semaphore</code>åŒ…æä¾›äº†ç›¸å…³çš„å®ç°ã€‚æ„é€ æ–¹æ³•ä¸è¯»è€…è·å–é”ã€é‡Šæ”¾é”çš„å®ç°å¦‚ä¸‹ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> maxWeight <span class="keyword">int64</span> = <span class="number">1</span> &lt;&lt; <span class="number">30</span></div><div class="line"></div><div class="line"><span class="keyword">type</span> SemaRWLock <span class="keyword">struct</span> &#123;</div><div class="line">    s *semaphore.Weighted</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// NewSemaRWLock creates a new SemaRWLock.</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSemaRWLock</span><span class="params">()</span> *<span class="title">SemaRWLock</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> &amp;SemaRWLock&#123;semaphore.NewWeighted(maxWeight)&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *SemaRWLock)</span> <span class="title">RLock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.s.Acquire(context.Background(), <span class="number">1</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *SemaRWLock)</span> <span class="title">RUnlock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.s.Release(<span class="number">1</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å†™è€…ä»…ä»…æ˜¯è·å–æ•´ä¸ªmaxWeight, ä»è€Œä¿è¯ä»…æœ‰ä¸€ä¸ªå†™é”èƒ½å¤Ÿè·å–ä¿¡å·é‡ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *SemaRWLock)</span> <span class="title">WLock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.s.Acquire(context.Background(), maxWeight)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *SemaRWLock)</span> <span class="title">WUnlock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.s.Release(maxWeight)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ç§å®ç°æ–¹å¼éå¸¸ç®€æ´ï¼Œåœ¨å®é™…æµ‹è¯•æ—¶ï¼Œå¯èƒ½æ˜¯å› ä¸º semaphore.Weighted ä¸é€‚åˆç‰¹å®šçš„æµ‹è¯•æ ·ä¾‹ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ€§èƒ½ç”šè‡³è¿˜æ²¡æœ‰ç¬¬ä¸€ç‰ˆå®ç°çš„æ€§èƒ½å¥½ã€‚</p>
<h2 id="è¯»è€…ä¼˜å…ˆ-vs-å†™è€…ä¼˜å…ˆ"><a href="#è¯»è€…ä¼˜å…ˆ-vs-å†™è€…ä¼˜å…ˆ" class="headerlink" title="è¯»è€…ä¼˜å…ˆ vs. å†™è€…ä¼˜å…ˆ"></a>è¯»è€…ä¼˜å…ˆ vs. å†™è€…ä¼˜å…ˆ</h2><p>ä¸Šè¿°çš„ä¸‰ç§å®ç°éƒ½å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå½“è¯»è€…æ•°é‡å¾ˆå¤§æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†™è€…é¥¥é¥¿ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€ç‰ˆå®ç°ä¸­ readerCount ä¸º0æ—¶ï¼Œå†™è€…æ‰èƒ½å¤Ÿè·å–é”ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªæ´»è·ƒçš„è¯»è€…ä»¥åŠä¸€ä¸ªç­‰å¾…çš„å†™è€…ï¼Œåœ¨å†™è€…ç­‰å¾…ä¸€ä¸ªè¯»è€…é‡Šæ”¾é”çš„è¿‡ç¨‹ä¸­ï¼Œå¦ä¸€ä¸ªè¯»è€…å¯èƒ½åˆä¼šè·å–é”</p>
<p>è¿™ä¹Ÿè¢«å«åš <em>è¯»è€…ä¼˜å…ˆ</em>, æˆ–è€… <em>å†™è€…é¥¥é¥¿</em> ã€‚ä¸‹é¢æˆ‘ä»¬å°†å®ç°å†™è€…ä¼˜å…ˆçš„ç›¸å…³é€»è¾‘ã€‚</p>
<h2 id="ç®€å•çš„å†™è€…ä¼˜å…ˆè¯»å†™é”"><a href="#ç®€å•çš„å†™è€…ä¼˜å…ˆè¯»å†™é”" class="headerlink" title="ç®€å•çš„å†™è€…ä¼˜å…ˆè¯»å†™é”"></a>ç®€å•çš„å†™è€…ä¼˜å…ˆè¯»å†™é”</h2><p>å®ç°æºäº <a href="https://en.wikipedia.org/wiki/Readers%E2%80%93writer_lock" target="_blank" rel="external">Wikipedia</a>ã€‚é¦–å…ˆï¼Œæ•°æ®ç»“æ„ä¸æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> WritePreferRWLock <span class="keyword">struct</span> &#123;</div><div class="line">    readerCount <span class="keyword">int</span></div><div class="line">    hasWriter   <span class="keyword">bool</span></div><div class="line">    c           *sync.Cond</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewWritePreferRWLock</span><span class="params">()</span> *<span class="title">WritePreferRWLock</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> &amp;WritePreferRWLock&#123;<span class="number">0</span>, <span class="literal">false</span>, sync.NewCond(<span class="built_in">new</span>(sync.Mutex))&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œçš„ readerCount ä»ç„¶æŒ‡ä»£æŒæœ‰é”çš„è¯»è€…æ•°é‡, ä½†æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæ–°çš„å­—æ®µ - hasWriter; å½“æœ‰å†™è€…ç­‰å¾…è·å–é”çš„æ—¶å€™ï¼Œå®ƒçš„å€¼ä¸ºtrueã€‚è¯»è€…è·å–é”ä¸é‡Šæ”¾é”çš„é€»è¾‘å¦‚ä¸‹ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *WritePreferRWLock)</span> <span class="title">RLock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.c.L.Lock()</div><div class="line">    <span class="keyword">for</span> l.hasWriter &#123;</div><div class="line">        l.c.Wait()</div><div class="line">    &#125;</div><div class="line">    l.readerCount++</div><div class="line">    l.c.L.Unlock()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *WritePreferRWLock)</span> <span class="title">RUnlock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.c.L.Lock()</div><div class="line">    l.readerCount--</div><div class="line">    <span class="keyword">if</span> l.readerCount == <span class="number">0</span> &#123;</div><div class="line">        l.c.Signal()</div><div class="line">    &#125;</div><div class="line">    l.c.L.Unlock()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å½“è¯»è€…å°è¯•è·å–é”æ—¶ï¼Œä¼šé¦–å…ˆæ£€æŸ¥æ˜¯å¦æœ‰å†™è€…ç­‰å¾…è·å–é”ï¼Œå¦‚æœæœ‰çš„è¯å°†ä¼šè®©å‡ºè·å–é”çš„æƒé™ï¼Œä¿è¯å†™è€…å…ˆè·å–é”ã€‚</p>
<p>åœ¨ç¼©æ”¾é”çš„æ—¶å€™ï¼Œæœ€åä¸€ä¸ªè¯»è€…ä¼šå‘å‡ºä¿¡å·ï¼Œè§¦å‘åœ¨ç­‰å¾…çš„çº¿ç¨‹æ‰§è¡Œã€‚</p>
<p>å†™è€…è·å–é”ã€é‡Šæ”¾é”çš„ç›¸å…³å®ç°ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *WritePreferRWLock)</span> <span class="title">WLock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.c.L.Lock()</div><div class="line">    <span class="keyword">for</span> l.hasWriter &#123;</div><div class="line">        l.c.Wait()</div><div class="line">    &#125;</div><div class="line">    l.hasWriter = <span class="literal">true</span></div><div class="line">    <span class="keyword">for</span> l.readerCount &gt; <span class="number">0</span> &#123;</div><div class="line">        l.c.Wait()</div><div class="line">    &#125;</div><div class="line">    l.c.L.Unlock()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *WritePreferRWLock)</span> <span class="title">WUnlock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.c.L.Lock()</div><div class="line">    l.hasWriter = <span class="literal">false</span></div><div class="line">    l.c.Broadcast()</div><div class="line">    l.c.L.Unlock()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å†™è€…å°†ä¼šé¦–å…ˆæ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–å†™è€…åœ¨ç­‰å¾…ï¼Œä¸åŒäºä¹‹å‰çš„å®ç°ï¼Œè¿™é‡Œå†™è€…åœ¨WLockä¸WUnlockä¹‹é—´ä¸å†æŒæœ‰mutexï¼Œå–è€Œä»£ä¹‹ï¼Œmutexä»…ç”¨äºæ§åˆ¶å…±äº«ç»“æ„çš„è®¿é—®ï¼ŒhasWriter å­—æ®µä¸ä»…è¡¨ç¤ºæœ‰å†™è€…åœ¨ç­‰å¾…é”ï¼Œä¹Ÿè¡¨ç¤ºå†™è€…æ­£åœ¨ä½¿ç”¨é”ï¼Œå½“hashWriterä¸ºtrueæ—¶ï¼Œä¸å†æœ‰æ–°çš„è¯»è€…èƒ½å¤Ÿè·å–åˆ°é”ã€‚</p>
<p>åœ¨ WUnlock ä¸­, å†™è€…å°† hasWriter ç½®ä¸º falseï¼ŒåŒæ—¶å¹¿æ’­ä¿¡å·ã€‚è¿™é‡Œä½¿ç”¨Broadcastè€Œä¸æ˜¯Signalæ˜¯å› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªè¯»è€…ç­‰å¾…ï¼Œè€Œæˆ‘ä»¬æœŸæœ›å”¤é†’æ‰€æœ‰ç­‰å¾…çš„è¯»è€…ã€‚</p>
<h2 id="æ›´é«˜æ•ˆçš„å†™è€…ä¼˜å…ˆè¯»å†™é”å®ç°"><a href="#æ›´é«˜æ•ˆçš„å†™è€…ä¼˜å…ˆè¯»å†™é”å®ç°" class="headerlink" title="æ›´é«˜æ•ˆçš„å†™è€…ä¼˜å…ˆè¯»å†™é”å®ç°"></a>æ›´é«˜æ•ˆçš„å†™è€…ä¼˜å…ˆè¯»å†™é”å®ç°</h2><p>ä¸Šè¿°çš„å®ç°éƒ½æ¯”è¾ƒç®€æ´ï¼Œä½†æ€§èƒ½è¡¨ç°å´ä¸å¤Ÿå¥½ã€‚å› æ­¤ï¼Œè¿™é‡Œæˆ‘ä»¬ç ”ç©¶ä¸‹Goè‡ªèº«è¯»å†™é”çš„å®ç°ã€‚</p>
<p>å®ç°çš„æ€»ä½“ç›®æ ‡æ˜¯ä½¿è¯»è€…èƒ½å¤Ÿå°½å¿«è·å–é”ï¼ŒåŒæ—¶è¦ä¿è¯å†™ä¼˜å…ˆã€‚</p>
<p>é¦–å…ˆæ˜¯ç»“æ„ä½“ä¸æ„é€ æ–¹æ³•çš„å®ç°ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> WritePreferFastRWLock <span class="keyword">struct</span> &#123;</div><div class="line">    w sync.Mutex</div><div class="line">    writerWait <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</div><div class="line">    readerWait <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</div><div class="line">    numPending <span class="keyword">int32</span>         <span class="comment">// å°è¯•æŒæœ‰é”æˆ–å·²ç»æŒæœ‰é”çš„è¯»è€…æ•°é‡ </span></div><div class="line">    readersDeparting <span class="keyword">int32</span>   <span class="comment">// åœ¨å†™è€…æŒæœ‰é”ä¹‹å‰è·å–é”çš„è¯»è€…æ•°é‡ï¼ˆè¯»è€…é‡Šæ”¾é”ï¼Œä¹Ÿä¼šéšä¹‹å‡1ï¼‰</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> maxReaders <span class="keyword">int32</span> = <span class="number">1</span> &lt;&lt; <span class="number">30</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewWritePreferFastRWLock</span><span class="params">()</span> *<span class="title">WritePreferFastRWLock</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> l WritePreferFastRWLock</div><div class="line">    l.writerWait = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</div><div class="line">    l.readerWait = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</div><div class="line">    <span class="keyword">return</span> &amp;l</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>mutex wä¸ä¼šè¢«è¯»è€…æ‰€ä½¿ç”¨ï¼Œå®ƒå­˜åœ¨çš„ä½œç”¨æ˜¯ä¸ºå†™è€…æä¾›äº’æ–¥ï¼Œç¨åå†ä»‹ç»å®ƒçš„å…·ä½“ç”¨æ³•ã€‚numPendingç”¨äºè¡¨ç¤ºæœ‰å¤šå°‘ä¸ªè¯»è€…æŒæœ‰é”ï¼ˆç±»ä¼¼ä¸Šæ–‡ä¸­çš„readerCountï¼‰ï¼Œä½†å®ƒåŒæ—¶ä¹Ÿè¢«å†™è€…ä½¿ç”¨ã€‚å†™è€…å°†è¯¥å­—æ®µå‡å»maxReadersï¼Œå¦‚æœå¾—åˆ°ä¸€ä¸ªè´Ÿæ•°å°±è¡¨æ˜ä¸€ä¸ªå†™è€…æ­£åœ¨ä½¿ç”¨é”ï¼Œé€šè¿‡åŸå­æ“ä½œè®¿é—®è¯¥å­—æ®µï¼Œå› æ­¤ä¸å†éœ€è¦é”ã€‚<br>ä¸‹é¢ä»‹ç»è¯»è€…ç›¸å…³æ–¹æ³•çš„å®ç°ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *WritePreferFastRWLock)</span> <span class="title">RLock</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> atomic.AddInt32(&amp;l.numPending, <span class="number">1</span>) &lt; <span class="number">0</span> &#123;</div><div class="line">        &lt;-l.readerWait</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *WritePreferFastRWLock)</span> <span class="title">RUnlock</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> r := atomic.AddInt32(&amp;l.numPending, <span class="number">-1</span>); r &lt; <span class="number">0</span> &#123;</div><div class="line">        <span class="keyword">if</span> atomic.AddInt32(&amp;l.readersDeparting, <span class="number">-1</span>) == <span class="number">0</span> &#123;</div><div class="line">            l.writerWait &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¯»è€…è·å–é”æ—¶ä¼šå¯¹numPendingåŠ 1ï¼Œå¦‚æœnumPendingæ˜¯éè´Ÿæ•°ï¼Œè¡¨æ˜æ²¡æœ‰å†™è€…ç­‰å¾…æŒæœ‰é”æˆ–æ­£æŒæœ‰é”ï¼Œå› æ­¤è¯»è€…å¯ä»¥ç»§ç»­æ“ä½œã€‚è¯»è€…è·å–é”çš„æ–¹æ³•æ‰§è¡Œæå…¶é¢‘ç¹ï¼Œè€Œè¿™é‡Œåªæ˜¯ç”¨äº†ä¸€ä¸ªåŸå­æ“ä½œã€ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ï¼Œå› æ­¤é€Ÿåº¦æå¿«ã€‚</p>
<p>å¦‚æœnumPendingæ˜¯è´Ÿæ•°ï¼Œè¡¨æ˜å†™è€…æ­£åœ¨ç­‰å¾…è·å–é”æˆ–å·²ç»è·å–é”ï¼Œå› æ­¤è¯»è€…å°†ä¼šè®©å‡ºæƒé™ï¼Œä¿æŒç­‰å¾…ï¼Œè¿™ä¸ªæ“ä½œæ˜¯é€šè¿‡åœ¨ä¸€ä¸ªæ— ç¼“å†²channelä¸Šç­‰å¾…å®ç°çš„ã€‚</p>
<p>å½“è¯»è€…é‡Šæ”¾é”æ—¶ï¼Œå®ƒå°†numPendingå‡1ï¼Œå¦‚æœæ²¡æœ‰å†™è€…ç­‰å¾…ï¼Œæ‰§è¡Œç»“æŸï¼›å¦‚æœæœ‰å†™è€…ç­‰å¾…ï¼ŒreadersDepartingå­—æ®µç”¨äºå‘ŠçŸ¥å†™è€…ä¸€ä¸ªè¯»è€…å·²ç»é‡Šæ”¾é”ã€‚</p>
<p>å†™è€…è·å–é”ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *WritePreferFastRWLock)</span> <span class="title">WLock</span><span class="params">()</span></span> &#123;</div><div class="line">    l.w.Lock()</div><div class="line">    r := atomic.AddInt32(&amp;l.numPending, -maxReaders) + maxReaders</div><div class="line">    <span class="keyword">if</span> r != <span class="number">0</span> &amp;&amp; atomic.AddInt32(&amp;l.readersDeparting, r) != <span class="number">0</span> &#123;</div><div class="line">        &lt;-l.writerWait</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>w mutexç”¨äºä¿è¯ä»…æœ‰ä¸€ä¸ªå†™è€…åœ¨ä»»æ„æ—¶é—´å†…è·å–é”ã€‚ç¬¬äºŒè¡Œå¤æ‚ä¸€äº›ï¼Œå®ƒå®Œæˆä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li><p>é€šè¿‡æ‰§è¡ŒnumPendingå‡maxReaderså‘ŠçŸ¥è¯»è€…å­˜åœ¨ä¸€ä¸ªå†™è€…ç­‰å¾…</p>
</li>
<li><p>é€šè¿‡æ‰§è¡ŒåŠ maxReadersæ“ä½œï¼Œè·å–æœ‰å¤šå°‘ä¸ªå°è¯•æŒæœ‰é”æˆ–æŒæœ‰é”çš„è¯»è€…</p>
</li>
</ol>
<p>æ¥ä¸‹æ¥ï¼Œå¦‚æœæœ‰ä»»æ„æ•°é‡å°è¯•æŒæœ‰é”æˆ–æŒæœ‰é”çš„è¯»è€…(r != 0)ï¼Œå®ƒå°†å¯¹åº”æ•°å€¼åŠ å…¥readersDepartingä¸­ï¼Œâ€”â€”è¿™è®©è¯»è€…åœ¨è§£é™¤å†™è€…ç­‰å¾…å‰çŸ¥é“æœ‰å¤šå°‘ä¸ªå°è¯•æŒæœ‰é”æˆ–æŒæœ‰é”çš„è¯»è€…ï¼Œå½“æœ€åä¸€ä¸ªæŒæœ‰é”çš„è¯»è€…é‡Šæ”¾æ—¶ï¼Œå‡½æ•°å°†è¿”å›ï¼ˆå†™è€…æŒæœ‰é”ï¼‰ï¼Œå…¶ä»–å†™è€…å› ä¸ºwè€Œé™·å…¥ç­‰å¾…ï¼Œè€Œè¯»è€…åˆ™ç­‰å¾…numPendingå˜ä¸ºéè´Ÿæ•°æ‰èƒ½è·å–é”ã€‚</p>
<p>å†™è€…é‡Šæ”¾é”ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *WritePreferFastRWLock)</span> <span class="title">WUnlock</span><span class="params">()</span></span> &#123;</div><div class="line">    r := atomic.AddInt32(&amp;l.numPending, maxReaders)</div><div class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="keyword">int</span>(r); i++ &#123;</div><div class="line">        l.readerWait &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</div><div class="line">    &#125;</div><div class="line">    l.w.Unlock()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å†ä¸€æ¬¡ï¼Œé€šè¿‡åŠ maxReadersï¼Œå†™è€…èƒ½å¤Ÿå‘Šè¯‰æœªæ¥çš„è¯»è€…å·²ç»æ²¡æœ‰å†™è€…è¿˜å¤„äºç­‰å¾…è·å–é”çš„è¿‡ç¨‹ä¸­äº†ã€‚rè¡¨ç¤ºç­‰å¾…è·å–é”çš„è¯»è€…æ•°é‡ï¼Œå†™è€…é€šè¿‡å‘é€rä¸ªç©ºå¯¹è±¡åˆ°readerWaitä¸­å”¤é†’æ‰€æœ‰ç­‰å¾…çš„è¯»è€…ï¼Œæœ€åå¯¹wè§£é”ï¼Œç»™äºˆåç»­å†™è€…ä¸Šé”çš„æœºä¼šã€‚</p>
<p>è¿™é‡Œä¸»è¦æ˜¯readersDepartingä¸å¤ªå¥½ç†è§£ï¼Œä¸ºäº†æ›´å¥½çš„ç†è§£å®ƒï¼Œå‡è®¾æœ‰å¦‚ä¸‹æ“ä½œï¼š</p>
<ol>
<li>ä¸¤ä¸ªè¯»è€…è·å–é”ï¼ˆnumPending = 2ï¼ŒreadersDeparting = 0ï¼‰</li>
<li>ä¸€ä¸ªå†™è€…è·å–é”(numPending = 2 - MAX, readersDeparting = 2)</li>
<li>ä¸€ä¸ªè¯»è€…è·å–é”ï¼ˆnumPending = 3 - MAX, readersDeparting = 2ï¼‰</li>
</ol>
<p>å¯è§ï¼ŒreadersDepartingä¸»è¦ç”¨äºè®°å½•å†™è€…ä¸Šé”å‰å°±å·²ç»æŒæœ‰é”çš„è¯»è€…æ•°é‡ï¼Œåç»­è¿™äº›è¿™äº›è¯»è€…é‡Šæ”¾é”æ—¶ï¼ŒreadersDepartingä¹Ÿä¼šéšä¹‹å‡å°‘ï¼Œå½“å®ƒå˜ä¸º0æ—¶ï¼Œæ°å¥½è¯´æ˜å†™è€…ä¹‹å‰è·å–é”çš„æ‰€æœ‰è¯»è€…å‡å·²ç»é‡Šæ”¾é”ã€‚</p>
<h2 id="åç»­-æ€§èƒ½æµ‹è¯•æ–¹æ³•"><a href="#åç»­-æ€§èƒ½æµ‹è¯•æ–¹æ³•" class="headerlink" title="åç»­: æ€§èƒ½æµ‹è¯•æ–¹æ³•"></a>åç»­: æ€§èƒ½æµ‹è¯•æ–¹æ³•</h2><p>æ€§èƒ½æµ‹è¯•ç›¸å…³æ–¹æ³•çš„ä»£ç ä½äº<a href="https://github.com/eliben/code-for-blog/blob/master/2019/rwlocks/rwlock_test.go" target="_blank" rel="external">GitHub</a>ã€‚å®ƒçš„ç›®çš„æ˜¯æµ‹è¯•æ­£ç¡®æ€§ï¼Œå› æ­¤å®ƒæ£€æŸ¥å¤šä¸ªè¯»è€…ä¸å†™è€…æ‰§è¡Œçš„æ­£ç¡®æ€§ã€‚åœ¨æ‰§è¡Œæ€§èƒ½æµ‹è¯•æ—¶ï¼Œä¼šè®°å½•æ¯ä¸ªè¯»è€…ä¸å†™è€…è·å–é”çš„ç­‰å¾…æ—¶é—´ï¼Œæœ€åæ‰“å°å¹³å‡æ—¶é—´ã€‚</p>
<h2 id="åŸæ–‡é“¾æ¥"><a href="#åŸæ–‡é“¾æ¥" class="headerlink" title="åŸæ–‡é“¾æ¥"></a>åŸæ–‡é“¾æ¥</h2><p><a href="https://eli.thegreenplace.net/2019/implementing-reader-writer-locks/" target="_blank" rel="external">Implementing reader-writer locks</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å½“å¤„ç†å¹¶å‘æ—¶ï¼Œé”æ˜¯æœ€å¸¸ç”¨çš„ç¼–ç¨‹è¯­è¨€å·¥å…·ï¼Œå¯¹äºå¤§å¤šæ•°åº”ç”¨è€Œè¨€ï¼Œä»…åœ¨ä½¿ç”¨æ•°æ®æ—¶åŠ é”ï¼Œä½¿ç”¨åé‡Šæ”¾å³å¯ã€‚ç„¶è€Œï¼Œå¯¹äºä¸€äº›å¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜çš„å¹¶å‘å®ç°ï¼Œé”çš„ä½¿ç”¨æ–¹å¼éœ€è¦ä½œå‡ºå¯¹åº”çš„ä¼˜åŒ–ã€‚ä¾‹å¦‚é”çš„ &lt;em&gt;ç²’åº¦&lt;/em&gt; ç»å¸¸ç”¨äºç¡®ä¿çº¿ç¨‹åœ¨å°½å¯èƒ½çŸ­çš„æ—¶é—´å†…ç‹¬å ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œä½¿ç”¨é”æ—¶
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="Go è¯»å†™é”" scheme="http://blog.yinwoods.work/tags/Go-%E8%AF%BB%E5%86%99%E9%94%81/"/>
    
  </entry>
  
  <entry>
    <title>Javaä¸­çš„å˜å‹</title>
    <link href="http://blog.yinwoods.work/2019/04/28/Java%E4%B8%AD%E7%9A%84%E5%8F%98%E5%9E%8B/"/>
    <id>http://blog.yinwoods.work/2019/04/28/Javaä¸­çš„å˜å‹/</id>
    <published>2019-04-28T03:48:00.000Z</published>
    <updated>2019-05-19T05:17:38.324Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯å˜å‹"><a href="#ä»€ä¹ˆæ˜¯å˜å‹" class="headerlink" title="ä»€ä¹ˆæ˜¯å˜å‹?"></a>ä»€ä¹ˆæ˜¯å˜å‹?</h2><p>ç»´åŸºç™¾ç§‘ä¸Š<a href="https://zh.wikipedia.org/wiki/%E5%8D%8F%E5%8F%98%E4%B8%8E%E9%80%86%E5%8F%98" target="_blank" rel="external">å˜å‹</a>çš„å®šä¹‰:</p>
<blockquote>
<p><strong>å˜å‹</strong>æ˜¯åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œæè¿°å…·æœ‰çˆ¶/å­å‹åˆ«å…³ç³»çš„å¤šä¸ªå‹åˆ«é€šè¿‡å‹åˆ«æ„é€ å™¨ã€æ„é€ å‡ºçš„å¤šä¸ªå¤æ‚å‹åˆ«ä¹‹é—´æ˜¯å¦æœ‰çˆ¶/å­å‹åˆ«å…³ç³»çš„ç”¨è¯­ã€‚</p>
</blockquote>
<p>è®¸å¤š<a href="https://zh.wikipedia.org/wiki/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E8%AA%9E%E8%A8%80" title="ç¨‹åºè®¾è®¡è¯­è¨€" target="_blank" rel="external">ç¨‹åºè®¾è®¡è¯­è¨€</a>çš„<a href="https://zh.wikipedia.org/wiki/%E5%9E%8B%E5%88%A5%E7%B3%BB%E7%B5%B1" title="ç±»å‹ç³»ç»Ÿ" target="_blank" rel="external">ç±»å‹ç³»ç»Ÿ</a>æ”¯æŒ<a href="https://zh.wikipedia.org/wiki/%E5%AD%90%E5%9E%8B%E5%88%A5" title="å­ç±»å‹" target="_blank" rel="external">å­ç±»å‹</a>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ<code>Cat</code>æ˜¯<code>Animal</code>çš„å­ç±»å‹ï¼Œé‚£ä¹ˆ<code>Cat</code>ç±»å‹çš„è¡¨è¾¾å¼å¯ç”¨äºä»»ä½•å‡ºç°<code>Animal</code>ç±»å‹è¡¨è¾¾å¼çš„åœ°æ–¹ã€‚æ‰€è°“çš„<strong>å˜å‹</strong>ï¼ˆvarianceï¼‰æ˜¯æŒ‡å¦‚ä½•æ ¹æ®ç»„æˆç±»å‹ä¹‹é—´çš„å­ç±»å‹å…³ç³»ï¼Œæ¥ç¡®å®šæ›´å¤æ‚çš„ç±»å‹ä¹‹é—´ï¼ˆä¾‹å¦‚<code>Cat</code>åˆ—è¡¨ä¹‹äº<code>Animal</code>åˆ—è¡¨ï¼Œè¿”å›å€¼ä¸º<code>Cat</code>çš„å‡½æ•°ä¹‹äºè¿”å›å€¼ä¸º<code>Animal</code>çš„å‡½æ•°â€¦ç­‰ç­‰ï¼‰çš„å­ç±»å‹å…³ç³»ã€‚å½“æˆ‘ä»¬ç”¨ç±»å‹æ„é€ å‡ºæ›´å¤æ‚çš„ç±»å‹ï¼ŒåŸæœ¬ç±»å‹çš„å­ç±»å‹æ€§è´¨å¯èƒ½è¢«ä¿æŒã€åè½¬ã€æˆ–å¿½ç•¥â”€â”€â”€å–å†³äº<a href="https://zh.wikipedia.org/wiki/%E5%9E%8B%E5%88%A5%E6%A7%8B%E9%80%A0%E5%99%A8" title="ç±»å‹æ„é€ å™¨" target="_blank" rel="external">ç±»å‹æ„é€ å™¨</a>çš„å˜å‹æ€§è´¨ã€‚ä¾‹å¦‚åœ¨<a href="https://zh.wikipedia.org/wiki/C%E2%99%AF" title="Câ™¯" target="_blank" rel="external">C#</a>ä¸­ï¼š</p>
<ul>
<li><p><code>IEnumerable&lt;Cat&gt;</code>æ˜¯<code>IEnumerable&lt;Animal&gt;</code>çš„å­ç±»å‹ï¼Œå› ä¸ºç±»å‹æ„é€ å™¨<code>IEnumerable&lt;T&gt;</code>æ˜¯åå˜çš„ï¼ˆcovariantï¼‰ã€‚æ³¨æ„åˆ°å¤æ‚ç±»å‹<code>IEnumerable</code>çš„å­ç±»å‹å…³ç³»å’Œå…¶æ¥å£ä¸­çš„å‚æ•°ç±»å‹æ˜¯ä¸€è‡´çš„ï¼Œäº¦å³ï¼Œå‚æ•°ç±»å‹ä¹‹é—´çš„å­ç±»å‹å…³ç³»è¢«ä¿æŒä½äº†ã€‚</p>
</li>
<li><p><code>Action&lt;Cat&gt;</code>æ˜¯<code>Action&lt;Animal&gt;</code>çš„è¶…ç±»å‹ï¼Œå› ä¸ºç±»å‹æ„é€ å™¨<code>Action&lt;T&gt;</code>æ˜¯é€†å˜çš„ï¼ˆcontravariantï¼‰ã€‚ï¼ˆåœ¨æ­¤ï¼Œ<code>Action&lt;T&gt;</code>è¢«ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå‚æ•°ç±»å‹ä¸º<code>T</code>æˆ–<code>sub-T</code>çš„<a href="https://zh.wikipedia.org/wiki/%E4%B8%80%E7%B4%9A%E5%87%BD%E6%95%B8" title="ä¸€çº§å‡½æ•°" target="_blank" rel="external">ä¸€çº§å‡½æ•°</a>ï¼‰ã€‚æ³¨æ„åˆ°<code>T</code>çš„å­ç±»å‹å…³ç³»åœ¨å¤æ‚ç±»å‹<code>Action</code>çš„å°è£…ä¸‹æ˜¯åè½¬çš„ï¼Œä½†æ˜¯å½“å®ƒè¢«è§†ä¸ºå‡½æ•°çš„å‚æ•°æ—¶å…¶å­ç±»å‹å…³ç³»æ˜¯è¢«ä¿æŒçš„ã€‚</p>
</li>
<li><p><code>IList&lt;Cat&gt;</code>æˆ–<code>IList&lt;Animal&gt;</code>å½¼æ­¤ä¹‹é—´æ²¡æœ‰å­ç±»å‹å…³ç³»ã€‚å› ä¸º<code>IList&lt;T&gt;</code>ç±»å‹æ„é€ å™¨æ˜¯ä¸å˜çš„ï¼ˆinvariantï¼‰ï¼Œæ‰€ä»¥å‚æ•°ç±»å‹ä¹‹é—´çš„å­ç±»å‹å…³ç³»è¢«å¿½ç•¥äº†ã€‚</p>
</li>
</ul>
<p>â€œå¤æ‚å‹åˆ«â€ æŒ‡çš„æ˜¯å¦‚å®¹å™¨ã€å‡½æ•°ä¹‹ç±»çš„é«˜çº§æ•°æ®ç»“æ„ï¼Œå› æ­¤å˜å‹æè¿°çš„æ˜¯é€šè¿‡ç»§æ‰¿å…³è”çš„å®¹å™¨ã€å‡½æ•°çš„èµ‹å€¼å…¼å®¹æ€§ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†ä¸€ä¸ªè¿”å›å€¼ä¸ºcatåˆ—è¡¨çš„æ–¹æ³•è¿”å›å€¼èµ‹å€¼åˆ°animalåˆ—è¡¨å—ï¼Ÿæˆ‘ä»¬èƒ½å¤Ÿå°†Audiåˆ—è¡¨ä½œä¸ºæ¥æ”¶carsåˆ—è¡¨æ–¹æ³•çš„å‚æ•°å—ï¼Ÿ</p>
<h2 id="å››ç§å˜å‹"><a href="#å››ç§å˜å‹" class="headerlink" title="å››ç§å˜å‹"></a>å››ç§å˜å‹</h2><p>åœ¨ä¸€é—¨ç¨‹åºè®¾è®¡è¯­è¨€çš„<a href="https://zh.wikipedia.org/wiki/%E5%9E%8B%E5%88%A5%E7%B3%BB%E7%B5%B1" title="ç±»å‹ç³»ç»Ÿ" target="_blank" rel="external">ç±»å‹ç³»ç»Ÿ</a>ä¸­ï¼Œä¸€ä¸ªç±»å‹è§„åˆ™æˆ–è€…ç±»å‹æ„é€ å™¨æ˜¯ï¼š</p>
<ul>
<li><strong>åå˜</strong>ï¼ˆcovariantï¼‰ï¼Œå¦‚æœå®ƒä¿æŒäº†<a href="https://zh.wikipedia.org/wiki/%E5%AD%90%E5%9E%8B%E5%88%A5" title="å­ç±»å‹" target="_blank" rel="external">å­ç±»å‹åºå…³ç³»â‰¦</a>ã€‚è¯¥åºå…³ç³»æ˜¯ï¼šå­ç±»å‹â‰¦åŸºç±»å‹ã€‚</li>
<li><strong>é€†å˜</strong>ï¼ˆcontravariantï¼‰ï¼Œå¦‚æœå®ƒé€†è½¬äº†å­ç±»å‹åºå…³ç³»ã€‚</li>
<li><strong>ä¸å˜</strong>ï¼ˆinvariantï¼‰ï¼Œå¦‚æœä¸Šè¿°ä¸¤ç§å‡ä¸é€‚ç”¨ã€‚</li>
</ul>
<h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><p>é¦–å…ˆè€ƒè™‘æ•°ç»„ç±»å‹æ„é€ å™¨ï¼š ä»<code>Animal</code>ç±»å‹ï¼Œå¯ä»¥å¾—åˆ°<code>Animal[]</code>ï¼ˆâ€œanimalæ•°ç»„â€ï¼‰ã€‚ æ˜¯å¦å¯ä»¥æŠŠå®ƒå½“ä½œ</p>
<ul>
<li>åå˜ï¼šä¸€ä¸ª<code>Cat[]</code>ä¹Ÿæ˜¯ä¸€ä¸ª<code>Animal[]</code></li>
<li>é€†å˜ï¼šä¸€ä¸ª<code>Animal[]</code>ä¹Ÿæ˜¯ä¸€ä¸ª<code>Cat[]</code></li>
<li>ä»¥ä¸ŠäºŒè€…å‡ä¸æ˜¯ï¼ˆä¸å˜ï¼‰ï¼Ÿ</li>
</ul>
<p>å¦‚æœè¦é¿å…ç±»å‹é”™è¯¯ï¼Œä¸”æ•°ç»„æ”¯æŒå¯¹å…¶å…ƒç´ çš„è¯»ã€å†™æ“ä½œï¼Œé‚£ä¹ˆåªæœ‰ç¬¬3ä¸ªé€‰æ‹©æ˜¯å®‰å…¨çš„ã€‚<code>Animal[]</code>å¹¶ä¸æ˜¯æ€»èƒ½å½“ä½œ<code>Cat[]</code>ï¼Œå› ä¸ºå½“ä¸€ä¸ªå®¢æˆ·è¯»å–æ•°ç»„å¹¶æœŸæœ›å¾—åˆ°ä¸€ä¸ª<code>Cat</code>ï¼Œä½†<code>Animal[]</code>ä¸­åŒ…å«çš„å¯èƒ½æ˜¯ä¸ª<code>Dog</code>ã€‚æ‰€ä»¥é€†å˜è§„åˆ™æ˜¯ä¸å®‰å…¨çš„ã€‚</p>
<p>åä¹‹ï¼Œä¸€ä¸ª<code>Cat[]</code>ä¹Ÿä¸èƒ½è¢«å½“ä½œä¸€ä¸ª<code>Animal[]</code>ã€‚å› ä¸ºæ€»æ˜¯å¯ä»¥æŠŠä¸€ä¸ª<code>Dog</code>æ”¾åˆ°<code>Animal[]</code>ä¸­ã€‚åœ¨åå˜æ•°ç»„ï¼Œè¿™å°±ä¸èƒ½ä¿è¯æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºèƒŒåçš„å­˜å‚¨å¯ä»¥å®é™…æ˜¯<code>Cat[]</code>ã€‚å› æ­¤åå˜è§„åˆ™ä¹Ÿä¸æ˜¯å®‰å…¨çš„â€”æ•°ç»„æ„é€ å™¨åº”è¯¥æ˜¯<strong>ä¸å˜</strong>ã€‚æ³¨æ„ï¼Œè¿™ä»…æ˜¯å¯å†™ï¼ˆmutableï¼‰æ•°ç»„çš„é—®é¢˜ï¼›å¯¹äºä¸å¯å†™ï¼ˆåªè¯»ï¼‰æ•°ç»„ï¼Œåå˜è§„åˆ™æ˜¯å®‰å…¨çš„ã€‚</p>
<p>è¿™ç¤ºä¾‹äº†ä¸€èˆ¬ç°åƒã€‚åªè¯»æ•°æ®ç±»å‹æ˜¯åå˜çš„ï¼›åªå†™æ•°æ®ç±»å‹æ˜¯é€†å˜çš„ã€‚å¯è¯»å¯å†™ç±»å‹åº”æ˜¯â€œä¸å˜â€çš„ã€‚</p>
<p>Javaä¸­æ³›å‹æ˜¯ä¸å˜çš„ï¼Œå¯æœ‰æ—¶éœ€è¦å®ç°é€†å˜ä¸åå˜ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ—¶ï¼Œé€šé…ç¬¦?æ´¾ä¸Šäº†ç”¨åœºï¼š</p>
<p><code>&lt;? extends&gt;</code>å®ç°äº†æ³›å‹çš„åå˜ï¼Œæ¯”å¦‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">List&lt;? extends Number&gt; list = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</div></pre></td></tr></table></figure></p>
<p><code>&lt;? super&gt;</code>å®ç°äº†æ³›å‹çš„é€†å˜ï¼Œæ¯”å¦‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">List&lt;? <span class="keyword">super</span> Number&gt; list = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</div></pre></td></tr></table></figure></p>
<p>extendsç¡®å®šäº†æ³›å‹çš„ä¸Šç•Œï¼Œè€Œsuperç¡®å®šäº†æ³›å‹çš„ä¸‹ç•Œã€‚</p>
<h3 id="Javaä¸­çš„åå˜"><a href="#Javaä¸­çš„åå˜" class="headerlink" title="Javaä¸­çš„åå˜"></a>Javaä¸­çš„åå˜</h3><blockquote>
<p>å¦‚æœ <code>B</code> æ˜¯ <code>A</code> çš„å­ç±»å‹, é‚£ä¹ˆ <code>GenericType&lt;B&gt;</code> æ˜¯ <code>GenericType&lt;? extends A&gt;</code> çš„å­ç±»å‹.</p>
</blockquote>
<p>æ—©æœŸç‰ˆæœ¬çš„Javaä¸åŒ…å«<a href="https://zh.wikipedia.org/wiki/%E6%B3%9B%E5%9E%8B" title="æ³›å‹" target="_blank" rel="external">æ³›å‹</a>ï¼ˆgenericsï¼Œå³å‚æ•°åŒ–å¤šæ€ï¼‰ã€‚åœ¨è¿™æ ·çš„è®¾ç½®ä¸‹ï¼Œä½¿æ•°ç»„ä¸ºâ€œä¸å˜â€å°†å¯¼è‡´è®¸å¤šæœ‰ç”¨çš„å¤šæ€ç¨‹åºè¢«æ’é™¤ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªç”¨äºé‡æ’ï¼ˆshuffleï¼‰æ•°ç»„çš„å‡½æ•°ï¼Œæˆ–è€…æµ‹è¯•ä¸¤ä¸ªæ•°ç»„ç›¸ç­‰çš„å‡½æ•°ï¼Œä½¿ç”¨<code>Object</code>ä¸<code>equals</code>æ–¹æ³•. å‡½æ•°çš„å®ç°å¹¶ä¸ä¾èµ–äºæ•°ç»„å…ƒç´ çš„ç¡®åˆ‡ç±»å‹ï¼Œå› æ­¤å¯ä»¥å†™ä¸€ä¸ªå•ç‹¬çš„å®ç°è€Œé€‚ç”¨äºæ‰€æœ‰çš„æ•°ç»„ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">equalArrays</span> <span class="params">(Object[] a1, Object[] a2)</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">shuffleArray</span><span class="params">(Object[] a)</span></span>;</div></pre></td></tr></table></figure></p>
<p>ç„¶è€Œï¼Œå¦‚æœæ•°ç»„ç±»å‹è¢«å¤„ç†ä¸ºâ€œä¸å˜â€ï¼Œé‚£ä¹ˆå®ƒä»…èƒ½ç”¨äºç¡®åˆ‡ä¸º<code>Object[]</code>ç±»å‹çš„æ•°ç»„ã€‚å¯¹äºå­—ç¬¦ä¸²æ•°ç»„ç­‰å°±ä¸èƒ½åšé‡æ’æ“ä½œäº†ã€‚</p>
<p>æ‰€ä»¥ï¼ŒJavaæŠŠæ•°ç»„ç±»å‹å¤„ç†ä¸ºåå˜ã€‚åœ¨Javaä¸­ï¼Œ<code>String[]</code>æ˜¯<code>Object[]</code>çš„å­ç±»å‹ã€‚</p>
<p>å¦‚å‰æ–‡æ‰€è¿°ï¼Œåå˜æ•°ç»„åœ¨å†™å…¥æ•°ç»„çš„æ“ä½œæ—¶ä¼šå‡ºé—®é¢˜ã€‚Javaä¸ºæ­¤æŠŠæ¯ä¸ªæ•°ç»„å¯¹åƒåœ¨åˆ›å»ºæ—¶é™„æ ‡ä¸€ä¸ªç±»å‹ã€‚ æ¯å½“å‘æ•°ç»„å­˜å…¥ä¸€ä¸ªå€¼ï¼Œç¼–è¯‘å™¨æ’å…¥ä¸€æ®µä»£ç æ¥æ£€æŸ¥è¯¥å€¼çš„è¿è¡Œæ—¶ç±»å‹æ˜¯å¦ç­‰äºæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ã€‚å¦‚æœä¸åŒ¹é…ï¼Œä¼šæŠ›å‡ºä¸€ä¸ª<code>ArrayStoreException</code>ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// a æ˜¯å•å…ƒç´ çš„ String æ•°ç»„</span></div><div class="line">String[] a = <span class="keyword">new</span> String[<span class="number">1</span>];</div><div class="line"></div><div class="line"><span class="comment">// b æ˜¯ Object çš„æ•°ç»„</span></div><div class="line">Object[] b = a;</div><div class="line"></div><div class="line"><span class="comment">// å‘ b ä¸­èµ‹ä¸€ä¸ªæ•´æ•°ã€‚å¦‚æœ b ç¡®å®æ˜¯ Object çš„æ•°ç»„ï¼Œè¿™æ˜¯å¯èƒ½çš„ï¼›ç„¶è€Œå®ƒå…¶å®æ˜¯ä¸ª String çš„æ•°ç»„ï¼Œå› æ­¤ä¼šå‘ç”Ÿ java.lang.ArrayStoreException</span></div><div class="line">b[<span class="number">0</span>] = <span class="number">1</span>;</div></pre></td></tr></table></figure></p>
<p>åœ¨ä¸Šä¾‹ä¸­ï¼Œå¯ä»¥ä»bä¸­å®‰å…¨åœ°è¯»ã€‚ä»…åœ¨å†™å…¥æ•°ç»„æ—¶å¯èƒ½ä¼šé‡åˆ°éº»çƒ¦ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•çš„ç¼ºç‚¹æ˜¯ç•™ä¸‹äº†è¿è¡Œæ—¶é”™è¯¯çš„å¯èƒ½ï¼Œè€Œä¸€ä¸ªæ›´ä¸¥æ ¼çš„<a href="https://zh.wikipedia.org/wiki/%E5%9E%8B%E5%88%A5%E7%B3%BB%E7%B5%B1" title="ç±»å‹ç³»ç»Ÿ" target="_blank" rel="external">ç±»å‹ç³»ç»Ÿ</a>æœ¬å¯ä»¥åœ¨ç¼–è¯‘æ—¶è¯†åˆ«å‡ºè¯¥é”™è¯¯ã€‚è¿™ä¸ªæ–¹æ³•è¿˜æœ‰æŸæ€§èƒ½ï¼Œå› ä¸ºåœ¨è¿è¡Œæ—¶è¦è¿è¡Œé¢å¤–çš„ç±»å‹æ£€æŸ¥ã€‚</p>
<p>Javaæœ‰äº†æ³›å‹åï¼Œæœ‰äº†ç±»å‹å®‰å…¨çš„ç¼–å†™è¿™ç§å¤šæ€å‡½æ•°ã€‚æ•°ç»„æ¯”è¾ƒä¸é‡æ’å¯ä»¥ç»™å®šå‚æ•°ç±»å‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">equalArrays</span> <span class="params">(T[] a1, T[] a2)</span></span>;</div><div class="line">&lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">shuffleArray</span><span class="params">(T[] a)</span></span>;</div></pre></td></tr></table></figure></p>
<h3 id="åå˜å®¹å™¨"><a href="#åå˜å®¹å™¨" class="headerlink" title="åå˜å®¹å™¨"></a>åå˜å®¹å™¨</h3><p>Javaå…è®¸å­ç±»å‹ï¼ˆåå˜ï¼‰æ³›å‹ç±»å‹ï¼Œä½†å®ƒä¼šä¸¥æ ¼é™åˆ¶å¯ä»¥â€œæµå…¥å’Œæµå‡ºâ€œçš„æ³›å‹ç±»å‹ã€‚æ¢å¥è¯è¯´ï¼Œå…·æœ‰ç±»å‹å‚æ•°çš„è¿”å›å€¼çš„æ–¹æ³•æ˜¯å¯è®¿é—®çš„ï¼Œè€Œå…·æœ‰ç±»å‹å‚æ•°çš„è¾“å…¥å‚æ•°çš„æ–¹æ³•æ˜¯ä¸å¯è®¿é—®çš„ã€‚</p>
<p>æ‚¨å¯ä»¥ä¸ºå­ç±»å‹èµ‹å€¼è¶…ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Type hierarchy: Person :&gt; Joe :&gt; JoeJr</span></div><div class="line">List&lt;? extends Joe&gt; joes = <span class="keyword">new</span> ArrayList&lt;Joe&gt;(); <span class="comment">// OKï¼Œæ²¡é—®é¢˜ğŸ‘Œ</span></div><div class="line">List&lt;? extends Joe&gt; joes = <span class="keyword">new</span> ArrayList&lt;JoeJr&gt;(); <span class="comment">// OKï¼Œæ²¡é—®é¢˜ğŸ‘Œ</span></div><div class="line">List&lt;? extends Joe&gt; joes = <span class="keyword">new</span> ArrayList&lt;Person&gt;(); <span class="comment">// COMPILE ERROR</span></div></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»åå˜å®¹å™¨ä¸­ <em>è¯»å‡º</em> è¶…ç±»å‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Type hierarchy: Person :&gt; Joe :&gt; JoeJr</span></div><div class="line">List&lt;? extends Joe&gt; joes = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">Joe j = joes.get(<span class="number">0</span>); <span class="comment">// OKï¼Œæ²¡é—®é¢˜ğŸ‘Œ</span></div><div class="line">Person p = joes.get(<span class="number">0</span>); <span class="comment">// OKï¼Œæ²¡é—®é¢˜ğŸ‘Œ</span></div><div class="line">JoeJr jr = joes.get(<span class="number">0</span>); <span class="comment">// compile error (you don't know what subtype of Joe is in the list)</span></div></pre></td></tr></table></figure></p>
<p>ä½†å‘åå˜å®¹å™¨ <em>å†™å…¥</em> è¶…ç±»å‹æ˜¯ç¦æ­¢çš„ã€‚åœ¨ä¸‹ä¾‹çš„ä»£ç ä¸­, å¦‚æœå…¶ä»–æ–¹æ³•å‘ <code>List&lt;? extends Person&gt;</code> å‚æ•°ä¸­åŠ å…¥ <code>Jill</code>ï¼Œ<code>List&lt;Joe&gt;</code> çš„è°ƒç”¨æˆ¿å°†ä¼š <em>æ··ä¹±</em> ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Type hierarchy: Person &gt; Joe &gt; JoeJr</span></div><div class="line">List&lt;? extends Joe&gt; joes = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">joes.add(<span class="keyword">new</span> Joe());  <span class="comment">// compile error (æ— æ³•çŸ¥é“joesæ¥å—Joeçš„ä»€ä¹ˆå­ç±»å‹)</span></div><div class="line">joes.add(<span class="keyword">new</span> JoeJr()); <span class="comment">// compile error (ditto)</span></div><div class="line">joes.add(<span class="keyword">new</span> Person()); <span class="comment">// compile error (intuitive)</span></div><div class="line">joes.add(<span class="keyword">new</span> Object()); <span class="comment">// compile error (intuitive)</span></div></pre></td></tr></table></figure></p>
<h2 id="Javaä¸­çš„ä¸å˜"><a href="#Javaä¸­çš„ä¸å˜" class="headerlink" title="Javaä¸­çš„ä¸å˜"></a>Javaä¸­çš„ä¸å˜</h2><blockquote>
<p>å¦‚æœ <code>A</code> æ˜¯ <code>B</code> çš„è¶…ç±»å‹, é‚£ä¹ˆ <code>GenericType&lt;A&gt;</code> <strong>ä¸æ˜¯</strong> <code>GenericType&lt;B&gt;</code> çš„è¶…ç±»å‹ï¼Œä»¥åŠåä¹‹äº¦ç„¶ã€‚</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ä¸¤ç§ç±»å‹äº’ä¸å…³è”ï¼Œä¸”åœ¨ä»»ä½•æ¡ä»¶ä¸‹éƒ½ä¸èƒ½äº’æ¢ã€‚</p>
<h3 id="ä¸å˜å®¹å™¨"><a href="#ä¸å˜å®¹å™¨" class="headerlink" title="ä¸å˜å®¹å™¨"></a>ä¸å˜å®¹å™¨</h3><p>åœ¨Javaä¸­ï¼Œä¸å˜é‡å¯èƒ½æ˜¯æ‚¨å°†é‡åˆ°çš„æ³›å‹çš„ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå¹¶ä¸”æ˜¯æœ€ç›´è§‚çš„ã€‚ç±»å‹å‚æ•°çš„æ–¹æ³•å¯ä»¥åƒäººä»¬æœŸæœ›çš„é‚£æ ·ä½¿ç”¨ã€‚å¯ä»¥è®¿é—®ç±»å‹å‚æ•°çš„æ‰€æœ‰æ–¹æ³•ã€‚</p>
<p>ä»–ä»¬æ— æ³•äº¤æ¢ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Type hierarchy: Person :&gt; Joe :&gt; JoeJr</span></div><div class="line">List&lt;Person&gt; p = <span class="keyword">new</span> ArrayList&lt;Joe&gt;(); <span class="comment">// COMPILE ERROR (a bit counterintuitive, but remember List&lt;Person&gt; is invariant)</span></div><div class="line">List&lt;Joe&gt; j = <span class="keyword">new</span> ArrayList&lt;Person&gt;(); <span class="comment">// COMPILE ERROR</span></div></pre></td></tr></table></figure></p>
<p>ä½†å¯ä»¥å‘å®¹å™¨ä¸­æ·»åŠ å¯¹åº”å¯¹è±¡ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Type hierarchy: Person :&gt; Joe :&gt; JoeJr</span></div><div class="line">List&lt;Person&gt; p = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">p.add(<span class="keyword">new</span> Person()); <span class="comment">// OK</span></div><div class="line">p.add(<span class="keyword">new</span> Joe()); <span class="comment">// OK</span></div><div class="line">p.add(<span class="keyword">new</span> JoeJr()); <span class="comment">// OK</span></div></pre></td></tr></table></figure></p>
<p>ä¹Ÿå¯ä»¥ä»å®¹å™¨ä¸­è¯»å–å¯¹è±¡ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Type hierarchy: Person :&gt; Joe :&gt; JoeJr</span></div><div class="line">List&lt;Joe&gt; joes = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">Joe j = joes.get(<span class="number">0</span>); <span class="comment">// OK</span></div><div class="line">Person p = joes.get(<span class="number">0</span>); <span class="comment">// OK</span></div></pre></td></tr></table></figure></p>
<h2 id="Javaä¸­çš„é€†å˜"><a href="#Javaä¸­çš„é€†å˜" class="headerlink" title="Javaä¸­çš„é€†å˜"></a>Javaä¸­çš„é€†å˜</h2><blockquote>
<p>å¦‚æœ <code>A</code> æ˜¯ <code>B</code> çš„è¶…ç±»å‹, é‚£ä¹ˆ <code>GenericType&lt;A&gt;</code> æ˜¯ <code>GenericType&lt;? super B&gt;</code> çš„è¶…ç±»å‹ã€‚</p>
</blockquote>
<h3 id="é€†å˜å®¹å™¨"><a href="#é€†å˜å®¹å™¨" class="headerlink" title="é€†å˜å®¹å™¨"></a>é€†å˜å®¹å™¨</h3><p>é€†å˜å®¹å™¨è¡¨ç°åŒåå˜å®¹å™¨ç›¸åï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥å…·æœ‰ç±»å‹å‚æ•°çš„è¾“å…¥å‚æ•°çš„æ–¹æ³•æ˜¯å¯è®¿é—®çš„ï¼Œè€Œå…·æœ‰ç±»å‹å‚æ•°çš„è¿”å›å€¼çš„æ–¹æ³•æ˜¯ä¸å¯è®¿é—®çš„ã€‚</p>
<p>å¯ä»¥ä¸ºè¶…ç±»å‹èµ‹å€¼å­ç±»å‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Type hierarchy: Person &gt; Joe &gt; JoeJr</span></div><div class="line">List&lt;? <span class="keyword">super</span> Joe&gt; joes = <span class="keyword">new</span> ArrayList&lt;Joe&gt;();  <span class="comment">// OK</span></div><div class="line">List&lt;? <span class="keyword">super</span> Joe&gt; joes = <span class="keyword">new</span> ArrayList&lt;Person&gt;(); <span class="comment">// OK</span></div><div class="line">List&lt;? <span class="keyword">super</span> Joe&gt; joes = <span class="keyword">new</span> ArrayList&lt;JoeJr&gt;(); <span class="comment">// COMPILE ERROR</span></div></pre></td></tr></table></figure></p>
<p>ä½†ä¸èƒ½ä»å®¹å™¨ä¸­è¯»å‡ºç‰¹å®šç±»å‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Type hierarchy: Person &gt; Joe &gt; JoeJr</span></div><div class="line">List&lt;? <span class="keyword">super</span> Joe&gt; joes = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">Joe j = joes.get(<span class="number">0</span>); <span class="comment">// compile error (0ä½ç½®çš„å…ƒç´ å¯ä»¥æ˜¯Objectæˆ–Person)</span></div><div class="line">Person p = joes.get(<span class="number">0</span>); <span class="comment">// compile error (ditto)</span></div><div class="line">Object o = joes.get(<span class="number">0</span>); <span class="comment">// èƒ½å¤Ÿæ‰§è¡Œï¼Œå› ä¸ºJavaä¸­ä¸€åˆ‡çš†å¯¹è±¡</span></div></pre></td></tr></table></figure></p>
<p>å¯ä»¥å‘å…¶æ·»åŠ ç›´æ¥å­ç±»å‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Type hierarchy: Person &gt; Joe &gt; JoeJr</span></div><div class="line">List&lt;? <span class="keyword">super</span> Joe&gt; joes = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">joes.add(<span class="keyword">new</span> JoeJr()); <span class="comment">// allowed</span></div></pre></td></tr></table></figure></p>
<p>ä½†ä¸èƒ½å‘å…¶æ·»åŠ è¶…ç±»å‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Type hierarchy: Person &gt; Joe &gt; JoeJr</span></div><div class="line">List&lt;? <span class="keyword">super</span> Joe&gt; joes = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">joes.add(<span class="keyword">new</span> Person()); <span class="comment">// compile error (again, could be a list of Object or Person or Joe)</span></div><div class="line">joes.add(<span class="keyword">new</span> Object()); <span class="comment">// compile error (ditto)</span></div></pre></td></tr></table></figure></p>
<h2 id="å…·æœ‰-N-Type-å‚æ•°ç»“æ„çš„åå˜"><a href="#å…·æœ‰-N-Type-å‚æ•°ç»“æ„çš„åå˜" class="headerlink" title="å…·æœ‰ N-Type å‚æ•°ç»“æ„çš„åå˜"></a>å…·æœ‰ N-Type å‚æ•°ç»“æ„çš„åå˜</h2><p>å¯¹äºå¦‚Functionsè¿™ç§æ›´å¤æ‚çš„ç±»å‹ï¼Œè§„åˆ™åŒæ ·é€‚ç”¨ï¼Œåªæ˜¯éœ€è¦è€ƒè™‘å¤šä¸ªå‚æ•°è§„åˆ™:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Type hierarchy: Person &gt; Joe &gt; JoeJr</span></div><div class="line"></div><div class="line"><span class="comment">// ä¸å˜</span></div><div class="line">Function&lt;Person, Joe&gt; personToJoe = <span class="keyword">null</span>;</div><div class="line">Function&lt;Joe, JoeJr&gt; joeToJoeJr = <span class="keyword">null</span>;</div><div class="line">personToJoe = joeToJoeJr; <span class="comment">// COMPILE ERROR (personToJoe æ˜¯ä¸å˜çš„)</span></div><div class="line"></div><div class="line"><span class="comment">// åå˜</span></div><div class="line">Function&lt;? extends Person, ? extends Joe&gt; personToJoe = <span class="keyword">null</span>; <span class="comment">// åå˜</span></div><div class="line">Function&lt;Joe, JoeJr&gt; joeToJoeJr = <span class="keyword">null</span>;</div><div class="line">personToJoe = joeToJoeJr;  <span class="comment">// OK</span></div><div class="line"></div><div class="line"><span class="comment">// é€†å˜</span></div><div class="line">Function&lt;? <span class="keyword">super</span> Joe, ? <span class="keyword">super</span> JoeJr&gt; joeToJoeJr = <span class="keyword">null</span>; <span class="comment">// é€†å˜</span></div><div class="line">Function&lt;? <span class="keyword">super</span> Person, ? <span class="keyword">super</span> Joe&gt; personToJoe = <span class="keyword">null</span>;</div><div class="line">joeToJoeJr = personToJoe; <span class="comment">// OK</span></div></pre></td></tr></table></figure></p>
<h2 id="åå˜ä¸ç»§æ‰¿"><a href="#åå˜ä¸ç»§æ‰¿" class="headerlink" title="åå˜ä¸ç»§æ‰¿"></a>åå˜ä¸ç»§æ‰¿</h2><p>Javaå…è®¸ä½¿ç”¨åå˜è¿”å›ç±»å‹å’Œå¼‚å¸¸ç±»å‹é‡è½½æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Person</span> </span>&#123;</div><div class="line">  <span class="function">Person <span class="title">get</span><span class="params">()</span></span>;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">fail</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Joe</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</div><div class="line">  <span class="function">JoeJr <span class="title">get</span><span class="params">()</span></span>;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">fail</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">JoeImpl</span> <span class="keyword">implements</span> <span class="title">Joe</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> JoeJr <span class="title">get</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// é‡è½½</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fail</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;&#125; <span class="comment">// é‡è½½</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½†æ˜¯å°è¯•ä½¿ç”¨åå˜å‚æ•°é‡è½½æ–¹æ³•åªä¼šå¯¼è‡´é‡å†™ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Person</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(Person p)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Joe</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(Joe j)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">JoeImpl</span> <span class="keyword">implements</span> <span class="title">Joe</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Person p)</span> </span>&#123;&#125;  <span class="comment">// overloaded</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Joe j)</span> </span>&#123;&#125; <span class="comment">// overloaded</span></div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<h2 id="Final-Thoughts"><a href="#Final-Thoughts" class="headerlink" title="Final Thoughts"></a>Final Thoughts</h2><p>åå˜ä¸ºJâ€‹â€‹avaå¸¦æ¥äº†é¢å¤–çš„å¤æ‚æ€§ã€‚è™½ç„¶åå˜çš„è§„åˆ™å¾ˆå®¹æ˜“ç†è§£ï¼Œä½†å…³äºç±»å‹å‚æ•°æ–¹æ³•çš„å¯è®¿é—®æ€§çš„è§„åˆ™æ˜¯è¿åç›´è§‰çš„ã€‚ç†è§£å®ƒä»¬éœ€è¦æš‚åœæ‰‹å¤´çš„å·¥ä½œï¼Œé¢å¤–æ€è€ƒã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘çš„æ—¥å¸¸ç»éªŒæ˜¯ï¼Œç»†å¾®å·®åˆ«é€šå¸¸ä¸ä¼šå—åˆ°å½±å“ï¼š</p>
<ul>
<li>æˆ‘ä¸è®°å¾—ä¸€ä¸ªæˆ‘å¿…é¡»å£°æ˜é€†å˜çš„å®ä¾‹ï¼Œæˆ‘å¾ˆå°‘é‡åˆ°å®ƒä»¬ï¼ˆè™½ç„¶å®ƒä»¬ç¡®å®å­˜åœ¨ï¼‰ã€‚</li>
<li>åå˜è®ºè¯ä¼¼ä¹æ›´å¸¸è§ï¼Œä½†åŒæ—¶å®ƒä»¬ä¹Ÿæ›´å®¹æ˜“æ¨ç†ã€‚</li>
</ul>
<p><strong>æ€»ç»“:</strong> åå˜åœ¨æ—¥å¸¸ç¼–ç¨‹ä¸­æä¾›äº†é€‚åº¦çš„ä¾¿åˆ©ï¼Œç‰¹åˆ«æ˜¯å½“éœ€è¦ä¸å­ç±»å‹çš„å…¼å®¹æ€§æ—¶ï¼ˆè¿™åœ¨OOPä¸­ç»å¸¸å‡ºç°ï¼‰ã€‚ä½¿ç”¨åå˜ã€é€†å˜æ—¶ä¸»è¦å‚è€ƒPECSï¼ˆProducer Extends Consumer Superï¼‰åŸåˆ™ï¼š</p>
<ul>
<li>é¢‘ç¹å¾€å¤–è¯»å–å†…å®¹çš„ï¼Œé€‚åˆç”¨ä¸Šç•ŒExtendsï¼ˆåå˜ï¼‰ã€‚</li>
<li>ç»å¸¸å¾€é‡Œæ’å…¥çš„ï¼Œé€‚åˆç”¨ä¸‹ç•ŒSuperï¼ˆé€†å˜ï¼‰ã€‚</li>
</ul>
<h2 id="åŸæ–‡é“¾æ¥"><a href="#åŸæ–‡é“¾æ¥" class="headerlink" title="åŸæ–‡é“¾æ¥"></a>åŸæ–‡é“¾æ¥</h2><p><a href="https://llorllale.github.io/java-variance/#fn:2" target="_blank" rel="external">java-variance</a><br><a href="https://zh.wikipedia.org/wiki/%E5%8D%8F%E5%8F%98%E4%B8%8E%E9%80%86%E5%8F%98" target="_blank" rel="external">åå˜ä¸é€†å˜</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä»€ä¹ˆæ˜¯å˜å‹&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯å˜å‹&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯å˜å‹?&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯å˜å‹?&lt;/h2&gt;&lt;p&gt;ç»´åŸºç™¾ç§‘ä¸Š&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E5%8D%8F%E5
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="Java å˜å‹" scheme="http://blog.yinwoods.work/tags/Java-%E5%8F%98%E5%9E%8B/"/>
    
  </entry>
  
  <entry>
    <title>k8såŸºæœ¬ç»„ä»¶åŠæ‰§è¡Œæµç¨‹</title>
    <link href="http://blog.yinwoods.work/2018/06/03/K8S%E5%9F%BA%E6%9C%AC%E7%BB%84%E4%BB%B6%E5%8F%8A%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/"/>
    <id>http://blog.yinwoods.work/2018/06/03/K8SåŸºæœ¬ç»„ä»¶åŠæ‰§è¡Œæµç¨‹/</id>
    <published>2018-06-03T11:54:00.000Z</published>
    <updated>2018-06-04T12:22:07.417Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯kubernetes"><a href="#ä»€ä¹ˆæ˜¯kubernetes" class="headerlink" title="ä»€ä¹ˆæ˜¯kubernetes"></a>ä»€ä¹ˆæ˜¯kubernetes</h3><p>Kubernetesï¼ˆç®€ç§°k8sï¼‰æ˜¯è°·æ­Œå¼€æºçš„å®¹å™¨ç¼–æ’ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å°†dockerç†è§£ä¸ºåŸºç¡€è®¾æ–½ï¼Œè€Œk8såˆ™æ˜¯ç”¨åŸºç¡€è®¾æ–½ä¹‹ä¸Šçš„ä¸Šå±‚å»ºç­‘ï¼Œå¹¶èƒ½å¤Ÿå®ç°å¯¹dockerçš„å„ç§ç®¡ç†ã€‚å®ƒä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>è‡ªåŠ¨èŠ±å®¹å™¨éƒ¨ç½²å’Œå¤åˆ¶</li>
<li>æ”¯æŒå®¹å™¨æœåŠ¡çš„è‡ªåŠ¨ä¼¸ç¼©</li>
<li>å°†å®¹å™¨ç»„ç»‡æˆç»„ï¼Œå¹¶æä¾›å®¹å™¨é—´çš„è´Ÿè½½å‡è¡¡</li>
<li>æ–¹ä¾¿å¯¹å®¹å™¨è¿›è¡Œç®¡ç†ï¼Œä»¥åŠå¯¹åº”ç”¨ç¨‹åºçš„ç®¡ç†ï¼ˆå¦‚æ»šåŠ¨æ›´æ–°ç­‰ï¼‰</li>
</ul>
<p>k8såŒ…å«ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p>
<h3 id="kubelet"><a href="#kubelet" class="headerlink" title="kubelet"></a>kubelet</h3><p>kubeletæ˜¯ä¸æœºå™¨ä¸Šçš„podå…·ä½“äº¤äº’çš„ç»„ä»¶ï¼Œå®ƒçš„ä¸»è¦èŒè´£æ˜¯åœ¨ç‰©ç†æœºä¸Šå¯åŠ¨ç›¸å…³å®¹å™¨å¹¶ä¿è¯å®ƒä»¬çš„è¿è¡Œã€‚kubeletè¿è¡Œçš„å•å…ƒæ˜¯podï¼›podæ˜¯ä¸€ç»„å…±äº«èµ„æºçš„å®¹å™¨é›†åˆï¼Œpodæœ‰å…¶ç‹¬ç«‹IPï¼Œpodä¸­çš„å®¹å™¨å…±äº«podç›®å½•å·ã€‚</p>
<h3 id="etcd"><a href="#etcd" class="headerlink" title="etcd"></a>etcd</h3><p>etcdæ‹…å½“k8sä¸­æ•°æ®åº“çš„è§’è‰²ï¼Œç”¨äºk8sä¸­æ‰€æœ‰ä¿¡æ¯çš„å­˜å‚¨ä¸æ›´æ–°ã€‚</p>
<h3 id="api-server"><a href="#api-server" class="headerlink" title="api server"></a>api server</h3><p>api serveræ˜¯k8sçš„æ ¸å¿ƒï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯é€šè¿‡api serveræ¥æ‰§è¡Œï¼Œapi serverå°†æ“ä½œç›¸å…³ä¿¡æ¯æ›´æ–°åˆ°etcdä¸­å»ï¼Œæ˜¯ç³»ç»Ÿä¸­å”¯ä¸€ä¸etcdç›´æ¥äº¤äº’çš„k8sç»„ä»¶ã€‚</p>
<h3 id="scheduler"><a href="#scheduler" class="headerlink" title="scheduler"></a>scheduler</h3><p>Schedulerè´Ÿè´£å®Œæˆé›†ç¾¤ä¸­podçš„è°ƒåº¦ï¼Œé€šè¿‡é¢„é€‰ä¸ä¼˜é€‰ä¸¤é˜¶æ®µè°ƒåº¦ç®—æ³•çš„æ‰“åˆ†å¾—å‡ºpodæ‰€åº”è°ƒåº¦çš„æœ€ä½³èŠ‚ç‚¹</p>
<h3 id="k8sè¿è¡Œpodæ­¥éª¤"><a href="#k8sè¿è¡Œpodæ­¥éª¤" class="headerlink" title="k8sè¿è¡Œpodæ­¥éª¤"></a>k8sè¿è¡Œpodæ­¥éª¤</h3><p>ä¸€å›¾èƒœåƒè¨€ï¼Œè¿è¡Œä¸€ä¸ªpodçš„æ—¶åºå›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä»»ä½•æ—¶å€™éƒ½éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šåªæœ‰api serverç›´æ¥ä¸etcdäº¤äº’ï¼Œå…¶ä»–ç»„ä»¶å‡é€šè¿‡api serverä¸etcdäº¤äº’ï¼Œå¯¹äºæ‰§è¡Œä¸€ä¸ªpodï¼Œå…·ä½“çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>api server æ¥æ”¶åˆ°podåˆ›å»ºè¯·æ±‚ï¼Œå°†podç›¸å…³ä¿¡æ¯å†™å…¥etcd</li>
<li>scheduleré€šè¿‡api serveræ£€æµ‹åˆ°etcdä¸­æœ‰å¾…è°ƒåº¦çš„podï¼Œé€šè¿‡ç›¸å…³è°ƒåº¦ç®—æ³•å†³å®šå°†podåˆ†é…åˆ°æŸå°ç‰©ç†æœºXä¸Šï¼Œå¹¶æŠŠå¯¹åº”ä¿¡æ¯é€šè¿‡api serverå†™å›etcd</li>
<li>ç‰©ç†æœºXä¸Šçš„kubeleté€šè¿‡api serverç›‘æµ‹åˆ°æœ‰å¾…å¯åŠ¨çš„podï¼Œè°ƒç”¨ç‰©ç†æœºä¸Šçš„dockeræ‰§è¡Œpodå†…å®¹å™¨å¹¶å®Œæˆç›¸å…³è®¾ç½®ï¼Œæ¥ç€å°†podå·²è¿è¡Œçš„çŠ¶æ€é€šè¿‡api serverå†™å›etcd</li>
</ol>
<p><img src="http://7xlh6u.com1.z0.glb.clouddn.com/k8s1.jpg" alt="1"></p>
<p>ä¹Ÿå¯å‚è€ƒä¸‹é¢çš„æ¼«ç”»</p>
<p><img src="http://7xlh6u.com1.z0.glb.clouddn.com/k8s2.jpg" alt="2"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä»€ä¹ˆæ˜¯kubernetes&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯kubernetes&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯kubernetes&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯kubernetes&lt;/h3&gt;&lt;p&gt;Kubernetesï¼ˆç®€ç§°k8sï¼‰æ˜¯è°·æ­Œå¼€æºçš„å®¹å™¨ç¼–
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="k8s" scheme="http://blog.yinwoods.work/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>IOæ¨¡å¼å’ŒIOå¤šè·¯å¤ç”¨</title>
    <link href="http://blog.yinwoods.work/2018/06/02/IO%E6%A8%A1%E5%BC%8F%E5%92%8CIO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/"/>
    <id>http://blog.yinwoods.work/2018/06/02/IOæ¨¡å¼å’ŒIOå¤šè·¯å¤ç”¨/</id>
    <published>2018-06-02T06:54:00.000Z</published>
    <updated>2018-06-02T12:27:55.452Z</updated>
    
    <content type="html"><![CDATA[<p>ç°åœ¨æ“ä½œç³»ç»Ÿéƒ½é‡‡ç”¨è™šæ‹Ÿå¯»å€ï¼Œå¤„ç†å™¨å…ˆäº§ç”Ÿä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œé€šè¿‡åœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€ï¼ˆå†…å­˜çš„åœ°å€ï¼‰ï¼Œå†é€šè¿‡æ€»çº¿çš„ä¼ é€’ï¼Œæœ€åå¤„ç†å™¨æ‹¿åˆ°æŸä¸ªç‰©ç†åœ°å€è¿”å›çš„å­—èŠ‚ã€‚</p>
<p>å¯¹32ä½æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå®ƒçš„å¯»å€ç©ºé—´ï¼ˆè™šæ‹Ÿå­˜å‚¨ç©ºé—´ï¼‰ä¸º4Gï¼ˆ2çš„32æ¬¡æ–¹ï¼‰ã€‚</p>
<p>æ ¸ç©ºé—´ï¼šåœ¨liunxä¸­ï¼Œå°†æœ€é«˜çš„1Gå­—èŠ‚ï¼ˆä»è™šæ‹Ÿåœ°å€0xC0000000åˆ°0xFFFFFFFFï¼‰ï¼Œä¾›å†…æ ¸ä½¿ç”¨ï¼Œç§°ä¸ºâ€œå†…æ ¸ç©ºé—´â€ã€‚</p>
<p>ç”¨æˆ·ç©ºé—´: åœ¨liunxä¸­ï¼Œå°†è¾ƒä½çš„3Gå­—èŠ‚ï¼ˆä»è™šæ‹Ÿåœ°å€ 0x00000000åˆ°0xBFFFFFFFï¼‰ï¼Œä¾›å„ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œç§°ä¸ºâ€œç”¨æˆ·ç©ºé—´ï¼‰ã€‚</p>
<p>å†…æ ¸æ€ï¼šå½“ä¸€ä¸ªä»»åŠ¡ï¼ˆè¿›ç¨‹ï¼‰æ‰§è¡Œç³»ç»Ÿè°ƒç”¨è€Œé™·å…¥å†…æ ¸ä»£ç ä¸­æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬å°±ç§°è¿›ç¨‹å¤„äºå†…æ ¸è¿è¡Œæ€</p>
<p>ç”¨æˆ·æ€ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„å†…æ ¸æ ˆã€‚å½“è¿›ç¨‹åœ¨æ‰§è¡Œç”¨æˆ·è‡ªå·±çš„ä»£ç æ—¶ï¼Œåˆ™ç§°å…¶å¤„äºç”¨æˆ·è¿è¡Œæ€ï¼ˆç”¨æˆ·æ€ï¼‰</p>
<p>å› ä¸ºæ¯ä¸ªè¿›ç¨‹å¯ä»¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸ï¼Œå› æ­¤ï¼ŒLinuxå†…æ ¸ç”±ç³»ç»Ÿ å†…çš„æ‰€æœ‰è¿›ç¨‹å…±äº«ã€‚äºæ˜¯ï¼Œä»å…·ä½“è¿›ç¨‹çš„è§’åº¦æ¥çœ‹ï¼Œæ¯ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰4Gå­—èŠ‚çš„è™šæ‹Ÿç©ºé—´ã€‚</p>
<ul>
<li><p>è¿›ç¨‹å¯»å€ç©ºé—´0~4G</p>
</li>
<li><p>è¿›ç¨‹åœ¨ç”¨æˆ·æ€åªèƒ½è®¿é—®0~3Gï¼Œåªæœ‰è¿›å…¥å†…æ ¸æ€æ‰èƒ½è®¿é—®3G~4G</p>
</li>
<li><p>è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸æ€</p>
</li>
<li>æ¯ä¸ªè¿›ç¨‹è™šæ‹Ÿç©ºé—´çš„3G~4Géƒ¨åˆ†æ˜¯ç›¸åŒçš„</li>
</ul>
<h4 id="è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆè¿›ç¨‹åˆ‡æ¢ï¼‰"><a href="#è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆè¿›ç¨‹åˆ‡æ¢ï¼‰" class="headerlink" title="è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆè¿›ç¨‹åˆ‡æ¢ï¼‰"></a>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆè¿›ç¨‹åˆ‡æ¢ï¼‰</h4><p>ä¸ºäº†æ§åˆ¶è¿›ç¨‹çš„æ‰§è¡Œï¼Œå†…æ ¸å¿…é¡»æœ‰èƒ½åŠ›æŒ‚èµ·æ­£åœ¨CPUä¸Šè¿è¡Œçš„è¿›ç¨‹ï¼Œå¹¶æ¢å¤ä»¥å‰æŒ‚èµ·çš„æŸä¸ªè¿›ç¨‹çš„æ‰§è¡Œã€‚è¿™ç§è¡Œä¸ºè¢«ç§°ä¸ºè¿›ç¨‹åˆ‡æ¢ï¼ˆä¹Ÿå«è°ƒåº¦ï¼‰ã€‚å› æ­¤å¯ä»¥è¯´ï¼Œä»»ä½•è¿›ç¨‹éƒ½æ˜¯åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„æ”¯æŒä¸‹è¿è¡Œçš„ï¼Œæ˜¯ä¸å†…æ ¸ç´§å¯†ç›¸å…³çš„ã€‚</p>
<p>ä»ä¸€ä¸ªè¿›ç¨‹çš„è¿è¡Œè½¬åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸Šè¿è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ç»è¿‡ä¸‹é¢è¿™äº›å˜åŒ–ï¼š</p>
<ol>
<li><p>ä¿å­˜å½“å‰è¿›ç¨‹Açš„ä¸Šä¸‹æ–‡ã€‚ ä¸Šä¸‹æ–‡å°±æ˜¯å†…æ ¸å†æ¬¡å”¤é†’å½“å‰è¿›ç¨‹æ—¶æ‰€éœ€è¦çš„çŠ¶æ€ï¼Œç”±ä¸€äº›å¯¹è±¡ï¼ˆç¨‹åºè®¡æ•°å™¨ã€çŠ¶æ€å¯„å­˜å™¨ã€ç”¨æˆ·æ ˆç­‰å„ç§å†…æ ¸æ•°æ®ç»“æ„ï¼‰çš„å€¼ç»„æˆã€‚ è¿™äº›å€¼åŒ…æ‹¬æç»˜åœ°å€ç©ºé—´çš„é¡µè¡¨ã€åŒ…å«è¿›ç¨‹ç›¸å…³ä¿¡æ¯çš„è¿›ç¨‹è¡¨ã€æ–‡ä»¶è¡¨ç­‰ã€‚</p>
</li>
<li><p>åˆ‡æ¢é¡µå…¨å±€ç›®å½•ä»¥å®‰è£…ä¸€ä¸ªæ–°çš„åœ°å€ç©ºé—´ã€‚</p>
</li>
<li><p>æ¢å¤è¿›ç¨‹Bçš„ä¸Šä¸‹æ–‡ã€‚</p>
</li>
</ol>
<p>å¯ä»¥ç†è§£æˆä¸€ä¸ªæ¯”è¾ƒè€—èµ„æºçš„è¿‡ç¨‹ã€‚</p>
<h4 id="ç›´æ¥I-Oå’Œç¼“å­˜I-O"><a href="#ç›´æ¥I-Oå’Œç¼“å­˜I-O" class="headerlink" title="ç›´æ¥I/Oå’Œç¼“å­˜I/O"></a>ç›´æ¥I/Oå’Œç¼“å­˜I/O</h4><p>ç¼“å­˜ I/O åˆè¢«ç§°ä½œæ ‡å‡† I/Oï¼Œå¤§å¤šæ•°æ–‡ä»¶ç³»ç»Ÿçš„é»˜è®¤ I/O æ“ä½œéƒ½æ˜¯ç¼“å­˜ I/Oã€‚åœ¨ Linux çš„ç¼“å­˜ I/O æœºåˆ¶ä¸­ï¼Œä»¥writeä¸ºä¾‹ï¼Œæ•°æ®ä¼šå…ˆè¢«æ‹·è´è¿›ç¨‹ç¼“å†²åŒºï¼Œåœ¨æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­ï¼Œç„¶åæ‰ä¼šå†™åˆ°å­˜å‚¨è®¾å¤‡ä¸­ã€‚<br><img src="https://l.ruby-china.org/photo/2018/d410db1c-f699-4122-8c4d-e28a348d31dd.png!large" alt="1.3"></p>
<h2 id="IOæ¨¡å¼"><a href="#IOæ¨¡å¼" class="headerlink" title="IOæ¨¡å¼"></a>IOæ¨¡å¼</h2><p>å¯¹äºä¸€æ¬¡IOè®¿é—®ï¼ˆè¿™å›ä»¥readä¸¾ä¾‹ï¼‰ï¼Œæ•°æ®ä¼šå…ˆè¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­ï¼Œç„¶åæ‰ä¼šä»æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„ç¼“å†²åŒºï¼Œæœ€åäº¤ç»™è¿›ç¨‹ã€‚æ‰€ä»¥è¯´ï¼Œå½“ä¸€ä¸ªreadæ“ä½œå‘ç”Ÿæ—¶ï¼Œå®ƒä¼šç»å†ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li><ol>
<li>ç­‰å¾…æ•°æ®å‡†å¤‡ (Waiting for the data to be ready)</li>
</ol>
</li>
<li><ol>
<li>å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°è¿›ç¨‹ä¸­ (Copying the data from the kernel to the process)</li>
</ol>
</li>
</ul>
<p>æ­£å¼å› ä¸ºè¿™ä¸¤ä¸ªé˜¶æ®µï¼Œlinuxç³»ç»Ÿäº§ç”Ÿäº†ä¸‹é¢äº”ç§ç½‘ç»œæ¨¡å¼çš„æ–¹æ¡ˆï¼š</p>
<ul>
<li>â€“ é˜»å¡ I/Oï¼ˆblocking IOï¼‰</li>
<li>â€“ éé˜»å¡ I/Oï¼ˆnonblocking IOï¼‰</li>
<li>â€“ I/O å¤šè·¯å¤ç”¨ï¼ˆ IO multiplexingï¼‰</li>
<li>â€“ ä¿¡å·é©±åŠ¨ I/Oï¼ˆ signal driven IOï¼‰</li>
<li>â€“ å¼‚æ­¥ I/Oï¼ˆasynchronous IOï¼‰</li>
</ul>
<h4 id="block-I-Oæ¨¡å‹ï¼ˆé˜»å¡I-Oï¼‰"><a href="#block-I-Oæ¨¡å‹ï¼ˆé˜»å¡I-Oï¼‰" class="headerlink" title="block I/Oæ¨¡å‹ï¼ˆé˜»å¡I/Oï¼‰"></a>block I/Oæ¨¡å‹ï¼ˆé˜»å¡I/Oï¼‰</h4><p>readä¸ºä¾‹ï¼š<br><img src="https://l.ruby-china.org/photo/2018/56b3cedc-cd0e-4d54-a001-28004acc71ad.jpg!large" alt="block IO"></p>
<p>ï¼ˆ1ï¼‰è¿›ç¨‹å‘èµ·readï¼Œè¿›è¡Œrecvfromç³»ç»Ÿè°ƒç”¨ï¼›</p>
<p>ï¼ˆ2ï¼‰å†…æ ¸å¼€å§‹ç¬¬ä¸€é˜¶æ®µï¼Œå‡†å¤‡æ•°æ®ï¼ˆä»ç£ç›˜æ‹·è´åˆ°ç¼“å†²åŒºï¼‰ï¼Œè¿›ç¨‹è¯·æ±‚çš„æ•°æ®å¹¶ä¸æ˜¯ä¸€ä¸‹å°±èƒ½å‡†å¤‡å¥½ï¼›å‡†å¤‡æ•°æ®æ˜¯è¦æ¶ˆè€—æ—¶é—´çš„ï¼›</p>
<p>ï¼ˆ3ï¼‰ä¸æ­¤åŒæ—¶ï¼Œè¿›ç¨‹é˜»å¡ï¼ˆè¿›ç¨‹æ˜¯è‡ªå·±é€‰æ‹©é˜»å¡ä¸å¦ï¼‰ï¼Œç­‰å¾…æ•°æ®ingï¼›</p>
<p>ï¼ˆ4ï¼‰ç›´åˆ°æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°äº†ç”¨æˆ·ç©ºé—´ï¼Œå†…æ ¸è¿”å›ç»“æœï¼Œè¿›ç¨‹è§£é™¤é˜»å¡ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå†…æ ¸å‡†å¤‡æ•°æ®å’Œæ•°æ®ä»å†…æ ¸æ‹·è´åˆ°è¿›ç¨‹å†…å­˜åœ°å€è¿™ä¸¤ä¸ªè¿‡ç¨‹éƒ½æ˜¯é˜»å¡çš„ã€‚</p>
<h4 id="non-blockï¼ˆéé˜»å¡I-Oæ¨¡å‹ï¼‰"><a href="#non-blockï¼ˆéé˜»å¡I-Oæ¨¡å‹ï¼‰" class="headerlink" title="non-blockï¼ˆéé˜»å¡I/Oæ¨¡å‹ï¼‰"></a>non-blockï¼ˆéé˜»å¡I/Oæ¨¡å‹ï¼‰</h4><p>å¯ä»¥é€šè¿‡è®¾ç½®socketä½¿å…¶å˜ä¸ºnon-blockingã€‚å½“å¯¹ä¸€ä¸ªnon-blocking socketæ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œæµç¨‹æ˜¯è¿™ä¸ªæ ·å­ï¼š<br><img src="https://l.ruby-china.org/photo/2018/77179aa5-7754-4822-8ab4-903566840175.jpg!large" alt="non-block IO"></p>
<p>ï¼ˆ1ï¼‰å½“ç”¨æˆ·è¿›ç¨‹å‘å‡ºreadæ“ä½œæ—¶ï¼Œå¦‚æœkernelä¸­çš„æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼›</p>
<p>ï¼ˆ2ï¼‰é‚£ä¹ˆå®ƒå¹¶ä¸ä¼šblockç”¨æˆ·è¿›ç¨‹ï¼Œè€Œæ˜¯ç«‹åˆ»è¿”å›ä¸€ä¸ªerrorï¼Œä»ç”¨æˆ·è¿›ç¨‹è§’åº¦è®² ï¼Œå®ƒå‘èµ·ä¸€ä¸ªreadæ“ä½œåï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…ï¼Œè€Œæ˜¯é©¬ä¸Šå°±å¾—åˆ°äº†ä¸€ä¸ªç»“æœï¼›</p>
<p>ï¼ˆ3ï¼‰ç”¨æˆ·è¿›ç¨‹åˆ¤æ–­ç»“æœæ˜¯ä¸€ä¸ªerroræ—¶ï¼Œå®ƒå°±çŸ¥é“æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œäºæ˜¯å®ƒå¯ä»¥å†æ¬¡å‘é€readæ“ä½œã€‚ä¸€æ—¦kernelä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå¹¶ä¸”åˆå†æ¬¡æ”¶åˆ°äº†ç”¨æˆ·è¿›ç¨‹çš„system callï¼›</p>
<p>ï¼ˆ4ï¼‰é‚£ä¹ˆå®ƒé©¬ä¸Šå°±å°†æ•°æ®æ‹·è´åˆ°äº†ç”¨æˆ·å†…å­˜ï¼Œç„¶åè¿”å›ã€‚</p>
<p>æ‰€ä»¥ï¼Œnonblocking IOçš„ç‰¹ç‚¹æ˜¯ç”¨æˆ·è¿›ç¨‹åœ¨å†…æ ¸å‡†å¤‡æ•°æ®çš„é˜¶æ®µéœ€è¦ä¸æ–­çš„ä¸»åŠ¨è¯¢é—®æ•°æ®å¥½äº†æ²¡æœ‰ã€‚</p>
<h4 id="I-Oå¤šè·¯å¤ç”¨"><a href="#I-Oå¤šè·¯å¤ç”¨" class="headerlink" title="I/Oå¤šè·¯å¤ç”¨"></a>I/Oå¤šè·¯å¤ç”¨</h4><p>I/Oå¤šè·¯å¤ç”¨å®é™…ä¸Šå°±æ˜¯ç”¨select, poll, epollç›‘å¬å¤šä¸ªioå¯¹è±¡ï¼Œå¯¹ä¸€ä¸ªIOç«¯å£ï¼Œä¸¤æ¬¡è°ƒç”¨ï¼Œä¸¤æ¬¡è¿”å›ï¼Œæ¯”é˜»å¡IOå¹¶æ²¡æœ‰ä»€ä¹ˆä¼˜è¶Šæ€§ï¼›å…³é”®æ˜¯èƒ½å®ç°åŒæ—¶å¯¹å¤šä¸ªIOç«¯å£è¿›è¡Œç›‘å¬ï¼›å½“ioå¯¹è±¡æœ‰å˜åŒ–ï¼ˆæœ‰æ•°æ®ï¼‰çš„æ—¶å€™å°±é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚ç°åœ¨å…ˆæ¥çœ‹ä¸‹I/Oå¤šè·¯å¤ç”¨çš„æµç¨‹ï¼š<br><img src="https://l.ruby-china.org/photo/2018/6b727e99-b45e-4104-ba1d-1dd2dd281e52.jpg!large" alt="I/Oå¤šè·¯å¤ç”¨"><br>ï¼ˆ1ï¼‰å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†selectï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹ä¼šè¢«blockï¼›</p>
<p>ï¼ˆ2ï¼‰è€ŒåŒæ—¶ï¼Œkernelä¼šâ€œç›‘è§†â€æ‰€æœ‰selectè´Ÿè´£çš„socketï¼›</p>
<p>ï¼ˆ3ï¼‰å½“ä»»ä½•ä¸€ä¸ªsocketä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œselectå°±ä¼šè¿”å›ï¼›</p>
<p>ï¼ˆ4ï¼‰è¿™ä¸ªæ—¶å€™ç”¨æˆ·è¿›ç¨‹å†è°ƒç”¨readæ“ä½œï¼Œå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹ã€‚</p>
<p>æ‰€ä»¥ï¼ŒI/O å¤šè·¯å¤ç”¨çš„ç‰¹ç‚¹æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ä¸€ä¸ªè¿›ç¨‹èƒ½åŒæ—¶ç­‰å¾…å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥—æ¥å­—æè¿°ç¬¦ï¼‰å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªè¿›å…¥è¯»å°±ç»ªçŠ¶æ€ï¼Œselect()å‡½æ•°å°±å¯ä»¥è¿”å›ã€‚</p>
<p>è¿™ä¸ªå›¾å’Œblocking IOçš„å›¾å…¶å®å¹¶æ²¡æœ‰å¤ªå¤§çš„ä¸åŒï¼Œäº‹å®ä¸Šï¼Œè¿˜æ›´å·®ä¸€äº›ã€‚å› ä¸ºè¿™é‡Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªsystem call (select å’Œ recvfrom)ï¼Œè€Œblocking IOåªè°ƒç”¨äº†ä¸€ä¸ªsystem call (recvfrom)ã€‚ ä½†æ˜¯ï¼Œç”¨selectçš„ä¼˜åŠ¿åœ¨äºå®ƒå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªconnectionã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœå¤„ç†çš„è¿æ¥æ•°ä¸æ˜¯å¾ˆé«˜çš„è¯ï¼Œä½¿ç”¨select/epollçš„web serverä¸ä¸€å®šæ¯”ä½¿ç”¨å¤šçº¿ç¨‹ + é˜»å¡ IOçš„web serveræ€§èƒ½æ›´å¥½ï¼Œå¯èƒ½å»¶è¿Ÿè¿˜æ›´å¤§ã€‚</p>
<p>select/epollçš„ä¼˜åŠ¿å¹¶ä¸æ˜¯å¯¹äºå•ä¸ªè¿æ¥èƒ½å¤„ç†å¾—æ›´å¿«ï¼Œè€Œæ˜¯åœ¨äºèƒ½å¤„ç†æ›´å¤šçš„è¿æ¥ã€‚</p>
<p>åœ¨IO multiplexing Modelä¸­ï¼Œå®é™…ä¸­ï¼Œå¯¹äºæ¯ä¸€ä¸ªsocketï¼Œä¸€èˆ¬éƒ½è®¾ç½®æˆä¸ºnon-blockingï¼Œä½†æ˜¯ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•´ä¸ªç”¨æˆ·çš„processå…¶å®æ˜¯ä¸€ç›´è¢«blockçš„ã€‚åªä¸è¿‡processæ˜¯è¢«selectè¿™ä¸ªå‡½æ•°blockï¼Œè€Œä¸æ˜¯è¢«socket IOç»™blockã€‚</p>
<h4 id="ä¿¡å·é©±åŠ¨I-Oæ¨¡å‹"><a href="#ä¿¡å·é©±åŠ¨I-Oæ¨¡å‹" class="headerlink" title="ä¿¡å·é©±åŠ¨I/Oæ¨¡å‹"></a>ä¿¡å·é©±åŠ¨I/Oæ¨¡å‹</h4><p><img src="https://l.ruby-china.org/photo/2018/c672dd70-c22a-42a6-a798-0c12aa7bf765.png!large" alt="sigio"></p>
<p>æˆ‘ä»¬é¦–å…ˆå¼€å¯å¥—æ¥å£çš„ä¿¡å·é©±åŠ¨I/OåŠŸèƒ½ï¼Œå¹¶é€šè¿‡sigactionç³»ç»Ÿè°ƒç”¨å®‰è£…ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ã€‚è¯¥ç³»ç»Ÿè°ƒç”¨ç«‹å³è¿”å›ï¼Œæˆ‘ä»¬çš„è¿›ç¨‹ç»§ç»­å·¥ä½œï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ²¡æœ‰è¢«é˜»å¡ã€‚å½“æ•°æ®æŠ¥å‡†å¤‡å¥½è¯»å–æ—¶ï¼Œå†…æ ¸å°±ä¸ºè¯¥è¿›ç¨‹äº§ç”Ÿä¸€ä¸ªSIGIOä¿¡å·ã€‚æˆ‘ä»¬éšåæ—¢å¯ä»¥åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨recvfromè¯»å–æ•°æ®æŠ¥ï¼Œå¹¶é€šçŸ¥ä¸»å¾ªç¯æ•°æ®å·²å‡†å¤‡å¥½å¾…å¤„ç†ï¼Œä¹Ÿå¯ä»¥ç«‹å³é€šçŸ¥ä¸»å¾ªç¯ï¼Œè®©å®ƒè¯»å–æ•°æ®æŠ¥ã€‚</p>
<p>æ— è®ºå¦‚ä½•å¤„ç†SIGIOä¿¡å·ï¼Œè¿™ç§æ¨¡å‹çš„ä¼˜åŠ¿åœ¨äºç­‰å¾…æ•°æ®æŠ¥åˆ°è¾¾æœŸé—´ï¼Œè¿›ç¨‹ä¸è¢«é˜»å¡ã€‚ä¸»å¾ªç¯å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œåªè¦ä¸æ—¶ç­‰å¾…æ¥è‡ªä¿¡å·å¤„ç†å‡½æ•°çš„é€šçŸ¥ï¼šæ—¢å¯ä»¥æ˜¯æ•°æ®å·²å‡†å¤‡å¥½è¢«å¤„ç†ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°æ®æŠ¥å·²å‡†å¤‡å¥½è¢«è¯»å–ã€‚</p>
<h4 id="asynchronous-I-Oï¼ˆå¼‚æ­¥-I-Oï¼‰"><a href="#asynchronous-I-Oï¼ˆå¼‚æ­¥-I-Oï¼‰" class="headerlink" title="asynchronous I/Oï¼ˆå¼‚æ­¥ I/Oï¼‰"></a>asynchronous I/Oï¼ˆå¼‚æ­¥ I/Oï¼‰</h4><p>å¼‚æ­¥I/Oï¼ˆasynchronous I/Oï¼‰ç”±POSIXè§„èŒƒå®šä¹‰ã€‚ä¸€èˆ¬åœ°è¯´ï¼Œè¿™äº›å‡½æ•°çš„å·¥ä½œæœºåˆ¶æ˜¯ï¼šå‘ŠçŸ¥å†…æ ¸å¯åŠ¨æŸä¸ªæ“ä½œï¼Œå¹¶è®©å†…æ ¸åœ¨æ•´ä¸ªæ“ä½œï¼ˆåŒ…æ‹¬å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°æˆ‘ä»¬è‡ªå·±çš„ç¼“å†²åŒºï¼‰å®Œæˆåé€šçŸ¥æˆ‘ä»¬ã€‚è¿™ç§æ¨¡å‹ä¸ä¿¡å·é©±åŠ¨æ¨¡å‹çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼šä¿¡å·é©±åŠ¨I/Oæ˜¯ç”±å†…æ ¸é€šçŸ¥æˆ‘ä»¬ä½•æ—¶å¯åŠ¨ä¸€ä¸ªI/Oæ“ä½œï¼Œè€Œå¼‚æ­¥I/Oæ¨¡å‹æ˜¯ç”±å†…æ ¸é€šçŸ¥æˆ‘ä»¬I/Oæ“ä½œä½•æ—¶å®Œæˆã€‚</p>
<p><img src="https://l.ruby-china.org/photo/2018/9ad0c25d-72e9-4a2d-8182-5cea6dc73b28.jpg!large" alt="asyncio"></p>
<p>æˆ‘ä»¬è°ƒç”¨aio<em>readå‡½æ•°ï¼ˆPOSIXå¼‚æ­¥I/Oå‡½æ•°ä»¥aio</em>æˆ–lio_å¼€å¤´ï¼‰ï¼Œç»™å†…æ ¸ä¼ é€’æè¿°å­—ã€ç¼“å†²åŒºæŒ‡é’ˆã€ç¼“å†²åŒºå¤§å°ï¼ˆä¸readç›¸åŒçš„ä¸‰ä¸ªå‚æ•°ï¼‰ã€æ–‡ä»¶åç§»ï¼ˆä¸lseekç±»ä¼¼ï¼‰ï¼Œå¹¶å‘Šè¯‰å†…æ ¸å½“æ•´ä¸ªæ“ä½œå®Œæˆæ—¶å¦‚ä½•é€šçŸ¥æˆ‘ä»¬ã€‚è¯¥ç³»ç»Ÿè°ƒç”¨ç«‹å³è¿”å›ï¼Œåœ¨ç­‰å¾…I/Oå®ŒæˆæœŸé—´ï¼Œæˆ‘ä»¬çš„è¿›ç¨‹ä¸è¢«é˜»å¡ã€‚</p>
<p>ï¼ˆ1ï¼‰ç”¨æˆ·è¿›ç¨‹å‘èµ·readæ“ä½œä¹‹åï¼Œç«‹åˆ»å°±å¯ä»¥å¼€å§‹å»åšå…¶å®ƒçš„äº‹ã€‚</p>
<p>ï¼ˆ2ï¼‰è€Œå¦ä¸€æ–¹é¢ï¼Œä»kernelçš„è§’åº¦ï¼Œå½“å®ƒå—åˆ°ä¸€ä¸ªasynchronous readä¹‹åï¼Œé¦–å…ˆå®ƒä¼šç«‹åˆ»è¿”å›ï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ç”¨æˆ·è¿›ç¨‹äº§ç”Ÿä»»ä½•blockã€‚</p>
<p>ï¼ˆ3ï¼‰ç„¶åï¼Œkernelä¼šç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œç„¶åå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œå½“è¿™ä¸€åˆ‡éƒ½å®Œæˆä¹‹åï¼Œkernelä¼šç»™ç”¨æˆ·è¿›ç¨‹å‘é€ä¸€ä¸ªsignalï¼Œå‘Šè¯‰å®ƒreadæ“ä½œå®Œæˆäº†ã€‚</p>
<h2 id="select-poll-epoll"><a href="#select-poll-epoll" class="headerlink" title="select/poll/epoll"></a>select/poll/epoll</h2><p>åœ¨æœåŠ¡å™¨ç«¯ï¼Œæ¯æ¬¡é€šè¿‡acceptç³»ç»Ÿè°ƒç”¨æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå»ºç«‹è¿æ¥ï¼Œæ¥ç€æœåŠ¡å™¨ç«¯ä¼šè·å–ä»£è¡¨è¿™ä¸ªè¿æ¥çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆLinuxä¸‹socketä¹Ÿè¢«è§†ä¸ºæ–‡ä»¶ï¼‰ï¼Œå¹¶å¤„ç†è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šçš„ç›¸å…³è¯·æ±‚ã€‚å½“ä¸æœåŠ¡å™¨ç«¯è¿æ¥çš„å¤§é‡å®¢æˆ·ç«¯åŒæ—¶è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯éœ€è¦èƒ½å¤Ÿæ„ŸçŸ¥åˆ°è¯·æ±‚çš„åˆ°æ¥å¹¶åŠæ—¶å¤„ç†ã€‚ä¸€ä¸ªå¾ˆç®€å•çš„æ€è·¯æ˜¯ä½¿ç”¨CPUè½®è¯¢å·²å»ºç«‹è¿æ¥çš„æ–‡ä»¶æè¿°ç¬¦ä¸Šæ˜¯å¦æœ‰æ–°çš„è¯·æ±‚åˆ°æ¥ï¼Œç±»ä¼¼å¦‚ä¸‹çš„ä»£ç ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> descriptor <span class="keyword">in</span> open_connections:</div><div class="line">    <span class="keyword">if</span> has_new_input(descriptor):</div><div class="line">        process_input(descriptor)</div></pre></td></tr></table></figure></p>
<p>è¿™ç§æ–¹æ³•ç†è®ºä¸Šæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å½“å¤§é‡è¿æ¥ä¸­åªæœ‰å°‘é‡æ˜¯æ´»è·ƒçš„è¿æ¥æ—¶ï¼Œè¿™æ— ç–‘ä¼šæµªè´¹å¾ˆå¤šCPUæ—¶é—´ï¼Œåœ¨Linuxä¸‹ï¼Œä¸å…¶åœ¨æœåŠ¡ç«¯å¯¹è¿™äº›æ–‡ä»¶æè¿°ç¬¦åšè½®è¯¢ï¼Œä¸å¦‚æŠŠæ–‡ä»¶æè¿°ç¬¦äº¤ç»™å†…æ ¸ï¼Œè®©å®ƒè´Ÿè´£å‘Šè¯‰æœåŠ¡ç«¯å“ªä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šæœ‰æ–°çš„è¯·æ±‚ã€‚è®©Linuxå¤„ç†å¤§é‡æ–‡ä»¶ææˆ·ç¬¦çš„æ“ä½œå…¶å®å°±æ˜¯I/Oå¤šè·¯å¤ç”¨ï¼ŒI/Oå¤šè·¯å¤ç”¨çš„æœ¬è´¨å°±æ˜¯ç”¨select/poll/epollï¼Œå»ç›‘å¬å¤šä¸ªsocketæ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœå…¶ä¸­çš„socketæ–‡ä»¶æè¿°ç¬¦æœ‰å˜åŒ–ï¼Œåªè¦æœ‰å˜åŒ–ï¼ŒæœåŠ¡å™¨è¿›ç¨‹å°±çŸ¥é“äº†ã€‚</p>
<p>åœ¨ä»»æ„unixæœºå™¨ä¸Šï¼Œselectå’Œpolléƒ½æ˜¯å¯ç”¨çš„ï¼Œepollåˆ™åªèƒ½å¤Ÿåœ¨Linuxä¸Šä½¿ç”¨ã€‚selectå’Œpollçš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p>
<ol>
<li>å°†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™select/poll</li>
<li>select/pollä¼šåœ¨ä»»ä¸€æ–‡ä»¶æè¿°ç¬¦æœ‰æ–°çš„è¯·æ±‚åˆ°æ¥æ—¶å‘ŠçŸ¥æœåŠ¡ç«¯è¿›ç¨‹</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯selectå’Œpollçš„æºç å‡ ä¹æ˜¯ç›¸åŒçš„ï¼Œä¸åŒçš„æ˜¯selectæ”¯æŒçš„æ“ä½œä¸å¦‚pollæ”¯æŒçš„ä¸°å¯Œï¼Œå¦‚åœ¨æ–‡ä»¶æè¿°ç¬¦æœ‰æ–°çš„è¯·æ±‚åˆ°æ¥æ—¶ï¼Œselectåªä¼šè¿”å›<code>æœ‰æ–°çš„è¾“å…¥</code>ã€<code>æœ‰æ–°çš„è¾“å‡º</code>æˆ–<code>æœ‰æ–°çš„é”™è¯¯</code>ï¼›è€Œpollåˆ™æ”¯æŒ<code>POLLRDNORM | POLLRDBAND | POLLIN | POLLHUP | POLLERR</code>ï¼Œselectä¼šå°†pollæ‰€æ”¯æŒçš„å¤šç§è¾“å‡ºç»Ÿä¸€è½¬æ¢ä¸ºä¸€ç§è¾“å‡ºï¼š<code>å¯å†™</code></p>
<h4 id="selectçš„ç¼ºç‚¹"><a href="#selectçš„ç¼ºç‚¹" class="headerlink" title="selectçš„ç¼ºç‚¹"></a>selectçš„ç¼ºç‚¹</h4><ul>
<li>å•ä¸ªè¿›ç¨‹èƒ½å¤Ÿç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡å­˜åœ¨å¤§é‡é™åˆ¶ï¼Œé€šå¸¸æ˜¯1024ï¼Œå¯ä»¥é€šè¿‡é‡æ–°ç¼–è¯‘Linuxå†…æ ¸çš„æ–¹å¼ä¿®æ”¹æ•°é‡ï¼Œå¦å¤–ç”±äºselecté‡‡ç”¨è½®è¯¢çš„æ–¹å¼æ‰«ææ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥æ–‡ä»¶æè¿°ç¬¦è¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®</li>
<li>å†…æ ¸/ç”¨æˆ·ç©ºé—´å†…å­˜æ‹·è´é—®é¢˜ï¼Œselectéœ€è¦å¤åˆ¶å¤§é‡çš„å¥æŸ„æ•°æ®ç»“æ„ï¼Œä¼šäº§ç”Ÿè¾ƒå¤§å¼€é”€</li>
<li>selectè¿”å›çš„æ˜¯å«æœ‰æ•´ä¸ªå¥æŸ„çš„æ•°ç»„ï¼Œåº”ç”¨ç¨‹åºéœ€è¦éå†æ•´ä¸ªæ•°ç»„æ‰èƒ½çŸ¥æ™“å“ªäº›å¥æŸ„å‘ç”Ÿäº†æ—¶é—´</li>
<li>selectè§¦å‘æ–¹å¼æ˜¯æ°´å¹³è§¦å‘ï¼Œåº”ç”¨ç¨‹åºå¦‚æœæ²¡æœ‰å®Œæˆå¯¹ä¸€ä¸ªå·²ç»å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦è¿›è¡ŒIOï¼Œé‚£ä¹ˆä¹‹åå†æ¬¡selectè°ƒç”¨è¿˜æ˜¯ä¼šå°†è¿™äº›æ–‡ä»¶æè¿°ç¬¦é€šçŸ¥è¿›ç¨‹</li>
</ul>
<p>ç›¸æ¯”äºselectæ¨¡å‹ï¼Œpollä½¿ç”¨é“¾è¡¨ä¿å­˜æ–‡ä»¶æè¿°ç¬¦ï¼Œå› æ­¤æ²¡æœ‰ç›‘è§†æ–‡ä»¶æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼ŒåŒæ—¶å½“æ–‡ä»¶æè¿°ç¬¦æ•°é‡è¾ƒå°‘æ—¶ï¼Œpollçš„æ€§èƒ½è¡¨ç°ä¹Ÿä¼šå¥½äºselect</p>
<p>nodejsä½¿ç”¨epollæ¨¡å‹çš„åŸå› æ˜¯ï¼šepollå¹¶ä¸æ˜¯é‡‡ç”¨è½®è¯¢æ–¹å¼å»ç›‘å¬äº†ï¼Œè€Œæ˜¯å½“socketæœ‰å˜åŒ–æ—¶é€šè¿‡å›è°ƒçš„æ–¹å¼ä¸»åŠ¨å‘ŠçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚èƒ½å¤Ÿæœ‰æ•ˆæå‡CPUåˆ©ç”¨ç‡ã€‚</p>
<h4 id="epollå®ç°æœºåˆ¶"><a href="#epollå®ç°æœºåˆ¶" class="headerlink" title="epollå®ç°æœºåˆ¶"></a>epollå®ç°æœºåˆ¶</h4><p>epollé€šè¿‡åœ¨Linuxå†…æ ¸ä¸­ç”³è¯·ä¸€ä¸ªç®€æ˜“çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒæŠŠåŸå…ˆçš„select/pollè°ƒç”¨åˆ†æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>è°ƒç”¨epoll_create()å»ºç«‹ä¸€ä¸ªepollå¯¹è±¡</li>
<li>è°ƒç”¨epoll_ctl()å‘epollå¯¹è±¡ä¸­ä½“æ£€è¿æ¥å¥—æ¥å­—</li>
<li>è°ƒç”¨epoll_wait()æ”¶é›†å‘ç”Ÿäº‹ä»¶çš„è¿æ¥</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°epollæ¯”select/pollçš„ä¼˜è¶Šä¹‹å¤„ï¼šå› ä¸ºåè€…æ¯æ¬¡è°ƒç”¨æ—¶éƒ½è¦ä¼ é€’ä½ æ‰€è¦ç›‘æ§çš„æ‰€æœ‰socketç»™select/pollç³»ç»Ÿè°ƒç”¨ï¼Œè¿™æ„å‘³ç€éœ€è¦å°†ç”¨æˆ·æ€çš„socketåˆ—è¡¨copyåˆ°å†…æ ¸æ€ï¼Œå¦‚æœä»¥ä¸‡è®¡çš„å¥æŸ„ä¼šå¯¼è‡´æ¯æ¬¡éƒ½è¦copyå‡ åå‡ ç™¾KBçš„å†…å­˜åˆ°å†…æ ¸æ€ï¼Œéå¸¸ä½æ•ˆã€‚è€Œæˆ‘ä»¬è°ƒç”¨epoll_waitæ—¶å°±ç›¸å½“äºä»¥å¾€è°ƒç”¨select/pollï¼Œä½†æ˜¯è¿™æ—¶å´ä¸ç”¨ä¼ é€’socketå¥æŸ„ç»™å†…æ ¸ï¼Œå› ä¸ºå†…æ ¸å·²ç»åœ¨epoll_ctlä¸­æ‹¿åˆ°äº†è¦ç›‘æ§çš„å¥æŸ„åˆ—è¡¨ã€‚</p>
<p>æ‰€ä»¥ï¼Œå®é™…ä¸Šåœ¨ä½ è°ƒç”¨epoll_createåï¼Œå†…æ ¸å°±å·²ç»åœ¨å†…æ ¸æ€å¼€å§‹å‡†å¤‡å¸®ä½ å­˜å‚¨è¦ç›‘æ§çš„å¥æŸ„äº†ï¼Œæ¯æ¬¡è°ƒç”¨epoll_ctlåªæ˜¯åœ¨å¾€å†…æ ¸çš„æ•°æ®ç»“æ„é‡Œå¡å…¥æ–°çš„socketå¥æŸ„ã€‚</p>
<p>æ€§èƒ½å¯¹æ¯”ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># operations  |  poll  |  select   | epoll</span></div><div class="line"><span class="number">10</span>            |  <span class="number">0.61</span>  |  <span class="number">0.73</span>     | <span class="number">0.41</span></div><div class="line"><span class="number">100</span>           |  <span class="number">2.9</span>   |  <span class="number">3.0</span>      | <span class="number">0.42</span></div><div class="line"><span class="number">1000</span>          |  <span class="number">35</span>    |  <span class="number">35</span>       | <span class="number">0.53</span></div><div class="line"><span class="number">10000</span>         |  <span class="number">990</span>   |  <span class="number">930</span>      | <span class="number">0.66</span></div></pre></td></tr></table></figure>
<p><strong> éœ€è¦æ³¨æ„çš„æ˜¯ï¼šepollå¹¶ä¸æ˜¯åœ¨æ‰€æœ‰çš„åº”ç”¨åœºæ™¯éƒ½ä¼šæ¯”selectå’Œpollé«˜å¾ˆå¤šã€‚å°¤å…¶æ˜¯å½“æ´»åŠ¨è¿æ¥æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå›è°ƒå‡½æ•°è¢«è§¦å‘å¾—è¿‡äºé¢‘ç¹çš„æ—¶å€™ï¼Œepollçš„æ•ˆç‡ä¹Ÿä¼šå—åˆ°æ˜¾è‘—å½±å“ï¼æ‰€ä»¥ï¼Œepollç‰¹åˆ«é€‚ç”¨äºè¿æ¥æ•°é‡å¤šï¼Œä½†æ´»åŠ¨è¿æ¥è¾ƒå°‘çš„æƒ…å†µã€‚ </strong></p>
<h3 id="LTï¼ˆæ°´å¹³è§¦å‘ï¼‰å’ŒETï¼ˆè¾¹ç¼˜è§¦å‘ï¼‰"><a href="#LTï¼ˆæ°´å¹³è§¦å‘ï¼‰å’ŒETï¼ˆè¾¹ç¼˜è§¦å‘ï¼‰" class="headerlink" title="LTï¼ˆæ°´å¹³è§¦å‘ï¼‰å’ŒETï¼ˆè¾¹ç¼˜è§¦å‘ï¼‰"></a>LTï¼ˆæ°´å¹³è§¦å‘ï¼‰å’ŒETï¼ˆè¾¹ç¼˜è§¦å‘ï¼‰</h3><p>epollå¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæœ‰ä¸¤ç§æ¨¡å¼ï¼šLTï¼ˆlevel triggerï¼‰å’ŒETï¼ˆedge triggerï¼‰ã€‚LTæ¨¡å¼æ˜¯é»˜è®¤æ¨¡å¼ï¼ŒLTæ¨¡å¼ä¸ETæ¨¡å¼çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>LTï¼šæ°´å¹³è§¦å‘ï¼Œæ•ˆç‡ä¼šä½äºETè§¦å‘ï¼Œå°¤å…¶åœ¨å¤§å¹¶å‘ï¼Œå¤§æµé‡çš„æƒ…å†µä¸‹ã€‚ä½†æ˜¯LTå¯¹ä»£ç ç¼–å†™è¦æ±‚æ¯”è¾ƒä½ï¼Œä¸å®¹æ˜“å‡ºç°é—®é¢˜ã€‚LTæ¨¡å¼æœåŠ¡ç¼–å†™ä¸Šçš„è¡¨ç°æ˜¯ï¼šåªè¦æœ‰æ•°æ®æ²¡æœ‰è¢«è·å–ï¼Œå†…æ ¸å°±ä¸æ–­é€šçŸ¥ä½ ï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒäº‹ä»¶ä¸¢å¤±çš„æƒ…å†µã€‚å½“epoll_waitæ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚ä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚</p>
</li>
<li><p>ETï¼šè¾¹ç¼˜è§¦å‘ï¼Œæ•ˆç‡éå¸¸é«˜ï¼Œåœ¨å¹¶å‘ï¼Œå¤§æµé‡çš„æƒ…å†µä¸‹ï¼Œä¼šæ¯”LTå°‘å¾ˆå¤šepollçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤æ•ˆç‡é«˜ã€‚ä½†æ˜¯å¯¹ç¼–ç¨‹è¦æ±‚é«˜ï¼Œéœ€è¦ç»†è‡´çš„å¤„ç†æ¯ä¸ªè¯·æ±‚ï¼Œå¦åˆ™å®¹æ˜“å‘ç”Ÿä¸¢å¤±äº‹ä»¶çš„æƒ…å†µã€‚å½“epoll_waitæ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚å¦‚æœä¸å¤„ç†ï¼Œä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¸ä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚ETæ¨¡å¼åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†epolläº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯”LTæ¨¡å¼é«˜ã€‚epollå·¥ä½œåœ¨ETæ¨¡å¼çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨éé˜»å¡å¥—æ¥å£ï¼Œä»¥é¿å…ç”±äºä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡è¯»/é˜»å¡å†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚</p>
</li>
</ul>
<h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><p><a href="https://ruby-china.org/topics/35472" target="_blank" rel="external">IO æ¨¡å¼å’Œ IO å¤šè·¯å¤ç”¨ Â· Ruby China</a><br><a href="https://idea.popcount.org/2017-01-06-select-is-fundamentally-broken/" target="_blank" rel="external">Select is fundamentally broken â€”    Idea of the day</a><br><a href="https://jvns.ca/blog/2017/06/03/async-io-on-linux--select--poll--and-epoll/" target="_blank" rel="external">Async IO on Linux: select, poll, and epoll - Julia Evans</a><br>[é«˜å¹¶å‘ç½‘ç»œç¼–ç¨‹ä¹‹epollè¯¦è§£]<a href="http://www.cnblogs.com/wuchanming/p/4349743.html" target="_blank" rel="external">http://www.cnblogs.com/wuchanming/p/4349743.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç°åœ¨æ“ä½œç³»ç»Ÿéƒ½é‡‡ç”¨è™šæ‹Ÿå¯»å€ï¼Œå¤„ç†å™¨å…ˆäº§ç”Ÿä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œé€šè¿‡åœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€ï¼ˆå†…å­˜çš„åœ°å€ï¼‰ï¼Œå†é€šè¿‡æ€»çº¿çš„ä¼ é€’ï¼Œæœ€åå¤„ç†å™¨æ‹¿åˆ°æŸä¸ªç‰©ç†åœ°å€è¿”å›çš„å­—èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹32ä½æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå®ƒçš„å¯»å€ç©ºé—´ï¼ˆè™šæ‹Ÿå­˜å‚¨ç©ºé—´ï¼‰ä¸º4Gï¼ˆ2çš„32æ¬¡æ–¹ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ ¸ç©ºé—´ï¼šåœ¨liunx
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="Linux æ“ä½œç³»ç»Ÿ æœåŠ¡å™¨ç¼–ç¨‹" scheme="http://blog.yinwoods.work/tags/Linux-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>é…ç½®ä¸åŒå±€åŸŸç½‘sshäº’è”</title>
    <link href="http://blog.yinwoods.work/2017/12/30/%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%B1%80%E5%9F%9F%E7%BD%91ssh%E4%BA%92%E8%81%94/"/>
    <id>http://blog.yinwoods.work/2017/12/30/é…ç½®ä¸åŒå±€åŸŸç½‘sshäº’è”/</id>
    <published>2017-12-30T06:54:00.000Z</published>
    <updated>2017-12-30T06:54:42.677Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æ–°å‘å®éªŒå®¤ç”³è¯·äº†ä¸‰å°æœåŠ¡å™¨ç”¨äºåšæ¯•ä¸šè®¾è®¡ï¼Œä½†æ˜¯å› ä¸ºä¸å¸¸åœ¨å®éªŒå®¤ï¼Œæ‰€ä»¥æƒ³åˆ°æœ‰æ²¡æœ‰ä¸€ä¸ªå¥½çš„æ–¹æ³•èƒ½å¤Ÿåšåˆ°å³ä½¿ä¸åœ¨å®éªŒå®¤çš„å±€åŸŸç½‘ä¸­ä¹Ÿèƒ½å¤Ÿsshåˆ°å®éªŒå®¤çš„æœºå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´åšåˆ°ä»ä¸€ä¸ªå±€åŸŸç½‘ä¸­çš„Aæœºå™¨sshè‡³å¦ä¸€ä¸ªå±€åŸŸç½‘ä¸­çš„Bæœºå™¨ã€‚</p>
<p>å…¶å®å¤§æ¦‚æƒ³ä¸€ä¸‹ï¼Œå°±çŸ¥é“å®Œå…¨æ˜¯å¯è¡Œçš„ï¼Œæ¯•ç«ŸAä¸Béƒ½è”ç½‘äº†ï¼Œæ²¡é“ç†è”ç½‘çš„æœºå™¨å´æ— æ³•äº’ç›¸é€šä¿¡ã€‚ä½†ä¹Ÿå¾ˆå®¹æ˜“æƒ³åˆ°å­˜åœ¨çš„é™åˆ¶ï¼Œå°±æ˜¯æˆ‘æ€ä¹ˆæ‹¿åˆ°Bçš„å”¯ä¸€IDï¼Œä»¥æ­¤æ¥ä¸å®ƒå»ºç«‹é€šä¿¡å‘¢ï¼Ÿä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬sshç”¨çš„æ˜¯åŸŸåæˆ–è€…å…¬ç½‘IPï¼ˆå½’æ ¹ç»“åº•å°±æ˜¯å…¬ç½‘IPï¼‰ï¼Œç”±æ­¤æƒ³åˆ°èƒ½å¦åˆ©ç”¨ä¸€å°å…·å¤‡å…¬ç½‘IPçš„æœºå™¨Cä½œä¸ºä¸¤ä¸ªå±€åŸŸç½‘ABä¹‹é—´çš„è·³æ¿æœºå‘¢ï¼Ÿ</p>
<p>çœ‹äº†ä¸‹sshå‘½ä»¤ï¼Œå‘ç°æ˜¯å¯ä»¥çš„ï¼Œä¸éœ€è¦å®‰è£…å…¶ä»–è½¯ä»¶ï¼Œä»…å€ŸåŠ©sshå³å¯å®ç°ã€‚</p>
<p>åœ¨æœºå™¨Bä¸Šæ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -fCNR &lt;port1&gt;:localhost:22 username@C</div></pre></td></tr></table></figure>
<p>å‘½ä»¤çš„æ„æ€æ˜¯åœ¨Cä¸Šåšç«¯å£è½¬å‘ï¼Œå°†Cæœºå™¨çš„port1ç«¯å£è½¬å‘åˆ°Bæœºå™¨çš„22ç«¯å£ï¼ˆ22æ˜¯sshdçš„é»˜è®¤ç«¯å£ï¼‰</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿåšåˆ°ä½¿ç”¨A sshè¿å…¥Cï¼Œå†æ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -p port1 localhost</div></pre></td></tr></table></figure>
<p>å³å¯sshè¿å…¥B</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘æ–°å‘å®éªŒå®¤ç”³è¯·äº†ä¸‰å°æœåŠ¡å™¨ç”¨äºåšæ¯•ä¸šè®¾è®¡ï¼Œä½†æ˜¯å› ä¸ºä¸å¸¸åœ¨å®éªŒå®¤ï¼Œæ‰€ä»¥æƒ³åˆ°æœ‰æ²¡æœ‰ä¸€ä¸ªå¥½çš„æ–¹æ³•èƒ½å¤Ÿåšåˆ°å³ä½¿ä¸åœ¨å®éªŒå®¤çš„å±€åŸŸç½‘ä¸­ä¹Ÿèƒ½å¤Ÿsshåˆ°å®éªŒå®¤çš„æœºå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´åšåˆ°ä»ä¸€ä¸ªå±€åŸŸç½‘ä¸­çš„Aæœºå™¨sshè‡³å¦ä¸€ä¸ªå±€åŸŸç½‘ä¸­çš„Bæœºå™¨ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®å¤§æ¦‚æƒ³ä¸€ä¸‹ï¼Œå°±çŸ¥é“å®Œå…¨æ˜¯å¯è¡Œçš„ï¼Œæ¯•
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="ssh ç«¯å£è½¬å‘" scheme="http://blog.yinwoods.work/tags/ssh-%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>AWSä¸Škafkaç«¯å£å¼€æ”¾å¤–ç½‘è®¿é—®é—®é¢˜è§£å†³æ–¹æ³•</title>
    <link href="http://blog.yinwoods.work/2017/11/15/AWS%E4%B8%8AKafka%E7%AB%AF%E5%8F%A3%E5%A4%96%E7%BD%91%E5%BC%80%E6%94%BE%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
    <id>http://blog.yinwoods.work/2017/11/15/AWSä¸ŠKafkaç«¯å£å¤–ç½‘å¼€æ”¾é—®é¢˜è§£å†³æ–¹æ³•/</id>
    <published>2017-11-15T14:23:00.000Z</published>
    <updated>2017-11-16T07:45:10.954Z</updated>
    
    <content type="html"><![CDATA[<p>ç›®å‰å…¬å¸é‡‡ç”¨ELKæ¥å­˜æ”¾ä»¥åŠåˆ©ç”¨æ—¥å¿—ï¼Œé‡‡ç”¨filebeatå°†æ—¥å¿—å‘é€è‡³Kafkaï¼Œä¹‹åå†å†™ä¸€ä¸ªpythonè„šæœ¬ä½œä¸ºæ¶ˆè´¹è€…æŠŠKafkaå†…çš„æ—¥å¿—æ‹‰å–ä¸‹æ¥å¹¶æ‰“å…¥åˆ°elasticsearchä¸­ï¼Œä¾›åæœŸæŸ¥è¯¢æ£€ç´¢ä½¿ç”¨ã€‚</p>
<p>æœ¬æ¥è¿™æ˜¯ä¸€å¥—æ¯”è¾ƒå®Œå¤‡çš„æµç¨‹ï¼Œä½†ç”±äºæœ€è¿‘æ¥äº†æ–°çš„ä¸šåŠ¡ï¼Œè€Œæ–°äº§ç”Ÿçš„æ—¥å¿—åœ¨å¯¹æ–¹çš„æœºå™¨ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦æŠŠKafkaç«¯å£å¼€æ”¾è‡³å…¬ç½‘ï¼Œä¾›å¤–éƒ¨æœºå™¨å†™å…¥æ¶ˆæ¯ï¼›</p>
<p>åœ¨ç¡®è®¤Kafkaç«¯å£å¼€æ”¾åï¼Œè¿œç¨‹ä¸»æœºå¯ä»¥è¿æ¥Kafkaå¹¶å»ºç«‹topicï¼Œä½†æ˜¯å´æ— æ³•å†™æ—¥å¿—ï¼›ä¸­é—´æŠ˜è…¾äº†å¥½å‡ ä¸ªå°æ—¶æ‰æŠ˜è…¾å‡ºæ¥ï¼Œè§‰å¾—æœ‰å¿…è¦è®°å½•ä¸€ä¸‹ï¼Œé¿å…åäººè¸©å‘ã€‚</p>
<p>é¦–å…ˆåˆ†åˆ«ä¿®æ”¹kafkaé›†ç¾¤å†…æœºå™¨é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<p> config/server.properties:</p>
<ul>
<li><code>advertised.host=PUBLIC_IP</code></li>
<li><code>host.name=HOST_NAME</code></li>
<li>host.port=9092</li>
</ul>
<p>config/producer.properties:</p>
<ul>
<li><code>metadata.broker.list=PUBLIC_IP</code></li>
</ul>
<p>è¿™æ ·è®¾ç½®ä¹‹åï¼Œè¿œç¨‹ä¸»æœºä»ç„¶æ— æ³•å†™æ•°æ®ï¼Œè¿™æ˜¯å› ä¸ºè¿œç¨‹ä¸»æœºæ— æ³•ç›´æ¥è¿æ¥<code>HOST_NAME</code>ï¼›ç”±æ­¤æƒ³åˆ°ä¿®æ”¹è¿œç¨‹ä¸»æœºçš„<code>/etc/hosts</code>ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<p>/etc/hosts:</p>
<ul>
<li><code>PUBLIC_IP1</code> <code>HOST_NAME1</code></li>
<li><code>PUBLIC_IP2</code> <code>HOST_NAME2</code></li>
<li><code>PUBLIC_IP3</code> <code>HOST_NAME3</code></li>
<li>â€¦</li>
<li><code>PUBLIC_IPn</code> <code>HOST_NAMEn</code></li>
</ul>
<p>ç»¼ä¸Šï¼Œç»è¿‡ä¸Šé¢çš„è¿™äº›é…ç½®ï¼Œç°åœ¨filebeatå°±å¯ä»¥å‘Kafkaæ‰“æ—¥å¿—äº†ï½</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç›®å‰å…¬å¸é‡‡ç”¨ELKæ¥å­˜æ”¾ä»¥åŠåˆ©ç”¨æ—¥å¿—ï¼Œé‡‡ç”¨filebeatå°†æ—¥å¿—å‘é€è‡³Kafkaï¼Œä¹‹åå†å†™ä¸€ä¸ªpythonè„šæœ¬ä½œä¸ºæ¶ˆè´¹è€…æŠŠKafkaå†…çš„æ—¥å¿—æ‹‰å–ä¸‹æ¥å¹¶æ‰“å…¥åˆ°elasticsearchä¸­ï¼Œä¾›åæœŸæŸ¥è¯¢æ£€ç´¢ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¥è¿™æ˜¯ä¸€å¥—æ¯”è¾ƒå®Œå¤‡çš„æµç¨‹ï¼Œä½†ç”±äºæœ€è¿‘æ¥äº†æ–°çš„ä¸šåŠ¡ï¼Œ
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="kafka aws" scheme="http://blog.yinwoods.work/tags/kafka-aws/"/>
    
  </entry>
  
  <entry>
    <title>druid hadoop index ä»»åŠ¡æ€§èƒ½è°ƒä¼˜</title>
    <link href="http://blog.yinwoods.work/2017/08/22/druid-hadoop-index%E4%BB%BB%E5%8A%A1%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/"/>
    <id>http://blog.yinwoods.work/2017/08/22/druid-hadoop-indexä»»åŠ¡æ€§èƒ½è°ƒä¼˜/</id>
    <published>2017-08-22T14:23:00.000Z</published>
    <updated>2017-08-22T14:43:59.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h3><p>ç”±äºæ—¥å¸¸æ‰€åšç»Ÿè®¡å¤šæ•°åŸºäºä¸€ä»½æ‹¼æ¥æ—¥å¿—ï¼Œç»“åˆæœ€è¿‘åšçš„druidç›¸å…³å·¥ä½œï¼Œå¾ˆè‡ªç„¶çš„æƒ³åˆ°æŠŠæ‹¼æ¥æ—¥å¿—ä¸€äº›ç»Ÿè®¡å¸¸ç”¨å­—æ®µselect group by å‡ºæ¥é€šè¿‡ druidç»Ÿè®¡ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠè‡ªå·±ä»æ¯ç‡¥ç¹ççš„ç»Ÿè®¡è„šæœ¬ä¸­è§£è„±å‡ºæ¥äº†ã€‚</p>
<h3 id="æ€§èƒ½è°ƒä¼˜"><a href="#æ€§èƒ½è°ƒä¼˜" class="headerlink" title="æ€§èƒ½è°ƒä¼˜"></a>æ€§èƒ½è°ƒä¼˜</h3><p>ä½†æ˜¯åœ¨æ‰§è¡Œdruidçš„indexä»»åŠ¡æ—¶é‡åˆ°äº†ä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡ä¹…çš„é—®é¢˜ï¼Œç”±äºé›†ç¾¤ä¸Šè¿˜æœ‰å…¶ä»–ä¾‹è¡ŒæœåŠ¡éœ€è¦èµ„æºï¼Œå› æ­¤æˆ‘è¿™ä¸ªä½ä¼˜å…ˆçº§çš„ä»»åŠ¡å¿…é¡»èƒ½å¤Ÿå¿«é€Ÿæ‰§è¡Œå®Œæˆæ‰å¯ä»¥ã€‚é€šè¿‡è¯•é”™ä»¥åŠå¯¹ç½‘ä¸Šç›¸å…³èµ„æ–™çš„æœç´¢ï¼Œå¾—åˆ°ä¸€ä¸‹å‡ ç§æ–¹æ³•ï¼š</p>
<ul>
<li>é€šè¿‡è®¾ç½®yarnçš„è°ƒåº¦ç­–ç•¥ï¼Œä¸ºè¿™ç§é»˜è®¤å ç”¨èµ„æºå¤šã€æ‰§è¡Œæ—¶é—´ä¹…çš„ä»»åŠ¡å•ç‹¬å¼€è¾Ÿä¸€ä¸ªé˜Ÿåˆ—ï¼Œé™åˆ¶å…¶èƒ½å¤Ÿä½¿ç”¨çš„æœ€å¤§èµ„æºé‡ï¼Œä»è€Œä¿è¯å…¶ä»–é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡èƒ½å¤ŸåŠæ—¶å¾—åˆ°å¤„ç†ã€‚è€Œhadoop indexä»»åŠ¡å¯ä»¥é€šè¿‡åœ¨tuningConfigä¸­çš„jobPropertiesè®¾ç½®mapreduce.job.queuename</li>
<li>é™ä½æ¯ä¸ªsegmentçš„è¡Œæ•°ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡è®¾ç½®targetPartitionSizeå®Œæˆã€‚å› ä¸ºä¸€ä¸ªsegmentå¯¹åº”ä¸€ä¸ªreducerï¼Œæ‰€ä»¥é€šè¿‡å‡å°‘è¡Œæ•°ï¼Œå¢åŠ segmentsä¸ªæ•°ä»è€Œå¢åŠ reducerä¸ªæ•°ï¼Œå……åˆ†åº”ç”¨å¹¶è¡ŒåŒ–ã€‚</li>
<li>åœ¨ioConfigä¸­è®¾ç½®rowFlushBoundaryå­—æ®µï¼Œå¹¶å°½å¯èƒ½å¤§ã€‚è¿™ä¸ªå‚æ•°æ„å‘³ç€åœ¨å°†æ•°æ®å†™å…¥ç£ç›˜å‰å †ä¸­ç¼“å­˜çš„è¡Œæ•°ï¼Œé€šè¿‡æé«˜ç¼“å­˜ä»è€Œä¼˜åŒ–ä»»åŠ¡æ‰§è¡Œæ•ˆç‡ã€‚ä½†ä¹Ÿè¦æ³¨æ„è®¾ç½®ä¸è¦è¶…è¿‡å †å†…å­˜çš„ä¸Šé™ã€‚</li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul>
<li><p>1ã€<a href="https://groups.google.com/forum/#!topic/druid-user/hG8ctsdt7XA" target="_blank" rel="external">Scheduling Hadoop indexing tasks in specific YARN queue</a></p>
</li>
<li><p>2ã€<a href="https://groups.google.com/forum/#!msg/druid-user/w82AsjkHzzk/qIxbjrcVBgAJ" target="_blank" rel="external">Druid hadoop EMR indexing is extremly slow</a></p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;èµ·å› &quot;&gt;&lt;/a&gt;èµ·å› &lt;/h3&gt;&lt;p&gt;ç”±äºæ—¥å¸¸æ‰€åšç»Ÿè®¡å¤šæ•°åŸºäºä¸€ä»½æ‹¼æ¥æ—¥å¿—ï¼Œç»“åˆæœ€è¿‘åšçš„druidç›¸å…³å·¥ä½œï¼Œå¾ˆè‡ªç„¶çš„æƒ³åˆ°æŠŠæ‹¼æ¥æ—¥å¿—ä¸€äº›ç»Ÿè®¡å¸¸ç”¨å­—æ®µselect group by
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="druid" scheme="http://blog.yinwoods.work/tags/druid/"/>
    
  </entry>
  
  <entry>
    <title>druidå†…å­˜å ç”¨è¿‡å¤šé—®é¢˜æ’æŸ¥</title>
    <link href="http://blog.yinwoods.work/2017/08/02/druid%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"/>
    <id>http://blog.yinwoods.work/2017/08/02/druidå†…å­˜å ç”¨è¿‡å¤šé—®é¢˜æ’æŸ¥/</id>
    <published>2017-08-02T13:53:00.000Z</published>
    <updated>2017-08-02T14:05:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ä½¿ç”¨druidæ¥åšå¹¿å‘Šå¹³å°çš„å®æ—¶åˆ†æï¼Œå‘ç°åå°å†…å­˜å ç”¨é•¿æœŸä¸º48Gï¼ˆä¸€å…±56Gï¼‰ï¼Œèµ·åˆæ€€ç–‘æ˜¯å› ä¸ºæ¯å¤©dataSourceæ•°æ®é‡è¾ƒå¤§ï¼Œå¦‚æœdruidå°†æ‰€æœ‰æ•°æ®åŠ è½½è¿›å†…å­˜å¤„ç†åˆ™ä¼šå¯¼è‡´è¿™ä¹ˆ48Gçš„å†…å­˜å ç”¨ï¼›ä½†æ˜¯åœ¨å¯¹dataSourceåšreindexå¤„ç†åï¼ŒdataSourceå¤§å°ç¼©å‡ä¸º5Må·¦å³çš„æƒ…å†µä¸‹å†…å­˜ä»ç„¶æ²¡æœ‰é™ä¸‹æ¥ã€‚</p>
<p>é€šè¿‡å¯¹ç³»ç»ŸçŠ¶å†µçš„ç»¼åˆè€ƒè™‘ï¼Œç°åœ¨æœ‰ä»¥ä¸‹ä¸¤ä¸ªçŒœæƒ³ï¼š</p>
<ul>
<li>druidé…ç½®é”™è¯¯ï¼Œå³ä½¿dataSourceå¾ˆå°ï¼Œdruidä»ç„¶æŠ¢ç€å†…å­˜ä¸æ”¾</li>
<li>reindexæ“ä½œé”™è¯¯ï¼Œä¹‹å‰çš„segmentå¹¶æœªåˆ é™¤ï¼Œdruidä»ç„¶åŠ è½½å†…å­˜å¯¼è‡´å†…å­˜æº¢å‡º</li>
</ul>
<p>å…¶å®è¿™é‡Œä¹‹æ‰€ä»¥å¯¹é—®é¢˜äº§ç”Ÿçš„åŸå› ä¸ç¡®å®šï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å› ä¸ºè‡ªå·±å¯¹druidè¿™ä¸€å¥—æœåŠ¡å¹¶ä¸äº†è§£ï¼Œç»è¿‡æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£åˆ°druidå¹¶ä¸ä¼šæŠŠæ‰€æœ‰çš„æ•°æ®åŠ è½½è¿›å†…å­˜å†å¤„ç†ã€‚ è€Œä¸”ï¼Œåœ¨æ‰§è¡Œreindexæ—¶ï¼Œhistoricalçš„æ•°æ®ä¼šè¢«åˆ é™¤ï¼Œä½†deep storageå†…çš„æ•°æ®ä»ç„¶ä¿ç•™ï¼›åœ¨å¤„ç†åç»­æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­historicalä¹Ÿä¸ä¼šæŒ‰éœ€é‡æ–°å°†deep storageä¸­çš„æ•°æ®åŠ è½½è¿›æ¥ã€‚å¦‚æœç¡®å®æœ‰æŸ¥è¯¢å·²åˆ é™¤segmentæ•°æ®çš„éœ€æ±‚ï¼Œå¯ä»¥å…ˆå°†æ•°æ®ä»deep segmentå¯¼å…¥historicalï¼Œä¹‹åå†æŸ¥è¯¢ã€‚å¦‚æœæƒ³ä»deep storageä¸­åˆ é™¤segmentå¯ä»¥å‚è€ƒï¼š<a href="http://druid.io/docs/latest/misc/tasks.html" target="_blank" rel="external">ğŸ”—</a></p>
<p>historicalå¹¶ä¸ä¼šæŒ‰éœ€å°†æ‰€æœ‰æ•°æ®å­˜å…¥segmentCacheï¼Œåªæœ‰åœ¨coordinatorè¦æ±‚historicalæå‰è½½å…¥ä¸€ä¸ªsegmentæ—¶æ‰ä¼šæŠŠæ•°æ®å­˜å…¥segmentCacheã€‚ä¹Ÿå°±æ˜¯è¯´historicalåœ¨åŠ è½½æ•°æ®æ—¶ä¼šå…ˆå°†æ‰€æœ‰çš„segmentæ•°æ®ä¸‹è½½è‡³æœ¬åœ°ç¡¬ç›˜ï¼Œå› æ­¤è¦æ³¨æ„åœ¨åŠ è½½æ•°æ®ä¹‹å‰éœ€è¦ä¿è¯historicalèŠ‚ç‚¹æœ‰è¶³å¤Ÿçš„ç¡¬ç›˜ç©ºé—´å­˜æ”¾è¿™äº›æ•°æ®ã€‚</p>
<p>å¯¹äºæŸ¥è¯¢é¢‘ç‡ä¸é«˜çš„å†å²æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªåŠæ³•æ¥é™ä½æˆæœ¬ï¼š</p>
<p>1ã€åœ¨æ€§èƒ½ç›¸å¯¹è¾ƒå·®çš„æœºå™¨ä¸Šï¼ˆæ¯”å¦‚ä½¿ç”¨æœºæ¢°ç¡¬ç›˜è€Œä¸æ˜¯SSDï¼‰æ„å»ºhistoricalèŠ‚ç‚¹å¹¶è®¾ç½®tierè§„åˆ™æ¥ä¸“é—¨å¤„ç†è¿™äº›å†å²æ•°æ®</p>
<p>2ã€å¦ä¸€ä¸ªæ–¹æ³•æ˜¯å¯¹è¶…è¿‡æŸä¸ªå†å²æ—¶æœŸçš„æ•°æ®è®¾ç½®è¾ƒå¤§çš„query granularityï¼Œä»è€Œé™ä½segmentå¤§å°ï¼›</p>
<p>å…·ä½“çš„historical tieré…ç½®å‚è€ƒ<a href="http://druid.io/docs/latest/configuration/historical.html" target="_blank" rel="external">ğŸ”—</a> </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘ä½¿ç”¨druidæ¥åšå¹¿å‘Šå¹³å°çš„å®æ—¶åˆ†æï¼Œå‘ç°åå°å†…å­˜å ç”¨é•¿æœŸä¸º48Gï¼ˆä¸€å…±56Gï¼‰ï¼Œèµ·åˆæ€€ç–‘æ˜¯å› ä¸ºæ¯å¤©dataSourceæ•°æ®é‡è¾ƒå¤§ï¼Œå¦‚æœdruidå°†æ‰€æœ‰æ•°æ®åŠ è½½è¿›å†…å­˜å¤„ç†åˆ™ä¼šå¯¼è‡´è¿™ä¹ˆ48Gçš„å†…å­˜å ç”¨ï¼›ä½†æ˜¯åœ¨å¯¹dataSourceåšreindexå¤„ç†åï¼ŒdataSourc
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="druid" scheme="http://blog.yinwoods.work/tags/druid/"/>
    
  </entry>
  
  <entry>
    <title>airflow + celery è¸©å‘è®°å½•</title>
    <link href="http://blog.yinwoods.work/2017/07/26/airflow+celery%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
    <id>http://blog.yinwoods.work/2017/07/26/airflow+celeryè¸©å‘è®°å½•/</id>
    <published>2017-07-26T09:02:00.000Z</published>
    <updated>2017-07-26T15:51:13.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åˆè¯†-airflow"><a href="#åˆè¯†-airflow" class="headerlink" title="åˆè¯† airflow"></a>åˆè¯† <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a></h3><p>å…¶å®æ—©åœ¨å»å¹´å°±å·²ç»æ¥è§¦åˆ° <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> äº†ï¼Œå½“æ—¶çš„éœ€æ±‚æ˜¯æŒ‰å°æ—¶æ‹¼æ¥ä¸¤ä»½çº¿ä¸Šæ—¥å¿—ï¼Œè€Œæ‹¼æ¥æ“ä½œå¿…é¡»ä¾èµ–äºä¸¤ä»½æ—¥å¿—çš„å®Œæ•´æ€§ã€‚ä»è¿™ä¸ªéœ€æ±‚å‡ºå‘ï¼Œäº†è§£åˆ°äº† <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ï¼Œä½†è¿«äºå®˜æ–¹æ–‡æ¡£çš„æ™¦æ¶©éš¾æ‡‚ï¼Œå†åŠ ä¸Šè¿™ä¸ªä»»åŠ¡å¯¹ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> çš„éœ€æ±‚ä¸å¤Ÿå¼ºï¼Œå°±å¼ƒå‘äº†ï¼›æœ€åä½¿ç”¨ python è„šæœ¬ä¸­ä¸€ä¸ª while True æ­»å¾ªç¯ + time.sleep() æ¥è§£å†³é—®é¢˜(å¦‚æœæ‰€ä¾èµ–çš„æ—¥å¿—æ²¡æœ‰å®Œå…¨å†™å…¥ï¼Œåˆ™ sleep ä¸€æ®µæ—¶é—´)ã€‚</p>
<h3 id="æ­£å¼å…¥å‘"><a href="#æ­£å¼å…¥å‘" class="headerlink" title="æ­£å¼å…¥å‘"></a>æ­£å¼å…¥å‘</h3><p>å‰å‡ å¤© boss å¸ƒç½®äº†ä¸€ä¸ªå¹¿å‘Šå¹³å°çš„ç»Ÿè®¡ä»»åŠ¡ï¼Œä¾èµ–å€’ä¹Ÿä¸å¤æ‚ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æœªæ¥å¹³å°çš„æ‰©å±•æ€§ï¼Œè¿˜æ˜¯éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿå¾ˆå¥½çš„å¤„ç†ç»Ÿè®¡ä»»åŠ¡çš„å·¥å…·çš„ã€‚è‡ªå·±ä¹Ÿè°ƒç ”æ¯”è¾ƒäº†ä¸€ä¸‹<code>ETL(æ•°æ®ä»“åº“)</code>è¿™æ–¹é¢çš„å·¥å…·ï¼Œç¡®å®æ•° <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> åŠŸèƒ½æœ€ä¸ºå¼ºå¤§ï¼Œæ—¢ç„¶è¿™æ ·é‚£å°±å…¥å‘å§ã€‚</p>
<h3 id="airflow-å®‰è£…é…ç½®è¿‡ç¨‹"><a href="#airflow-å®‰è£…é…ç½®è¿‡ç¨‹" class="headerlink" title="airflow å®‰è£…é…ç½®è¿‡ç¨‹"></a><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> å®‰è£…é…ç½®è¿‡ç¨‹</h3><p>è¿™é‡Œéƒ½æ˜¯æŒ‰ç…§å®˜ç½‘æ“ä½œï¼Œå…·ä½“å¦‚ä¸‹:</p>
<p>1ã€è®¾ç½® <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> é¡¹ç›®è·¯å¾„ï¼Œé»˜è®¤æ˜¯ç”¨æˆ·ä¸»ç›®å½•ä¸‹ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ï¼Œä¹Ÿå¯ä»¥æ˜¾ç¤ºç”¨ç¯å¢ƒå˜é‡ <code>AIRFLOW_HOME</code> æŒ‡å®š;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> AIRFLOW_HOME=~/airflow</div></pre></td></tr></table></figure>
<p>2ã€<a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> å®‰è£…ï¼Œå› ä¸º <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> æ˜¯åŸºäº python ç¼–å†™ï¼Œå› æ­¤å¯ä»¥ç›´æ¥åˆ©ç”¨ pip å®‰è£…ï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> è¿˜æä¾›äº†ä½¿ç”¨å…¶ä»–è½¯ä»¶çš„æ’ä»¶ï¼Œä¾‹å¦‚ mysqlã€hdfsã€hive ç­‰å·¥å…·ï¼Œå½“ç„¶è¿™äº›ä¹Ÿå¯ä»¥åœ¨åç»­éœ€è¦æ—¶å†å®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pip3 install airflow</div><div class="line"></div><div class="line"><span class="comment"># å®‰è£… [airflow](https://github.com/apache/incubator-airflow) hive æ’ä»¶</span></div><div class="line">pip3 install <span class="string">"airflow[hive]"</span></div></pre></td></tr></table></figure>
<p>3ã€åˆå§‹åŒ– <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ç›¸å…³æ•°æ®åº“</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">airflow initdb</div></pre></td></tr></table></figure>
<p>4ã€å¯åŠ¨ webserver æœåŠ¡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">airflow webserver</div></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œä¸€ä¸ªæœ€åŸºç¡€çš„ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> æœåŠ¡å°±å¯åŠ¨äº†ï¼Œä¸‹é¢è¯´ä¸€è¯´ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> çš„é…ç½®ã€‚</p>
<h3 id="airflow-åŸºç¡€é…ç½®"><a href="#airflow-åŸºç¡€é…ç½®" class="headerlink" title="airflow åŸºç¡€é…ç½®"></a><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> åŸºç¡€é…ç½®</h3><p><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> çš„é…ç½®æ–‡ä»¶ä¿å­˜åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œå‘½åä¸º airflow.cfg ï¼Œé€šè¿‡æ–‡ä»¶å†…çš„æ³¨é‡Šä¹Ÿå¯ä»¥çŸ¥é“æ¯ä¸ªé…ç½®é¡¹çš„å¤§è‡´å«ä¹‰ï¼Œè¿™é‡Œç®€å•è¯´ä¸‹å¸¸ç”¨çš„é…ç½®é¡¹ã€‚</p>
<h4 id="æ›´æ”¹æ•°æ®åº“"><a href="#æ›´æ”¹æ•°æ®åº“" class="headerlink" title="æ›´æ”¹æ•°æ®åº“"></a>æ›´æ”¹æ•°æ®åº“</h4><p><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ä¸ºäº†èƒ½å¤Ÿè®©ç”¨æˆ·å¿«é€Ÿä½¿ç”¨é€‰æ‹©äº† sqllite æ•°æ®åº“ï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¾€å¾€ mysql æ›´ä¸ºå¹¿æ³›ä½¿ç”¨ï¼Œè‹¥è¦ä½¿ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ä½¿ç”¨ mysql ï¼Œé¦–å…ˆæ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip3 install <span class="string">"airflow[mysql]"</span></div></pre></td></tr></table></figure>
<p>æ›´æ”¹ airflow.cfg ä¸­ <code>sql_alchemy_conn</code> çš„å€¼ï¼Œé€šè¿‡å˜é‡åå¯çŸ¥é…ç½®ä½¿ç”¨çš„æ˜¯ <a href="https://www.sqlalchemy.org/" target="_blank" rel="external">sql_alchemy</a> çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œå…·ä½“æ ¼å¼ä¸ºï¼š<code>mysql+pymysql://username:password@host:port/database</code>ï¼Œå½“ç„¶è¿™é‡Œ <a href="https://github.com/PyMySQL/PyMySQL" target="_blank" rel="external">pymysql</a> å¯ä»¥æ ¹æ®è‡ªå·±å–œå¥½æ›´æ¢ã€‚</p>
<p>ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åï¼Œéœ€è¦æ‰§è¡Œ <code>airflow resetdb</code> å¹¶é‡æ–°å¯åŠ¨ web æœåŠ¡(<code>airflow webserver</code>)ï¼Œæ•°æ®åº“æ›´æ¢åˆ™ç”Ÿæ•ˆã€‚</p>
<h4 id="ä¸ºwebæœåŠ¡å¼€å¯ç”¨æˆ·èº«ä»½éªŒè¯åŠŸèƒ½"><a href="#ä¸ºwebæœåŠ¡å¼€å¯ç”¨æˆ·èº«ä»½éªŒè¯åŠŸèƒ½" class="headerlink" title="ä¸ºwebæœåŠ¡å¼€å¯ç”¨æˆ·èº«ä»½éªŒè¯åŠŸèƒ½"></a>ä¸ºwebæœåŠ¡å¼€å¯ç”¨æˆ·èº«ä»½éªŒè¯åŠŸèƒ½</h4><p><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> é»˜è®¤æ˜¯æ— éœ€ç™»å½•å³å¯è®¿é—®ä½¿ç”¨çš„ï¼Œè€Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºäº†æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œéœ€è¦å¼€å¯ç”¨æˆ·èº«ä»½éªŒè¯åŠŸèƒ½ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[webserver]</div><div class="line"><span class="comment"># å¼€å¯ç”¨æˆ·èº«ä»½éªŒè¯</span></div><div class="line">authenticate = True</div><div class="line"></div><div class="line"><span class="comment"># æ ¹æ®ç”¨æˆ·æ˜¾ç¤ºdagåˆ—è¡¨(ä¾èµ–äºç”¨æˆ·èº«ä»½éªŒè¯çš„å¼€å¯)</span></div><div class="line">filter_by_owner = False</div></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¼€å¯äº†ç”¨æˆ·èº«ä»½éªŒè¯çš„åŠŸèƒ½ï¼Œä½†ç³»ç»Ÿè¿˜æ²¡æœ‰é»˜è®¤ç”¨æˆ·ï¼Œéœ€è¦è‡ªè¡Œæ‰‹åŠ¨æ·»åŠ ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥æ’å…¥é»˜è®¤ç”¨æˆ·ä¿¡æ¯åˆ°æ•°æ®åº“å¯¹åº”çš„ users è¡¨ä¸­(ä¸æ¨è);å¦ä¸€ç§åˆ™æ˜¯é€šè¿‡ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> æä¾›çš„åŠŸèƒ½æ¥æ·»åŠ ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p>
<p>æ‰“å¼€ipythonï¼Œæ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> airflow</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> airflow <span class="keyword">import</span> models, settings</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> airflow.contrib.auth.backends.password_auth <span class="keyword">import</span> PasswordUser</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>user = PasswordUser(models.User())</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>user.username = <span class="string">'new_user_name'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>user.email = <span class="string">'new_user_email@example.com'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>user.password = <span class="string">'set_the_password'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>session = settings.Session()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>session.add(user)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>session.commit()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>session.close()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>exit()</div></pre></td></tr></table></figure>
<p>é‡å¯ web æœåŠ¡( <code>airflow webserver</code> )ï¼Œåˆ·æ–°ç½‘å€æµè§ˆå™¨ä¼šè‡ªåŠ¨è·³è½¬åˆ°ç”¨æˆ·ç™»å½•é¡µé¢ã€‚</p>
<h3 id="é…ç½®-airflow-Celery"><a href="#é…ç½®-airflow-Celery" class="headerlink" title="é…ç½® airflow + Celery"></a>é…ç½® <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> + <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a></h3><p><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> æä¾›äº†ä¸‰ç§ Executor ï¼Œåˆ†åˆ«æ˜¯ <code>SequentialExecutor</code>ã€<code>LocalExecutor</code> ä»¥åŠ <code>CeleryExecutor</code>ï¼›<a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> é…ç½®æ–‡ä»¶ä¸­ï¼Œé»˜è®¤çš„æ‰§è¡Œæ–¹å¼æ˜¯(<code>SequentialExecutor</code>)ï¼Œè¿™ä¸‰è€…çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>SequentialExecutor</code>: å•è¿›ç¨‹é¡ºåºæ‰§è¡Œï¼Œé€šå¸¸åªç”¨äºæµ‹è¯•</li>
<li><code>LocalExecutor</code>: å¤šè¿›ç¨‹æœ¬åœ°æ‰§è¡Œï¼Œä½¿ç”¨pythonçš„å¤šè¿›ç¨‹åº“è¾¾åˆ°å¤šè¿›ç¨‹æ‰§è¡Œç›®çš„</li>
<li><code>CeleryExecutor</code>: ä½¿ç”¨<a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> ä½œä¸ºæ‰§è¡Œå™¨ï¼Œé…ç½® <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> åå¯ä»¥åˆ©ç”¨é›†ç¾¤åˆ†å¸ƒå¼æ‰§è¡Œä»»åŠ¡</li>
</ul>
<p>åœ¨è¿™é‡Œæˆ‘é€‰ç”¨äº†<a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a>ï¼ŒåŒæ ·æ˜¯ä¸ºäº† <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> æœªæ¥çš„å¯æ‰©å±•æ€§ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°ä½¿ç”¨ <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> æ—¶ï¼Œåç«¯æœåŠ¡å¯ä»¥ä½¿ç”¨ <a href="https://www.rabbitmq.com/" target="_blank" rel="external">RabbitMQ</a> æˆ– <a href="https://redis.io/" target="_blank" rel="external">Redis</a> ï¼Œç›¸å¯¹æ¥è¯´è‡ªå·±å¯¹ redis ç†Ÿæ‚‰ä¸€äº›ï¼Œä½†æ®æˆ‘æ‰€çŸ¥ <a href="https://redis.io/" target="_blank" rel="external">Redis</a> ç›¸å¯¹æ¥è¯´æ¯”è¾ƒåƒå†…å­˜ï¼Œå› æ­¤åœ¨è¿™é‡Œé€‰ç”¨äº† <a href="https://www.rabbitmq.com/" target="_blank" rel="external">RabbitMQ</a> ã€‚å…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p>
<h4 id="å®‰è£…-RabbitMQ"><a href="#å®‰è£…-RabbitMQ" class="headerlink" title="å®‰è£… RabbitMQ"></a>å®‰è£… <a href="https://www.rabbitmq.com/" target="_blank" rel="external">RabbitMQ</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Ubuntu 17.04</span></div><div class="line">sudo apt install erlang rabbitmq-server</div></pre></td></tr></table></figure>
<h4 id="RabbitMQ-æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¯†ç "><a href="#RabbitMQ-æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¯†ç " class="headerlink" title="RabbitMQ æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¯†ç "></a><a href="https://www.rabbitmq.com/" target="_blank" rel="external">RabbitMQ</a> æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¯†ç </h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Ubuntu 17.04</span></div><div class="line">sudo rabbitmqctl add_user airflow airflow</div><div class="line">sudo rabbitmqctl add_vhost airflow</div><div class="line">sudo rabbitmqctl set_user_tags airflow airflow</div><div class="line">sudo rabbitmqctl set_permissions -p airflow airflow <span class="string">".*"</span> <span class="string">".*"</span> <span class="string">".*"</span></div><div class="line">sudo rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</div></pre></td></tr></table></figure>
<p>æ›´æ”¹é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># transport://userid:password@hostname:port/virtual_host</span></div><div class="line">broker_url = amqp://ariflow:airflow@localhost:5672/airflow</div><div class="line">celery_result_backend = amqp://airflow:airflow@localhost:5672/airflow</div></pre></td></tr></table></figure>
<p>è‡³æ­¤ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> + <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> é…ç½®å®Œæˆï¼Œæ¥ä¸‹æ¥è¯´è¯´å¦‚ä½•å¯åŠ¨æœåŠ¡</p>
<h3 id="å¯åŠ¨-Airflow-Celery-æœåŠ¡"><a href="#å¯åŠ¨-Airflow-Celery-æœåŠ¡" class="headerlink" title="å¯åŠ¨ Airflow + Celery æœåŠ¡"></a>å¯åŠ¨ Airflow + Celery æœåŠ¡</h3><p>ä¸€å…±æœ‰å››ä¸ªæœåŠ¡ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><code>airflow webserver</code> æœåŠ¡</li>
<li><code>airflow flower</code> <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> ç®¡ç†ç•Œé¢</li>
<li><code>airflow worker</code> <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> Worker</li>
<li><code>airflow scheduler</code> è°ƒåº¦å™¨</li>
</ul>
<h4 id="å¯åŠ¨-airflow-webserver-æœåŠ¡"><a href="#å¯åŠ¨-airflow-webserver-æœåŠ¡" class="headerlink" title="å¯åŠ¨ airflow webserver æœåŠ¡"></a>å¯åŠ¨ <code>airflow webserver</code> æœåŠ¡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">airflow webserver</div></pre></td></tr></table></figure>
<h4 id="å¯åŠ¨airflow-flower"><a href="#å¯åŠ¨airflow-flower" class="headerlink" title="å¯åŠ¨airflow flower"></a>å¯åŠ¨<a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> flower</h4><p><code>airflow flower</code> æ˜¯ä¸€ä¸ªç›‘æ§ <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> åˆ†å¸ƒå¼é˜Ÿåˆ—çš„ web æœåŠ¡ï¼Œé€šè¿‡å®ƒå¯ä»¥çœ‹åˆ° <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> dag ä¸­task çš„æ‰§è¡ŒçŠ¶å†µã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">airflow flower</div></pre></td></tr></table></figure>
<h4 id="å¯åŠ¨-airflow-worker"><a href="#å¯åŠ¨-airflow-worker" class="headerlink" title="å¯åŠ¨ airflow worker"></a>å¯åŠ¨ <code>airflow worker</code></h4><p><a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> çš„ workerï¼Œç”¨äºæ‰§è¡Œ dag ä¸­å…·ä½“çš„ task</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">airflow worker</div></pre></td></tr></table></figure>
<h4 id="å¯åŠ¨-airflow-scheduler"><a href="#å¯åŠ¨-airflow-scheduler" class="headerlink" title="å¯åŠ¨ airflow scheduler"></a>å¯åŠ¨ <code>airflow scheduler</code></h4><p><code>airflow scheduler</code> ç”¨äºå¯åŠ¨è°ƒåº¦å™¨ï¼Œå®Œæˆå¯¹ dag ä¸­ task çš„è°ƒåº¦ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">airflow scheduler</div></pre></td></tr></table></figure>
<h3 id="airflow-ç®€å•ç¤ºä¾‹"><a href="#airflow-ç®€å•ç¤ºä¾‹" class="headerlink" title="airflow ç®€å•ç¤ºä¾‹"></a><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ç®€å•ç¤ºä¾‹</h3><p>ç¯å¢ƒå·²ç»æ­å¥½ï¼Œç°åœ¨å†™ä¸ª dag æ¥æµ‹è¯•ä¸€ä¸‹ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> å§ã€‚åœ¨å…·ä½“çš„ä»£ç å±•ç°ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸€ä¸‹ä¸Šæ–‡å·²ç»å‡ºç°å¤šæ¬¡çš„ dag è¿™ä¸ªæ¦‚å¿µï¼Œdag å¯¹äºç†Ÿæ‚‰å›¾è®ºçš„åŒå­¦ä¸€å®šä¸é™Œç”Ÿï¼Œä¹Ÿå³ <code>(Directed Acyclic Graph, DAG)</code> ï¼Œä¸ºä»€ä¹ˆå«æœ‰å‘æ— ç¯å›¾å‘¢ï¼Œå› ä¸ºä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å°±æ˜¯ä¸€ä¸ª DAG ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="/images/dag.png" alt="DAG">ã€‚</p>
<p><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ä¼šé»˜è®¤è¯»å– <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ç›®å½•ä¸‹ dags ä¸­çš„æ‰€æœ‰ python æ–‡ä»¶ä½œä¸º dag ï¼Œå› æ­¤æˆ‘ä»¬æ–°å»ºä¸€ä¸ª dags ç›®å½•ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç å†™å…¥ <code>dags/test.py</code> ä¸­ï¼Œä¸ºäº†èƒ½å¤Ÿæ–¹ä¾¿çœ‹åˆ° dag æµ‹è¯•æˆåŠŸä¸å¦ï¼Œåœ¨ test.py é‡Œé¢è®¾ç½®äº†æ¯æ¬¡å‘ test ç›®å½•ä¸‹çš„æ–‡ä»¶å†™å…¥æ–°å†…å®¹ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> builtins <span class="keyword">import</span> range</div><div class="line"><span class="keyword">import</span> airflow</div><div class="line"><span class="keyword">from</span> airflow.operators.python_operator <span class="keyword">import</span> PythonOperator</div><div class="line"><span class="keyword">from</span> airflow.models <span class="keyword">import</span> DAG</div><div class="line"></div><div class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</div><div class="line"></div><div class="line">args = &#123;</div><div class="line">    <span class="string">'owner'</span>: <span class="string">'yinwoods'</span>,</div><div class="line">    <span class="string">'start_date'</span>: airflow.utils.dates.datetime(<span class="number">2017</span>, <span class="number">7</span>, <span class="number">27</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">dag = DAG(</div><div class="line">    dag_id=<span class="string">'yinwoods'</span>, default_args=args,</div><div class="line">    schedule_interval=<span class="string">'0 1 * * *'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_write_function</span><span class="params">(random_base)</span>:</span></div><div class="line">    <span class="string">"""This is a function that will run within the DAG execution"""</span></div><div class="line">    <span class="keyword">with</span> open(<span class="string">'~/airflow/test/'</span> + random_base, <span class="string">'a'</span>) <span class="keyword">as</span> f:</div><div class="line">        f.write(random_base[<span class="number">-1</span>] + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_context</span><span class="params">(ds, **kwargs)</span>:</span></div><div class="line">    pprint(kwargs)</div><div class="line">    print(ds)</div><div class="line">    <span class="keyword">return</span> <span class="string">'Whatever you return gets printed in the logs'</span></div><div class="line"></div><div class="line"></div><div class="line">run_this = PythonOperator(</div><div class="line">    task_id=<span class="string">'print_the_context'</span>,</div><div class="line">    provide_context=<span class="keyword">True</span>,</div><div class="line">    python_callable=print_context,</div><div class="line">    op_kwargs=&#123;<span class="string">'test'</span>: <span class="string">'test'</span>&#125;,</div><div class="line">    dag=dag)</div><div class="line"></div><div class="line"><span class="comment"># Generate 10 sleeping tasks, sleeping from 0 to 9 seconds respectively</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</div><div class="line">    task = PythonOperator(</div><div class="line">        task_id=<span class="string">'print_for_'</span> + str(i),</div><div class="line">        python_callable=my_write_function,</div><div class="line">        op_kwargs=&#123;<span class="string">'random_base'</span>: <span class="string">'file_'</span> + str(i)&#125;,</div><div class="line">        dag=dag)</div><div class="line"></div><div class="line">    task.set_upstream(run_this)</div></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä»£ç ä¿å­˜åï¼Œæ‰§è¡Œ <code>python test.py</code> å³å°†è¯¥ dag å¯¼å…¥ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ä¸­ï¼Œä¹‹åå¯ä»¥é€‰ç”¨ <code>airflow test</code> æˆ– <code>airflow backfill</code> æµ‹è¯•ï¼Œè¿™é‡Œå°±ä¸å†è®²è¿°å…·ä½“ç”¨æ³•ã€‚</p>
<p>å¯åŠ¨ dag æ—¶æ—¢å¯ä»¥ä½¿ç”¨ <code>airflow run dag_id task_id execution_date</code> ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ web ç•Œé¢çš„æ‰§è¡ŒæŒ‰é’®æ‰§è¡Œã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å¯åŠ¨ä¹‹å‰éœ€è¦ <code>airflow unpause dag_id</code> æˆ–åœ¨ web ç•Œé¢å¼€å¯ dag å¯¹åº”çš„æŒ‰é’®ã€‚</p>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥çœ‹åˆ°æ‰§è¡ŒçŠ¶æ€ä»¥åŠç»“æœäº†ã€‚å¦å¤–ä¸‹é¢æä¾›äº†å¦ä¸€ä»½ç¤ºä¾‹ä»£ç ï¼Œæ³¨æ„è§‚å¯Ÿè¿™ä»½ä»£ç ä¸­å®šä¹‰ä»»åŠ¡é—´ä¾èµ–å…³ç³»çš„è¯­å¥:)ï¼Œä¸ªäººè®¤ä¸ºè¿™æ ·çš„è¯­å¥èƒ½å¤Ÿæ›´ç›´è§‚è¡¨æ˜ä»»åŠ¡ä¹‹é—´çš„å…³ç³»ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"><span class="keyword">from</span> [airflow](https://github.com/apache/incubator-airflow) <span class="keyword">import</span> DAG</div><div class="line"><span class="keyword">from</span> airflow.operators.dummy_operator <span class="keyword">import</span> DummyOperator</div><div class="line"><span class="keyword">from</span> airflow.operators.python_operator <span class="keyword">import</span> PythonOperator</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_hello</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> <span class="string">'Hello world!'</span></div><div class="line"></div><div class="line">dag = DAG(<span class="string">'hello_world'</span>, description=<span class="string">'Simple tutorial DAG'</span>,</div><div class="line">          schedule_interval=<span class="string">'0 12 * * *'</span>,</div><div class="line">          start_date=datetime(<span class="number">2017</span>, <span class="number">3</span>, <span class="number">20</span>),</div><div class="line">          catchup=<span class="keyword">False</span>)</div><div class="line"></div><div class="line">dummy_operator = DummyOperator(task_id=<span class="string">'dummy_task'</span>, retries=<span class="number">3</span>, dag=dag)</div><div class="line"></div><div class="line">hello_operator = PythonOperator(task_id=<span class="string">'hello_task'</span>,</div><div class="line">                                python_callable=print_hello, dag=dag)</div><div class="line"></div><div class="line">dummy_operator &gt;&gt; hello_operator</div></pre></td></tr></table></figure>
<p>å¦‚æœæ‰§è¡Œ dag åï¼Œå‘ç° dag ä¸­éƒ¨åˆ† task ä¸€ç›´å¤„äº queue çš„çŠ¶æ€ï¼Œå¯ä»¥æŸ¥çœ‹ <code>airflow scheduler</code> çš„æ‰§è¡ŒçŠ¶æ€ï¼Œå¦‚æœæ˜¯æŒ‚æ‰äº†ï¼Œä¸”é‡å¯ååˆæŒ‚æ‰å¯ä»¥å‚è€ƒä¸‹é¢çš„è§£å†³æ–¹æ³•ã€‚</p>
<h3 id="æ”¹æºç è§£å†³-airflow-scheduler-ä¸­æ–­-bug"><a href="#æ”¹æºç è§£å†³-airflow-scheduler-ä¸­æ–­-bug" class="headerlink" title="æ”¹æºç è§£å†³ airflow scheduler ä¸­æ–­ bug"></a>æ”¹æºç è§£å†³ <code>airflow scheduler</code> ä¸­æ–­ bug</h3><p>æˆ‘åœ¨ä½¿ç”¨ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a>  çš„è¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿäº† <code>airflow scheduler</code> å¯åŠ¨åæ‰§è¡Œç‰‡åˆ»å³è¢«æ–­å¼€è¿æ¥çš„æƒ…å†µï¼Œé€šè¿‡è°·æ­Œæœç´¢ï¼Œæ‰¾åˆ°äº†ä»¥ä¸‹ä¿®æ”¹ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> æºç çš„è§£å†³æ–¹æ³•ï¼Œè‡³äºè¿™ä¸ªä¸­æ–­bugçš„å…·ä½“åŸå› å°šä¸æ¸…æ¥šã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">--- /usr/local/lib/python3<span class="number">.4</span>/dist-packages/airflow/jobs.py.orig	<span class="number">2017</span><span class="number">-02</span><span class="number">-16</span> <span class="number">11</span>:<span class="number">58</span>:<span class="number">55.057991344</span> +<span class="number">0000</span></div><div class="line">+++ /usr/local/lib/python3<span class="number">.4</span>/dist-packages/airflow/jobs.py	<span class="number">2017</span><span class="number">-02</span><span class="number">-16</span> <span class="number">11</span>:<span class="number">57</span>:<span class="number">07.060060262</span> +<span class="number">0000</span></div><div class="line"><span class="meta">@@ -1371,6 +1371,8 @@</span></div><div class="line">         last_stat_print_time = datetime(<span class="number">2000</span>, <span class="number">1</span>, <span class="number">1</span>)</div><div class="line">         <span class="comment"># Last time that self.heartbeat() was called.</span></div><div class="line">         last_self_heartbeat_time = datetime.now()</div><div class="line">+        <span class="comment"># Last time that self.executor.heartbeat() was called.</span></div><div class="line">+        last_executor_heartbeat_time = datetime.now()</div><div class="line">         <span class="comment"># Last time that the DAG dir was traversed to look for files</span></div><div class="line">         last_dag_dir_refresh_time = datetime.now()</div><div class="line"></div><div class="line"><span class="meta">@@ -1436,9 +1438,14 @@</span></div><div class="line">                 self._execute_task_instances(simple_dag_bag,</div><div class="line">                                              (State.SCHEDULED,))</div><div class="line"></div><div class="line">-            <span class="comment"># Call hearbeats</span></div><div class="line">-            self.logger.info(<span class="string">"Heartbeating the executor"</span>)</div><div class="line">-            self.executor.heartbeat()</div><div class="line">+            <span class="comment"># Heartbeat the executor periodically</span></div><div class="line">+            time_since_last_heartbeat = (datetime.now() -</div><div class="line">+                                         last_executor_heartbeat_time).total_seconds()</div><div class="line">+            <span class="keyword">if</span> time_since_last_heartbeat &gt; self.heartrate:</div><div class="line">+                self.logger.info(<span class="string">"Heartbeating the executor"</span>)</div><div class="line">+                <span class="keyword">try</span>: self.executor.heartbeat()</div><div class="line">+                <span class="keyword">except</span> ConnectionResetError: <span class="keyword">pass</span>  <span class="comment"># RabbitMQ sometimes resets the socket connection</span></div><div class="line">+                last_executor_heartbeat_time = datetime.now()</div><div class="line"></div><div class="line">             <span class="comment"># Process events from the executor</span></div><div class="line">             self._process_executor_events()</div></pre></td></tr></table></figure>
<p><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> çš„ä»‹ç»ä¸ä½¿ç”¨å°±å…ˆå†™åˆ°è¿™é‡Œï¼Œå¦‚æœè¯»è€…æœ‰ä¸æˆ‘ç±»ä¼¼æˆ–ç›¸åŒçš„é—®é¢˜ï¼Œæ¬¢è¿è¯„è®ºåŒºæ¢è®¨ã€‚</p>
<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul>
<li><a href="https://airflow.incubator.apache.org/" target="_blank" rel="external">Airflow å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="http://morefreeze.github.io/2016/12/airflow.html" target="_blank" rel="external">Airflow ç®€æ˜æŒ‡å—</a></li>
<li><a href="http://blog.genesino.com/2016/05/airflow/#%E9%85%8D%E7%BD%AEceleryexecutor-rabbitmq%E6%94%AF%E6%8C%81" target="_blank" rel="external">Airflow Useage</a></li>
<li><a href="https://issues.apache.org/jira/browse/AIRFLOW-342" target="_blank" rel="external">Exception in <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> scheduler: Connection reset by peer</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;åˆè¯†-airflow&quot;&gt;&lt;a href=&quot;#åˆè¯†-airflow&quot; class=&quot;headerlink&quot; title=&quot;åˆè¯† airflow&quot;&gt;&lt;/a&gt;åˆè¯† &lt;a href=&quot;https://github.com/apache/incubator-airflow&quot;
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="python, airflow, celery" scheme="http://blog.yinwoods.work/tags/python-airflow-celery/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠFluent Pythonã€‹è¯»ä¹¦ç¬”è®°</title>
    <link href="http://blog.yinwoods.work/2017/07/25/fluent-python-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    <id>http://blog.yinwoods.work/2017/07/25/fluent-python-è¯»ä¹¦ç¬”è®°/</id>
    <published>2017-07-25T06:12:37.000Z</published>
    <updated>2017-07-26T10:06:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç¬¬äºŒæ¬¡è¯»Fluent Pythonäº†ï¼Œè®°å¾—ç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™æ€»æœ‰é†é†çŒé¡¶çš„æ„Ÿè§‰ï¼Œä½†è¿«äºå½“æ—¶åˆšæ¥è§¦pythonä¸ä¹…ï¼Œä¸”æ²¡æœ‰åšè¯»ä¹¦ç¬”è®°ï¼Œæ‰€ä»¥åªæ˜¯çœ‹çš„æ—¶å€™è§‰å¾—è¿™æœ¬ä¹¦å¾ˆå¥½ï¼Œçœ‹è¿‡å°±å¿˜äº†ã€‚ç¬¬äºŒæ¬¡è¯»ï¼Œç‰¹æ„ä¹°äº†çº¸è´¨ç‰ˆï¼Œæ‰“ç®—å°†è¯»ä¹¦è¿‡ç¨‹ä¸­çš„æ„Ÿæƒ³ã€æ€è€ƒéƒ½è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾›ä»–äººä»¥åŠæœªæ¥çš„è‡ªå·±å‚è€ƒã€‚</p>
<h3 id="ç¬¬äºŒç« -An-Array-of-Sequences"><a href="#ç¬¬äºŒç« -An-Array-of-Sequences" class="headerlink" title="ç¬¬äºŒç«  An Array of Sequences"></a>ç¬¬äºŒç«  An Array of Sequences</h3><ul>
<li>Pg46: å€Ÿç”¨äºŒåˆ†æœç´¢æ¥å®ç°å¤šé‡æ¡ä»¶åˆ¤æ–­ï¼Œè¿™æ ·çš„æ“ä½œå€¼å¾—å€Ÿé‰´ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">grade</span><span class="params">(score, breakpoints=[<span class="number">60</span>, <span class="number">70</span>, <span class="number">80</span>, <span class="number">90</span>], grades=<span class="string">'FDCBA'</span>)</span>:</span></div><div class="line">    i = bisect.bisect(breakpoints, score)</div><div class="line">    <span class="keyword">return</span> grades[i]</div></pre></td></tr></table></figure>
<ul>
<li><p>Pg48: å¤§é‡æ•°å€¼çš„è¯»å†™ä»¥åŠç›¸å…³æ“ä½œæœ€å¥½ä½¿ç”¨é’ˆå¯¹æ•°å€¼ä¼˜åŒ–çš„arrayè€Œä¸æ˜¯list</p>
</li>
<li><p>Pg51: å¤§é‡æ•°æ®çš„å¤åˆ¶å¯ä»¥å€ŸåŠ©memoryview</p>
</li>
</ul>
<h3 id="ç¬¬ä¸‰ç« -Dictionaries-and-Sets"><a href="#ç¬¬ä¸‰ç« -Dictionaries-and-Sets" class="headerlink" title="ç¬¬ä¸‰ç«  Dictionaries and Sets"></a>ç¬¬ä¸‰ç«  Dictionaries and Sets</h3><ul>
<li>Pg70: åœ¨ä½¿ç”¨dictçš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™éš¾ä»¥ç¡®å®škeyæ˜¯å¦åœ¨dictä¸­å­˜åœ¨ï¼Œå› æ­¤ä¼šå…ˆåˆ©ç”¨getæ–¹æ³•å–keyå¯¹åº”çš„valueï¼Œåœ¨å¯¹valueè¿›è¡Œä¸€äº›æ“ä½œä¹‹åå†update dictï¼Œè¿™æ ·çš„æ“ä½œä¼šæ˜¾å¾—å¾ˆçç¢ï¼Œå¾ˆå¤šæ—¶å€™å¯ä»¥å€ŸåŠ©dict.setdefault()æ–¹æ³•æ¥å®Œæˆä¸Šè¿°ä¸€ç³»åˆ—æ“ä½œã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>dt = dict(one=<span class="number">1</span>, two=<span class="number">2</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dt.setdefault(<span class="string">'three'</span>, <span class="number">0</span>)</div><div class="line"><span class="number">0</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dt.update(&#123;<span class="string">'three'</span>: dt.setdefault(<span class="string">'three'</span>, <span class="number">0</span>) + <span class="number">3</span>&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dt</div><div class="line">&#123;<span class="string">'one'</span>: <span class="number">1</span>, <span class="string">'two'</span>: <span class="number">2</span>, <span class="string">'three'</span>: <span class="number">3</span>&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dt.update(&#123;<span class="string">'one'</span>: dt.setdefault(<span class="string">'one'</span>, <span class="number">0</span>) + <span class="number">3</span>&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dt</div><div class="line">&#123;<span class="string">'one'</span>: <span class="number">4</span>, <span class="string">'two'</span>: <span class="number">2</span>, <span class="string">'three'</span>: <span class="number">3</span>&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>Pg70: åœ¨dictä¸Šåšä¸€äº›æ“ä½œæ—¶ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç›´æ¥åˆ©ç”¨[key]å½¢å¼å–å€¼æ—¶ä¸äº§ç”Ÿ<code>KeyError</code>ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼›ä¸€ç§æ˜¯å€Ÿç”¨defaultDictï¼Œå¦ä¸€ç§åˆ™æ˜¯ç»§æ‰¿dictç±»å¹¶è‡ªå·±å®ç°<strong>missing</strong>æ–¹æ³•</p>
</li>
<li><p>Pg78: pythonæ ‡å‡†åº“ä¸­å¹¶æ²¡æœ‰æä¾›åªè¯»çš„dictï¼Œä½†æ˜¯å¯ä»¥å€Ÿç”¨typesä¸­çš„MappingProxyTypeæ¥å®ç°ç›¸å…³åŠŸèƒ½ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯MappingProxyTypeå®ä¾‹ä¼šéšç€ä¼ é€’è¿›æ¥çš„dictæ”¹å˜è€Œæ”¹å˜</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> types <span class="keyword">import</span> MappingProxyType</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="number">1</span>: <span class="string">'A'</span>&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d_proxy = MappingProxyType(d)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d_proxy</div><div class="line">mappingproxy(&#123;<span class="number">1</span>: <span class="string">'A'</span>&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d_proxy[<span class="number">1</span>]</div><div class="line"><span class="string">'A'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d_proxy[<span class="number">2</span>] = <span class="string">'x'</span></div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">TypeError: <span class="string">'mappingproxy'</span> object does <span class="keyword">not</span> support item assignment</div><div class="line"><span class="string">'mappingproxy'</span> object does <span class="keyword">not</span> support item assignment</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="number">2</span>] = <span class="string">'B'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d_proxy</div><div class="line">mappingproxy(&#123;<span class="number">1</span>: <span class="string">'A'</span>, <span class="number">2</span>: <span class="string">'B'</span>&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d_proxy[<span class="number">2</span>]</div><div class="line"><span class="string">'B'</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç¬¬äºŒæ¬¡è¯»Fluent Pythonäº†ï¼Œè®°å¾—ç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™æ€»æœ‰é†é†çŒé¡¶çš„æ„Ÿè§‰ï¼Œä½†è¿«äºå½“æ—¶åˆšæ¥è§¦pythonä¸ä¹…ï¼Œä¸”æ²¡æœ‰åšè¯»ä¹¦ç¬”è®°ï¼Œæ‰€ä»¥åªæ˜¯çœ‹çš„æ—¶å€™è§‰å¾—è¿™æœ¬ä¹¦å¾ˆå¥½ï¼Œçœ‹è¿‡å°±å¿˜äº†ã€‚ç¬¬äºŒæ¬¡è¯»ï¼Œç‰¹æ„ä¹°äº†çº¸è´¨ç‰ˆï¼Œæ‰“ç®—å°†è¯»ä¹¦è¿‡ç¨‹ä¸­çš„æ„Ÿæƒ³ã€æ€è€ƒéƒ½è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾›ä»–äººä»¥åŠæœªæ¥çš„è‡ªå·±å‚è€ƒã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="python" scheme="http://blog.yinwoods.work/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>python requestsåº“å¤„ç†302é‡å®šå‘</title>
    <link href="http://blog.yinwoods.work/2017/06/24/python-requests%E5%BA%93%E5%A4%84%E7%90%86302%E9%87%8D%E5%AE%9A%E5%90%91/"/>
    <id>http://blog.yinwoods.work/2017/06/24/python-requestsåº“å¤„ç†302é‡å®šå‘/</id>
    <published>2017-06-24T11:10:37.000Z</published>
    <updated>2017-07-26T10:06:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æ¥äº†ä¸€ä¸ªæ´»ï¼Œç»™å®šä¸€äº›é“¾æ¥ï¼Œç»Ÿè®¡æ¯ä¸ªé“¾æ¥çš„è·³è½¬æ¬¡æ•°ä»¥åŠæœ€ç»ˆè·³è½¬è‡³çš„ç½‘å€ã€‚</p>
<p>åˆšå¼€å§‹æ˜¯ç”¨scrapyå†™çš„ï¼Œé€šè¿‡Googleä¸stack overflowäº†è§£åˆ°ä¸‹é¢è¿™ç§å†™æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">conn = pymysql.connect(</div><div class="line">        host=<span class="string">'host'</span>,</div><div class="line">        user=<span class="string">'user'</span>,</div><div class="line">        password=<span class="string">'password'</span>,</div><div class="line">        db=<span class="string">'database'</span>)</div><div class="line">cursor = conn.cursor()</div><div class="line"></div><div class="line">sql = <span class="string">'''</span></div><div class="line">    select distinct click_url from table</div><div class="line">    where country = "&#123;&#125;" and status=0'''.format(country)</div><div class="line">cursor.execute(sql)</div><div class="line">urls = cursor.fetchall()</div><div class="line">start_urls = (x[<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> urls)</div><div class="line"></div><div class="line"><span class="comment"># æ— é™è·³è½¬ æµ‹è¯•ä½¿ç”¨</span></div><div class="line"><span class="comment"># start_urls = ('http://maoshuai.sinaapp.com/cnblog/302test.php', )</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_requests</span><span class="params">(self)</span>:</span></div><div class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> self.start_urls:</div><div class="line">        <span class="keyword">yield</span> scrapy.Request(url, meta=&#123;<span class="string">'original_url'</span>: url&#125;)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></div><div class="line">    <span class="comment"># print('response url', response.url)</span></div><div class="line">    <span class="comment"># print('response status', response.status)</span></div><div class="line">    request = response.request</div><div class="line">    redirected_url = request.url</div><div class="line"></div><div class="line">    original_url = response.meta[<span class="string">'original_url'</span>]</div><div class="line"></div><div class="line">    <span class="keyword">if</span> original_url <span class="keyword">not</span> <span class="keyword">in</span> self.redirect_count.keys():</div><div class="line">        self.redirect_count.update(&#123;original_url: <span class="number">0</span>&#125;)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> response.status &gt;= <span class="number">300</span> <span class="keyword">and</span> response.status &lt; <span class="number">400</span>:</div><div class="line"></div><div class="line">        self.redirect_count[original_url] += <span class="number">1</span></div><div class="line">        location = to_native_str(</div><div class="line">                response.headers[<span class="string">'location'</span>].decode(<span class="string">'latin1'</span>))</div><div class="line">        request = response.request</div><div class="line">        redirected_url = urljoin(request.url, location)</div><div class="line">        <span class="comment"># print('redirected to ', redirected_url)</span></div><div class="line">        <span class="keyword">yield</span> scrapy.Request(</div><div class="line">                redirected_url,</div><div class="line">                meta=&#123;<span class="string">'original_url'</span>: original_url&#125;,</div><div class="line">                callback=self.parse)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        redirected = request.replace(</div><div class="line">                url=redirected_url, method=<span class="string">'GET'</span>, body=<span class="string">''</span>)</div><div class="line">        redirected.headers.pop(<span class="string">'Content-Type'</span>, <span class="keyword">None</span>)</div><div class="line">        redirected.headers.pop(<span class="string">'Content-Length'</span>, <span class="keyword">None</span>)</div><div class="line">        <span class="keyword">yield</span> redirected</div><div class="line"></div><div class="line">    count = self.redirect_count.get(original_url)</div><div class="line">    <span class="keyword">if</span> count &gt;= <span class="number">1</span> <span class="keyword">and</span> response.url.startswith(<span class="string">'https://play.google.com'</span>):</div><div class="line">        print(self.redirect_count.get(original_url))</div><div class="line">        self.update_count(</div><div class="line">                original_url, self.redirect_count.get(original_url))</div></pre></td></tr></table></figure>
<p>å¤§è‡´è¯´ä¸€ä¸‹ä¸Šé¢ä»£ç çš„æ€è·¯ï¼Œåœ¨start_requestsä¸­ï¼Œyield requestæ—¶æºå¸¦åŸå§‹URLï¼Œä»è€Œåˆ©ç”¨dictç»Ÿè®¡è¯¥URLçš„è·³è½¬æ¬¡æ•°ï¼›parseå‡½æ•°æ˜¯æ ¸å¿ƒåŠŸèƒ½ä»£ç ï¼Œç”¨äºå¤„ç†302é‡å®šå‘ï¼Œé€šè¿‡é€’å½’è°ƒç”¨parseå‡½æ•°å¤„ç†é‡å®šå‘åçš„URLã€‚</p>
<p>ä¸Šé¢è¿™ç§ä»£ç æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯ç”±äºéœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œä»£ç ï¼Œè€Œè‡ªå·±å¯¹ä¸Šé¢ä»£ç çš„æ•´ä¸ªæ‰§è¡Œæµç¨‹ä¸å¤Ÿæ¸…æ¥šï¼Œå› æ­¤æœ€åè¿˜æ˜¯é€‰ç”¨requestsåº“æ¥è§£å†³è¯¥é—®é¢˜ï¼Œå°½ç®¡é€Ÿåº¦ä¸Šä¼šæ…¢ä¸€äº›ï¼Œä½†æ˜¯è‡ªå·±å¯¹æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œæœ‰æ›´æ¸…æ™°çš„æŠŠæ§ã€‚ï¼ˆPSï¼šä¹Ÿæ˜¯ä»è¿™é‡Œæˆ‘æ„è¯†åˆ°å½“æ€§èƒ½ä¸æ˜¯ç¨‹åºçš„ç“¶é¢ˆæ—¶ï¼Œä¸€å®šä¸è¦ç‰ºç‰²ç¨³å®šæ€§æ¥æå‡ç¨‹åºæ€§èƒ½ï¼Œè¿™ç§è¡Œä¸ºå¸¦æ¥çš„ä»£ä»·å¾€å¾€æ˜¯å·¨å¤§çš„ï¼ï¼‰</p>
<p>æ”¹ç”¨requestsæ”¹å†™åï¼Œå†™èµ·æ¥å¾ˆè½»æ¾ï¼Œå› ä¸ºä½¿ç”¨response.historyå°±å¯ä»¥è½»æ¾è·å–é‡å®šå‘æœ€ç»ˆé“¾æ¥ä»¥åŠä¸­é—´é‡å®šå‘æ¬¡æ•°ã€‚å…·ä½“ä»£ç å‚è€ƒ<a href="http://docs.python-requests.org/en/master/user/quickstart/" target="_blank" rel="external">requestså®˜æ–¹æ–‡æ¡£</a>å³å¯ã€‚</p>
<p>ä½†éšååˆæœ‰äº†æ–°éœ€æ±‚ï¼Œå½“ä½¿ç”¨ç§»åŠ¨å®¢æˆ·ç«¯è®¿é—®è¿™äº›é“¾æ¥æ—¶ï¼Œé“¾æ¥å¯èƒ½æœ€ç»ˆè·³è½¬è‡³ä»¥<code>market://</code>å¼€å¤´çš„URLï¼Œè€Œè¿™ç§URLä¼šè¢«requestsè®¤ä¸ºæ˜¯æ— æ•ˆURLè€ŒæŠ¥é”™ï¼Œä¸ºäº†èƒ½å¤Ÿæ­£ç¡®å¤„ç†è¿™ç§æƒ…å†µï¼Œä¹Ÿå³è·å–ä»¥<code>market://</code>å¼€å¤´çš„æœ€ç»ˆURLä»¥åŠä¸­é—´çš„è·³è½¬æ¬¡æ•°ï¼Œå¾ˆæ˜æ˜¾ç®€å•åœ°ä½¿ç”¨response.historyæ— æ³•è¾¾åˆ°ç›®çš„ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœåœ¨è®¿é—®ä¸€ä¸ªURLæ—¶ï¼Œç¦æ­¢é‡å®šå‘ï¼Œç„¶åè‡ªè¡Œå¤„ç†é‡å®šå‘è¿‡ç¨‹ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¡Œçš„åŠæ³•ã€‚ä½†æ˜¯åœ¨å®è·µä¸­é‡åˆ°302ä¸­responseçš„Locationå­—æ®µè·³è½¬è‡³æœ¬ç«™æ ¹åŸŸåä¸‹çš„å…¶ä»–é“¾æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´Locationå­—æ®µä¿å­˜çš„æ˜¯ä¸€ä¸ªç›¸å¯¹URLï¼Œå› æ­¤è‡ªè¡Œå¤„ç†é‡å®šå‘å°±éœ€è¦é¢å¤–å¤„ç†ç›¸å¯¹URLï¼Œè¿™è®©é‡å®šå‘é—®é¢˜åˆä¸€æ­¥å¤æ‚åŒ–ï¼Œæ•…æ”¾å¼ƒè¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>ä¹‹åæƒ³åˆ°çš„æ–¹æ³•æ˜¯æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼Œç›¸ä¿¡å®˜æ–¹æ–‡æ¡£åº”è¯¥æœ‰å¯¹é‡å®šå‘é—®é¢˜æ›´åŠ è‡ªå®šä¹‰çš„æ”¯æŒã€‚æœä¸å…¶ç„¶ï¼Œåœ¨å®˜æ–¹æ–‡æ¡£çš„è§’è½é‡Œç¿»é˜…åˆ°requestsä¸­æœ‰<code>resolve_redirects()</code>æ–¹æ³•ï¼Œè™½ç„¶æ–‡æ¡£ä¸­å¯¹è¯¥æ–¹æ³•æ— è¾ƒå¤šä»‹ç»ï¼Œä½†é€šè¿‡Googleå¤§æ³•ä¹Ÿæ˜¯æ‰¾åˆ°äº†ä¸€äº›ä»£ç ç‰‡æ®µï¼Œé€šè¿‡å¯¹ä»£ç è¿›è¡ŒåŠ å·¥æ”¹é€ ï¼Œå¾—åˆ°èƒ½å¤Ÿå®Œç¾è§£å†³æˆ‘çš„éš¾é¢˜çš„ä»¥ä¸‹ä»£ç ç‰ˆæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">iter_send</span><span class="params">(self, session, request, **kwargs)</span>:</span></div><div class="line">    <span class="comment"># è¿”å›é‡å®šå‘è¿‡ç¨‹ä¸­ä¸€ç³»åˆ—response</span></div><div class="line">    <span class="comment"># å¦‚æœæœ€ç»ˆç»“æœä¸ºåº”ç”¨å†…è·³è½¬urlï¼Œç±»ä¼¼market://å½¢å¼åˆ™è¿”å›ä¸Šä¸€ä¸ªresponse</span></div><div class="line">    resp = session.send(request, allow_redirects=<span class="keyword">False</span>,</div><div class="line">                        timeout=<span class="number">10</span>, **kwargs)</div><div class="line">    redir_iter = session.resolve_redirects(resp, request, timeout=<span class="number">10</span>)</div><div class="line">    <span class="keyword">while</span> resp.is_redirect:</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            resp = next(redir_iter)</div><div class="line">            <span class="keyword">yield</span> resp</div><div class="line">        <span class="keyword">except</span> requests.exceptions.InvalidSchema:</div><div class="line">            <span class="keyword">break</span></div><div class="line">    <span class="keyword">yield</span> resp</div></pre></td></tr></table></figure>
<p>è™½ç„¶é—®é¢˜çš„æ•´ä¸ªè§£å†³è¿‡ç¨‹è‡ªå·±æ²¡æœ‰è¿›è¡Œå¤æ‚åœ°ç¼–ç¨‹ï¼Œä½†æ˜¯å¯ä»¥å‘ç°ä»£ç å†™çš„å¤šäº†èƒ½å¤Ÿè®­ç»ƒå‡ºç¨‹åºå‘˜çš„ä¸€ç§ç›´è§‰ï¼Œæ¥ç€å†å»éªŒè¯è‡ªå·±çš„ç›´è§‰å¾€å¾€èƒ½å¤ŸèŠ‚çœå¾ˆå¤šæ—¶é—´ï¼Œå¯è§ç»éªŒçš„é‡è¦æ€§äº†ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘æ¥äº†ä¸€ä¸ªæ´»ï¼Œç»™å®šä¸€äº›é“¾æ¥ï¼Œç»Ÿè®¡æ¯ä¸ªé“¾æ¥çš„è·³è½¬æ¬¡æ•°ä»¥åŠæœ€ç»ˆè·³è½¬è‡³çš„ç½‘å€ã€‚&lt;/p&gt;
&lt;p&gt;åˆšå¼€å§‹æ˜¯ç”¨scrapyå†™çš„ï¼Œé€šè¿‡Googleä¸stack overflowäº†è§£åˆ°ä¸‹é¢è¿™ç§å†™æ³•ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="python, requests" scheme="http://blog.yinwoods.work/tags/python-requests/"/>
    
  </entry>
  
  <entry>
    <title>BKæ ‘æ•°æ®ç»“æ„å­¦ä¹ </title>
    <link href="http://blog.yinwoods.work/2017/04/09/BK%E6%A0%91%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/"/>
    <id>http://blog.yinwoods.work/2017/04/09/BKæ ‘æ•°æ®ç»“æ„å­¦ä¹ /</id>
    <published>2017-04-08T16:00:00.000Z</published>
    <updated>2017-07-26T10:06:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>BKæ ‘æ˜¯ä¸€ç§åŸºäºæ ‘çš„æ•°æ®ç»“æ„ï¼Œç”¨æ¥å¿«é€ŸæŸ¥æ‰¾åŸºäºç¼–è¾‘è·ç¦»çš„ç›¸ä¼¼å­—ç¬¦ä¸²åŒ¹é…ï¼Œæ¯”å¦‚æ‹¼å†™çº é”™æˆ–æ¨¡ç³ŠæŸ¥æ‰¾ã€‚è®¸å¤šè½¯ä»¶ä¸­çš„è‡ªåŠ¨æ‹¼å†™çº é”™å°±æ˜¯åŸºäºè¿™ä¸ªæ•°æ®ç»“æ„æ¥å®ç°çš„ã€‚</p>
<p>BKæ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯è¯å…¸ä¸­çš„ä¸€ä¸ªå•è¯ï¼Œè€Œæ ‘ä¸­çš„è¾¹æƒé‡åˆ™è¡¨æ˜å¶å­ç»“ç‚¹åˆ°æ ¹èŠ‚ç‚¹ä¹‹é—´çš„ç¼–è¾‘è·ç¦»ã€‚ä¾‹å¦‚ä»èŠ‚ç‚¹uåˆ°èŠ‚ç‚¹vçš„è¾¹ä¸Šæƒé‡ä¸ºwï¼Œé‚£ä¹ˆwå°±æ˜¯æŠŠuè½¬åŒ–ä¸ºvçš„ç¼–è¾‘è·ç¦»ã€‚</p>
<p>ä¾‹å¦‚å¯¹äºè¯å…¸<code>{&quot;help&quot;, &quot;hell&quot;, &quot;hello&quot;}</code>ï¼Œå…¶å¯¹åº”çš„BKæ ‘å¦‚ä¸‹ï¼š</p>
<p><img src="http://7xlnl2.com1.z0.glb.clouddn.com/2017-04-09-1.png" alt="BKæ ‘"></p>
<p>BKæ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸å­èŠ‚ç‚¹çš„ç¼–è¾‘è·ç¦»å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œåœ¨æ’å…¥èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­å¦‚æœç¼–è¾‘è·ç¦»ä¸å½“å‰èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹ä¹‹é—´çš„ç¼–è¾‘è·ç¦»ç›¸åŒï¼Œåˆ™è€ƒè™‘æ’å…¥åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚BKæ ‘æ¯æ¬¡æ’å…¥å‡ä»æ ¹ç»“ç‚¹å¼€å§‹ï¼Œæ ¹èŠ‚ç‚¹å¯ä»¥æ˜¯è¯å…¸ä¸­çš„ä»»æ„ä¸€ä¸ªå•è¯ã€‚</p>
<p>ä¾‹å¦‚å‘ä¸Šè¿°è¯å…¸æ’å…¥æ–°å•è¯<code>shell</code>æ—¶æ’å…¥è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ¯”è¾ƒshellä¸æ ¹èŠ‚ç‚¹helpçš„ç¼–è¾‘è·ç¦»ï¼Œå¾—åˆ°2</li>
<li>å‘ç°æ ¹èŠ‚ç‚¹å·²ç»å­˜åœ¨ç¼–è¾‘è·ç¦»ä¸º2çš„å­èŠ‚ç‚¹helloï¼Œå› æ­¤å°è¯•å°†shellæ’å…¥åˆ°å­èŠ‚ç‚¹helloä¸Š</li>
<li>æ¯”è¾ƒshellä¸helloçš„ç¼–è¾‘è·ç¦»ï¼Œå› ä¸ºhelloæ²¡æœ‰ç¼–è¾‘è·ç¦»ä¸º2çš„å­èŠ‚ç‚¹ï¼Œå› æ­¤æ’å…¥</li>
</ul>
<p>å¾—åˆ°ä¸‹å›¾ï¼š<br><img src="http://7xlnl2.com1.z0.glb.clouddn.com/2017-04-09-2.png" alt="æ–°çš„BKæ ‘"></p>
<p>å¯¹äºä¸€ä¸ªç»™å®šçš„TOLï¼ˆtolerance valueï¼‰ä½œä¸ºç¼–è¾‘è·ç¦»çš„ä¸Šé™ï¼Œæˆ‘ä»¬ä½¿ç”¨BKæ ‘æ¥æŸ¥æ‰¾ä¸ç»™å®šèŠ‚ç‚¹Nç¼–è¾‘è·ç¦»å°äºç­‰äºTOLçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>è®¡ç®—ç»™å®šèŠ‚ç‚¹Nä¸æ ¹èŠ‚ç‚¹çš„ç¼–è¾‘è·ç¦»Dï¼Œæ¥ç€ç»§ç»­æœç´¢ä¸æ ¹èŠ‚ç‚¹ç¼–è¾‘è·ç¦»åœ¨[D - TOL, D + TOL]ä¹‹é—´çš„å­èŠ‚ç‚¹ã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹çŸ¥é“æ‰¾åˆ°æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ã€‚</p>
</blockquote>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LEN 10</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">    <span class="built_in">string</span> word;</div><div class="line">    <span class="comment">// next[i]ä¸­ä¿å­˜çš„å€¼ä¸ºä¸wordç¼–è¾‘è·ç¦»ä¸ºiçš„è¯åœ¨treeä¸­çš„ä¸‹æ ‡</span></div><div class="line">    <span class="keyword">int</span> next[<span class="number">2</span> * LEN];</div><div class="line"></div><div class="line">    Node(<span class="built_in">string</span> x): word(x) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">2</span>*LEN; ++i) &#123;</div><div class="line">            next[i] = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Node():word() &#123;&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line">Node RT;</div><div class="line"><span class="keyword">int</span> dp[<span class="number">2</span> * LEN][<span class="number">2</span> * LEN];</div><div class="line">Node tree[MAXN];</div><div class="line"></div><div class="line"><span class="keyword">int</span> ptr = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">min</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> min(min(a, b), c);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">editDistance</span><span class="params">(<span class="built_in">string</span> &amp;a, <span class="built_in">string</span> &amp;b)</span> </span>&#123;</div><div class="line">    <span class="comment">// åŠ¨æ€è§„åˆ’è·å–æœ€çŸ­ç¼–è¾‘è·ç¦»</span></div><div class="line">    <span class="keyword">int</span> a_len = a.length();</div><div class="line">    <span class="keyword">int</span> b_len = b.length();</div><div class="line"></div><div class="line">    <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp));</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=a_len; ++i)</div><div class="line">        dp[i][<span class="number">0</span>] = i;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;=b_len; ++j)</div><div class="line">        dp[<span class="number">0</span>][j] = j;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=a_len; ++i) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;=b_len; ++j) &#123;</div><div class="line">            <span class="keyword">if</span>(a[i<span class="number">-1</span>] != b[j<span class="number">-1</span>]) &#123;</div><div class="line">                dp[i][j] = min(<span class="number">1</span> + dp[i<span class="number">-1</span>][j],      <span class="comment">// deletion</span></div><div class="line">                               <span class="number">1</span> + dp[i][j<span class="number">-1</span>],      <span class="comment">// insertion</span></div><div class="line">                               <span class="number">1</span> + dp[i<span class="number">-1</span>][j<span class="number">-1</span>]);   <span class="comment">// replacement</span></div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> dp[a_len][b_len];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(Node &amp;root, Node &amp;cur)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(root.word.length() == <span class="number">0</span>) &#123;</div><div class="line">        root = cur;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> distance = editDistance(cur.word, root.word);</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(tree[root.next[distance]].word.length() == <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">// è‹¥ä¸rootç¼–è¾‘è·ç¦»ä¸ºdistanceçš„ä½ç½®æ²¡æœ‰èŠ‚ç‚¹ï¼Œåˆ™å°†è¯¥èŠ‚ç‚¹æ ‡è®°ä¸ºå¶å­ç»“ç‚¹</span></div><div class="line">        ++ptr;</div><div class="line">        tree[ptr] = cur;</div><div class="line">        root.next[distance] = ptr;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        add(tree[root.next[distance]], cur);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; getSimilarWords(Node &amp;root, <span class="built_in">string</span> &amp;s, <span class="keyword">int</span> TOL) &#123;</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; ret;</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(root.word == <span class="string">""</span>)</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> distance = editDistance(root.word, s);</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(distance &lt;= TOL)</div><div class="line">        ret.push_back(root.word);</div><div class="line"></div><div class="line">    <span class="keyword">int</span> start = distance - TOL;</div><div class="line">    <span class="keyword">if</span>(start &lt; <span class="number">0</span>)</div><div class="line">        start = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">while</span>(start &lt; distance + TOL) &#123;</div><div class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; tmp = getSimilarWords(tree[root.next[start]], s, TOL);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i : tmp) &#123;</div><div class="line">            ret.push_back(i);</div><div class="line">        &#125;</div><div class="line">        ++start;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">string</span> dictionary[] = &#123;<span class="string">"hello"</span>, <span class="string">"help"</span>, <span class="string">"shel"</span>, <span class="string">"smell"</span>, <span class="string">"fell"</span>,</div><div class="line">                           <span class="string">"felt"</span>, <span class="string">"oops"</span>, <span class="string">"pop"</span>, <span class="string">"oouch"</span>, <span class="string">"halt"</span>&#125;;</div><div class="line"></div><div class="line">    ptr = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> sz = <span class="keyword">sizeof</span>(dictionary) / <span class="keyword">sizeof</span>(<span class="built_in">string</span>);</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;sz; ++i) &#123;</div><div class="line">        Node temp = Node(dictionary[i]);</div><div class="line">        add(RT, temp);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">string</span> w1 = <span class="string">"ops"</span>;</div><div class="line">    <span class="built_in">string</span> w2 = <span class="string">"helt"</span>;</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; match = getSimilarWords(RT, w1, <span class="number">2</span>);</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"similar words in dictionary for: "</span> &lt;&lt; w1 &lt;&lt; <span class="string">":"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> x : match) &#123;</div><div class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"- "</span> &lt;&lt; x &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    match = getSimilarWords(RT, w2, <span class="number">2</span>);</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"similar words in dictionary for: "</span> &lt;&lt; w2 &lt;&lt; <span class="string">":"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> x : match) &#123;</div><div class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"* "</span> &lt;&lt; x &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>BKæ ‘çš„åº”ç”¨ï¼š</p>
<p>ä¸€èˆ¬æåˆ°BKæ ‘ï¼Œäº†è§£è¿™ä¸ªæ•°æ®ç»“æ„çš„äººéƒ½ä¼šæƒ³åˆ°å•è¯çº é”™ã€‚è€Œæœ€è¿‘çœ‹åˆ°ä¸€éåšæ–‡è®²è¿°äº†å¦‚ä½•ä½¿ç”¨BKæ ‘å®ç°æµ·é‡å›¾ç‰‡çš„å»é‡ï¼ˆæ‰¾åˆ°ä¸ç»™å®šå›¾ç‰‡ç¼–è¾‘è·ç¦»åœ¨ä¸Šé™èŒƒå›´å†…çš„æ‰€æœ‰å›¾ç‰‡å¹¶åˆ é™¤ï¼‰ï¼Œå…¶å®ä»”ç»†æƒ³ä¸€æƒ³å¯¹BKæ ‘åº”ç”¨çš„æ­£ç¡®ç†è§£åº”è¯¥æ˜¯åŸºäºç›¸ä¼¼åº¦æœç´¢ç»“æœï¼Œè€Œä¸åº”è¯¥ç®€å•ç²—æš´åœ°ç†è§£ä¸ºå•è¯çº é”™ï¼ˆå…¶å®ä¹Ÿæ˜¯æ¨¡ç³ŠæŸ¥è¯¢ï¼‰è¿™ç§å…¸å‹çš„åº”ç”¨åœºæ™¯ï¼Œè¿™æ ·çš„è®¤çŸ¥æœ‰æ—¶å€™å¯èƒ½ä¼šé™åˆ¶æˆ‘ä»¬åœ¨å®é™…åœºæ™¯ä¸­å¯¹è„‘æµ·ä¸­çŸ¥è¯†çš„å˜ç°ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;BKæ ‘æ˜¯ä¸€ç§åŸºäºæ ‘çš„æ•°æ®ç»“æ„ï¼Œç”¨æ¥å¿«é€ŸæŸ¥æ‰¾åŸºäºç¼–è¾‘è·ç¦»çš„ç›¸ä¼¼å­—ç¬¦ä¸²åŒ¹é…ï¼Œæ¯”å¦‚æ‹¼å†™çº é”™æˆ–æ¨¡ç³ŠæŸ¥æ‰¾ã€‚è®¸å¤šè½¯ä»¶ä¸­çš„è‡ªåŠ¨æ‹¼å†™çº é”™å°±æ˜¯åŸºäºè¿™ä¸ªæ•°æ®ç»“æ„æ¥å®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;BKæ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯è¯å…¸ä¸­çš„ä¸€ä¸ªå•è¯ï¼Œè€Œæ ‘ä¸­çš„è¾¹æƒé‡åˆ™è¡¨æ˜å¶å­ç»“ç‚¹åˆ°æ ¹èŠ‚ç‚¹ä¹‹é—´çš„ç¼–è¾‘è·ç¦»ã€‚ä¾‹å¦‚ä»èŠ‚ç‚¹uåˆ°
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="data structure" scheme="http://blog.yinwoods.work/tags/data-structure/"/>
    
  </entry>
  
  <entry>
    <title>2016å¹´å¹´ç»ˆæ€»ç»“</title>
    <link href="http://blog.yinwoods.work/2016/12/30/2016%E5%B9%B4%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>http://blog.yinwoods.work/2016/12/30/2016å¹´å¹´ç»ˆæ€»ç»“/</id>
    <published>2016-12-29T16:00:00.000Z</published>
    <updated>2017-07-26T10:06:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸çŸ¥ä¸è§‰2016å°±è¦ç»“æŸäº†,ä¹Ÿåˆ°äº†äº¤ä¸Šè‡ªå·±2016å¹´ç­”å·çš„æ—¶å€™äº†ã€‚æ¬²æ‰¬å…ˆæŠ‘çš„2016å¹´å¹´ç»ˆæ€»ç»“ï¼Œå…ˆä»åæ¶ˆæ¯å¼€å§‹å§ã€‚</p>
<h3 id="2016å¹´é—æ†¾çš„"><a href="#2016å¹´é—æ†¾çš„" class="headerlink" title="2016å¹´é—æ†¾çš„"></a>2016å¹´é—æ†¾çš„</h3><p>å…¶å®ä»è‡ªå·±å†…å¿ƒæ·±å¤„æ¥è¯´ï¼Œæ²¡æœ‰è§‰å¾—2016å¹´æœ‰ä»€ä¹ˆé—æ†¾ï¼Œä½†ä½œä¸ºå¹´ç»ˆæ€»ç»“å¦‚æœä¸€ç‚¹é—æ†¾éƒ½æ²¡æœ‰ä¹Ÿç¡®å®è¯´ä¸è¿‡å»:)ã€‚</p>
<p>æœ€å¤§çš„é—æ†¾æ˜¯ç­”åº”è‡ªå·±å»æ—¥æœ¬æ—…è¡Œçš„æ‰¿è¯ºæ²¡æœ‰åšåˆ°å§ï¼ŒåŸå› æ˜¯ç­¾è¯å¤ªéš¾åŠäº†ï¼Œå°¤å…¶å¯¹æˆ‘æ¥è¯´ã€‚ã€‚ã€‚æ‰€ä»¥æš‘å‡çš„æ¯•ä¸šæ—…è¡Œé€‰æ‹©äº†æ¢…å¼€ä¸¤åº¦â€”â€”äº‘å—ï¼Œä¹Ÿè¿˜ç®—ç©çš„å¼€å¿ƒå§ï¼Œä¸è¿‡å› ä¸ºæ˜¯ç¬¬äºŒæ¬¡å»ï¼Œæ‰€ä»¥æŸç§ç¨‹åº¦ä¸Šæˆäº†åŸºå‹å›¢çš„å¯¼æ¸¸ï¼ŒçœŸçœŸæ˜¯ç—›å¹¶å¿«ä¹ç€ã€‚</p>
<h3 id="2016å¹´å¤±å»çš„"><a href="#2016å¹´å¤±å»çš„" class="headerlink" title="2016å¹´å¤±å»çš„"></a>2016å¹´å¤±å»çš„</h3><p>2016å¹´å¤±å»äº†ä¸€äº›åšæŒäº†å¾ˆä¹…çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å¯¹ä¸€ä¸ªäººæŒç»­äº†å‡ å¹´çš„å–œæ¬¢ï¼Œå½“ç„¶æˆ‘æ‰¿è®¤è¿™ç§å–œæ¬¢æœ¬èº«å°±æ˜¯ä¸ç†æ™ºã€ç•¸å½¢çš„ï¼Œä¸è¿‡å®ƒä¹Ÿæ˜¯å€¾å…¥å¿ƒè¡€ã€ä¸æ±‚å›æŠ¥çš„ã€‚anywayï¼Œè·¯è¿‡äº†ï¼Œå¤±å»äº†ï¼Œæ²¡ä»€ä¹ˆå¯é—æ†¾çš„ã€‚</p>
<h3 id="2016å¹´å˜æœ¬åŠ å‰çš„"><a href="#2016å¹´å˜æœ¬åŠ å‰çš„" class="headerlink" title="2016å¹´å˜æœ¬åŠ å‰çš„"></a>2016å¹´å˜æœ¬åŠ å‰çš„</h3><p>2016å¹´çš„è‡ªå·±äººæƒ…å‘³å¥½åƒåˆè·Œäº†ã€‚ã€‚ã€‚ä»¥å‰å¤§æ¦‚æœ‰ä¸ª50%ï¼Ÿç°åœ¨å¯èƒ½åªå‰©ä¸‹20-30%äº†ï¼Ÿç»†æ€ææï¼Œåæ€è¿™ä¸€å¹´ä¸­çš„è‡ªå·±ç¡®å®å¦‚æœ‹å‹æ‰€è¯´ç»å¸¸æ‘†ä¸ªè‡­è„¸ï¼Œä¸€è„¸é«˜å†·ï¼ˆéè¤’ä¹‰ï¼‰ã€‚è™½ç„¶å’Œæœ‹å‹åœ¨ä¸€èµ·æ—¶è¿˜å¯ä»¥åšåˆ°æ¬¢å£°ç¬‘è¯­ï¼Œä½†å¤§å¤šæ—¶å€™çœŸçš„æ˜¯ç»·ç€è‡­è„¸ä¸€è¨€ä¸å‘å•Šï¼Œä¹Ÿè®¸è¿™ä¹Ÿæ˜¯æˆ‘ç ”ç©¶ç”Ÿå…¥å­¦åˆ°ç°åœ¨æ–°è®¤è¯†å¥³ç”Ÿä¸ªæ•°ä¸º0çš„åŸå› ï¼Ÿå“ˆå“ˆå“ˆã€‚ä¸è¿‡è¯è¯´å›æ¥ï¼Œä½œä¸ºä¸€ä¸ª20å¤šå²ç¤¾ä¼šäººå‘˜é¢„å¤‡å½¹ç ”ç©¶ç”Ÿï¼Œè¿™äº›ç¼ºç‚¹è‡ªå·±ä¸€ç›´æ˜¯å¿ƒé‡Œæœ‰æ•°çš„ï¼Œä¹‹æ‰€ä»¥æ²¡æœ‰æ”¹ä¸æ˜¯å› ä¸ºè‡ªå·±æ— èƒ½ä¸ºåŠ›ï¼Œè€Œæ˜¯æˆ‘éœ€è¦ã€‚ä¸‰ç‚¹åŸå› å§:</p>
<ul>
<li><p>å®éªŒå®¤çš„æ°›å›´æ€»æ˜¯é€éœ²ç€è¿·ä¹‹å°´å°¬çš„æ°”æ¯ï¼ˆéå¸¸é€‚åˆç°é˜¶æ®µçš„æˆ‘ï¼‰ï¼Œç¡®å®ä¸é€‚åˆæ•´å¤©å˜»å˜»å“ˆå“ˆã€æ²¡å¿ƒæ²¡è‚ºçš„ç”Ÿæ´»ï¼›</p>
</li>
<li><p>å‡ºäºå±è”½å¤–ç•Œå¹²æ‰°ï¼Œä¸“å¿ƒåšäº‹çš„è€ƒè™‘å§ï¼Œæ¯•ç«Ÿç²¾åŠ›æœ‰é™ï¼Œè€Œä¸”è‡ªå·±æƒ³è¦åšçš„äº‹éœ€è¦å€¾å…¥ç»å¤§éƒ¨åˆ†ç²¾åŠ›ï¼›</p>
</li>
<li><p>è‡ªå·±ä¸€ç›´ä»¥æ¥æœ‰ä¸ªè‡­æ¯›ç—…ï¼šå¤ªå¤§å˜´å·´å•¦ã€‚ã€‚ã€‚æ‰€ä»¥ä¸‡è¨€ä¸‡å½“ï¼Œä¸å¦‚ä¸€é»˜ï¼›</p>
</li>
</ul>
<h3 id="2016å¹´æ”¹æ­£çš„"><a href="#2016å¹´æ”¹æ­£çš„" class="headerlink" title="2016å¹´æ”¹æ­£çš„"></a>2016å¹´æ”¹æ­£çš„</h3><p>é¦–æ¨å¤§å˜´å·´ã€‚ã€‚ã€‚æ€ä¹ˆä»¥å‰è‡ªå·±æƒ³è¯´çš„è¯å°±é‚£ä¹ˆå¤šå‘¢ï¼Œè€Œä¸”å¤§å¤šæ•°æ—¶å€™éƒ½æ˜¯å‡ºäºå¤¸è€€è‡ªå·±æŠ€æœ¯ä¸Šçš„ä¸€äº›å¾®ä¸è¶³é“çš„å°æˆå°±ã€‚æ‰€å¹¸åœ¨2016å¹´çš„å°å°¾å·´ä»æ‰‹ä¸­æµé€ä¹‹é™…æ”¹æ‰äº†ï¼Œå…¶å®2015å¹´è‡ªå·±ç¤¾äº¤åœˆå­åŸºæœ¬å…¨éƒ¨å™¤å£°ï¼Œæ€ä¹ˆ2016å¹´å°±åƒæ‰“äº†é¸¡è¡€ä¸€æ ·ï¼Œä¸€ç›´BBå¨BBå¨ã€‚ã€‚ã€‚å½“ç„¶ä¹‹æ‰€ä»¥æ”¹æ‰äº†è¿™ä¸ªç¼ºç‚¹å€’ä¸åªæ˜¯è¯´åœ¨ç¤¾äº¤åœˆå­å†…å‘å£°å˜å°‘ï¼Œè€Œæ˜¯æºäºå¯¹è‡ªå·±å†…å¿ƒæ·±å¤„çš„å®¡è§†ï¼Œæœªæ¥è‡ªå·±è§‰å¾—å¥½çš„ä¸œè¥¿å¯èƒ½è¿˜æ˜¯ä¼šåˆ†äº«ï¼Œå¯æ˜¯ä¸å†å¸Œæœ›å…¨ä¸–ç•Œéƒ½çŸ¥é“äº†ï¼Œæ¯•ç«Ÿç”Ÿæ´»æ˜¯è‡ªå·±çš„ã€‚</p>
<h3 id="2016å¹´æ”¶è·çš„"><a href="#2016å¹´æ”¶è·çš„" class="headerlink" title="2016å¹´æ”¶è·çš„"></a>2016å¹´æ”¶è·çš„</h3><p>è¯´äº†ä¸€å †ï¼Œç»ˆäºè¦è¿ˆå…¥åšå®¢æ­£é¢˜äº†ï¼Œå…¶å®2016å¹´å½’æ ¹åˆ°åº•ï¼Œè‡ªå·±çš„æ”¶è·è¿œè¿œå¤§äºæ”¶å…¥çš„ï¼Œä¹Ÿä¸å±€é™äºæŠ€æœ¯æ–¹é¢ï¼Œè€Œæ˜¯æ¶µç›–ç”Ÿæ´»çš„å„ä¸ªæ–¹é¢ï¼Œä¸‹é¢å¨“å¨“é“æ¥ï¼Œä¹Ÿç®—æ˜¯å¯¹è‡ªå·±2016å¹´çš„æ”¶è·åšä¸€ä¸ªæ¢³ç†å§ã€‚</p>
<h4 id="æŠ€æœ¯ä¸Šæ”¶è·çš„"><a href="#æŠ€æœ¯ä¸Šæ”¶è·çš„" class="headerlink" title="æŠ€æœ¯ä¸Šæ”¶è·çš„"></a>æŠ€æœ¯ä¸Šæ”¶è·çš„</h4><p>ä½œä¸ºä¸€ä¸ªç¨‹åºçŒ¿ï¼Œè¦æ˜¯å¹´åº¦æ€»ç»“ä¸æ¯«ä¸ææŠ€æœ¯ï¼Œé‚£è¿™ä¸€å¹´å¾—æ˜¯è¿‡å¾—å¤šå¤±è´¥å•Š:Pã€‚2016å¹´å¯ä»¥ç®—æ˜¯è‡ªå·±æ­£å¼è¿ˆå…¥è®¡ç®—æœºæŠ€æœ¯å¤§é—¨é—¨æ§›çš„ä¸€å¹´å§ï¼ˆç°åœ¨ç¡®å®æ˜¯è¿™ä¹ˆè§‰å¾—ï¼Œä¸çŸ¥é“ä»¥åä¼šä¸ä¼šæ‰“è„¸ï¼Œä¸è¿‡æˆé•¿ä¸å°±æ˜¯ä¸æ–­æ‰“è„¸çš„è¿‡ç¨‹å—ï¼‰ï¼Œè¿™ä¸€å¹´å¯ä»¥æ¸…æ¥šåœ°å¯Ÿè§‰åˆ°è‡ªå·±çªç ´äº†é•¿æœŸä»¥æ¥çš„æŠ€æœ¯ç“¶é¢ˆï¼Œæœ¬ç§‘å››å¹´è‡ªå·±å¾ˆåŠªåŠ›ï¼Œå¯æ˜¯è‹¦äºæ²¡æœ‰ä¸€ä¸ªå¯ä¾›æ·±è€•çš„æ–¹å‘ï¼Œå­¦äº†ä¸€å¤§å †ä¸œè¥¿ï¼Œåˆ°å¤´æ¥å‘ç°èƒ½è®°ä½ã€åœ¨ç”Ÿæ´»ä¸­èƒ½è¿ç”¨åˆ°çš„çš„å´å¯¥å¯¥æ— å‡ ã€‚ä¸è¿‡ä¹Ÿæ­£æ˜¯å› ä¸ºä»¥å‰è‡ªå·±å­¦çš„å¤ªæ‚ï¼Œæ‰€ä»¥æœ‰äº†ä»Šå¤©çš„é‡å˜åˆ°è´¨å˜è½¬åŒ–çš„è¿‡ç¨‹ã€‚å¼•å‘è´¨å˜çš„åŸå› æ€»ç»“ä¸‹æ¥æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å§ï¼š</p>
<ul>
<li><p>å®ä¹ å‘†çš„å…¬å¸æ˜¯åˆåˆ›å…¬å¸ï¼Œä»€ä¹ˆåŸºç¡€è®¾æ–½éƒ½æœ‰è‡ªå·±æ­å»ºï¼Œæ‰€ä»¥å¾—åˆ°äº†æå¤§çš„é”»ç‚¼ï¼Œå¤–åŠ é¢†å¯¼ç›¸å½“æœ‰èŠ‚å¥çš„pushï¼Œæ‰€ä»¥æˆé•¿é€Ÿåº¦è¿œå¿«äºåœ¨å­¦æ ¡çš„æ—¥å­ï¼›</p>
</li>
<li><p>è¿›å…¥äº†ä¸€ä¸ªæ›´é«˜çš„å¹³å°ï¼Œæ¥è§¦çš„äººã€æŠ€æœ¯ä¹Ÿå¤„äºä¸€ä¸ªæ›´é«˜çš„å±‚æ¬¡ï¼Œå› æ­¤èƒ½å¤Ÿåœ¨å®é™…ç”Ÿæ´»ä¸­ä»èº«è¾¹çš„æœ‹å‹ã€åŒäº‹èº«ä¸Šå­¦ä¹ å¾ˆå¤šï¼›</p>
</li>
<li><p>åœ¨å®ä¹ è¿‡ç¨‹ä¸­å¯¹ä¸€ä¸ªç¨‹åºçŒ¿çš„æˆé•¿æ›²çº¿æœ‰äº†ä¸€ä¸ªå¤§è‡´çš„è®¤çŸ¥ï¼Œæ‰€ä»¥å¯¹è‡ªå·±çš„å‘å±•è·¯çº¿ä¹Ÿæœ‰äº†ä¸€ä¸ªå¤§è‡´è§„åˆ’ï¼›</p>
</li>
<li><p>åº¦è¿‡äº†2015å¹´çš„èˆ’é€‚åŒºï¼Œè¿›å…¥äº†ä¸€ä¸ªå¿™ç¢Œçš„é˜¶æ®µï¼Œè¿™ç§çªå˜çš„ç¯å¢ƒå¾€å¾€ä¹Ÿä¼šå¯¼è‡´ä¸€ä¸ªäººçš„çªå˜ï¼ˆfor me, technologicallyï¼‰ï¼›</p>
</li>
<li><p>è‡ªå·±æš‘å‡æœŸé—´å¼€å§‹é˜…è¯»è‹±æ–‡æŠ€æœ¯ä¹¦ç±å¹¶ <strong>è¯»å®Œ</strong> ï¼Œæ”¾ä½›æ‰“å¼€äº†æ–°ä¸–ç•Œçš„å¤§é—¨å•Šã€‚ã€‚ã€‚å¦‚æœæ˜¯ä¸­æ–‡æŠ€æœ¯èµ„æ–™æ˜¯V0.1çš„è¯ï¼Œè‹±æ–‡èµ„æ–™å®Œå…¨æ˜¯V2.0å•Šï¼ï¼çœŸçš„å¼ºçƒˆæ¨èåšæŠ€æœ¯çš„æœ‹å‹å¥½å¥½å­¦è‹±è¯­ï¼Œ å®ƒè¿œæ¯”ä½ æƒ³è±¡ä¸­æœ‰ç”¨åœ°å¤šå¾—å¤šï¼›</p>
</li>
</ul>
<p>ä¹‹æ‰€ä»¥è¯´è¿™ä¸€å¹´è‡ªå·±çš„æŠ€æœ¯ä¸Šäº§ç”Ÿäº†è´¨å˜ï¼ŒåŸå› æ˜¯ç°åœ¨çš„è‡ªå·±æ„Ÿè§‰å­¦ä»€ä¹ˆä¸œè¥¿éƒ½ç›¸å½“å¿«ï¼ˆå¯¹æ¯”ä»¥å‰çš„è‡ªå·±æ¥è¯´ï¼‰ã€‚ä¸¾å‡ ä¸ªä¾‹å­ï¼š</p>
<ul>
<li><p>ç°åœ¨å¯ä»¥ä¸å®¢æ°”åœ°è¯´è‡ªå·±ç†Ÿç»ƒæŒæ¡äº†pythonï¼ŒåŸå› ä¸ä»…ä»…æ˜¯å†™äº†å‡ ä¸‡è¡Œpythonä»£ç é‚£ä¹ˆç®€å•ï¼Œå­¦ä¹ è¿‡ç¨‹ä¸­å¯æ˜¯æŸ¥é˜…äº†æ•°é‡ç›¸å½“åºå¤§çš„pythonè‹±æ–‡èµ„æ–™å•Šï¼›</p>
</li>
<li><p>åå‡ å¤©è¿‡äº†ä¸€éã€ŠLinux Command Guideã€‹ï¼Œå†åŠ ä¸Šå®ä¹ è¿‡ç¨‹ä¸­ç»å¸¸äº²çœ¼ç›®ç¹bossä½¿ç”¨linuxçš„èŠ±å¼ç»„åˆå‘½ä»¤ï¼Œè‡ªå·±ç°åœ¨å¯¹linuxä¹Ÿèƒ½å¤Ÿç†Ÿç»ƒä½¿ç”¨äº†ï¼Œç†Ÿæ‚‰åæ„ˆå‘è§‰å¾—linuxæ˜¯æ•ˆç‡ç¥å™¨ï¼Œä½¿ç”¨èµ·æ¥æ¸¸åˆƒæœ‰ä½™ã€‚</p>
</li>
<li><p>å‡ å¤©è¿‡äº†ä¸€éã€ŠLearn the vi and vim Editorsã€‹ï¼Œå¯¹vimçš„ä½¿ç”¨ä»¥åŠlinux shellçš„ä½¿ç”¨è‡ªå®šä¹‰é…ç½®éƒ½æœ‰äº†ä¸€å®šçš„äº†è§£ï¼ŒåŒæ•ˆç‡ç¥å™¨ã€‚ã€‚ã€‚ä¸ºä»€ä¹ˆè‡ªå·±ç°åœ¨æ‰æ·±å…¥å­¦ä¹ å•Šå•Šå•Šå•Š</p>
</li>
<li><p>å®ä¹ è¿‡ç¨‹ä¸­å®Œå…¨æ˜¯sshè¿œç¨‹æ“ä½œï¼Œå°¤å…¶æ˜¯å¤§æ•°æ®ç›¸å…³æ“ä½œç¼–å†™mapreduceä»»åŠ¡ã€éƒ¨ç½²å®šæ—¶ä»»åŠ¡ã€æ­å»ºdockerå¼€å‘ç¯å¢ƒä»¥åŠpython tornadoåå°å¼€å‘ç­‰ç­‰ã€‚ã€‚ã€‚</p>
</li>
</ul>
<p>æ€»ä¹‹ï¼Œåœ¨16å¹´å¹´åº•å›é¦–è¿™ä¸€å¹´ï¼Œæˆ‘å¯¹è‡ªå·±çš„æŠ€æœ¯æˆé•¿æ˜¯ç›¸å½“æ»¡æ„çš„ï¼ŒåŒæ—¶ä¹Ÿå¯¹2017å¹´çš„è‡ªå·±ä¹ƒè‡³æœªæ¥çš„è‡ªå·±æœ‰äº†æ›´å¤šä¿¡å¿ƒã€‚</p>
<h4 id="å¿ƒçµä¸Šæ”¶è·çš„"><a href="#å¿ƒçµä¸Šæ”¶è·çš„" class="headerlink" title="å¿ƒçµä¸Šæ”¶è·çš„"></a>å¿ƒçµä¸Šæ”¶è·çš„</h4><p>16å¹´çœŸçš„æ˜¯è‡ªå·±äººç”Ÿè¿ˆå‘æ–°é˜¶æ®µçš„å…ƒå¹´ï¼Œæƒ³æƒ³15å¹´çš„è‡ªå·±é¢“åœ°å°±å·®è‡ªæš´è‡ªå¼ƒäº†ã€‚ã€‚ã€‚ç°åœ¨åˆ™å¯¹è‡ªå·±æœ‰ç€è¶³å¤Ÿçš„ä¿¡å¿ƒï¼Œè¿™äº›ä¿¡å¿ƒæºäºå¯¹è‡ªå·±çš„è®¤çŸ¥ï¼Œè®¤æ¸…äº†è‡ªå·±æ˜¯æ€æ ·çš„ï¼Œèº«è¾¹äººæ˜¯æ€æ ·çš„ï¼Œè¿™ä¸ªç¤¾ä¼šåˆæ˜¯æ€æ ·çš„ï¼Œä»˜å‡ºäº†é‚£ä¹ˆå¤šï¼Œæœ‰ä»€ä¹ˆç†ç”±ä¸è‡ªä¿¡å‘¢ï¼Ÿæˆ‘æƒ³ä¸€ä¸ªäººçš„æˆé•¿è¿‡ç¨‹å°±æ˜¯è¿™æ ·å§ï¼Œæ­¤èµ·å½¼ä¼ã€ä¸Šä¸Šä¸‹ä¸‹ï¼Œå¯æ˜¯éšç€æ—¶é—´çš„æµé€ï¼Œæˆ‘ä»¬å¯¹è‡ªå·±çš„è®¤çŸ¥ç»ˆä¼šè¶‹å‘äºä¸€ä¸ªç†æ€§çš„åŒºé—´ï¼Œè¯´ç€è¯´ç€åˆæœ‰äº›æœŸå¾…ä¸‹æ¬¡é¢“åºŸçš„è‡ªå·±äº†ï¼Œè¦å†é‡åˆ°ä»€ä¹ˆæ ·çš„å¤§ç‰›ï¼Œæ‰¿å—ä»€ä¹ˆæ ·çš„åŠæ‰“å‘¢ï¼Ÿ</p>
<p>è‡ªå·±å¦ä¸€ä¸ªå˜åŒ–å°±æ˜¯èƒ½å¤Ÿæ›´æ¸…æ™°åœ°å®¡è§†è‡ªå·±çš„æœªæ¥äº†å§ï¼ŒæåŠæ¢¦æƒ³ï¼Œè‡ªå·±å°±å……æ»¡äº†æ–—å¿—ã€‚ã€‚ã€‚å¹²åŠ²åè¶³ï¼Œæ‰“é¸¡è¡€çŠ¶æ€ã€‚è¿™ç§çŠ¶æ€å§ï¼Œå°±å¥½æ¯”æœ‰äº›æ·˜æ°”çš„å°å­©å­æƒ³è¦åƒç³–ï¼Œçˆ¸çˆ¸å¦ˆå¦ˆä¸ç»™ï¼Œé‚£ä»–å“­å“‘äº†å—“å­ä¹Ÿè¦åƒåˆ°é‚£å—ç³–ï¼Œæˆ‘ç°åœ¨å°±æ˜¯è¿™æ ·ã€‚ã€‚ã€‚æœ‰äº›äº‹æ˜¯çœŸçš„æ— è®ºå¦‚ä½•ä¹Ÿè¦åšåˆ°ï¼Œè¿™ä¹ˆè¯´å¯èƒ½ä¸å¤ªåˆé€‚ï¼Œæ˜¯æœ‰äº›äº‹æ— è®ºå¦‚ä½•ä¹Ÿè¦å°½åŠ›åšåˆ°å§ã€‚å“ªæ€•è¿™æ¡è·¯è¦ä¸€ä¸ªäººèµ°ï¼Œè¦ç‰ºç‰²å¾ˆå¤šã€‚ä½†å¿ƒç”˜æƒ…æ„¿ï¼Œåªæœ‰è¿™æ ·è‡ªå·±æ‰ä¼šæ„Ÿåˆ°å¼€å¿ƒã€‚</p>
<p>æœ€åä¸€ç‚¹å°±æ˜¯è‡ªå·±ä¸€ç›´ä»¥æ¥æƒ³åšçš„ä¸€ä¸ªæ”¹å˜äº†ï¼Œä¹Ÿæ˜¯æˆ‘è®¤ä¸ºè‡ªå·±ä»¥å‰æœ€ç¼ºçš„ä¸€ç‚¹å§ï¼šé—·å£°å‘å¤§è´¢ï¼Œè¿™æ ·æ‰æ˜¯æœ€å¥½çš„ï¼Œå“ˆå“ˆå“ˆã€‚2017å¹´è¦ä½è°ƒåœ°åˆ’è¿‡å»ï½</p>
<h3 id="å†™è¿‡çš„ä»£ç "><a href="#å†™è¿‡çš„ä»£ç " class="headerlink" title="å†™è¿‡çš„ä»£ç "></a>å†™è¿‡çš„ä»£ç </h3><p>ä»Šå¹´githubæäº¤ä¸»è¦è¿˜æ˜¯è‡ªå·±çš„åšå®¢ï¼Œå¿æ„§ã€‚ã€‚ã€‚</p>
<p>å¦å¤–ä¹æœˆä»½è‡ªå·±å†™äº†ä¸ªé’ˆå¯¹åŒ—èˆªåƒåœ¾ç³»ç»Ÿçš„çˆ¬è™«çˆ¬å–ä¸ªäººè¯¾è¡¨ã€‚</p>
<p>æ˜å¹´å†æ¥å†å‰~</p>
<p><img src="http://7xlnl2.com1.z0.glb.clouddn.com/post59-github.jpg" alt="Github"></p>
<h4 id="è¯»è¿‡çš„ä¹¦"><a href="#è¯»è¿‡çš„ä¹¦" class="headerlink" title="è¯»è¿‡çš„ä¹¦"></a>è¯»è¿‡çš„ä¹¦</h4><p>ç°åœ¨çš„ç¤¾äº¤åª’ä½“ä¸Šå¥½åƒæ€»æ˜¯å€¾å‘äºæŠŠè¯»ä¹¦å®£æ‰¬ä¸ºä¸€ä»¶å¾ˆä¼˜é›…ã€é«˜ç«¯çš„è¡Œä¸ºã€‚æ— è§£ã€‚åœ¨æˆ‘çœ¼é‡Œå®ƒå’Œçœ‹ç”µå½±æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå†µä¸”å¾ˆå¤šäººè¯»å†å¤šçš„ä¹¦è„‘å­é‡Œçš„æ€æƒ³ä¹Ÿæ˜¯è‡­ä¸å¯é—»ã€‚è¯»è¿‡çš„ä¹¦ç›®ã€èµ°è¿‡çš„è·¯é€”ï¼Œæ•æˆ‘ç›´è¨€ï¼Œå’Œä¸€ä¸ªäººçš„ä¸‰è§‚ä¿®å…»ä¸è§å¾—æ˜¯ä¸€ä¸ªæ­£æ¯”ä¾‹å‡½æ•°ï¼Œé‡è¦çš„æ˜¯è¿™äº›è¿‡ç¨‹ä¸­è‡ªå·±çš„æ€è€ƒå§ã€‚æ‰€ä»¥èº«è¾¹å¦‚æœæœ‰äººè¯´ä»–åœ¨è¯»é²è¿…ã€èŒ¨å¨æ ¼ã€æ‘ä¸Šæ˜¥æ ‘ç­‰ç­‰ï¼Œæˆ‘å“ªæ€•åœ¨è¯»çš„æ˜¯è¡—è¾¹é»„è‰²å°ä¹¦åˆŠä¹Ÿä¸ä¼šè§‰å¾—è‡ªå·±å§¿åŠ¿å°±ä½åˆ°å“ªé‡Œå»äº†ã€‚è¨€å½’æ­£ä¼ ï¼Œ16å¹´è¯»çš„è¿˜æ˜¯å°è¯´ã€æŠ€æœ¯ä¹¦ç±å±…å¤šï¼Œæœ‰ä¸‹é¢è¿™äº›å§ï¼š</p>
<ul>
<li><p>ä¸€æœˆï¼šå‡†é£æœˆè°ˆ</p>
</li>
<li><p>äºŒæœˆï¼šæ–‡åŒ–çš„åŠ›é‡</p>
</li>
<li><p>å››æœˆï¼šæ€§çˆ±ä¸å©šå§»ã€ä¹”å®¶å¤§é™¢ã€è¾¹åŸ</p>
</li>
<li><p>äº”æœˆï¼šè¥¿æ¸¸è®°</p>
</li>
<li><p>å…­æœˆï¼šå°ç¥æ¼”ä¹‰ã€çº¢é«˜ç²±</p>
</li>
<li><p>ä¸ƒæœˆï¼š <strong>é€€åï¼Œæˆ‘è¦å¼€å§‹è£…é€¼äº†ã€‚ã€‚ã€‚</strong> Learn C the Hard Wayã€æ“ä½œç³»ç»Ÿæ€è€ƒã€è®ºæŒä¹…æˆ˜ã€è¡Œè€…æ— ç–†</p>
</li>
<li><p>å…«æœˆï¼šFluent Pythonã€Python Cookbook 3rd Editionã€Code Like a Pythonista Idiomatic Pythonã€Intermediate Pythonã€Web Scraping with Python</p>
</li>
<li><p>ä¹æœˆï¼šä¸€ä¸ªé™Œç”Ÿå¥³äººçš„æ¥ä¿¡</p>
</li>
<li><p>åæœˆï¼šAlgorithm Unplugged</p>
</li>
<li><p>åä¸€æœˆï¼šThe Linux Command Lineã€ Pro Git</p>
</li>
<li><p>åäºŒæœˆï¼šLearn the Vi and Vimã€Hadoop with Python</p>
</li>
</ul>
<h4 id="çœ‹è¿‡çš„ç”µå½±"><a href="#çœ‹è¿‡çš„ç”µå½±" class="headerlink" title="çœ‹è¿‡çš„ç”µå½±"></a>çœ‹è¿‡çš„ç”µå½±</h4><p>çœ‹è¿‡çš„ç”µå½±è¿˜çœŸä¸å°‘ï¼Œä¸»è¦é›†ä¸­åœ¨ä¸ŠåŠå¹´çš„å®ä¹ è¿‡ç¨‹ä¸­ï¼Œç ”ç©¶ç”Ÿå…¥å­¦ä»¥åæœ€æ–°ç§‘ç ”ï¼Œçœ‹å¾—ç”µå½±ä¹Ÿå°‘äº†ã€‚ã€‚ã€‚</p>
<p>è¯¦æƒ…è§<a href="https://movie.douban.com/standbyme/2016/share?source=broadcast&amp;user_id=79236503" target="_blank" rel="external">é“¾æ¥</a></p>
<h4 id="å¬è¿‡çš„æ­Œ"><a href="#å¬è¿‡çš„æ­Œ" class="headerlink" title="å¬è¿‡çš„æ­Œ"></a>å¬è¿‡çš„æ­Œ</h4><p>16å¹´å› ä¸ºå®ä¹ è¿‡ç¨‹ä¸­åœ¨è·¯ä¸Šçš„æ—¶é—´å¾ˆå¤šï¼Œæ‰€ä»¥å¬çš„æ­Œä¹Ÿå¾ˆå¤šï¼Œä¸€å¹´å¤§æ¦‚å¬äº†æœ‰3000+é¦–ï¼Ÿä¹Ÿæ˜¯åœ¨è¿™ä¸€å¹´ç¡®å®šäº†è‡ªå·±æœ€çˆ±çš„éŸ³ä¹ç±»å‹ï¼šç”µéŸ³ï¼›</p>
<h4 id="å»è¿‡çš„åœ°æ–¹"><a href="#å»è¿‡çš„åœ°æ–¹" class="headerlink" title="å»è¿‡çš„åœ°æ–¹"></a>å»è¿‡çš„åœ°æ–¹</h4><p>è¯´æ¥å¿æ„§ï¼Œä»Šå¹´çœŸçš„æ˜¯æ²¡å»å“ªé‡Œæµªï¼Œæœ€èµ·ç å’Œè‡ªå·±çš„é¢„æœŸè¿˜æ˜¯æœ‰å¾ˆå¤§å·®è·çš„ã€‚è¿œçš„åœ°æ–¹å°±å»äº†å—äº¬ã€æ‰¬å·ã€æ˜†æ˜ã€å¤§ç†ï¼›è¿‘çš„åœ°æ–¹åˆ™å»äº†é¦™å±±ï¼ˆè‡ªå·±è¯´å‡ºæ¥éƒ½å«Œä¸¢äººã€‚ã€‚ã€‚ï¼‰ã€é’é¾™å³¡ã€åæ¸¡ã€‚</p>
<h4 id="äº²æƒ…ä¸Šæ”¶è·çš„"><a href="#äº²æƒ…ä¸Šæ”¶è·çš„" class="headerlink" title="äº²æƒ…ä¸Šæ”¶è·çš„"></a>äº²æƒ…ä¸Šæ”¶è·çš„</h4><p>å› ä¸ºæ˜¯ä¸ªäººæ€»ç»“ï¼Œæ‰€ä»¥ä¸æƒ³æ·±è°ˆè‡ªå·±çš„å®¶åº­ç­‰ç­‰ã€‚æ€»ä¹‹16å¹´ä¸€åˆ‡éƒ½è¿ˆä¸Šäº†æ­£è§„ï¼Œä½œä¸ºæŒèˆµäººï¼Œä¼šè®©ä¸€åˆ‡è¶Šæ¥è¶Šå¥½ã€‚</p>
<p><img src="http://7xlnl2.com1.z0.glb.clouddn.com/post59-2017.jpg" alt="2017"></p>
<h3 id="2017æœŸå¾…çš„"><a href="#2017æœŸå¾…çš„" class="headerlink" title="2017æœŸå¾…çš„"></a>2017æœŸå¾…çš„</h3><p>è¯´å®Œäº†16å¹´çš„æ€»ç»“ï¼Œå…ä¸äº†ä¿—åœ°è¦è°ˆè°ˆ17å¹´çš„å°ç›®æ ‡äº†ï¼Œç»™è‡ªå·±ç«‹å‡ ä¸ªå¤Ÿå¾—ç€çš„FLAGï¼ˆè¯è¯´ç«‹è¿‡çš„FLAGå¥½åƒè¿˜æ²¡å€’è¿‡ï¼‰ã€‚</p>
<h4 id="æŠ€æœ¯ä¸Š"><a href="#æŠ€æœ¯ä¸Š" class="headerlink" title="æŠ€æœ¯ä¸Š"></a>æŠ€æœ¯ä¸Š</h4><p>ä¸ŠåŠå¹´ä¼šç»§ç»­æ·±å…¥åç«¯ï¼Œä¸ŠåŠå¹´ä»ç„¶ä»¥pythonä½œä¸ºä¸»åŠ›å¼€å‘è¯­è¨€ï¼Œå…¶ä¸­å‡½æ•°å¼ç¼–ç¨‹ä¸åç¨‹æ˜¯è‡ªå·±çš„ä¸¤ä¸ªä¸»è¦çªç ´ç‚¹ï¼Œå¦å¤–ç»§ç»­æ·±å…¥å­¦ä¹ ä½¿ç”¨linuxã€vimã€python webå¼€å‘æ¡†æ¶ã€‚</p>
<p>ä¸‹åŠå¹´åˆ™ä¼šç³»ç»Ÿåœ°è¿‡ä¸€éC++ï¼ŒæŒæ¡ç½‘ç»œã€æ“ä½œç³»ç»Ÿç­‰çŸ¥è¯†ï¼ˆä¸»è¦æŒ‡ä¸€äº›è¾ƒä½å±‚çš„çŸ¥è¯†ï¼‰ã€‚</p>
<p>è‡ªå·±æ‰“ç®—æŒæ¡çš„ä¸€äº›é›¶ç¢æˆ–ç›®å‰è¿˜ä¸€ç›´åŠè§£çš„ç›¸å…³æ¦‚å¿µï¼Œå®Œå–„çŸ¥è¯†ä½“ç³»ï¼š</p>
<ul>
<li><p>redisã€memcache</p>
</li>
<li><p>hadoopæ¶æ„åŠç”Ÿæ€</p>
</li>
<li><p>dockeré‡åº¦ä½¿ç”¨</p>
</li>
<li><p>unikernelä½¿ç”¨</p>
</li>
<li><p>NoSQLéç»“æ„åŒ–æ•°æ®åº“</p>
</li>
<li><p>æ·±åº¦å­¦ä¹ çš„åº”ç”¨åŠå‰æ™¯</p>
</li>
</ul>
<p>å¦å¤–è®¡åˆ’å¼€å‘ä¸€ä¸ªé’ˆå¯¹å®éªŒå®¤æŠ¥é”€çš„æŠ¥è´¦ç³»ç»Ÿï¼ŒèŠ‚çœè‡ªå·±æŠ¥è´¦æ—¶é—´ï¼›è¿˜æœ‰ç³»ç»Ÿåœ°è¯»ä¸€äº›Githubä¼˜è´¨æºä»£ç ï¼Œä¹¦ç­¾é‡Œå·²ç»èººäº†å‡ ä¸ªã€‚</p>
<p>å½“ç„¶ï¼Œé‡å¤´æˆæ€»è¦æ”¾åœ¨æœ€åï¼Œ17å¹´æ‰“ç®—è¿ˆå…¥å‰ç«¯å¤§é—¨ï¼Œå°±ä»¥è‡ªå·±çš„åšå®¢ä¸ºå®éªŒå°ç™½é¼ ï¼Œè¾¹å­¦è¾¹ç»ƒï¼Œå°†åšå®¢æ¥ä¸€æ¬¡å½»å¤´å½»å°¾çš„æ”¹å˜ï¼ˆåšçš„è¿‡ç¨‹ä¸­å­¦ä¼šä»¥äº§å“çš„è§’åº¦æ¥çœ‹å¾…æ•´ä¸ªåšå®¢ï¼‰ã€‚</p>
<p>æœ€åå®ç°å°†è‡ªå·±æŠ€æœ¯ä½“ç³»ä¸­å‰ç«¯ã€åç«¯æ‰“é€šçš„ç›®æ ‡ã€‚ä½†åº”è¯¥ä»ç„¶ä¼šä»¥åç«¯ä¸ºä¸»ï¼ˆä½†ä¹Ÿä¸æ’é™¤å­¦ä¹ è¿‡ç¨‹ä¸­å‘ç°å‰ç«¯å¤ªå¥½ç©ï¼Œè½¬å‰ç«¯ä¸ºä¸»çš„å¯èƒ½æ€§ï¼‰ã€‚</p>
<h4 id="æ€§æ ¼ä¸Š"><a href="#æ€§æ ¼ä¸Š" class="headerlink" title="æ€§æ ¼ä¸Š"></a>æ€§æ ¼ä¸Š</h4><p>æ€§æ ¼ä¸Šæƒ³è¦æ”¹å˜çš„åœ°æ–¹æœ‰ï¼š</p>
<ul>
<li><p>æ”¹å–„è‡ªå·±ç»·ç€ä¸ªè„¸çš„è‡­æ¯›ç—…ï¼ˆä¸æ˜¯æ ¹é™¤ï¼‰</p>
</li>
<li><p>å­¦ä¼šå¯’æš„ï¼Œç¥ç‰¹ä¹ˆç§˜åˆ¶æŠ€èƒ½ï¼Œæˆ‘ç°åœ¨æ˜¯çœŸçš„ä¸€ç‚¹ä¸ä¼š</p>
</li>
<li><p>å¤šçœ‹å°‘è¯´</p>
</li>
<li><p>æ€¥äººæ‰€éœ€ï¼Œå¤šå…³å¿ƒèº«è¾¹çš„æœ‹å‹ã€äº²äºº</p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸çŸ¥ä¸è§‰2016å°±è¦ç»“æŸäº†,ä¹Ÿåˆ°äº†äº¤ä¸Šè‡ªå·±2016å¹´ç­”å·çš„æ—¶å€™äº†ã€‚æ¬²æ‰¬å…ˆæŠ‘çš„2016å¹´å¹´ç»ˆæ€»ç»“ï¼Œå…ˆä»åæ¶ˆæ¯å¼€å§‹å§ã€‚&lt;/p&gt;
&lt;h3 id=&quot;2016å¹´é—æ†¾çš„&quot;&gt;&lt;a href=&quot;#2016å¹´é—æ†¾çš„&quot; class=&quot;headerlink&quot; title=&quot;2016å¹´é—æ†¾çš„&quot;&gt;&lt;
    
    </summary>
    
      <category term="diary" scheme="http://blog.yinwoods.work/categories/diary/"/>
    
    
      <category term="thoughts" scheme="http://blog.yinwoods.work/tags/thoughts/"/>
    
  </entry>
  
  <entry>
    <title>vim å­¦ä¹ ç¬”è®°</title>
    <link href="http://blog.yinwoods.work/2016/12/04/vim%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://blog.yinwoods.work/2016/12/04/vimå­¦ä¹ ç¬”è®°/</id>
    <published>2016-12-03T16:00:00.000Z</published>
    <updated>2017-07-26T10:06:54.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Chapter-3-Moving-Around-in-a-Hurry"><a href="#Chapter-3-Moving-Around-in-a-Hurry" class="headerlink" title="Chapter 3 Moving Around in a Hurry"></a>Chapter 3 Moving Around in a Hurry</h3><p>^F: scroll forward one screen.<br>^B: scroll backward one screen.</p>
<p>^D: scroll forward half screen.<br>^U: scroll backward half screen.</p>
<p>^E: scroll forward one line.<br>^Y: scroll backward one line.</p>
<p>zENTER: move current line to top of screen and scroll.<br>z.: move current line to center of screen and scroll.<br>z-: move current line to bottom of screen and scroll.</p>
<p>H: move to home-the top line of screen.<br>M: move to middle line of screen.<br>L: move to bottom line of screen.</p>
<p>ENTER: move to first character of next line.<br>+: move to first character of next line.<br>-: move to first character of previous line.</p>
<p>^: move to first nonblank character of current line.<br>n|: move to column n of current line.</p>
<p>e: move to end of word.<br>E: move to end of ward(ignore punctuation)</p>
<p>(: move to begining of current sentence.<br>): move to begining of next sentence.</p>
<p>{: move to begining of current paragraph.<br>}: move to begining of next paragraph.</p>
<p>[[: move to begining of current section.<br>]]: move to begining of next section.</p>
<p>/pattern: search forward for pattern.<br>?pattern: search backward for pattern.</p>
<p>n: repeat last search.<br>N: repeat last search in opposite direction.</p>
<p>/: repeat last search forward.<br>?: repeat last search backward.</p>
<p>fx: find next occurrence of x in the line, where x stands for any character.<br>Fx: find previous occurrence of x in the line.</p>
<p>tx: find character before next occurrence of x in the line.<br>Tx: find character after previous occurrence of x in the line.</p>
<p>;: repeat previous find command in same direction.<br>,: repeat previous find command in opposite direction.</p>
<p><code>: returns you to your original position(the position where you issued the last G command).
&#39;&#39;: act same as</code>, except that it returns the cursor to the begining of the line.</p>
<p>^G: show current line(not a movement command)</p>
<h3 id="Chapter-4-Beyond-the-Basics"><a href="#Chapter-4-Beyond-the-Basics" class="headerlink" title="Chapter 4 Beyond the Basics"></a>Chapter 4 Beyond the Basics</h3><p>vim +n file: opens file at line number n<br>vim + file: opens file at last line<br>vim +/pattern file: opens file at the first occurence of pattern<br>vim -c command file: run command after opening file, usually a line number or a search.</p>
<p>vim -R file: operate in read-only mode.<br>vim -r file: recover files after a crash.<br>view file: to look at a file in read-only mode.</p>
<p>â€œ[a-z]command: do command with buffer [a-z].<br>â€œ[a-z]p: put the contents of buffer [a-z] after cursor.<br>â€œ[A-Z]command: accumulate the text dealed by command to buffer named [a-z].</p>
<p>mx: mark current position with x.<br>â€˜x: move cursor to first character of the line marked by x.<br>`x: move cursor to character marked by x.<br>``: return to exact position of previous mark or context after a move.<br>â€˜â€™: return to begining of the line of previous mark or context.</p>
<h3 id="Chapter-5-Introducint-the-ex-Editor"><a href="#Chapter-5-Introducint-the-ex-Editor" class="headerlink" title="Chapter 5 Introducint the ex Editor"></a>Chapter 5 Introducint the ex Editor</h3><p>=: print total number of lines.<br>.=: print line number of current line.<br>/pattern/=: print line number of first line that matches pattern.</p>
<p>start,end[delete|d]: delete lines.<br>start,end[move|m]number: move lines from start through end to number line.<br>start,end[copy|co|t]number: copy lines from start through end to number line.</p>
<p>/pattern/d: delete next line containing pattern.<br>/pattern/+d: delete line below next line containing pattern.<br>/patter1/,/pattern2/d: delete from first line containing patter1 through first line containing pattern2.</p>
<p>g/pattern: find last occurence of pattern in file.<br>g/pattern/p: find and display all lines in file containing pattern.<br>g!/pattern/nu: find and diaplay all lines in file that donâ€™t contain pattern;also display the line number for each line found.</p>
<p>[read|r] filename: read in contents of another file with ex command. </p>
<h3 id="Chapter-6-Global-Replacement"><a href="#Chapter-6-Global-Replacement" class="headerlink" title="Chapter 6 Global Replacement"></a>Chapter 6 Global Replacement</h3><p>put troff italicization codes around the wrod ENTER: :%s/ENTER/\fI&amp;\fP/g</p>
<p>modify a list of pathnames in a file: :%s:/home/time:/home/linda:g</p>
<p>put html italicization codes around the wrod ENTER: :%s:ENTER:<i>&amp;</i>:g</p>
<p>change all periods to semicolons in lines 1 to 10: :1,10s/./;/g</p>
<p>change all occurrences of the word help (or Help) to HELP: :%s/[Hh]elp/HELP/g</p>
<p>replace one or more spaces with a single space: :%s/  */ /g</p>
<p>replace one or more spaces following a colon with two spaces: :%s/:  */:  /g</p>
<p>replace one or more spaces following a period or a colon with two spaces: :%s/([:.])  */\1  /g</p>
<p>standardize various uses of a word or heading: :%s/^Note[ :s]*/Notes: /g</p>
<p>delete all blank lines: :g/^$/d</p>
<p>delete all blank lines, plus any lines that contain only whitespace: :g/^[ tab]*$/d</p>
<p>delete all leading spaces on every line: :%s/^  <em>(.</em>)/\1/</p>
<p>delete all spaces at the end of every line: :%s/(.<em>)  </em>$/\1/</p>
<p>insert a &gt;  at the start of every line in a file: :%s/^/&gt;  /</p>
<p>add a period to the end of the next six lines: :.,+5s/$/./</p>
<p>reverse the order of all hyphen-separated items in a list: :%s/(.<em>) - (.</em>)/\2 - \1/</p>
<p>change every letter in a file to uppercase: :%s/.*/\U&amp;/</p>
<p>reverse the order of lines in a file: :g/.*/mo0</p>
<p>in a text-file database, on all lines not marked Paid in full, append the phrase Overdue: :g!/Paid in full/s/$/ Overdue/</p>
<p>for any line that doesnâ€™t begin with a number, move the line to the end of the file: :g!/^[[:digit:]]/m$</p>
<p>remove numbering from section headings in a document: :%s/^[1-9][0-9]<em>.[1-9][0-9.]</em> //</p>
<h3 id="Chapter-7-Advanced-Editing"><a href="#Chapter-7-Advanced-Editing" class="headerlink" title="Chapter 7 Advanced Editing"></a>Chapter 7 Advanced Editing</h3><p>execute unix command: !command<br>enter shell without exit vim: !sh</p>
<p>examples: r!date, r!sort file, !ls</p>
<p>filter text in ex: start,end!sort</p>
<p>word abbreviation: ab abbr phrase</p>
<p>disable abbreviation: unab abbr</p>
<p>map x sequence : define character x as a sequence of editing commands.<br>unmap x: disable the squence defined for x.<br>map: list the characters that are currently mapped.</p>
<h3 id="Chapter-11-Multiple-Windows-in-Vim"><a href="#Chapter-11-Multiple-Windows-in-Vim" class="headerlink" title="Chapter 11: Multiple Windows in Vim"></a>Chapter 11: Multiple Windows in Vim</h3><p>vim -o[number] file1 file2: opens the edit session with display hrizontally split into number(default is two) equal-sized windows, one for each file.</p>
<p>[n]split [++opt] [+cmd] [file]:<br>n: tells how many lines to display in the new window, which goes at the top.<br>opt: passes vim option information to the new window session (note that it must be preceded by two plus signs).<br>cmd: passes a command for execution in the new window (note that it must be preceded by a single plus sign).<br>file: specifies a file to edit in the new window.</p>
<p>sviw filename: splits screen horizontally to open a new window and sets readonly for that buffer.<br>sfind [++opt] [+cmd] filename: works like :split, but looks for filename in path. if vim does not find the file, it doesnâ€™t split the window.</p>
<p>resize -n: decrease current window size, default amount is one line.<br>resize +n: increase current window size, default amount is one line.</p>
<p>resize n: set current window height, default is to maximize window height.<br>vertical resize n: set current window width to n. default is to make window as wide as possible.</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Chapter-3-Moving-Around-in-a-Hurry&quot;&gt;&lt;a href=&quot;#Chapter-3-Moving-Around-in-a-Hurry&quot; class=&quot;headerlink&quot; title=&quot;Chapter 3 Moving Around 
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="tools, linux" scheme="http://blog.yinwoods.work/tags/tools-linux/"/>
    
  </entry>
  
  <entry>
    <title>å«éšæœºæŒ‡é’ˆçš„å•é“¾è¡¨/äºŒå‰æ ‘çš„æ·±åº¦æ‹·è´</title>
    <link href="http://blog.yinwoods.work/2016/10/24/%E5%90%AB%E9%9A%8F%E6%9C%BA%E6%8C%87%E9%92%88%E7%9A%84%E5%8D%95%E9%93%BE%E8%A1%A8%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E6%B7%B1%E5%BA%A6%E6%8B%B7%E8%B4%9D/"/>
    <id>http://blog.yinwoods.work/2016/10/24/å«éšæœºæŒ‡é’ˆçš„å•é“¾è¡¨äºŒå‰æ ‘çš„æ·±åº¦æ‹·è´/</id>
    <published>2016-10-23T16:00:00.000Z</published>
    <updated>2017-07-26T10:06:54.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€åŒ…å«éšæœºæŒ‡é’ˆçš„å•é“¾è¡¨çš„æ·±åº¦æ‹·è´"><a href="#ä¸€ã€åŒ…å«éšæœºæŒ‡é’ˆçš„å•é“¾è¡¨çš„æ·±åº¦æ‹·è´" class="headerlink" title="ä¸€ã€åŒ…å«éšæœºæŒ‡é’ˆçš„å•é“¾è¡¨çš„æ·±åº¦æ‹·è´"></a>ä¸€ã€åŒ…å«éšæœºæŒ‡é’ˆçš„å•é“¾è¡¨çš„æ·±åº¦æ‹·è´</h3><p>æœ€è¿‘é‡åˆ°ä¸€é“å¾ˆæœ‰è¶£çš„é¢˜ç›®ï¼š<code>ç»™å®šæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«éšæœºæŒ‡é’ˆçš„å•é“¾è¡¨ï¼Œé—®å¦‚ä½•æ·±åº¦æ‹·è´è¿™ä¸ªå•é“¾è¡¨ï¼Ÿ</code></p>
<p>ç±»ä¼¼çš„å•é“¾è¡¨å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://7xlnl2.com1.z0.glb.clouddn.com/post57-2.jpg" alt="å›¾1"></p>
<p>æ€»ç»“äº†ä¸‹çœ‹åˆ°çš„ç­”æ¡ˆï¼Œå¤§è‡´å¯åˆ†ä¸ºä¸‰ç§æ–¹æ³•ï¼š</p>
<h4 id="1ã€æš´åŠ›å¤åˆ¶ï¼ˆå¾ˆæœ´ç´ çš„æ–¹æ³•ï¼‰"><a href="#1ã€æš´åŠ›å¤åˆ¶ï¼ˆå¾ˆæœ´ç´ çš„æ–¹æ³•ï¼‰" class="headerlink" title="1ã€æš´åŠ›å¤åˆ¶ï¼ˆå¾ˆæœ´ç´ çš„æ–¹æ³•ï¼‰"></a>1ã€æš´åŠ›å¤åˆ¶ï¼ˆå¾ˆæœ´ç´ çš„æ–¹æ³•ï¼‰</h4><p>å› ä¸ºéšæœºæŒ‡é’ˆå¯èƒ½æŒ‡å‘å½“å‰èŠ‚ç‚¹ä¹‹åçš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥è€ƒè™‘åˆ†ä¸¤æ­¥æ¥åšã€‚</p>
<p>ç¬¬ä¸€æ­¥éå†å•é“¾è¡¨ï¼Œæ‹·è´èŠ‚ç‚¹åŠèŠ‚ç‚¹çš„nextæŒ‡é’ˆï¼Œä¸è€ƒè™‘èŠ‚ç‚¹çš„randomæŒ‡é’ˆã€‚ç»“æŸåå¾—åˆ°ä¸€ä¸ªæ–°çš„å•é“¾è¡¨ã€‚</p>
<p>ç¬¬äºŒæ­¥éå†åŸå•é“¾è¡¨ï¼Œå¦‚æœå½“å‰è®¿é—®èŠ‚ç‚¹Aæœ‰randomæŒ‡é’ˆæŒ‡å‘èŠ‚ç‚¹Bï¼Œåˆ™åœ¨æ–°çš„å•é“¾è¡¨ä¸­æ‰¾åˆ°ç›¸åº”çš„èŠ‚ç‚¹AAä»¥åŠrandomæ‰€æŒ‡å‘èŠ‚ç‚¹BBï¼Œä»¤AA-&gt;random = BBã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦ï¼šO(N2)</p>
<h4 id="2ã€é€šè¿‡èŠ‚ç‚¹æ˜ å°„å…³ç³»å®ç°æ·±åº¦æ‹·è´"><a href="#2ã€é€šè¿‡èŠ‚ç‚¹æ˜ å°„å…³ç³»å®ç°æ·±åº¦æ‹·è´" class="headerlink" title="2ã€é€šè¿‡èŠ‚ç‚¹æ˜ å°„å…³ç³»å®ç°æ·±åº¦æ‹·è´"></a>2ã€é€šè¿‡èŠ‚ç‚¹æ˜ å°„å…³ç³»å®ç°æ·±åº¦æ‹·è´</h4><p>è€ƒè™‘ç¬¬ä¸€ç§æ–¹æ³•å¯ä»¥å‘ç°æ—¶é—´ä¸»è¦è€—è´¹åœ¨å¤åˆ¶randomæŒ‡é’ˆçš„è¿‡ç¨‹ä¸­éœ€è¦æŸ¥æ‰¾ç›¸åº”çš„èŠ‚ç‚¹ï¼Œå› æ­¤å¯æƒ³åˆ°å¦‚æœèƒ½å¤Ÿå»ºç«‹åŸå•é“¾è¡¨ä¸æ–°å•é“¾è¡¨èŠ‚ç‚¹ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œé‚£ä¹ˆåªéœ€éå†ä¸€æ¬¡å³å¯å®ŒæˆrandomæŒ‡é’ˆçš„æ‹·è´ã€‚è¯¦ç»†æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>ç¬¬ä¸€æ­¥éå†å•é“¾è¡¨ï¼Œæ‹·è´èŠ‚ç‚¹åŠèŠ‚ç‚¹çš„nextæŒ‡é’ˆï¼Œä¸è€ƒè™‘èŠ‚ç‚¹çš„randomæŒ‡é’ˆã€‚ç»“æŸåå¾—åˆ°ä¸€ä¸ªæ–°çš„å•é“¾è¡¨ã€‚</p>
<p>ç¬¬äºŒæ­¥éå†åŸå•é“¾è¡¨ï¼Œå¦‚æœå½“å‰è®¿é—®èŠ‚ç‚¹Aæœ‰randomæŒ‡é’ˆæŒ‡å‘èŠ‚ç‚¹Bï¼Œåˆ™ä»¤map[A]-&gt;random = map[B]å³å¯ã€‚</p>
<p>æ•…åªéœ€è¦ä¸¤æ¬¡éå†ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(2N)</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> key;</div><div class="line">    Node *next, *random;</div><div class="line">    Node(<span class="keyword">int</span> k, Node *nt, Node *rand): key(k), next(nt), random(rand) &#123;&#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">printInOrder</span><span class="params">(Node *node)</span> </span>&#123;</div><div class="line"></div><div class="line">    Node* curNode = node;</div><div class="line">    <span class="keyword">while</span>(curNode != <span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"[ "</span> &lt;&lt; curNode-&gt;key &lt;&lt; <span class="string">", "</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(curNode-&gt;random == <span class="literal">NULL</span>) &#123;</div><div class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"NULL ] -&gt; "</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">cout</span> &lt;&lt; curNode-&gt;random-&gt;key &lt;&lt; <span class="string">" ] -&gt; "</span>;</div><div class="line">        &#125;</div><div class="line">        curNode = curNode-&gt;next;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">Node* <span class="title">copyLinkedList</span><span class="params">(Node* treeNode, <span class="built_in">map</span>&lt;Node*, Node*&gt; *mymap)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(treeNode == <span class="literal">NULL</span>)</div><div class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line"></div><div class="line">    Node* headNode = <span class="keyword">new</span> Node(treeNode-&gt;key, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node* curNode = headNode;</div><div class="line">    (*mymap)[treeNode] = headNode;</div><div class="line"></div><div class="line">    treeNode = treeNode-&gt;next;</div><div class="line"></div><div class="line">    <span class="keyword">while</span>(treeNode != <span class="literal">NULL</span>) &#123;</div><div class="line"></div><div class="line">        Node* cloneNode = <span class="keyword">new</span> Node(treeNode-&gt;key, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">        (*mymap)[treeNode] = cloneNode;</div><div class="line"></div><div class="line">        curNode-&gt;next = cloneNode;</div><div class="line">        curNode = curNode-&gt;next;</div><div class="line">        treeNode = treeNode-&gt;next;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> headNode;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">copyRandom</span><span class="params">(Node* treeNode, Node* cloneNode, <span class="built_in">map</span>&lt;Node*, Node*&gt; *mymap)</span> </span>&#123;</div><div class="line"></div><div class="line">    Node* headNode = cloneNode;</div><div class="line"></div><div class="line">    <span class="keyword">while</span>(treeNode != <span class="literal">NULL</span>) &#123;</div><div class="line">        cloneNode-&gt;random = (*mymap)[treeNode-&gt;random];</div><div class="line"></div><div class="line">        treeNode = treeNode-&gt;next;</div><div class="line">        cloneNode = cloneNode-&gt;next;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    cloneNode = headNode;</div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">Node* <span class="title">cloneList</span><span class="params">(Node* tree)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(tree == <span class="literal">NULL</span>)</div><div class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line"></div><div class="line">    <span class="built_in">map</span>&lt;Node*, Node*&gt; *mymap = <span class="keyword">new</span> <span class="built_in">map</span>&lt;Node*, Node*&gt;;</div><div class="line"></div><div class="line">    Node* newList = copyLinkedList(tree, mymap);</div><div class="line"></div><div class="line">    copyRandom(tree, newList, mymap);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> newList;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line"></div><div class="line">    Node* node1 = <span class="keyword">new</span> Node(<span class="number">1</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node* node2 = <span class="keyword">new</span> Node(<span class="number">2</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node* node3 = <span class="keyword">new</span> Node(<span class="number">3</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node* node4 = <span class="keyword">new</span> Node(<span class="number">4</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">    node1-&gt;next = node2;</div><div class="line">    node2-&gt;next = node3;</div><div class="line">    node3-&gt;next = node4;</div><div class="line"></div><div class="line">    node1-&gt;random = node3;</div><div class="line">    node2-&gt;random = node4;</div><div class="line"></div><div class="line">    printInOrder(node1);</div><div class="line"></div><div class="line">    Node* clone = cloneList(node1);</div><div class="line"></div><div class="line">    printInOrder(clone);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3ã€åœ¨åŸå•é“¾è¡¨ä¸Šæ’å…¥èŠ‚ç‚¹å¹¶åˆ é™¤å®ç°æ·±åº¦æ‹·è´"><a href="#3ã€åœ¨åŸå•é“¾è¡¨ä¸Šæ’å…¥èŠ‚ç‚¹å¹¶åˆ é™¤å®ç°æ·±åº¦æ‹·è´" class="headerlink" title="3ã€åœ¨åŸå•é“¾è¡¨ä¸Šæ’å…¥èŠ‚ç‚¹å¹¶åˆ é™¤å®ç°æ·±åº¦æ‹·è´"></a>3ã€åœ¨åŸå•é“¾è¡¨ä¸Šæ’å…¥èŠ‚ç‚¹å¹¶åˆ é™¤å®ç°æ·±åº¦æ‹·è´</h3><p>åŸºæœ¬æ€æƒ³åŒ2ç›¸ä¼¼ï¼Œé€šè¿‡å‡å°‘æŸ¥æ‰¾èŠ‚ç‚¹çš„æ—¶é—´æ¥æé«˜æ•ˆç‡ã€‚åœ¨åŸå•é“¾è¡¨ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¹‹åæ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://7xlnl2.com1.z0.glb.clouddn.com/post57-3.jpg" alt="å›¾2"></p>
<p>å½“æ‹·è´randomæŒ‡é’ˆæ—¶å°±å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç å®ç°ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">A-&gt;next-&gt;random = A-&gt;random-&gt;next</div><div class="line"></div><div class="line"># æ¢å¤åŸå•é“¾è¡¨</div><div class="line">A-&gt;next = A-&gt;next-&gt;next</div></pre></td></tr></table></figure>
<p><strong> å…¶å®è¿™ä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„èŠ‚ç‚¹æ˜ å°„å…³ç³» </strong>ã€‚æ•…æ—¶é—´å¤æ‚åº¦åŒ2ä¸ºO(2N)</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> key;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>, *<span class="title">random</span>;</span></div><div class="line">    Node(<span class="keyword">int</span> k, Node* nt, Node* rand): key(k), next(nt), random(rand) &#123;&#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// æ‰“å°é“¾è¡¨ï¼Œ[a, b] è¡¨ç¤º key ä¸º a çš„èŠ‚ç‚¹ random æŒ‡é’ˆæŒ‡å‘ key ä¸º b çš„èŠ‚ç‚¹</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">printInorder</span><span class="params">(Node* node)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(node == <span class="literal">NULL</span>)</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line"></div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"[ "</span> &lt;&lt; node-&gt;key &lt;&lt; <span class="string">" "</span>;</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(node-&gt;random == <span class="literal">NULL</span>)</div><div class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"NULL ], "</span>;</div><div class="line">    <span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; node-&gt;random-&gt;key &lt;&lt; <span class="string">" ], "</span>;</div><div class="line"></div><div class="line">    printInorder(node-&gt;next);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å¤åˆ¶æ¯ä¸ªèŠ‚ç‚¹ï¼ˆä¸åŒ…å«éšæœºæŒ‡é’ˆï¼‰ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªå¤åˆ¶çš„èŠ‚ç‚¹ </span></div><div class="line"><span class="function">Node* <span class="title">copyLinkedListNode</span><span class="params">(Node* treeNode)</span> </span>&#123;</div><div class="line">    Node* curNode = treeNode;</div><div class="line">    <span class="keyword">while</span>(curNode != <span class="literal">NULL</span>) &#123;</div><div class="line">        Node* next = curNode-&gt;next;</div><div class="line">        curNode-&gt;next = <span class="keyword">new</span> Node(curNode-&gt;key, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">        curNode-&gt;next-&gt;next = next;</div><div class="line">        curNode = next;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> treeNode-&gt;next;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å¤åˆ¶éšæœºæŒ‡é’ˆ</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">copyRandomNode</span><span class="params">(Node* treeNode, Node* cloneNode)</span> </span>&#123;</div><div class="line">    Node *headNode = cloneNode;</div><div class="line">    <span class="keyword">while</span>(treeNode != <span class="literal">NULL</span>) &#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(treeNode-&gt;random != <span class="literal">NULL</span>)</div><div class="line">            cloneNode-&gt;random = treeNode-&gt;random-&gt;next;</div><div class="line">        <span class="keyword">else</span> cloneNode-&gt;random = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(treeNode-&gt;next == <span class="literal">NULL</span> || cloneNode-&gt;next == <span class="literal">NULL</span>)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            treeNode = treeNode-&gt;next-&gt;next;</div><div class="line">            cloneNode = cloneNode-&gt;next-&gt;next;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    cloneNode = headNode;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æ¢å¤åŸæ¥çš„å•é“¾è¡¨ï¼Œå³åˆ†ç¦»ä¸¤ä¸ªå•é“¾è¡¨</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">restoreLinkedList</span><span class="params">(Node* treeNode, Node* cloneNode)</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span>(treeNode != <span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(cloneNode-&gt;next != <span class="literal">NULL</span>) &#123;</div><div class="line">            Node* cloneNext = cloneNode-&gt;next-&gt;next;</div><div class="line">            treeNode-&gt;next = treeNode-&gt;next-&gt;next;</div><div class="line">            cloneNode-&gt;next = cloneNext;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            treeNode-&gt;next = <span class="literal">NULL</span>;</div><div class="line">        &#125;</div><div class="line">        treeNode = treeNode-&gt;next;</div><div class="line">        cloneNode = cloneNode-&gt;next;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å¤åˆ¶æ•´ä¸ªå•é“¾è¡¨</span></div><div class="line"><span class="function">Node* <span class="title">cloneLinkedList</span><span class="params">(Node* treeNode)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(treeNode == <span class="literal">NULL</span>)</div><div class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line"></div><div class="line">    Node* cloneNode = copyLinkedListNode(treeNode);</div><div class="line">    copyRandomNode(treeNode, cloneNode);</div><div class="line">    restoreLinkedList(treeNode, cloneNode);</div><div class="line">    <span class="keyword">return</span> cloneNode;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    Node* node1 = <span class="keyword">new</span> Node(<span class="number">1</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node* node2 = <span class="keyword">new</span> Node(<span class="number">2</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node* node3 = <span class="keyword">new</span> Node(<span class="number">3</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node* node4 = <span class="keyword">new</span> Node(<span class="number">4</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">    node1-&gt;next = node2;</div><div class="line">    node2-&gt;next = node3;</div><div class="line">    node3-&gt;next = node4;</div><div class="line">    node1-&gt;random = node3;</div><div class="line">    node2-&gt;random = node4;</div><div class="line"></div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"traversal of original binary tree is: "</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    printInorder(node1);</div><div class="line"></div><div class="line">    Node *clone = cloneLinkedList(node1);</div><div class="line"></div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"\n\ntraversal of cloned binary tree is: "</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    printInorder(clone);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="äºŒã€åŒ…å«éšæœºæŒ‡é’ˆçš„äºŒå‰æ ‘æ·±åº¦æ‹·è´"><a href="#äºŒã€åŒ…å«éšæœºæŒ‡é’ˆçš„äºŒå‰æ ‘æ·±åº¦æ‹·è´" class="headerlink" title="äºŒã€åŒ…å«éšæœºæŒ‡é’ˆçš„äºŒå‰æ ‘æ·±åº¦æ‹·è´"></a>äºŒã€åŒ…å«éšæœºæŒ‡é’ˆçš„äºŒå‰æ ‘æ·±åº¦æ‹·è´</h3><p>åŒä¸Šï¼Œè¿™é‡Œä¹Ÿæœ‰ä¸‰ç§å¯¹åº”çš„æ–¹æ³•ã€‚</p>
<h3 id="1ã€æš´åŠ›å¤åˆ¶ï¼ˆOTZï¼‰"><a href="#1ã€æš´åŠ›å¤åˆ¶ï¼ˆOTZï¼‰" class="headerlink" title="1ã€æš´åŠ›å¤åˆ¶ï¼ˆOTZï¼‰"></a>1ã€æš´åŠ›å¤åˆ¶ï¼ˆOTZï¼‰</h3><p>å°±æ˜¯æš´åŠ›ã€‚ã€‚ã€‚æ—¶é—´å¤æ‚åº¦ä¸ºO(N2)</p>
<h3 id="2ã€é€šè¿‡èŠ‚ç‚¹æ˜ å°„å…³ç³»å®ç°æ·±åº¦æ‹·è´-1"><a href="#2ã€é€šè¿‡èŠ‚ç‚¹æ˜ å°„å…³ç³»å®ç°æ·±åº¦æ‹·è´-1" class="headerlink" title="2ã€é€šè¿‡èŠ‚ç‚¹æ˜ å°„å…³ç³»å®ç°æ·±åº¦æ‹·è´"></a>2ã€é€šè¿‡èŠ‚ç‚¹æ˜ å°„å…³ç³»å®ç°æ·±åº¦æ‹·è´</h3><p>åŒå•é“¾è¡¨ä¸­èŠ‚ç‚¹å»ºç«‹æ˜ å°„å…³ç³»ä¸€æ ·ï¼Œè¿™é‡Œçš„æ—¶é—´å¤æ‚åº¦åŒæ ·ä¸ºO(2N)ã€‚</p>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">	<span class="keyword">int</span> key;</div><div class="line">	Node *left, *right, *random;</div><div class="line">	Node(<span class="keyword">int</span> k, Node* l, Node* r, Node* rand) : key(k), left(l), right(r), random(rand) &#123;&#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// æŒ‰ä¸­åºéå†é€’å½’æ‰“å°æ ‘</span></div><div class="line"><span class="comment">// å…¶ä¸­[a, b]è¡¨ç¤ºèŠ‚ç‚¹açš„keyå€¼ä¸randomæŒ‡é’ˆæ‰€æŒ‡èŠ‚ç‚¹çš„keyå€¼</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">printInorder</span><span class="params">(Node* node)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span>(node == <span class="literal">NULL</span>) </div><div class="line">		<span class="keyword">return</span> ;</div><div class="line"></div><div class="line">	printInorder(node-&gt;left);</div><div class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"[ "</span> &lt;&lt; node-&gt;key &lt;&lt; <span class="string">" "</span>;</div><div class="line"></div><div class="line">	<span class="keyword">if</span>(node-&gt;random == <span class="literal">NULL</span>) &#123;</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"NULL ], "</span>;</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; node-&gt;random-&gt;key &lt;&lt; <span class="string">" ], "</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	printInorder(node-&gt;right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æ‹·è´ä»¥treeNodeä¸ºæ ¹èŠ‚ç‚¹çš„æ•´æ£µæ ‘å¹¶è¿”å›æ‹·è´å®Œæˆåæ–°çš„æ ¹èŠ‚ç‚¹</span></div><div class="line"><span class="comment">// æ‹·è´è¿‡ç¨‹ä¸­åŒ…å«æ‰€æœ‰èŠ‚ç‚¹çš„å·¦å³å­©å­ï¼Œä½†ä¸åŒ…å«èŠ‚ç‚¹çš„randomæŒ‡é’ˆ</span></div><div class="line"><span class="function">Node* <span class="title">copyLeftRightNode</span><span class="params">(Node* treeNode, <span class="built_in">map</span>&lt;Node *, Node *&gt; *mymap)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span>(treeNode == <span class="literal">NULL</span>) &#123;</div><div class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	Node* cloneNode = <span class="keyword">new</span> Node(treeNode-&gt;key, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">	<span class="comment">// å»ºç«‹å½“å‰èŠ‚ç‚¹åˆ°å…‹éš†èŠ‚ç‚¹çš„æ˜ å°„</span></div><div class="line">	(*mymap)[treeNode] = cloneNode;</div><div class="line">	cloneNode-&gt;left = copyLeftRightNode(treeNode-&gt;left, mymap);</div><div class="line">	cloneNode-&gt;right = copyLeftRightNode(treeNode-&gt;right, mymap);</div><div class="line">	<span class="keyword">return</span> cloneNode;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// éå†å¹¶æ‹·è´randomæŒ‡é’ˆ</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">copyRandom</span><span class="params">(Node* treeNode, Node* cloneNode, <span class="built_in">map</span>&lt;Node*, Node*&gt; *mymap)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span>(cloneNode == <span class="literal">NULL</span>)</div><div class="line">		<span class="keyword">return</span> ;</div><div class="line">	cloneNode-&gt;random = (*mymap)[treeNode-&gt;random];</div><div class="line">	copyRandom(treeNode-&gt;left, cloneNode-&gt;left, mymap);</div><div class="line">	copyRandom(treeNode-&gt;right, cloneNode-&gt;right, mymap);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å…‹éš†æ•´æ£µæ ‘çš„å‡½æ•°ä¸»ä½“</span></div><div class="line"><span class="function">Node* <span class="title">cloneTree</span><span class="params">(Node* tree)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span>(tree == <span class="literal">NULL</span>)</div><div class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line"></div><div class="line">	<span class="comment">// åˆ›å»ºèŠ‚ç‚¹åˆ°èŠ‚ç‚¹çš„æ˜ å°„</span></div><div class="line">	<span class="built_in">map</span>&lt;Node*, Node*&gt; *mymap = <span class="keyword">new</span> <span class="built_in">map</span>&lt;Node*, Node*&gt;;</div><div class="line"></div><div class="line">	<span class="comment">// ç¬¬ä¸€æ¬¡éå†åªæ‹·è´æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­©å­</span></div><div class="line">	<span class="comment">// ä¹Ÿå°±æ˜¯è¯´æš‚æ—¶ä¸æ‹·è´randomæŒ‡é’ˆ</span></div><div class="line">	Node* newTree = copyLeftRightNode(tree, mymap);</div><div class="line"></div><div class="line">	<span class="comment">// ç¬¬äºŒæ¬¡éå†æ‹·è´randomæŒ‡é’ˆ</span></div><div class="line">	copyRandom(tree, newTree, mymap);</div><div class="line">	<span class="keyword">return</span> newTree;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line"></div><div class="line">	Node *tree = <span class="keyword">new</span> Node(<span class="number">1</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">	tree-&gt;left = <span class="keyword">new</span> Node(<span class="number">2</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">	tree-&gt;right = <span class="keyword">new</span> Node(<span class="number">3</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">	tree-&gt;left-&gt;left = <span class="keyword">new</span> Node(<span class="number">4</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">	tree-&gt;left-&gt;right = <span class="keyword">new</span> Node(<span class="number">5</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">	tree-&gt;random = tree-&gt;left-&gt;right;</div><div class="line">	tree-&gt;left-&gt;right-&gt;random = tree-&gt;right;</div><div class="line"></div><div class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"Inorder traversal of original binary tree is: "</span> &lt;&lt; <span class="built_in">endl</span>; </div><div class="line">	printInorder(tree);</div><div class="line"></div><div class="line">	Node *clone = cloneTree(tree);</div><div class="line"></div><div class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"\n\nInorder traversal of cloned binary tree is: "</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">	printInorder(clone);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3ã€åœ¨åŸäºŒå‰æ ‘ä¸Šæ’å…¥æ–°èŠ‚ç‚¹åå†åˆ é™¤"><a href="#3ã€åœ¨åŸäºŒå‰æ ‘ä¸Šæ’å…¥æ–°èŠ‚ç‚¹åå†åˆ é™¤" class="headerlink" title="3ã€åœ¨åŸäºŒå‰æ ‘ä¸Šæ’å…¥æ–°èŠ‚ç‚¹åå†åˆ é™¤"></a>3ã€åœ¨åŸäºŒå‰æ ‘ä¸Šæ’å…¥æ–°èŠ‚ç‚¹åå†åˆ é™¤</h3><p>æ€æƒ³åŒå•é“¾è¡¨æ“ä½œä¸€æ ·ï¼Œä½†è¿™é‡Œè¦æ³¨æ„èŠ‚ç‚¹é—´çš„ç›¸å¯¹å…³ç³»ï¼Œåœ¨åˆ›å»ºæ–°èŠ‚ç‚¹æ—¶è¦æ­£ç¡®å»ºç«‹è¯¥èŠ‚ç‚¹ä¸çˆ¶èŠ‚ç‚¹åŸå·¦å³å­©å­çš„å…³ç³»ã€‚å…·ä½“å¦‚å›¾ç¤ºï¼š</p>
<p><img src="http://7xlnl2.com1.z0.glb.clouddn.com/post57-1.jpg" alt="å›¾3"></p>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">	<span class="keyword">int</span> key;</div><div class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">left</span>, *<span class="title">right</span>, *<span class="title">random</span>;</span></div><div class="line">	Node(<span class="keyword">int</span> k, Node* l, Node* r, Node* rand): key(k), left(l), right(r), random(rand) &#123;&#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// å±‚æ¬¡éå†</span></div><div class="line"><span class="comment">// [a, b] è¡¨ç¤º key ä¸º a çš„èŠ‚ç‚¹ random æŒ‡é’ˆæŒ‡å‘ key ä¸º b çš„èŠ‚ç‚¹</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">printInorder</span><span class="params">(Node* node)</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">if</span>(node == <span class="literal">NULL</span>)</div><div class="line">		<span class="keyword">return</span> ;</div><div class="line"></div><div class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"[ "</span> &lt;&lt; node-&gt;key &lt;&lt; <span class="string">" "</span>;</div><div class="line"></div><div class="line">	<span class="keyword">if</span>(node-&gt;random == <span class="literal">NULL</span>)</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"NULL ], "</span>;</div><div class="line">	<span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; node-&gt;random-&gt;key &lt;&lt; <span class="string">" ], "</span>;</div><div class="line"></div><div class="line">	printInorder(node-&gt;left);</div><div class="line">	printInorder(node-&gt;right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å¤åˆ¶æ¯ä¸ªèŠ‚ç‚¹åŠå·¦å³å­©å­ï¼ˆä¸åŒ…å«éšæœºæŒ‡é’ˆï¼‰ï¼Œå¹¶è¿”å›å¤åˆ¶åçš„èŠ‚ç‚¹ </span></div><div class="line"><span class="function">Node* <span class="title">copyLeftRightNode</span><span class="params">(Node* treeNode)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span>(treeNode == <span class="literal">NULL</span>)</div><div class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line"></div><div class="line">	<span class="comment">// åœ¨æ ¹èŠ‚ç‚¹ä¸å·¦å­©å­ä¹‹é—´æ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹</span></div><div class="line">	Node* left = treeNode-&gt;left;</div><div class="line">	treeNode-&gt;left = <span class="keyword">new</span> Node(treeNode-&gt;key, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">	treeNode-&gt;left-&gt;left = left;</div><div class="line"></div><div class="line">	<span class="keyword">if</span>(left != <span class="literal">NULL</span>) &#123;</div><div class="line">		left-&gt;left = copyLeftRightNode(left);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// å¤åˆ¶åçš„å·¦èŠ‚ç‚¹å³å­©å­æŒ‡å‘å…¶çˆ¶èŠ‚ç‚¹å³å­©å­å¤åˆ¶åå¾—åˆ°çš„èŠ‚ç‚¹</span></div><div class="line">	treeNode-&gt;left-&gt;right = copyLeftRightNode(treeNode-&gt;right);</div><div class="line">	<span class="keyword">return</span> treeNode-&gt;left;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å¤åˆ¶éšæœºæŒ‡é’ˆ</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">copyRandomNode</span><span class="params">(Node* treeNode, Node* cloneNode)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span>(treeNode == <span class="literal">NULL</span>)</div><div class="line">		<span class="keyword">return</span> ;</div><div class="line"></div><div class="line">	<span class="keyword">if</span>(treeNode-&gt;random != <span class="literal">NULL</span>)</div><div class="line">		cloneNode-&gt;random = treeNode-&gt;random-&gt;left;</div><div class="line">	<span class="keyword">else</span></div><div class="line">		cloneNode-&gt;random = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line">	<span class="keyword">if</span>(treeNode-&gt;left != <span class="literal">NULL</span> &amp;&amp; cloneNode-&gt;left != <span class="literal">NULL</span>)</div><div class="line">		copyRandomNode(treeNode-&gt;left-&gt;left, cloneNode-&gt;left-&gt;left);</div><div class="line">	copyRandomNode(treeNode-&gt;right, cloneNode-&gt;right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æ¢å¤åŸæ¥çš„äºŒå‰æ ‘ï¼Œä¹Ÿå³åˆ†ç¦»å‡ºæ–°å¤åˆ¶çš„äºŒå‰æ ‘</span></div><div class="line"><span class="comment">// å› ä¸ºå³å­©å­å…³ç³»ä¿æŒæ­£ç¡®ï¼Œå› æ­¤åªéœ€æ›´æ–°å·¦å­©å­å…³ç³»</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">restoreTreeLeftNode</span><span class="params">(Node* treeNode, Node* cloneNode)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span>(treeNode == <span class="literal">NULL</span>)</div><div class="line">		<span class="keyword">return</span> ;</div><div class="line">	<span class="keyword">if</span>(cloneNode-&gt;left != <span class="literal">NULL</span>) &#123;</div><div class="line">		Node* cloneLeft = cloneNode-&gt;left-&gt;left;</div><div class="line">		treeNode-&gt;left = treeNode-&gt;left-&gt;left;</div><div class="line">		cloneNode-&gt;left = cloneLeft;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">		treeNode-&gt;left = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line">	restoreTreeLeftNode(treeNode-&gt;left, cloneNode-&gt;left);</div><div class="line">	restoreTreeLeftNode(treeNode-&gt;right, cloneNode-&gt;right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å¤åˆ¶æ•´æ£µäºŒå‰æ ‘</span></div><div class="line"><span class="function">Node* <span class="title">cloneTree</span><span class="params">(Node* treeNode)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span>(treeNode == <span class="literal">NULL</span>)</div><div class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line"></div><div class="line">	Node* cloneNode = copyLeftRightNode(treeNode);</div><div class="line">	copyRandomNode(treeNode, cloneNode);</div><div class="line">	restoreTreeLeftNode(treeNode, cloneNode);</div><div class="line">	<span class="keyword">return</span> cloneNode;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">/*</span></div><div class="line">	Node* tree = new Node(1);</div><div class="line">	tree-&gt;left = new Node(2);</div><div class="line">	tree-&gt;right = new Node(3);</div><div class="line">	tree-&gt;left-&gt;left = new Node(4);</div><div class="line">	tree-&gt;left-&gt;right = new Node(5);</div><div class="line">	tree-&gt;random = tree-&gt;left-&gt;right;</div><div class="line">	tree-&gt;left-&gt;left-&gt;random = tree;</div><div class="line">	tree-&gt;left-&gt;right-&gt;random = tree-&gt;right;</div><div class="line">*/</div><div class="line">	Node *tree = <span class="keyword">new</span> Node(<span class="number">10</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node *n2 = <span class="keyword">new</span> Node(<span class="number">6</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node *n3 = <span class="keyword">new</span> Node(<span class="number">12</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node *n4 = <span class="keyword">new</span> Node(<span class="number">5</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node *n5 = <span class="keyword">new</span> Node(<span class="number">8</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node *n6 = <span class="keyword">new</span> Node(<span class="number">11</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node *n7 = <span class="keyword">new</span> Node(<span class="number">13</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node *n8 = <span class="keyword">new</span> Node(<span class="number">7</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    Node *n9 = <span class="keyword">new</span> Node(<span class="number">9</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    tree-&gt;left = n2;</div><div class="line">    tree-&gt;right = n3;</div><div class="line">    tree-&gt;random = n2;</div><div class="line">    n2-&gt;left = n4;</div><div class="line">    n2-&gt;right = n5;</div><div class="line">    n2-&gt;random = n8;</div><div class="line">    n3-&gt;left = n6;</div><div class="line">    n3-&gt;right = n7;</div><div class="line">    n3-&gt;random = n5;</div><div class="line">    n4-&gt;random = n9;</div><div class="line">    n5-&gt;left = n8;</div><div class="line">    n5-&gt;right = n9;</div><div class="line">    n5-&gt;random = tree;</div><div class="line">    n6-&gt;random = n9;</div><div class="line">    n9-&gt;random = n8;</div><div class="line"></div><div class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"traversal of original binary tree is: "</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">	printInorder(tree);</div><div class="line"></div><div class="line">	Node *clone = cloneTree(tree);</div><div class="line"></div><div class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"\n\ntraversal of cloned binary tree is: "</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">	printInorder(clone);</div><div class="line"></div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä¸€ã€åŒ…å«éšæœºæŒ‡é’ˆçš„å•é“¾è¡¨çš„æ·±åº¦æ‹·è´&quot;&gt;&lt;a href=&quot;#ä¸€ã€åŒ…å«éšæœºæŒ‡é’ˆçš„å•é“¾è¡¨çš„æ·±åº¦æ‹·è´&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€åŒ…å«éšæœºæŒ‡é’ˆçš„å•é“¾è¡¨çš„æ·±åº¦æ‹·è´&quot;&gt;&lt;/a&gt;ä¸€ã€åŒ…å«éšæœºæŒ‡é’ˆçš„å•é“¾è¡¨çš„æ·±åº¦æ‹·è´&lt;/h3&gt;&lt;p&gt;æœ€è¿‘é‡åˆ°ä¸€é“å¾ˆæœ‰è¶£çš„
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="algorithm" scheme="http://blog.yinwoods.work/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>åç¼€æ•°ç»„(suffix Array)å­¦ä¹ </title>
    <link href="http://blog.yinwoods.work/2016/10/16/%E5%90%8E%E7%BC%80%E6%95%B0%E7%BB%84%E5%AD%A6%E4%B9%A0/"/>
    <id>http://blog.yinwoods.work/2016/10/16/åç¼€æ•°ç»„å­¦ä¹ /</id>
    <published>2016-10-15T16:00:00.000Z</published>
    <updated>2017-07-26T10:06:54.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯-åç¼€ï¼ˆSuffixï¼‰"><a href="#ä»€ä¹ˆæ˜¯-åç¼€ï¼ˆSuffixï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯ åç¼€ï¼ˆSuffixï¼‰"></a>ä»€ä¹ˆæ˜¯ åç¼€ï¼ˆSuffixï¼‰</h3><p>Sæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º N çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå®šä¹‰Sçš„ç¬¬ i ä¸ªåç¼€å°±æ˜¯Sçš„å­ä¸² <code>S[i...n-1]</code></p>
<h3 id="ä»€ä¹ˆæ˜¯-åç¼€æ•°ç»„ï¼ˆSuffix-Arrayï¼‰"><a href="#ä»€ä¹ˆæ˜¯-åç¼€æ•°ç»„ï¼ˆSuffix-Arrayï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯ åç¼€æ•°ç»„ï¼ˆSuffix Arrayï¼‰"></a>ä»€ä¹ˆæ˜¯ åç¼€æ•°ç»„ï¼ˆSuffix Arrayï¼‰</h3><p>åç¼€æ•°ç»„ä½œä¸ºä¸€ç§æ•°æ®ç»“æ„ï¼Œè¢«å¹¿æ³›åº”ç”¨äºæ•°æ®å‹ç¼©ã€ç”Ÿç‰©ä¿¡æ¯å­¦ç­‰é¢†åŸŸã€‚é€šä¿—åœ°è¯´åç¼€æ•°ç»„è¢«åº”ç”¨äº<code>ä»»ä½•å¤„ç†å­—ç¬¦ä¸²ä¸å­—ç¬¦ä¸²åŒ¹é…çš„åœºåˆ</code>ã€‚</p>
<p>åç¼€æ•°ç»„æ˜¯å„ä¸ªæ’åºåçš„åç¼€çš„èµ·å§‹ä½ç½®ç»„æˆçš„æ•°ç»„ã€‚</p>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å½“ S = abaab æ—¶ã€‚</p>
<p>æ‰€æœ‰çš„åç¼€å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="number">0.</span> abaab</div><div class="line"><span class="number">1.</span> baab</div><div class="line"><span class="number">2.</span> aab</div><div class="line"><span class="number">3.</span> ab</div><div class="line"><span class="number">4.</span> b</div></pre></td></tr></table></figure>
<p>ä¾æ®å­—ç¬¦ä¸²çš„æ¯”è¾ƒå¯¹åç¼€è¿›è¡Œæ’åºåå¾—åˆ°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="number">2.</span> aab</div><div class="line"><span class="number">3.</span> ab</div><div class="line"><span class="number">0.</span> abaab</div><div class="line"><span class="number">4.</span> b</div><div class="line"><span class="number">1.</span> baab</div></pre></td></tr></table></figure>
<p>å› æ­¤å­—ç¬¦ä¸²Sçš„åç¼€æ•°ç»„ä¸ºï¼š <code>(2, 3, 0, 4, 1)</code></p>
<h3 id="åç¼€æ•°ç»„çš„æ„é€ "><a href="#åç¼€æ•°ç»„çš„æ„é€ " class="headerlink" title="åç¼€æ•°ç»„çš„æ„é€ "></a>åç¼€æ•°ç»„çš„æ„é€ </h3><h4 id="O-N2logN-æ„é€ æ³•"><a href="#O-N2logN-æ„é€ æ³•" class="headerlink" title="O(N2logN)  æ„é€ æ³•"></a>O(N2logN)  æ„é€ æ³•</h4><p>è¿™æ˜¯æœ€æœ´ç´ çš„æ„é€ æ–¹æ³•æ•ˆç‡ï¼Œå³è·å–æ‰€æœ‰åç¼€å¹¶ä½¿ç”¨O(NlogN)çš„æ’åºç®—æ³•å¦‚å¿«æ’æˆ–è€…åˆå¹¶æ’åºå¯¹è¿™äº›åç¼€è¿›è¡Œæ’åºã€‚è€Œæ„é€ æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(N2logN)è€Œä¸æ˜¯O(NlogN)çš„åŸå› æ˜¯æ’åºè¿‡ç¨‹ä¸­ä¸¤ä¸ªåç¼€çš„æ¯”è¾ƒå¤æ‚åº¦ä¸ºO(N)ã€‚ä¸‹é¢æˆ‘ä»¬å°†æŠŠæ¯”è¾ƒçš„å¤æ‚åº¦ä»O(N)é™ä¸ºO(logN)ã€‚</p>
<h4 id="O-N-log2-N-æ„é€ æ³•"><a href="#O-N-log2-N-æ„é€ æ³•" class="headerlink" title="O(N log2 N) æ„é€ æ³•"></a>O(N log2 N) æ„é€ æ³•</h4><p>æ¯”è¾ƒçš„å¤æ‚åº¦èƒ½å¤Ÿä»O(N)é™ä¸ºO(logN)ä¾èµ–äºåç¼€çš„ç‰¹æ€§ï¼šè¿™äº›åç¼€å¹¶ä¸æ˜¯éšæœºçš„ï¼Œè€Œæ˜¯åŒå±äºä¸€ä¸ªå­—ç¬¦ä¸²çš„åç¼€ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›åç¼€æœ‰ç›¸åŒçš„å…¬å…±éƒ¨åˆ†å¯ä»¥ä¾›æˆ‘ä»¬åˆ©ç”¨ã€‚</p>
<p>ä¸‹é¢ç”¨ç¤ºä¾‹è¯´æ˜ã€‚æˆ‘ä»¬ä»¥æ‰€æœ‰åç¼€çš„é¦–å­—æ¯ä¸ºåŸºå‡†æ’åºï¼Œå¹¶å¯¹è¿™äº›é¦–å­—æ¯èµ‹äºˆä¸€ä¸ª rank å€¼ä»£è¡¨ä»–ä»¬ä¹‹é—´çš„å¤§å°å…³ç³»ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="number">0.</span> a|baab</div><div class="line"><span class="number">0.</span> a|ab</div><div class="line"><span class="number">0.</span> a|b</div><div class="line"><span class="number">1.</span> b|aab</div><div class="line"><span class="number">1.</span> b|</div></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼Œä»¥ | å·¦ä¾§å­—ç¬¦ä¸²ä¸ºæ¯”è¾ƒåŸºå‡†ï¼Œå­—ç¬¦ä¸²å‰çš„æ•°å­—è¡¨ç¤º | å·¦ä¾§å­—ç¬¦ä¸²å¯¹åº”çš„ rankã€‚ç”±æ­¤ï¼Œrank(a) = 0ï¼Œ rank(b) = 1ã€‚</p>
<p>æˆ‘ä»¬å–ä¸¤ä¸ªå­—ç¬¦è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œæ¯”è¾ƒåˆ†ä¸¤æ­¥ã€‚é¦–å…ˆæ¯”è¾ƒç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœç›¸ç­‰åˆ™ç»§ç»­æ¯”è¾ƒç¬¬äºŒä¸ªå­—ç¬¦ã€‚</p>
<p>1ã€å¯¹äº abaab å’Œ baabï¼Œå› ä¸ºäºŒè€…é¦–å­—æ¯ rank å€¼å·²çŸ¥ä¸”ä¸åŒï¼Œå› æ­¤ abaab æ’åºåœ¨ baab ä¹‹å‰ã€‚</p>
<p>2ã€å¯¹äº abaab å’Œ aabï¼Œå› ä¸ºè€Œè¿™é¦–å­—æ¯ rank å€¼å·²çŸ¥ä¸”ç›¸åŒï¼Œå› æ­¤ç»§ç»­çœ‹ç¬¬äºŒä¸ªå­—ç¬¦ï¼Œä¸¤è€…çš„ç¬¬äºŒä¸ªå­—ç¬¦ä¸åŒä¸” rank å€¼å·²çŸ¥ï¼Œæ‰€ä»¥ aab æ’åœ¨ abaab ä¹‹å‰ã€‚</p>
<p>é€šè¿‡ä¸Šé¢ä¸¤ä¸ªæ­¥éª¤çš„è§£æå¯ä»¥å‘ç°ï¼Œåœ¨æ¯”è¾ƒæ‰€æœ‰åç¼€çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¹‹åï¼Œæˆ‘ä»¬å°±å·²ç»è·å¾—äº†æ•´ä¸ªå­—ç¬¦ä¸² S çš„æ‰€æœ‰å­—ç¬¦çš„ rank å€¼ã€‚ï¼ˆå› ä¸ºæ‰€æœ‰åç¼€çš„é¦–å­—ç¬¦ç»„åœ¨ä¸€èµ·æ°å¥½ä¸ºå­—ç¬¦ä¸²Sï¼Œè”æƒ³åç¼€çš„å®šä¹‰å³Sä»i(0 &lt;= i &lt; len(s))åˆ°Sçš„æœ€åä¸€ä¸ªå­—ç¬¦æ‰€ç»„æˆçš„å­—ç¬¦ä¸²é›†åˆï¼‰</p>
<p>å¯¹äºæ²¡æœ‰ç¬¬äºŒä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²æˆ‘ä»¬è®¤ä¸ºå®ƒçš„ç¬¬äºŒéƒ¨åˆ† rank å€¼ä¸ºæœ€å°å€¼ï¼Œè¿™é‡Œè®¾å…¶ä¸º-1ã€‚ä¾‹å¦‚ b åªæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œå› æ­¤å®ƒçš„å‰ä¸¤ä¸ªå­—ç¬¦ rank å¯¹å°±ä¸ºï¼ˆ1ï¼Œ -1ï¼‰</p>
<p>ç°åœ¨æˆ‘ä»¬å°è¯•ä»¥ä¸¤ä¸ªå­—ç¬¦ä½œä¸ºæ¯”è¾ƒåŸºå‡†ï¼Œæœ‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="number">0.</span> aa|b</div><div class="line"><span class="number">1.</span> ab|aab</div><div class="line"><span class="number">1.</span> ab|</div><div class="line"><span class="number">2.</span> b|</div><div class="line"><span class="number">2.</span> ba|ab</div></pre></td></tr></table></figure>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œå¯¹äºå­—ç¬¦ä¸²ä¸‹æ¬¡æ¯”è¾ƒï¼Œæˆ‘ä»¬é€‰å–4ä¸ªå­—ç¬¦ï¼Œè€Œ4ä¸ªå­—ç¬¦çš„æ¯”è¾ƒåˆå¯åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šå‰ä¸¤ä¸ªå­—ç¬¦å’Œåä¸¤ä¸ªå­—ç¬¦ã€‚è¿™åˆå›åˆ°äº†ä¸Šä¸€æ­¥çš„è¿‡ç¨‹ã€‚å› æ­¤æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬åªéœ€æ¯”è¾ƒå‰1ã€2ã€4ã€8ã€â€¦ã€log(len(s))ä¸ªå­—ç¬¦ã€‚</p>
<p>ä¸‹é¢æ˜¯ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"bits/stdc++.h"</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"> </div><div class="line"><span class="comment">// suffixRank ä¿å­˜æ¯æ¬¡éå†è¿‡ç¨‹ä¸­æ¯ä¸ªå­—ç¬¦ä¸²çš„Rankå€¼ </span></div><div class="line"><span class="comment">// suffixRank[i][j] ä»£è¡¨ç¬¬ i æ¬¡éå†ï¼Œç¬¬ j ä¸ªåç¼€çš„ rank </span></div><div class="line"></div><div class="line"><span class="keyword">int</span> suffixRank[<span class="number">20</span>][<span class="keyword">int</span>(<span class="number">1E6</span>)];</div><div class="line"></div><div class="line"><span class="comment">// ç¤ºä¾‹ï¼š "abaab" </span></div><div class="line"><span class="comment">// å¯¹åº”çš„åç¼€æ•°ç»„ï¼š (2, 3, 0, 4, 1) </span></div><div class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªä¿å­˜æ¯ä¸ªåç¼€ rank å€¼åºåˆ—çš„ç»“æ„ä½“ã€‚ </span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">myTuple</span> &#123;</span>  </div><div class="line">    <span class="keyword">int</span> originalIndex;   <span class="comment">// ä¿å­˜åŸå§‹åç¼€é¦–å­—æ¯çš„åºåˆ—å·</span></div><div class="line">    <span class="keyword">int</span> firstHalf;       <span class="comment">// ä¿å­˜åç¼€å‰åŠéƒ¨åˆ†çš„ rank å€¼</span></div><div class="line">    <span class="keyword">int</span> secondHalf;      <span class="comment">// ä¿å­˜åç¼€ååŠéƒ¨åˆ†çš„ rank å€¼</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// åç¼€æ¯”è¾ƒå‡½æ•°ï¼Œæ—¶é—´å¤æ‚åº¦O(1)</span></div><div class="line"><span class="comment">// é¦–å…ˆ a çš„ firstHalf æ˜¯å¦ä¸ b çš„ firstHalf ç›¸ç­‰</span></div><div class="line"><span class="comment">// å¦‚æœç›¸ç­‰ï¼Œåˆ™æ¯”è¾ƒ secondHalf</span></div><div class="line"><span class="comment">// å¦åˆ™æ¯”è¾ƒç»“æœå–å†³äº firstHalf çš„ rank å€¼å¤§å°</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(myTuple a, myTuple b)</span> </span>&#123;  </div><div class="line">    <span class="keyword">if</span>(a.firstHalf == b.firstHalf) <span class="keyword">return</span> a.secondHalf &lt; b.secondHalf;  </div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> a.firstHalf &lt; b.firstHalf;  </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="comment">// è¾“å…¥å­—ç¬¦ä¸² S </span></div><div class="line">	<span class="comment">// ä¿å­˜ S çš„é•¿åº¦åˆ° N ä¸­</span></div><div class="line"></div><div class="line">    <span class="built_in">string</span> s; <span class="built_in">cin</span> &gt;&gt; s;</div><div class="line">    <span class="keyword">int</span> N = s.size();</div><div class="line">	</div><div class="line">	<span class="comment">// åˆå§‹åŒ– æ¯ä¸ªåç¼€çš„é¦–å­—æ¯ rank å€¼ä½œä¸ºå¯¹åº”åç¼€çš„ rank å€¼ </span></div><div class="line">	<span class="comment">// å¯¹äºå•å­—æ¯ rank å€¼ï¼Œä»¥è¯¥å­æ¯ä¸ a å·®è·ä½œä¸º rankï¼Œå› æ­¤ 'a' = 0, 'b' = 1, 'c' = 2, ... ,'z' = 25</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</div><div class="line">        suffixRank[<span class="number">0</span>][i] = s[i] - <span class="string">'a'</span>;</div><div class="line"></div><div class="line">	<span class="comment">// åˆ›å»ºæ¯ä¸ªåç¼€çš„ å…ƒç»„ æ•°ç»„</span></div><div class="line"></div><div class="line">    myTuple L[N];</div><div class="line">	</div><div class="line">	<span class="comment">// éå† log(n) æ¬¡ï¼Œç›´åˆ°æ‰€æœ‰çš„åç¼€æ’åºå®Œæ¯•</span></div><div class="line">	<span class="comment">// 'stp' ä¿å­˜å½“å‰éå†æ¬¡æ•°</span></div><div class="line">	<span class="comment">// 'cnt' ä¿å­˜å°†è¢«æ¯”è¾ƒçš„åç¼€é•¿åº¦ </span></div><div class="line"></div><div class="line">	<span class="comment">// æ¯æ¬¡éå†ï¼Œ æˆ‘ä»¬ç”¨ä¸Šä¸€æ¬¡éå†è·å¾—çš„å€¼åˆå§‹åŒ–æ¯ä¸ªåç¼€æ•°ç»„çš„å…ƒç»„</span></div><div class="line">	</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> cnt = <span class="number">1</span>, stp = <span class="number">1</span>; cnt &lt; N; cnt *= <span class="number">2</span>, ++stp) &#123;</div><div class="line"></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">            L[i].firstHalf = suffixRank[stp - <span class="number">1</span>][i];</div><div class="line">            L[i].secondHalf = i + cnt &lt; N ? suffixRank[stp - <span class="number">1</span>][i + cnt] : <span class="number">-1</span>;</div><div class="line">            L[i].originalIndex = i;</div><div class="line">        &#125;</div><div class="line">		</div><div class="line">		<span class="comment">// ä»¥ å…ƒç»„ ä¸ºåŸºå‡†å¯¹ å…ƒç»„æ•°ç»„ æ’åº</span></div><div class="line"></div><div class="line">        sort(L, L + N, cmp);</div><div class="line">		</div><div class="line">		<span class="comment">// æ’åºåï¼Œå¦æ’åºæœ€é å‰çš„ rank å€¼åˆå§‹åŒ–ä¸º0 </span></div><div class="line">        <span class="comment">// Initialize rank for rank 0 suffix after sorting to its original index</span></div><div class="line">        <span class="comment">// in suffixRank array</span></div><div class="line"></div><div class="line">        suffixRank[stp][L[<span class="number">0</span>].originalIndex] = <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>, currRank = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">			</div><div class="line">			<span class="comment">// æ¯”è¾ƒç¬¬ i ä¸ªåç¼€å’Œç¬¬ i-1 ä¸ªåç¼€</span></div><div class="line">			<span class="comment">// å¦‚æœäºŒè€…ç›¸ç­‰ï¼Œåˆ™å°†ç¬¬ i-1 ä¸ªåç¼€çš„ rank å€¼èµ‹ç»™ç¬¬ i ä¸ªåç¼€</span></div><div class="line">			<span class="comment">// å¦åˆ™ç¬¬ i ä¸ªåç¼€çš„ rank ä¸ºç¬¬ i-1 ä¸ªåç¼€çš„ rank å€¼åŠ 1 </span></div><div class="line"></div><div class="line">            <span class="keyword">if</span>(L[i - <span class="number">1</span>].firstHalf != L[i].firstHalf || L[i - <span class="number">1</span>].secondHalf != L[i].secondHalf)</div><div class="line">                ++currRank;</div><div class="line"></div><div class="line">            suffixRank[stp][L[i].originalIndex] = currRank;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// è¾“å‡ºåç¼€æ•°ç»„ </span></div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) <span class="built_in">cout</span> &lt;&lt; L[i].originalIndex &lt;&lt; <span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="åç¼€æ•°ç»„çš„åº”ç”¨"><a href="#åç¼€æ•°ç»„çš„åº”ç”¨" class="headerlink" title="åç¼€æ•°ç»„çš„åº”ç”¨"></a>åç¼€æ•°ç»„çš„åº”ç”¨</h3><p>1ã€ç»“åˆLCPï¼ˆLongest Common Prefixï¼‰</p>
<p>2ã€æ¨¡å¼åŒ¹é…</p>
<p>3ã€ æŸ¥æ‰¾æœ€é•¿é‡å¤å­ä¸²</p>
<p>4ã€ æŸ¥æ‰¾æœ€é•¿å…¬å…±å­ä¸²</p>
<p>5ã€ æŸ¥æ‰¾æœ€é•¿å›æ–‡å­ä¸²</p>
<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><p>1ã€<a href="https://www.hackerrank.com/challenges/string-function-calculation/topics/two-pointer-technique" target="_blank" rel="external">String Function Calculation Topics</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä»€ä¹ˆæ˜¯-åç¼€ï¼ˆSuffixï¼‰&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯-åç¼€ï¼ˆSuffixï¼‰&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯ åç¼€ï¼ˆSuffixï¼‰&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯ åç¼€ï¼ˆSuffixï¼‰&lt;/h3&gt;&lt;p&gt;Sæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º N çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå®šä¹‰Sçš„ç¬¬
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="algorithm, data structure" scheme="http://blog.yinwoods.work/tags/algorithm-data-structure/"/>
    
  </entry>
  
  <entry>
    <title>é¦–å°¾æŒ‡é’ˆæ³•</title>
    <link href="http://blog.yinwoods.work/2016/10/16/%E9%A6%96%E5%B0%BE%E6%8C%87%E9%92%88%E6%B3%95/"/>
    <id>http://blog.yinwoods.work/2016/10/16/é¦–å°¾æŒ‡é’ˆæ³•/</id>
    <published>2016-10-15T16:00:00.000Z</published>
    <updated>2017-07-26T10:06:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>é¦–å°¾æŒ‡é’ˆæ³•å¤šåº”ç”¨äºåœ¨å·²æ’åºçš„æ•°ç»„ä¸­å®ç°O(N)çš„æŸ¥æ‰¾ã€‚</p>
<p>ä¾‹å¦‚ï¼šç»™å®šä¸€ä¸ªæ•´æ•°kï¼Œå¯¹äºä¸¤ä¸ªé€’å¢æ•°ç»„ï¼Œæ‰¾åˆ°(i, j)ä½¿å¾— a ä¸­çš„ i ä½ç½®ä¸ b ä¸­çš„ j ä½ç½®æ»¡è¶³ a[i] + b[j] = kã€‚<br>å¯¹äºè¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬å¾€å¾€å¯ä»¥å– a ä¸­çš„ç¬¬iä½åŠ b ä¸­ç¬¬jä½ï¼Œä¾æ¬¡ç›¸åŠ å¹¶æ ¹æ®ç›¸åŠ ç»“æœä¸æ•°å€¼ k çš„å¤§å°æ¥å†³å®ši, jçš„ç§»åŠ¨æ–¹å‘ã€‚</p>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>#!CPP
while (i &lt; a.size()) {
    while(a[i] + b[j] &gt; X &amp;&amp; j &gt; 0) j--;
    if (a[i] + b[j] == X) writeAnswer(i, j);
    i++;
}
</code></pre><p>é—®é¢˜å˜å½¢ï¼š</p>
<p>1ã€å¯¹äºæ— é‡å¤å…ƒç´ çš„æ•°ç»„ aï¼Œé—®å­˜åœ¨å¤šå°‘ç§ä¸‰ä¸ªæ•°ç›¸åŠ ï¼Œå’Œä¸ºå®šå€¼kçš„æƒ…å†µã€‚</p>
<blockquote>
<p>è§£ç­”ï¼šå…ˆå¯¹æ•°ç»„æ’åºï¼Œå¤–éƒ¨å¾ªç¯éå†aï¼Œå¹¶åœ¨å¾ªç¯å†…éƒ¨æ‰¾a[p] + a[q] = k - a[i]çš„æƒ…å†µã€‚å…¶ä¸­ p,q çš„å¯»æ‰¾å³åˆ©ç”¨é¦–å°¾æŒ‡é’ˆæ³•ã€‚</p>
</blockquote>
<p>2ã€å¯¹äºæ— é‡å¤å…ƒç´ çš„æ•°ç»„ aï¼Œé—®å­˜åœ¨å¤šå°‘ç§ä¸¤ä¸ªæ•°ç›¸å‡ï¼Œå’Œä¸ºå®šå€¼kçš„æƒ…å†µã€‚</p>
<blockquote>
<p>è§£ç­”ï¼šå…ˆå¯¹æ•°ç»„æ’åºï¼Œå¤–éƒ¨å¾ªç¯éå†aï¼Œåˆ¤æ–­a[i] + kæ˜¯å¦åœ¨æ•°ç»„aä¸­å³å¯ï¼Œåˆ¤æ–­å¯ä»¥åˆ©ç”¨setæ¥å®ç°log(N)çš„æ—¶é—´å¤æ‚åº¦ï¼Œå› æ­¤è¯¥ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(NlogN)ã€‚</p>
<p>è§£ç­”ï¼š æ›´é«˜æ•ˆçš„æ–¹æ³•æ˜¯å–i = 0, j = 1, å½“ a[j] - a[i] &gt; k æ—¶ï¼Œ++iï¼›å½“a[j] - a[i] &lt; kæ—¶ï¼Œ++j;</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é¦–å°¾æŒ‡é’ˆæ³•å¤šåº”ç”¨äºåœ¨å·²æ’åºçš„æ•°ç»„ä¸­å®ç°O(N)çš„æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼šç»™å®šä¸€ä¸ªæ•´æ•°kï¼Œå¯¹äºä¸¤ä¸ªé€’å¢æ•°ç»„ï¼Œæ‰¾åˆ°(i, j)ä½¿å¾— a ä¸­çš„ i ä½ç½®ä¸ b ä¸­çš„ j ä½ç½®æ»¡è¶³ a[i] + b[j] = kã€‚&lt;br&gt;å¯¹äºè¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬å¾€å¾€å¯ä»¥å– a ä¸­çš„ç¬¬iä½åŠ b ä¸­ç¬¬
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="algorithm" scheme="http://blog.yinwoods.work/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>å®ä¹ æ€»ç»“</title>
    <link href="http://blog.yinwoods.work/2016/09/26/%E5%AE%9E%E4%B9%A0%E6%80%BB%E7%BB%93/"/>
    <id>http://blog.yinwoods.work/2016/09/26/å®ä¹ æ€»ç»“/</id>
    <published>2016-09-25T16:00:00.000Z</published>
    <updated>2017-07-26T10:06:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»2015å¹´1æœˆåº•åˆ°2016å¹´8æœˆåº•åœ¨æŸäºŒæ‰‹è½¦æœåŠ¡å¹³å°å…¬å¸åŒ—äº¬ç ”å‘éƒ¨å®ä¹ äº†ä¹Ÿç®—æœ‰åŠå¹´çš„æ—¶é—´ï¼ˆå»é™¤ä¸­é—´å›æ ¡ç­”è¾©çš„ä¸€ä¸ªæœˆï¼‰ï¼Œä»åˆšè¿›å…¥å›¢é˜Ÿæ—¶çš„å››äº”ä¸ªäººåˆ°ç¦»å¼€æ—¶çš„20+äººé˜Ÿä¼ï¼Œä¹Ÿç®—æ˜¯ä»ä¸€ä¸ªå®ä¹ ç”Ÿè§’åº¦è§è¯äº†ä¸€ä¸ªå…¬å¸çš„æˆé•¿è¿‡ç¨‹ã€‚</p>
<h3 id="å®ä¹ ä¹‹åˆï¼š"><a href="#å®ä¹ ä¹‹åˆï¼š" class="headerlink" title="å®ä¹ ä¹‹åˆï¼š"></a>å®ä¹ ä¹‹åˆï¼š</h3><p>æ¥æ‰‹çš„å·¥ä½œæ˜¯å°½å¯èƒ½å¤šåœ°åŒ¹é…ä¸¤ä¸ªè½¦å‹åº“ä¸­çš„è½¦å‹ï¼Œæé«˜è½¦å‹åŒ¹é…ç‡ã€‚è¯´å®è¯è¿™ä¸ªå·¥ä½œæˆ‘åšåœ°å¾ˆç—›è‹¦ï¼Œå› ä¸ºç”¨C++å†™çš„ï¼Œæœ¬èº«å¼€å‘é€Ÿåº¦å°±æ¯”è¾ƒæ…¢ï¼Œè€Œä¸”åˆšè¿›å…¥å›¢é˜Ÿä¸€æ–¹é¢æ˜¯æƒ³å±•ç°å‡ºè‡ªå·±çš„å®åŠ›ï¼›å¦ä¸€æ–¹é¢å›¢é˜Ÿé¢†å¯¼ä¹Ÿå¯¹æˆ‘ä¸å¤Ÿä¿¡ä»»ï¼Œç»™æˆ‘çš„æ„Ÿè§‰å°±æ˜¯ä»–ä»¬è®¤ä¸ºæˆ‘åœ¨å·æ‡’ï¼Œè€Œäº‹å®æ˜¯æˆ‘æŠ•å…¥äº†å¤§é‡çš„æ—¶é—´åœ¨å…¶ä¸­ã€‚å†™å®Œäº†ä¸€ç‰ˆä¹‹åå°±ä¼šå‘ç°æœ‰å„ç§caseè¦å•ç‹¬å¤„ç†ï¼Œå½“ç„¶å‡ºç°è¿™ç§é—®é¢˜å¾ˆå¤§çš„åŸå› æ˜¯æˆ‘åœ¨åŠ¨æ‰‹å†™é¡¹ç›®ä¹‹å‰æ²¡æœ‰è®¤çœŸè€ƒè™‘è¿‡æ•´ä¸ªé¡¹ç›®çš„ç»“æ„ä»¥åŠå„ç§å¯èƒ½ä¼šé¢å¯¹çš„caseï¼Œè¿™åº”è¯¥å½’å› äºæˆ‘çš„ç»éªŒé—®é¢˜ï¼Œè€Œä¸æ˜¯èƒ½åŠ›é—®é¢˜ã€‚é¢å¯¹è¿™ç§æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™æ‘†åœ¨é¢å‰çš„é€‰æ‹©æœ‰ï¼š</p>
<p>1ã€åœ¨ç¨‹åºä¸­åŠ å„ç§åˆ¤æ–­è¯­å¥é’ˆå¯¹å¤„ç†ï¼›</p>
<p>2ã€ä»£ç é‡æ„ï¼›</p>
<p>å°±æˆ‘ä¸ªäººè€Œè¨€æˆ‘æ›´å€¾å‘äºä»£ç é‡æ„ï¼Œå› ä¸ºèƒ½å¤Ÿé‡æ–°ç†æ¸…æ€è·¯ï¼Œé¿å…åç»­å‡ºç°çš„å¾ˆå¤šå‘ã€‚ä½†æ˜¯ç”±äºä¸šåŠ¡éœ€è¦ï¼Œbossä»¬æ›´å€¾å‘äºæˆ‘å¿«äº›äº¤ä»˜ï¼Œå› æ­¤å°±åªèƒ½åƒæ‰“è¡¥ä¸ä¸€æ ·å¾€åŸä»£ç é‡Œé¢åŠ å„ç§å¤„ç†ï¼Œå¯¼è‡´æœ€åæ•´ä¸ªä»£ç æ”¹èµ·æ¥ç‰¹åˆ«åƒåŠ›ï¼Œæ¯å¤©èŠ±è´¹å¤§æŠŠçš„æ—¶é—´æŠ•å…¥å…¶ä¸­è€Œå–å¾—çš„æ•ˆæœå´å¾®ä¹å…¶å¾®ã€‚è€Œä¸”bossçš„æƒ³æ³•æ€»æ˜¯æƒ³ä¸€å‡ºæ˜¯ä¸€å‡ºï¼Œéœ€æ±‚æ¥å›å˜æ¢è€Œæˆ‘åˆä¸èƒ½é‡æ„ä»£ç ã€‚é‚£æ®µæ—¶é—´è‡ªå·±ä¹Ÿå¾ˆç—›è‹¦ï¼Œåæ¥å‘bossæ˜ç¡®è¡¨ç¤ºè‡ªå·±ä¸æƒ³å†åšè¿™æ–¹é¢çš„å·¥ä½œäº†ã€‚å¹¸å¥½bossä¹Ÿè¡¨ç¤ºç†è§£ï¼Œå¹¶ä¸”è¿™é¡¹å·¥ä½œä¹Ÿè¯æ˜äº†å¾ˆéš¾èµ°å¾—é€šï¼ˆ <strong> åŸå› ï¼šä¸¤ä¸ªè½¦å‹åº“çš„è½¦å‹å‘½åå·®å¼‚å¤ªå¤§ï¼Œå¾ˆéš¾æå–å…±é€šä¹‹å¤„ã€‚ </strong> ï¼‰</p>
<h3 id="å®ä¹ ä¹‹ä¸­ï¼š"><a href="#å®ä¹ ä¹‹ä¸­ï¼š" class="headerlink" title="å®ä¹ ä¹‹ä¸­ï¼š"></a>å®ä¹ ä¹‹ä¸­ï¼š</h3><p>å› ä¸ºè½¦å‹åŒ¹é…è¿™æ¡è·¯èµ°ä¸é€šåŠ ä¸Šæˆ‘æ˜ç¡®è¡¨ç¤ºè¿™é¡¹å·¥ä½œè®©æˆ‘è§‰å¾—å¾ˆç—›è‹¦ï¼Œå› æ­¤bossç»™æˆ‘åˆ†é…çš„æ–°ä»»åŠ¡æ˜¯çˆ¬è™«ï¼Œçˆ¬å–å„å¤§è½¦ä¸Šç½‘ç«™çš„æ•°æ®ï¼ˆä¸»è¦æ˜¯æ¯æ¬¾è½¦çš„é…ç½®ä»·æ ¼ç­‰æ•°æ®ï¼‰ã€‚åœ¨è¿™ä¹‹å‰æˆ‘å­¦ä¹ è¿‡ä¸€æ®µæ—¶é—´çš„pythonï¼Œç®—æ˜¯å…¥é—¨ï¼Œå…¶ä¸­ä¹Ÿæ¶‰åŠåˆ°äº†åŸºç¡€çš„çˆ¬è™«æŠ“å–ï¼Œæ‡‚å¾—urllibä»¥åŠbeautifulsoupçš„ä½¿ç”¨ã€‚åˆšåˆšæ¥æ‰‹è¿™ä¸ªå·¥ä½œè¿˜æ˜¯å¾ˆæƒ¶æçš„ï¼Œå¥½åœ¨bossè¡¨ç¤ºäº¤ç»™æˆ‘çš„ä»»åŠ¡æ˜¯å°è¯•æ€§çš„ï¼Œèƒ½å¤Ÿçˆ¬å–æ›´å¥½ï¼Œä¸èƒ½çˆ¬å–çš„è¯å†æƒ³åˆ«çš„æ–¹æ³•ã€‚ä¹Ÿæ­£æ˜¯ä»è¿™é‡Œå¼€å§‹äº†æˆ‘è¾¹å­¦ä¹ è¾¹å†™çˆ¬è™«çš„å®ä¹ ä¹‹è·¯ã€‚</p>
<p>èµ·åˆåˆšæ¥æ‰‹çš„æ˜¯<a href="http://www.carking001.com/" target="_blank" rel="external">è½¦ç‹ç½‘</a>,è®°å¾—å¥½åƒæ²¡æœ‰ä»€ä¹ˆé˜²çˆ¬æªæ–½ï¼Œå› æ­¤å¤§æ¦‚èŠ±äº†ä¸€å‘¨çš„æ—¶é—´é¡ºåˆ©åœ°å®Œæˆäº†çˆ¬å–å·¥ä½œï¼Œbossä¹Ÿå¯¹æˆ‘å®Œæˆçš„å·¥ä½œæ¯”è¾ƒæ»¡æ„ï¼Œåé¢å°±ç»™æˆ‘å¸ƒç½®äº†çˆ¬å–<a href="http://www.che300.com/" target="_blank" rel="external">è½¦300</a>çš„å·¥ä½œã€‚è¯´åˆ°è¿™é‡Œå°±è¦æåˆ°ä¸€ä»¶æ¯”è¾ƒæœ‰è¶£çš„äº‹äº†ï¼Œå› ä¸ºè¦æ±‚æˆ‘å†™çš„çˆ¬è™«åªéœ€è¦æŠŠç›¸åº”ç½‘ç«™çš„è½¦å‹åº“æ•´ä½“çˆ¬ä¸‹æ¥ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯åŠ¨æ€æ›´æ–°ï¼Œå› æ­¤å†™å¾—æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸æ¶‰åŠå¹¶è¡Œæ“ä½œï¼Œè€Œæ¯ä¸ªè½¦å‹éƒ½å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„idï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥å¯åŠ¨å¤šä¸ªpythonçˆ¬è™«è„šæœ¬ï¼Œæ¯ä¸ªè„šæœ¬çˆ¬å–ä¸€ä¸ªidèŒƒå›´å†…çš„è½¦å‹ä¿¡æ¯ï¼Œè¿™æ ·ä¹Ÿç®—æ˜¯ä»æŸç§è§’åº¦ä¸Šå®ç°äº†å¹¶è¡Œçˆ¬å–ã€‚åˆšå¥½bosså½“æ—¶å¯¹è½¦300æ•°æ®è¦çš„æ¯”è¾ƒæ€¥ï¼Œå°±è®©æˆ‘åŒæ—¶å¯åŠ¨10ä¸ªè„šæœ¬ä¸€èµ·çˆ¬ï¼Œè¿™æ ·ä¸€æ¥é€Ÿåº¦ä¸Šç¡®å®å¿«äº†å¾ˆå¤šã€‚ä½†æ˜¯å› ä¸ºå•ä½æ—¶é—´å†…å¤§é‡è®¿é—®ï¼Œipè¢«å°äº†ã€‚ã€‚ã€‚ä¹Ÿå°±æ˜¯ä»è¿™é‡Œå¼€å§‹å­¦ä¹ äº†å„ç§å-åçˆ¬è™«çš„æŠ€æœ¯ã€‚åé¢åˆçˆ¬äº†<a href="http://www.dpac.gov.cn/" target="_blank" rel="external">å›½å®¶è´¨æ£€æ€»å±€äº§å“ç¼ºé™·ç®¡ç†ä¸­å¿ƒ</a>ï¼Œæ–°æ—§é¡µé¢ç»“æ„å˜åŒ–å¾ˆå¤§ï¼Œä¸”è€æ•°æ®å±•ç¤ºåŠå…¶ä¸è§„èŒƒï¼ä¸è¿‡èŠ±äº†å†™æ—¶é—´æ€»ç®—æ˜¯æ¯”è¾ƒåƒæ ·åœ°å®ç°äº†ã€‚</p>
<p>è¿™æ®µæ—¶é—´å…¬å¸å„é¡¹ä¸šåŠ¡ä¹Ÿå¼€å§‹èµ·æ­¥ï¼Œæ‹›è˜äº†å¾ˆå¤šæ–°äººï¼Œå¹¶è´­ç½®äº†å¾ˆå¤šæœåŠ¡å™¨ã€‚ä½œä¸ºä¸€ä¸ªå®ä¹ ç”Ÿï¼Œè¿è¥ç»´æŠ¤ä¹Ÿå°±æˆäº†æˆ‘å·¥ä½œä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå®ç°ä¸€äº›å®šæ—¶è„šæœ¬ç­‰ç­‰ã€‚è¿™é‡Œä¸å¾—ä¸åæ§½ä¸€ä¸‹ï¼šä¸ºä»€ä¹ˆå¥½å¤šè®¡ç®—æœºä»ä¸šäººå‘˜è¿è£…ç³»ç»Ÿéƒ½ä¸ä¼šå•Šã€‚ã€‚ã€‚</p>
<p>æœŸé—´ä¹Ÿåœ¨å®ä¹ ä¸­å®Œæˆäº†è‡ªå·±çš„æ¯•ä¸šè®¾è®¡ï¼Œå›æ ¡ç­”è¾©ã€‚ï¼ˆçˆ¬è™«è·‘èµ·æ¥æŠ“å–æ•°æ®çš„æ—¶å€™æˆ‘å°±æœ‰æ—¶é—´åŠ¨æ‰‹å†™è‡ªå·±çš„æ¯•è®¾äº†ï¼Œè¿™ä¹Ÿç®—æ˜¯å†™çˆ¬è™«çš„ä¸€ä¸ªç¦åˆ©å§ï¼ï¼‰</p>
<h3 id="å®ä¹ ä¹‹å°¾"><a href="#å®ä¹ ä¹‹å°¾" class="headerlink" title="å®ä¹ ä¹‹å°¾"></a>å®ä¹ ä¹‹å°¾</h3><p>æœ¬æ¥é¢„è®¡å›æ ¡ä¸€å‘¨å®Œæˆç­”è¾©å·¥ä½œçš„ï¼Œæ²¡æƒ³åˆ°æˆ‘ä»¬é™¢ç¡¬ç”Ÿç”Ÿåœ°æ‹–äº†å¤§åŠä¸ªæœˆæ‰å¼€å§‹ç­”è¾©å·¥ä½œ #_#!ã€‚å¯èƒ½æ˜¯ç»è¿‡å‰é¢è¿™æ®µæ—¶é—´çš„é«˜å¼ºåº¦å®ä¹ ï¼Œå¾ˆå¤šçŸ¥è¯†éƒ½æ²¡æœ‰æ—¶é—´æ¶ˆåŒ–ï¼Œå›æ ¡è¿™æ®µä¼‘é—²çš„æ—¶é—´åè€Œæ„Ÿè§‰é¢†ä¼šäº†å¾ˆå¤šä¸œè¥¿ã€‚æœŸé—´ä¹Ÿå¸®åŒå­¦çš„ä¸€ä¸ªå§å§ç¼–å†™äº†ä¸€ä¸ªæ ¡å†…æŠ¢å…ˆé¢„å®šå®éªŒè®¾å¤‡çš„è„šæœ¬ï¼ŒåŠŸèƒ½å€’æ˜¯å®ç°äº†ï¼Œå¯ä»¥å› ä¸ºç”¨çš„æ˜¯ <a href="http://www.seleniumhq.org/" target="_blank" rel="external">selenium</a> + <a href="http://phantomjs.org/" target="_blank" rel="external">phantomjs</a>å¯¼è‡´æœ€åé€Ÿåº¦ä¸Šè¿˜æ²¡æœ‰äººå·¥æ“ä½œå¿«ã€‚ã€‚ã€‚ä¹Ÿç®—æ˜¯èƒæ­»è…¹ä¸­äº†å§ã€‚</p>
<p>ç­”è¾©å®Œæˆåå’Œæœ‹å‹ä»¬ä¸€èµ·å»äº‘å—ç©äº†ä¸€å‘¨ï¼Œåˆå›åˆ°å…¬å¸å®ä¹ ï¼Œç»§ç»­åšçˆ¬è™«ç›¸å…³å·¥ä½œã€‚å®ç°äº†ä¸€ä¸ªå®šæ—¶æŠ“å–<a href="">æ±½è½¦ä¹‹å®¶</a>çš„åŠ¨æ€å¢é‡çˆ¬è™«ï¼Œå¹¶éƒ¨ç½²åˆ°äº†å…¬å¸çš„æœåŠ¡å™¨ä¸Šï¼Œæ¯ä¸ªæœˆåˆå®šæ—¶çˆ¬å–ã€‚</p>
<h3 id="å®ä¹ æ€»ç»“"><a href="#å®ä¹ æ€»ç»“" class="headerlink" title="å®ä¹ æ€»ç»“"></a>å®ä¹ æ€»ç»“</h3><p>å®ä¹ è¿‡ç¨‹ä¸­è‡ªå·±ç¡®å®å­¦åˆ°äº†å¾ˆå¤šï¼Œçœ‹åˆ°äº†ä¸€äº›ä¼˜ç§€ç¨‹åºå‘˜çš„è¿½æ±‚å·²ç»ä¸å†æ˜¯å¤šå°‘å¤šå°‘é’±ï¼Œè€Œæ˜¯åœ¨æ„‰å¿«åœ°å·¥ä½œä¸­å®ç°è‡ªå·±çš„ä»·å€¼ã€‚è®©æˆ‘äº†è§£åˆ°äº†ä¼˜ç§€çš„ç¨‹åºå‘˜æ˜¯æ€ä¹ˆçœ‹å¾…é—®é¢˜ä»¥åŠå¤„ç†é—®é¢˜çš„ã€‚åœ¨è·å–é…¬åŠ³çš„åŒæ—¶ä¹Ÿå­¦åˆ°äº†å¾ˆå¤šçŸ¥è¯†ä»¥åŠæŠ€æœ¯ï¼Œä»¥åŠä¸€äº›ä¸hrã€bossäº¤æµçš„æ³¨æ„äº‹é¡¹ã€‚ç›¸ä¿¡å¯¹ä»¥åä»äº‹å·¥ä½œåº”è¯¥ä¹Ÿæœ‰æ‰€å¸®åŠ©ã€‚</p>
<p>è‡ªå·±ä¹Ÿè®¤çœŸåœ°æ€è€ƒäº†ä¸€ä¸‹å»åˆåˆ›å…¬å¸çš„ä¸€äº›é•¿å¤„å’Œç¼ºç‚¹ï¼Œä»…ä¾›å¤§å®¶å‚è€ƒï¼š</p>
<p>é•¿å¤„ï¼š</p>
<p>1ã€èƒ½å¤Ÿå’Œå¤§ç‰›ä»¬ä¸€èµ·å¹¶è‚©æˆ˜æ–—ï¼Œå¼€æ‹“çœ¼ç•Œï¼›</p>
<p>2ã€å›¢é˜Ÿå·¥ä½œå¼ºåº¦å¤§ï¼Œé”»ç‚¼å¤šï¼Œæˆé•¿é€Ÿåº¦å¿«ï¼›</p>
<p>3ã€ä¸€äººå¤šç”¨ï¼Œè¦åšå„æ–¹é¢çš„å·¥ä½œï¼›ï¼ˆæˆ–è®¸ç®—æ˜¯ç¼ºç‚¹-&gt;_-&gt;ï¼‰</p>
<p>4ã€å’Œé¢†å¯¼æ¥è§¦æœºä¼šå¤šï¼Œèƒ½å¤Ÿçœ‹åˆ°é¢†å¯¼æ˜¯æ€ä¹ˆçœ‹å¾…é—®é¢˜ï¼Œæ€ä¹ˆå¤„ç†çº çº·çš„ï¼›</p>
<p>5ã€äººé™…å…³ç³»ç®€å•ï¼ŒåŒäº‹ç›¸å¤„èµ·æ¥æ²¡æœ‰å¤ªå¤šçº¦æŸï¼›</p>
<p>ç¼ºç‚¹ï¼š</p>
<p>1ã€ç¼ºä¹æœ‰æ•ˆçš„å›¢é˜Ÿç®¡ç†ï¼Œå¼€å‘è¿›åº¦å¾ˆå¤§ç¨‹åº¦ä¸Šé è‡ªæˆ‘çº¦æŸä»¥åŠä¸Šçº§ç£ä¿ƒï¼›</p>
<p>2ã€éœ€æ±‚æ¥å›å˜æ¢ï¼Œå¾€å¾€æƒ³ä¸€å‡ºæ˜¯ä¸€å‡ºï¼Œæ²¡æœ‰ç³»ç»Ÿåœ°æ„æ¶ï¼›</p>
<p>3ã€å¼€å‘å·¥å…·ã€è¯­è¨€æ²¡æœ‰ç»Ÿä¸€è¦æ±‚ï¼Œæ•´ä½“æ¯”è¾ƒæ··ä¹±ï¼›</p>
<p>å›æƒ³èµ·å®ä¹ çš„é‚£æ®µæ—¶é—´ï¼Œè™½ç„¶æ¯”è¾ƒè¾›è‹¦ï¼Œä½†æ•´ä½“è¿˜æ˜¯æ„Ÿè§‰å¾ˆå¿«ä¹ï¼Œè‡ªå·±ä¹Ÿç¡®å®æˆé•¿äº†è®¸å¤šã€‚æ„Ÿè°¢å®ä¹ å…¬å¸ç»™äºˆæˆ‘çš„å®ä¹ æœºä¼šä»¥åŠåŒäº‹ä»¬ç»™äºˆæˆ‘çš„æŒ‡å¯¼å’Œå¸®åŠ©ï¼</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»2015å¹´1æœˆåº•åˆ°2016å¹´8æœˆåº•åœ¨æŸäºŒæ‰‹è½¦æœåŠ¡å¹³å°å…¬å¸åŒ—äº¬ç ”å‘éƒ¨å®ä¹ äº†ä¹Ÿç®—æœ‰åŠå¹´çš„æ—¶é—´ï¼ˆå»é™¤ä¸­é—´å›æ ¡ç­”è¾©çš„ä¸€ä¸ªæœˆï¼‰ï¼Œä»åˆšè¿›å…¥å›¢é˜Ÿæ—¶çš„å››äº”ä¸ªäººåˆ°ç¦»å¼€æ—¶çš„20+äººé˜Ÿä¼ï¼Œä¹Ÿç®—æ˜¯ä»ä¸€ä¸ªå®ä¹ ç”Ÿè§’åº¦è§è¯äº†ä¸€ä¸ªå…¬å¸çš„æˆé•¿è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å®ä¹ ä¹‹åˆï¼š&quot;&gt;&lt;a href=&quot;
    
    </summary>
    
      <category term="diary" scheme="http://blog.yinwoods.work/categories/diary/"/>
    
    
      <category term="thoughts" scheme="http://blog.yinwoods.work/tags/thoughts/"/>
    
  </entry>
  
  <entry>
    <title>pythonä¸­çš„context manager</title>
    <link href="http://blog.yinwoods.work/2016/08/08/python%E4%B8%AD%E7%9A%84context-manager/"/>
    <id>http://blog.yinwoods.work/2016/08/08/pythonä¸­çš„context-manager/</id>
    <published>2016-08-07T16:00:00.000Z</published>
    <updated>2017-07-26T10:06:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨è¯»pythonè¿›é˜¶ç±»ä¹¦ç±ã€ŠIntermediate Pythonã€‹ï¼Œçœ‹åˆ°åé¢æœ‰ä¸€ç« è®²åˆ°<code>context manager</code>ï¼Œè®²çš„å¾ˆæµ…ï¼Œæˆ‘ä¹Ÿæ²¡çœ‹æ‡‚ã€‚äºæ˜¯è‡ªå·±æŠ½æ—¶é—´æœé›†äº†ç½‘ä¸Šçš„ä¸€äº›èµ„æ–™ï¼Œæ•´ç†å¦‚ä¸‹ï¼š</p>
<p>pythonä¸­çš„<code>context manager</code>ä¹Ÿå«åšä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ç¡®ä¿ä»£ç å—å§‹ç»ˆèƒ½å¤Ÿå¾—åˆ°æ­£ç¡®çš„â€˜å–„åâ€™å¤„ç†ã€‚æœ‰ç‚¹åƒjavaä¸­çš„<code>try     ... catch     ... finally     ...</code></p>
<p>å¯¹äºæ‰“å¼€æ–‡ä»¶è¯»å†™ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ä¸‹é¢çš„å®ç°æ–¹å¼æ›´å¥½ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> open(<span class="string">'file'</span>) <span class="keyword">as</span> f:</div><div class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</div><div class="line">    	print(line)</div></pre></td></tr></table></figure>
<p>ä½†è¿™ç§æ–¹å¼ä¸ºä»€ä¹ˆæ›´å¥½å‘¢ï¼ŸåŸå› åœ¨äºä½¿ç”¨<code>with</code>å¯ä»¥æ‰§è¡Œ<code>context manager</code>çš„ç›¸åº”å‡½æ•°ï¼Œç¡®ä¿è¢«æ‰“å¼€çš„æ–‡ä»¶å§‹ç»ˆèƒ½å¤Ÿè¢«å…³é—­ã€‚å¦‚æœæˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨<code>open()</code>ã€<code>close()</code>åˆ™å¯èƒ½ä¼šå› ä¸ºä¸­é—´ä»£ç äº§ç”Ÿçš„å¼‚å¸¸å¯¼è‡´<code>close()</code>æ— æ³•æ‰§è¡Œã€‚å› æ­¤ä½¿ç”¨<code>with</code>å¯ä»¥è®©ä»£ç æ—¢ç®€æ´åˆæœ‰æ•ˆã€‚</p>
<p>ä¸‹é¢æ¥ç€è¯´ä¸€è¯´<code>context manager</code>çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚</p>
<h3 id="ç®¡ç†èµ„æº"><a href="#ç®¡ç†èµ„æº" class="headerlink" title="ç®¡ç†èµ„æº"></a>ç®¡ç†èµ„æº</h3><p><code>context manager</code>æœ€å¸¸è¢«ç”¨äºç®¡ç†èµ„æºï¼Œäº‹å®ä¸Šï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä½¿ç”¨å®ƒçš„åŸå› ã€‚</p>
<p>å½“æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œç¨‹åºä¼šå æœ‰å¯¹åº”çš„èµ„æºï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰ï¼Œè€Œèµ„æºçš„ç®¡ç†åˆ™ç”±æ“ä½œç³»ç»Ÿæ¥å®Œæˆï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€æ—¶é—´èƒ½å¤Ÿæ‰“å¼€çš„æ–‡ä»¶æˆ–è¿›ç¨‹æ˜¯æœ‰é™çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¿è¡Œä¸‹é¢è¿™ä»½ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">files = []</div><div class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">100000</span>):</div><div class="line">    files.append(open(<span class="string">'foo.txt'</span>, <span class="string">'w'</span>))</div></pre></td></tr></table></figure>
<p>åœ¨mac osæˆ–linuxä¸Šè¿è¡Œè¿™ä»½ä»£ç å¾ˆæœ‰å¯èƒ½ä¼šäº§ç”ŸOSErrorè€Œå¯¼è‡´ä¸­æ–­ï¼Œè€Œåœ¨windowsä¸Šè¿è¡Œç¨‹åºåˆ™å¯èƒ½å¯¼è‡´ç³»ç»Ÿç›´æ¥å¡æ­»ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ç­”ï¼šæ˜¯<em>å†…å­˜æ³„éœ²ï¼</em> è¿™é‡Œçš„æ³„éœ²åŸå› æ˜¯æŒ‡æ‰“å¼€æ–‡ä»¶åä½†æœªå…³é—­ã€‚</p>
<p>ä¸ºäº†é¿å…å¯¹æ–‡ä»¶æ“ä½œæ—¶äº§ç”Ÿä¸Šè¿°çš„é”™è¯¯ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼š</p>
<blockquote>
<p>1ã€é¿å…åŒæ—¶æ‰“å¼€è¶…è¿‡æ“ä½œç³»ç»Ÿä¸Šé™ä¸ªæ•°ä¸ªæ–‡ä»¶ï¼›</p>
<p>2ã€æ¯æ¬¡æ‰“å¼€æ–‡ä»¶åå…³é—­æ–‡ä»¶ï¼›</p>
</blockquote>
<p>æ¯«æ— ç–‘é—®ï¼Œè¿™é‡Œ2çš„æ“ä½œæ›´å¥½ï¼Œå› ä¸ºèƒ½å¤Ÿæ›´å¥½åœ°å®ç°é«˜å±‚æŠ½è±¡å¹¶è§£å†³å†…å­˜æ³„éœ²é—®é¢˜ã€‚</p>
<p>å…ˆè¯´1ï¼šåœ¨unixä¸Š<code>ulimit -n</code>å¯ä»¥æŸ¥çœ‹åŒæ—¶æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦ä¸Šé™ï¼Œåœ¨å†™ä»£ç æ—¶ç¡®ä¿åŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æ•°ä¸è¶…è¿‡ä¸Šé™å€¼å³å¯ã€‚ä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰è§£å†³æ ¹æœ¬é—®é¢˜ï¼šå†…å­˜æ³„éœ²ï¼</p>
<p>å†è¯´2ï¼šæˆ‘ä»¬å½“ç„¶å¯ä»¥ä¸ºä¸Šé¢çš„ä»£ç æ·»åŠ close()å‡½æ•°ï¼Œå¯æ˜¯å¦‚æœæ‰“å¼€æ–‡ä»¶æˆ–è€…å¯¹æ–‡ä»¶å†…å®¹å¤„ç†æ—¶äº§ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆåé¢çš„<code>close()</code>å°±æ— æ³•è¢«æ‰§è¡Œï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚</p>
<p><code>context manager</code>æ­£æ˜¯ç”¨äºå¤„ç†è¿™ç§æƒ…å†µçš„ä¸€ä¸ªæ¥å£ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> something_that_returns_a_context_manager() <span class="keyword">as</span> my_resource:</div><div class="line">    do_something(my_resource)</div><div class="line">    ...</div><div class="line">    print(<span class="string">'done using my_resource'</span>)</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>with</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ“ä½œä»»ä½•ä¸€ä¸ªè¿”å›ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„å‡½æ•°ï¼ˆä¾‹å¦‚å†…ç½®å‡½æ•°<code>open()</code>ï¼‰ï¼›<code>with</code>èƒ½å¤Ÿä¿è¯å½“ç›¸åº”ä»£ç å—å†…çš„ä»£ç æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œå§‹ç»ˆè°ƒç”¨ä¸€ä¸ªåŒ…å«æ¸…ç†èµ„æºçš„â€˜å–„åâ€™å‡½æ•°ã€‚è¿™ä¸ªâ€˜å–„åâ€™å‡½æ•°å°±å®šä¹‰åœ¨<code>context manager</code>ä¸­ã€‚</p>
<p>å®ç°ä¸€ä¸ªæœ€ç®€å•çš„context manageråªè¦æ±‚åŒ…å«<code>__enter__()</code>å‡½æ•°ä»¥åŠ<code>__exit__()</code>ã€‚</p>
<blockquote>
<p><code>__enter__()</code>æ‰§è¡Œæ“ä½œå¹¶è¿”å›è¢«ç®¡ç†çš„èµ„æºï¼›</p>
<p><code>__exit__()</code>åˆ™æ¸…ç†èµ„æºï¼Œæ— è¿”å›ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„<code>context manager</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span><span class="params">()</span>:</span></div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, filename, mode)</span>:</span></div><div class="line">        self.filename = filename</div><div class="line">        self.mode = mode</div><div class="line">        </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></div><div class="line">        self.open_file = open(self.filename, self.mode)</div><div class="line">        <span class="keyword">return</span> self.open_file</div><div class="line">        </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self)</span>:</span></div><div class="line">        self.open_file.close()</div><div class="line">        </div><div class="line">files = []</div><div class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">100000</span>):</div><div class="line">    <span class="keyword">with</span> File(<span class="string">'foo.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</div><div class="line">        files.append(f.write(<span class="string">'foo'</span>))</div></pre></td></tr></table></figure>
<p>è¿™é‡Œ<code>__enter__()</code>æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶è¿”å›ï¼›<code>__exit__()</code>åˆ™å…³é—­æ–‡ä»¶ã€‚</p>
<h3 id="å…¶ä»–æœ‰ç”¨çš„èµ„æºç®¡ç†å™¨"><a href="#å…¶ä»–æœ‰ç”¨çš„èµ„æºç®¡ç†å™¨" class="headerlink" title="å…¶ä»–æœ‰ç”¨çš„èµ„æºç®¡ç†å™¨"></a>å…¶ä»–æœ‰ç”¨çš„èµ„æºç®¡ç†å™¨</h3><p>å¾ˆå¤šåº“ä¸­ä¹ŸåŒ…å«èµ„æºç®¡ç†å™¨ï¼Œä¾‹å¦‚<code>zipfile.ZipFile</code>ã€<code>subprocess.Popen</code>ã€<code>tarfile.TarFile</code>ã€<code>telnet.Telnet</code>ã€<code>pathlib.Path</code>ç­‰ã€‚å…¶å®ï¼Œåœ¨ä½¿ç”¨å®Œèµ„æºä¹‹åè°ƒç”¨<code>close()</code>æ–¹æ³•çš„éƒ½æ˜¯<code>context manager</code>ã€‚</p>
<h3 id="å…³äºcontextlib"><a href="#å…³äºcontextlib" class="headerlink" title="å…³äºcontextlib"></a>å…³äº<code>contextlib</code></h3><p><code>contextlib</code>æ¨¡å—åŒ…å«äº†è®¸å¤šåˆ›å»ºã€ä½¿ç”¨<code>context manager</code>çš„å·¥å…·ã€‚</p>
<p>ä¾‹å¦‚ä½¿ç”¨<code>@contextmanager</code>è£…é¥°å™¨æ¥åˆ›å»ºä¸€ä¸ª<code>context manager</code>ã€‚å…·ä½“çš„åˆ›å»ºæ–¹æ³•æ˜¯ä½¿ç”¨<code>@contextmanager</code>æ¥è£…é¥°åªåŒ…å«ä¸€ä¸ª<code>yield</code>è¯­å¥çš„<code>generator</code>å‡½æ•°ã€‚åœ¨<code>yield</code>ä¹‹å‰çš„éƒ¨åˆ†éƒ½è¢«è§†ä¸º<code>__enter__()</code>å‡½æ•°å†…å®¹ï¼Œè€Œä¹‹åçš„éƒ¨åˆ†åˆ™æ˜¯<code>__exit__()</code>å‡½æ•°å†…å®¹ã€‚ä¸‹é¢è®©æˆ‘ä»¬ç”¨è¿™ç§æ–¹æ³•æ¥é‡å†™<code>File()</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</div><div class="line"></div><div class="line"><span class="meta">@contextmanager</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">open_file</span><span class="params">(path, mode)</span>:</span></div><div class="line">    the_file = open(path, mode)</div><div class="line">    <span class="keyword">yield</span> the_file</div><div class="line">    the_file.close()</div><div class="line">    </div><div class="line">files = []</div><div class="line"></div><div class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">100000</span>):</div><div class="line">    <span class="keyword">with</span> open_file(<span class="string">'foo.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</div><div class="line">        files.append(f)</div></pre></td></tr></table></figure>
<p>å¯¹æ¯”åå¯ä»¥å‘ç°ä½¿ç”¨è¿™ç§æ–¹æ³•çš„ä»£ç æ›´åŠ ç®€æ´ã€‚</p>
<p>å¦å¤–æœ‰ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­å¯ä»¥å¸®åŠ©ä½ ç†è§£<code>@contextmanager</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</div><div class="line"></div><div class="line"><span class="meta">@contextmanager</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">tag</span><span class="params">(name)</span>:</span></div><div class="line">    print(<span class="string">"&lt;%s&gt;"</span> % name)</div><div class="line">    <span class="keyword">yield</span></div><div class="line">    print(<span class="string">"&lt;/%s&gt;"</span> % name)</div><div class="line">    </div><div class="line"><span class="keyword">with</span> tag(<span class="string">"h1"</span>):</div><div class="line">    print(<span class="string">"hello, world!"</span>)</div></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š<code>&lt;h1&gt;hello, world!&lt;/h1&gt;</code></p>
<p>å¦å¤–ä¹Ÿå¯ä»¥é€šè¿‡<code>contextlib.ContextDecorator</code>æ¥å®ç°è‡ªå·±çš„<code>context manager</code>è£…é¥°å™¨ã€‚ä¾‹å¦‚æ¥ç€ä½¿ç”¨ä¸Šé¢çš„ä¾‹å­æ¥è¯´æ˜ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> ContextDecorator</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">makeparagraph</span><span class="params">(ContextDecorator)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">'&lt;p&gt;'</span>)</div><div class="line">        <span class="keyword">return</span> self</div><div class="line">        </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, *exc)</span>:</span></div><div class="line">        print(<span class="string">'&lt;/p&gt;'</span>)</div><div class="line">        <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">        </div><div class="line"><span class="meta">@makeparagraph</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">emit_html</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">'Here is some non-HTML'</span>)</div></pre></td></tr></table></figure>
<p>æ‰§è¡Œ<code>emit_html()</code><br>ä¼šè¾“å‡º<code>&lt;p&gt;Here is some non-HTML&lt;/p&gt;</code></p>
<h3 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h3><blockquote>
<ul>
<li><p><a href="https://www.python.org/dev/peps/pep-0343/" target="_blank" rel="external">PEP 34</a></p>
</li>
<li><p><a href="https://jeffknupp.com/blog/2016/03/07/python-with-context-managers/" target="_blank" rel="external">Python with Context Managers</a></p>
</li>
</ul>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘åœ¨è¯»pythonè¿›é˜¶ç±»ä¹¦ç±ã€ŠIntermediate Pythonã€‹ï¼Œçœ‹åˆ°åé¢æœ‰ä¸€ç« è®²åˆ°&lt;code&gt;context manager&lt;/code&gt;ï¼Œè®²çš„å¾ˆæµ…ï¼Œæˆ‘ä¹Ÿæ²¡çœ‹æ‡‚ã€‚äºæ˜¯è‡ªå·±æŠ½æ—¶é—´æœé›†äº†ç½‘ä¸Šçš„ä¸€äº›èµ„æ–™ï¼Œæ•´ç†å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;pythonä¸­çš„&lt;code&gt;contex
    
    </summary>
    
      <category term="coding" scheme="http://blog.yinwoods.work/categories/coding/"/>
    
    
      <category term="python" scheme="http://blog.yinwoods.work/tags/python/"/>
    
  </entry>
  
</feed>
