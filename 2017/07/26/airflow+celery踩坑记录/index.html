<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="yinwoods,yinwoods#163.com"><title>airflow + celery è¸©å‘è®°å½• Â· yinwoods</title><meta name="description" content="åˆè¯† airflowå…¶å®æ—©åœ¨å»å¹´å°±å·²ç»æ¥è§¦åˆ° airflow äº†ï¼Œå½“æ—¶çš„éœ€æ±‚æ˜¯æŒ‰å°æ—¶æ‹¼æ¥ä¸¤ä»½çº¿ä¸Šæ—¥å¿—ï¼Œè€Œæ‹¼æ¥æ“ä½œå¿…é¡»ä¾èµ–äºä¸¤ä»½æ—¥å¿—çš„å®Œæ•´æ€§ã€‚ä»è¿™ä¸ªéœ€æ±‚å‡ºå‘ï¼Œäº†è§£åˆ°äº† airflow ï¼Œä½†è¿«äºå®˜æ–¹æ–‡æ¡£çš„æ™¦æ¶©éš¾æ‡‚ï¼Œå†åŠ ä¸Šè¿™ä¸ªä»»åŠ¡å¯¹ airflow çš„éœ€æ±‚ä¸å¤Ÿå¼ºï¼Œå°±å¼ƒå‘äº†ï¼›æœ€åä½¿ç”¨ python è„šæœ¬ä¸­ä¸€"><meta name="keywords" content="Hexo,Linux,Python"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">yinwoods</a></h3><div class="description"><p>To Be A Better Man!ğŸ˜ˆ</p></div></div></div><ul class="social-links"><li><a href="http://weibo.com/yinwoods"><i class="fa fa-weibo"></i></a></li><li><a href="http://facebook.com/yinwoods"><i class="fa fa-facebook"></i></a></li><li><a href="http://github.com/yinwoods"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">é¦–é¡µ</a></li><li><a href="/archives">å½’æ¡£</a></li><li><a href="/links">å‹é“¾</a></li><li><a href="/about">å…³äº</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>airflow + celery è¸©å‘è®°å½•</a></h3></div><div class="post-content"><h3 id="åˆè¯†-airflow"><a href="#åˆè¯†-airflow" class="headerlink" title="åˆè¯† airflow"></a>åˆè¯† <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a></h3><p>å…¶å®æ—©åœ¨å»å¹´å°±å·²ç»æ¥è§¦åˆ° <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> äº†ï¼Œå½“æ—¶çš„éœ€æ±‚æ˜¯æŒ‰å°æ—¶æ‹¼æ¥ä¸¤ä»½çº¿ä¸Šæ—¥å¿—ï¼Œè€Œæ‹¼æ¥æ“ä½œå¿…é¡»ä¾èµ–äºä¸¤ä»½æ—¥å¿—çš„å®Œæ•´æ€§ã€‚ä»è¿™ä¸ªéœ€æ±‚å‡ºå‘ï¼Œäº†è§£åˆ°äº† <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ï¼Œä½†è¿«äºå®˜æ–¹æ–‡æ¡£çš„æ™¦æ¶©éš¾æ‡‚ï¼Œå†åŠ ä¸Šè¿™ä¸ªä»»åŠ¡å¯¹ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> çš„éœ€æ±‚ä¸å¤Ÿå¼ºï¼Œå°±å¼ƒå‘äº†ï¼›æœ€åä½¿ç”¨ python è„šæœ¬ä¸­ä¸€ä¸ª while True æ­»å¾ªç¯ + time.sleep() æ¥è§£å†³é—®é¢˜(å¦‚æœæ‰€ä¾èµ–çš„æ—¥å¿—æ²¡æœ‰å®Œå…¨å†™å…¥ï¼Œåˆ™ sleep ä¸€æ®µæ—¶é—´)ã€‚</p>
<h3 id="æ­£å¼å…¥å‘"><a href="#æ­£å¼å…¥å‘" class="headerlink" title="æ­£å¼å…¥å‘"></a>æ­£å¼å…¥å‘</h3><p>å‰å‡ å¤© boss å¸ƒç½®äº†ä¸€ä¸ªå¹¿å‘Šå¹³å°çš„ç»Ÿè®¡ä»»åŠ¡ï¼Œä¾èµ–å€’ä¹Ÿä¸å¤æ‚ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æœªæ¥å¹³å°çš„æ‰©å±•æ€§ï¼Œè¿˜æ˜¯éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿå¾ˆå¥½çš„å¤„ç†ç»Ÿè®¡ä»»åŠ¡çš„å·¥å…·çš„ã€‚è‡ªå·±ä¹Ÿè°ƒç ”æ¯”è¾ƒäº†ä¸€ä¸‹<code>ETL(æ•°æ®ä»“åº“)</code>è¿™æ–¹é¢çš„å·¥å…·ï¼Œç¡®å®æ•° <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> åŠŸèƒ½æœ€ä¸ºå¼ºå¤§ï¼Œæ—¢ç„¶è¿™æ ·é‚£å°±å…¥å‘å§ã€‚</p>
<h3 id="airflow-å®‰è£…é…ç½®è¿‡ç¨‹"><a href="#airflow-å®‰è£…é…ç½®è¿‡ç¨‹" class="headerlink" title="airflow å®‰è£…é…ç½®è¿‡ç¨‹"></a><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> å®‰è£…é…ç½®è¿‡ç¨‹</h3><p>è¿™é‡Œéƒ½æ˜¯æŒ‰ç…§å®˜ç½‘æ“ä½œï¼Œå…·ä½“å¦‚ä¸‹:</p>
<p>1ã€è®¾ç½® <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> é¡¹ç›®è·¯å¾„ï¼Œé»˜è®¤æ˜¯ç”¨æˆ·ä¸»ç›®å½•ä¸‹ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ï¼Œä¹Ÿå¯ä»¥æ˜¾ç¤ºç”¨ç¯å¢ƒå˜é‡ <code>AIRFLOW_HOME</code> æŒ‡å®š;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> AIRFLOW_HOME=~/airflow</div></pre></td></tr></table></figure>
<p>2ã€<a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> å®‰è£…ï¼Œå› ä¸º <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> æ˜¯åŸºäº python ç¼–å†™ï¼Œå› æ­¤å¯ä»¥ç›´æ¥åˆ©ç”¨ pip å®‰è£…ï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> è¿˜æä¾›äº†ä½¿ç”¨å…¶ä»–è½¯ä»¶çš„æ’ä»¶ï¼Œä¾‹å¦‚ mysqlã€hdfsã€hive ç­‰å·¥å…·ï¼Œå½“ç„¶è¿™äº›ä¹Ÿå¯ä»¥åœ¨åç»­éœ€è¦æ—¶å†å®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pip3 install airflow</div><div class="line"></div><div class="line"><span class="comment"># å®‰è£… [airflow](https://github.com/apache/incubator-airflow) hive æ’ä»¶</span></div><div class="line">pip3 install <span class="string">"airflow[hive]"</span></div></pre></td></tr></table></figure>
<p>3ã€åˆå§‹åŒ– <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ç›¸å…³æ•°æ®åº“</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">airflow initdb</div></pre></td></tr></table></figure>
<p>4ã€å¯åŠ¨ webserver æœåŠ¡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">airflow webserver</div></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œä¸€ä¸ªæœ€åŸºç¡€çš„ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> æœåŠ¡å°±å¯åŠ¨äº†ï¼Œä¸‹é¢è¯´ä¸€è¯´ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> çš„é…ç½®ã€‚</p>
<h3 id="airflow-åŸºç¡€é…ç½®"><a href="#airflow-åŸºç¡€é…ç½®" class="headerlink" title="airflow åŸºç¡€é…ç½®"></a><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> åŸºç¡€é…ç½®</h3><p><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> çš„é…ç½®æ–‡ä»¶ä¿å­˜åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œå‘½åä¸º airflow.cfg ï¼Œé€šè¿‡æ–‡ä»¶å†…çš„æ³¨é‡Šä¹Ÿå¯ä»¥çŸ¥é“æ¯ä¸ªé…ç½®é¡¹çš„å¤§è‡´å«ä¹‰ï¼Œè¿™é‡Œç®€å•è¯´ä¸‹å¸¸ç”¨çš„é…ç½®é¡¹ã€‚</p>
<h4 id="æ›´æ”¹æ•°æ®åº“"><a href="#æ›´æ”¹æ•°æ®åº“" class="headerlink" title="æ›´æ”¹æ•°æ®åº“"></a>æ›´æ”¹æ•°æ®åº“</h4><p><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ä¸ºäº†èƒ½å¤Ÿè®©ç”¨æˆ·å¿«é€Ÿä½¿ç”¨é€‰æ‹©äº† sqllite æ•°æ®åº“ï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¾€å¾€ mysql æ›´ä¸ºå¹¿æ³›ä½¿ç”¨ï¼Œè‹¥è¦ä½¿ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ä½¿ç”¨ mysql ï¼Œé¦–å…ˆæ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip3 install <span class="string">"airflow[mysql]"</span></div></pre></td></tr></table></figure>
<p>æ›´æ”¹ airflow.cfg ä¸­ <code>sql_alchemy_conn</code> çš„å€¼ï¼Œé€šè¿‡å˜é‡åå¯çŸ¥é…ç½®ä½¿ç”¨çš„æ˜¯ <a href="https://www.sqlalchemy.org/" target="_blank" rel="external">sql_alchemy</a> çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œå…·ä½“æ ¼å¼ä¸ºï¼š<code>mysql+pymysql://username:password@host:port/database</code>ï¼Œå½“ç„¶è¿™é‡Œ <a href="https://github.com/PyMySQL/PyMySQL" target="_blank" rel="external">pymysql</a> å¯ä»¥æ ¹æ®è‡ªå·±å–œå¥½æ›´æ¢ã€‚</p>
<p>ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åï¼Œéœ€è¦æ‰§è¡Œ <code>airflow resetdb</code> å¹¶é‡æ–°å¯åŠ¨ web æœåŠ¡(<code>airflow webserver</code>)ï¼Œæ•°æ®åº“æ›´æ¢åˆ™ç”Ÿæ•ˆã€‚</p>
<h4 id="ä¸ºwebæœåŠ¡å¼€å¯ç”¨æˆ·èº«ä»½éªŒè¯åŠŸèƒ½"><a href="#ä¸ºwebæœåŠ¡å¼€å¯ç”¨æˆ·èº«ä»½éªŒè¯åŠŸèƒ½" class="headerlink" title="ä¸ºwebæœåŠ¡å¼€å¯ç”¨æˆ·èº«ä»½éªŒè¯åŠŸèƒ½"></a>ä¸ºwebæœåŠ¡å¼€å¯ç”¨æˆ·èº«ä»½éªŒè¯åŠŸèƒ½</h4><p><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> é»˜è®¤æ˜¯æ— éœ€ç™»å½•å³å¯è®¿é—®ä½¿ç”¨çš„ï¼Œè€Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºäº†æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œéœ€è¦å¼€å¯ç”¨æˆ·èº«ä»½éªŒè¯åŠŸèƒ½ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[webserver]</div><div class="line"><span class="comment"># å¼€å¯ç”¨æˆ·èº«ä»½éªŒè¯</span></div><div class="line">authenticate = True</div><div class="line"></div><div class="line"><span class="comment"># æ ¹æ®ç”¨æˆ·æ˜¾ç¤ºdagåˆ—è¡¨(ä¾èµ–äºç”¨æˆ·èº«ä»½éªŒè¯çš„å¼€å¯)</span></div><div class="line">filter_by_owner = False</div></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¼€å¯äº†ç”¨æˆ·èº«ä»½éªŒè¯çš„åŠŸèƒ½ï¼Œä½†ç³»ç»Ÿè¿˜æ²¡æœ‰é»˜è®¤ç”¨æˆ·ï¼Œéœ€è¦è‡ªè¡Œæ‰‹åŠ¨æ·»åŠ ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥æ’å…¥é»˜è®¤ç”¨æˆ·ä¿¡æ¯åˆ°æ•°æ®åº“å¯¹åº”çš„ users è¡¨ä¸­(ä¸æ¨è);å¦ä¸€ç§åˆ™æ˜¯é€šè¿‡ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> æä¾›çš„åŠŸèƒ½æ¥æ·»åŠ ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p>
<p>æ‰“å¼€ipythonï¼Œæ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> airflow</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> airflow <span class="keyword">import</span> models, settings</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> airflow.contrib.auth.backends.password_auth <span class="keyword">import</span> PasswordUser</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>user = PasswordUser(models.User())</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>user.username = <span class="string">'new_user_name'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>user.email = <span class="string">'new_user_email@example.com'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>user.password = <span class="string">'set_the_password'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>session = settings.Session()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>session.add(user)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>session.commit()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>session.close()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>exit()</div></pre></td></tr></table></figure>
<p>é‡å¯ web æœåŠ¡( <code>airflow webserver</code> )ï¼Œåˆ·æ–°ç½‘å€æµè§ˆå™¨ä¼šè‡ªåŠ¨è·³è½¬åˆ°ç”¨æˆ·ç™»å½•é¡µé¢ã€‚</p>
<h3 id="é…ç½®-airflow-Celery"><a href="#é…ç½®-airflow-Celery" class="headerlink" title="é…ç½® airflow + Celery"></a>é…ç½® <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> + <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a></h3><p><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> æä¾›äº†ä¸‰ç§ Executor ï¼Œåˆ†åˆ«æ˜¯ <code>SequentialExecutor</code>ã€<code>LocalExecutor</code> ä»¥åŠ <code>CeleryExecutor</code>ï¼›<a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> é…ç½®æ–‡ä»¶ä¸­ï¼Œé»˜è®¤çš„æ‰§è¡Œæ–¹å¼æ˜¯(<code>SequentialExecutor</code>)ï¼Œè¿™ä¸‰è€…çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>SequentialExecutor</code>: å•è¿›ç¨‹é¡ºåºæ‰§è¡Œï¼Œé€šå¸¸åªç”¨äºæµ‹è¯•</li>
<li><code>LocalExecutor</code>: å¤šè¿›ç¨‹æœ¬åœ°æ‰§è¡Œï¼Œä½¿ç”¨pythonçš„å¤šè¿›ç¨‹åº“è¾¾åˆ°å¤šè¿›ç¨‹æ‰§è¡Œç›®çš„</li>
<li><code>CeleryExecutor</code>: ä½¿ç”¨<a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> ä½œä¸ºæ‰§è¡Œå™¨ï¼Œé…ç½® <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> åå¯ä»¥åˆ©ç”¨é›†ç¾¤åˆ†å¸ƒå¼æ‰§è¡Œä»»åŠ¡</li>
</ul>
<p>åœ¨è¿™é‡Œæˆ‘é€‰ç”¨äº†<a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a>ï¼ŒåŒæ ·æ˜¯ä¸ºäº† <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> æœªæ¥çš„å¯æ‰©å±•æ€§ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°ä½¿ç”¨ <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> æ—¶ï¼Œåç«¯æœåŠ¡å¯ä»¥ä½¿ç”¨ <a href="https://www.rabbitmq.com/" target="_blank" rel="external">RabbitMQ</a> æˆ– <a href="https://redis.io/" target="_blank" rel="external">Redis</a> ï¼Œç›¸å¯¹æ¥è¯´è‡ªå·±å¯¹ redis ç†Ÿæ‚‰ä¸€äº›ï¼Œä½†æ®æˆ‘æ‰€çŸ¥ <a href="https://redis.io/" target="_blank" rel="external">Redis</a> ç›¸å¯¹æ¥è¯´æ¯”è¾ƒåƒå†…å­˜ï¼Œå› æ­¤åœ¨è¿™é‡Œé€‰ç”¨äº† <a href="https://www.rabbitmq.com/" target="_blank" rel="external">RabbitMQ</a> ã€‚å…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p>
<h4 id="å®‰è£…-RabbitMQ"><a href="#å®‰è£…-RabbitMQ" class="headerlink" title="å®‰è£… RabbitMQ"></a>å®‰è£… <a href="https://www.rabbitmq.com/" target="_blank" rel="external">RabbitMQ</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Ubuntu 17.04</span></div><div class="line">sudo apt install erlang rabbitmq-server</div></pre></td></tr></table></figure>
<h4 id="RabbitMQ-æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¯†ç "><a href="#RabbitMQ-æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¯†ç " class="headerlink" title="RabbitMQ æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¯†ç "></a><a href="https://www.rabbitmq.com/" target="_blank" rel="external">RabbitMQ</a> æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¯†ç </h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Ubuntu 17.04</span></div><div class="line">sudo rabbitmqctl add_user airflow airflow</div><div class="line">sudo rabbitmqctl add_vhost airflow</div><div class="line">sudo rabbitmqctl set_user_tags airflow airflow</div><div class="line">sudo rabbitmqctl set_permissions -p airflow airflow <span class="string">".*"</span> <span class="string">".*"</span> <span class="string">".*"</span></div><div class="line">sudo rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</div></pre></td></tr></table></figure>
<p>æ›´æ”¹é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># transport://userid:password@hostname:port/virtual_host</span></div><div class="line">broker_url = amqp://ariflow:airflow@localhost:5672/airflow</div><div class="line">celery_result_backend = amqp://airflow:airflow@localhost:5672/airflow</div></pre></td></tr></table></figure>
<p>è‡³æ­¤ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> + <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> é…ç½®å®Œæˆï¼Œæ¥ä¸‹æ¥è¯´è¯´å¦‚ä½•å¯åŠ¨æœåŠ¡</p>
<h3 id="å¯åŠ¨-Airflow-Celery-æœåŠ¡"><a href="#å¯åŠ¨-Airflow-Celery-æœåŠ¡" class="headerlink" title="å¯åŠ¨ Airflow + Celery æœåŠ¡"></a>å¯åŠ¨ Airflow + Celery æœåŠ¡</h3><p>ä¸€å…±æœ‰å››ä¸ªæœåŠ¡ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><code>airflow webserver</code> æœåŠ¡</li>
<li><code>airflow flower</code> <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> ç®¡ç†ç•Œé¢</li>
<li><code>airflow worker</code> <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> Worker</li>
<li><code>airflow scheduler</code> è°ƒåº¦å™¨</li>
</ul>
<h4 id="å¯åŠ¨-airflow-webserver-æœåŠ¡"><a href="#å¯åŠ¨-airflow-webserver-æœåŠ¡" class="headerlink" title="å¯åŠ¨ airflow webserver æœåŠ¡"></a>å¯åŠ¨ <code>airflow webserver</code> æœåŠ¡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">airflow webserver</div></pre></td></tr></table></figure>
<h4 id="å¯åŠ¨airflow-flower"><a href="#å¯åŠ¨airflow-flower" class="headerlink" title="å¯åŠ¨airflow flower"></a>å¯åŠ¨<a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> flower</h4><p><code>airflow flower</code> æ˜¯ä¸€ä¸ªç›‘æ§ <a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> åˆ†å¸ƒå¼é˜Ÿåˆ—çš„ web æœåŠ¡ï¼Œé€šè¿‡å®ƒå¯ä»¥çœ‹åˆ° <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> dag ä¸­task çš„æ‰§è¡ŒçŠ¶å†µã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">airflow flower</div></pre></td></tr></table></figure>
<h4 id="å¯åŠ¨-airflow-worker"><a href="#å¯åŠ¨-airflow-worker" class="headerlink" title="å¯åŠ¨ airflow worker"></a>å¯åŠ¨ <code>airflow worker</code></h4><p><a href="http://www.celeryproject.org/" target="_blank" rel="external">Celery</a> çš„ workerï¼Œç”¨äºæ‰§è¡Œ dag ä¸­å…·ä½“çš„ task</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">airflow worker</div></pre></td></tr></table></figure>
<h4 id="å¯åŠ¨-airflow-scheduler"><a href="#å¯åŠ¨-airflow-scheduler" class="headerlink" title="å¯åŠ¨ airflow scheduler"></a>å¯åŠ¨ <code>airflow scheduler</code></h4><p><code>airflow scheduler</code> ç”¨äºå¯åŠ¨è°ƒåº¦å™¨ï¼Œå®Œæˆå¯¹ dag ä¸­ task çš„è°ƒåº¦ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">airflow scheduler</div></pre></td></tr></table></figure>
<h3 id="airflow-ç®€å•ç¤ºä¾‹"><a href="#airflow-ç®€å•ç¤ºä¾‹" class="headerlink" title="airflow ç®€å•ç¤ºä¾‹"></a><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ç®€å•ç¤ºä¾‹</h3><p>ç¯å¢ƒå·²ç»æ­å¥½ï¼Œç°åœ¨å†™ä¸ª dag æ¥æµ‹è¯•ä¸€ä¸‹ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> å§ã€‚åœ¨å…·ä½“çš„ä»£ç å±•ç°ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸€ä¸‹ä¸Šæ–‡å·²ç»å‡ºç°å¤šæ¬¡çš„ dag è¿™ä¸ªæ¦‚å¿µï¼Œdag å¯¹äºç†Ÿæ‚‰å›¾è®ºçš„åŒå­¦ä¸€å®šä¸é™Œç”Ÿï¼Œä¹Ÿå³ <code>(Directed Acyclic Graph, DAG)</code> ï¼Œä¸ºä»€ä¹ˆå«æœ‰å‘æ— ç¯å›¾å‘¢ï¼Œå› ä¸ºä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å°±æ˜¯ä¸€ä¸ª DAG ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="/images/dag.png" alt="DAG">ã€‚</p>
<p><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ä¼šé»˜è®¤è¯»å– <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ç›®å½•ä¸‹ dags ä¸­çš„æ‰€æœ‰ python æ–‡ä»¶ä½œä¸º dag ï¼Œå› æ­¤æˆ‘ä»¬æ–°å»ºä¸€ä¸ª dags ç›®å½•ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç å†™å…¥ <code>dags/test.py</code> ä¸­ï¼Œä¸ºäº†èƒ½å¤Ÿæ–¹ä¾¿çœ‹åˆ° dag æµ‹è¯•æˆåŠŸä¸å¦ï¼Œåœ¨ test.py é‡Œé¢è®¾ç½®äº†æ¯æ¬¡å‘ test ç›®å½•ä¸‹çš„æ–‡ä»¶å†™å…¥æ–°å†…å®¹ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> builtins <span class="keyword">import</span> range</div><div class="line"><span class="keyword">import</span> airflow</div><div class="line"><span class="keyword">from</span> airflow.operators.python_operator <span class="keyword">import</span> PythonOperator</div><div class="line"><span class="keyword">from</span> airflow.models <span class="keyword">import</span> DAG</div><div class="line"></div><div class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</div><div class="line"></div><div class="line">args = &#123;</div><div class="line">    <span class="string">'owner'</span>: <span class="string">'yinwoods'</span>,</div><div class="line">    <span class="string">'start_date'</span>: airflow.utils.dates.datetime(<span class="number">2017</span>, <span class="number">7</span>, <span class="number">27</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">dag = DAG(</div><div class="line">    dag_id=<span class="string">'yinwoods'</span>, default_args=args,</div><div class="line">    schedule_interval=<span class="string">'0 1 * * *'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_write_function</span><span class="params">(random_base)</span>:</span></div><div class="line">    <span class="string">"""This is a function that will run within the DAG execution"""</span></div><div class="line">    <span class="keyword">with</span> open(<span class="string">'~/airflow/test/'</span> + random_base, <span class="string">'a'</span>) <span class="keyword">as</span> f:</div><div class="line">        f.write(random_base[<span class="number">-1</span>] + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_context</span><span class="params">(ds, **kwargs)</span>:</span></div><div class="line">    pprint(kwargs)</div><div class="line">    print(ds)</div><div class="line">    <span class="keyword">return</span> <span class="string">'Whatever you return gets printed in the logs'</span></div><div class="line"></div><div class="line"></div><div class="line">run_this = PythonOperator(</div><div class="line">    task_id=<span class="string">'print_the_context'</span>,</div><div class="line">    provide_context=<span class="keyword">True</span>,</div><div class="line">    python_callable=print_context,</div><div class="line">    op_kwargs=&#123;<span class="string">'test'</span>: <span class="string">'test'</span>&#125;,</div><div class="line">    dag=dag)</div><div class="line"></div><div class="line"><span class="comment"># Generate 10 sleeping tasks, sleeping from 0 to 9 seconds respectively</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</div><div class="line">    task = PythonOperator(</div><div class="line">        task_id=<span class="string">'print_for_'</span> + str(i),</div><div class="line">        python_callable=my_write_function,</div><div class="line">        op_kwargs=&#123;<span class="string">'random_base'</span>: <span class="string">'file_'</span> + str(i)&#125;,</div><div class="line">        dag=dag)</div><div class="line"></div><div class="line">    task.set_upstream(run_this)</div></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä»£ç ä¿å­˜åï¼Œæ‰§è¡Œ <code>python test.py</code> å³å°†è¯¥ dag å¯¼å…¥ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> ä¸­ï¼Œä¹‹åå¯ä»¥é€‰ç”¨ <code>airflow test</code> æˆ– <code>airflow backfill</code> æµ‹è¯•ï¼Œè¿™é‡Œå°±ä¸å†è®²è¿°å…·ä½“ç”¨æ³•ã€‚</p>
<p>å¯åŠ¨ dag æ—¶æ—¢å¯ä»¥ä½¿ç”¨ <code>airflow run dag_id task_id execution_date</code> ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ web ç•Œé¢çš„æ‰§è¡ŒæŒ‰é’®æ‰§è¡Œã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å¯åŠ¨ä¹‹å‰éœ€è¦ <code>airflow unpause dag_id</code> æˆ–åœ¨ web ç•Œé¢å¼€å¯ dag å¯¹åº”çš„æŒ‰é’®ã€‚</p>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥çœ‹åˆ°æ‰§è¡ŒçŠ¶æ€ä»¥åŠç»“æœäº†ã€‚å¦å¤–ä¸‹é¢æä¾›äº†å¦ä¸€ä»½ç¤ºä¾‹ä»£ç ï¼Œæ³¨æ„è§‚å¯Ÿè¿™ä»½ä»£ç ä¸­å®šä¹‰ä»»åŠ¡é—´ä¾èµ–å…³ç³»çš„è¯­å¥:)ï¼Œä¸ªäººè®¤ä¸ºè¿™æ ·çš„è¯­å¥èƒ½å¤Ÿæ›´ç›´è§‚è¡¨æ˜ä»»åŠ¡ä¹‹é—´çš„å…³ç³»ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"><span class="keyword">from</span> [airflow](https://github.com/apache/incubator-airflow) <span class="keyword">import</span> DAG</div><div class="line"><span class="keyword">from</span> airflow.operators.dummy_operator <span class="keyword">import</span> DummyOperator</div><div class="line"><span class="keyword">from</span> airflow.operators.python_operator <span class="keyword">import</span> PythonOperator</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_hello</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> <span class="string">'Hello world!'</span></div><div class="line"></div><div class="line">dag = DAG(<span class="string">'hello_world'</span>, description=<span class="string">'Simple tutorial DAG'</span>,</div><div class="line">          schedule_interval=<span class="string">'0 12 * * *'</span>,</div><div class="line">          start_date=datetime(<span class="number">2017</span>, <span class="number">3</span>, <span class="number">20</span>),</div><div class="line">          catchup=<span class="keyword">False</span>)</div><div class="line"></div><div class="line">dummy_operator = DummyOperator(task_id=<span class="string">'dummy_task'</span>, retries=<span class="number">3</span>, dag=dag)</div><div class="line"></div><div class="line">hello_operator = PythonOperator(task_id=<span class="string">'hello_task'</span>,</div><div class="line">                                python_callable=print_hello, dag=dag)</div><div class="line"></div><div class="line">dummy_operator &gt;&gt; hello_operator</div></pre></td></tr></table></figure>
<p>å¦‚æœæ‰§è¡Œ dag åï¼Œå‘ç° dag ä¸­éƒ¨åˆ† task ä¸€ç›´å¤„äº queue çš„çŠ¶æ€ï¼Œå¯ä»¥æŸ¥çœ‹ <code>airflow scheduler</code> çš„æ‰§è¡ŒçŠ¶æ€ï¼Œå¦‚æœæ˜¯æŒ‚æ‰äº†ï¼Œä¸”é‡å¯ååˆæŒ‚æ‰å¯ä»¥å‚è€ƒä¸‹é¢çš„è§£å†³æ–¹æ³•ã€‚</p>
<h3 id="æ”¹æºç è§£å†³-airflow-scheduler-ä¸­æ–­-bug"><a href="#æ”¹æºç è§£å†³-airflow-scheduler-ä¸­æ–­-bug" class="headerlink" title="æ”¹æºç è§£å†³ airflow scheduler ä¸­æ–­ bug"></a>æ”¹æºç è§£å†³ <code>airflow scheduler</code> ä¸­æ–­ bug</h3><p>æˆ‘åœ¨ä½¿ç”¨ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a>  çš„è¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿäº† <code>airflow scheduler</code> å¯åŠ¨åæ‰§è¡Œç‰‡åˆ»å³è¢«æ–­å¼€è¿æ¥çš„æƒ…å†µï¼Œé€šè¿‡è°·æ­Œæœç´¢ï¼Œæ‰¾åˆ°äº†ä»¥ä¸‹ä¿®æ”¹ <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> æºç çš„è§£å†³æ–¹æ³•ï¼Œè‡³äºè¿™ä¸ªä¸­æ–­bugçš„å…·ä½“åŸå› å°šä¸æ¸…æ¥šã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">--- /usr/local/lib/python3<span class="number">.4</span>/dist-packages/airflow/jobs.py.orig	<span class="number">2017</span><span class="number">-02</span><span class="number">-16</span> <span class="number">11</span>:<span class="number">58</span>:<span class="number">55.057991344</span> +<span class="number">0000</span></div><div class="line">+++ /usr/local/lib/python3<span class="number">.4</span>/dist-packages/airflow/jobs.py	<span class="number">2017</span><span class="number">-02</span><span class="number">-16</span> <span class="number">11</span>:<span class="number">57</span>:<span class="number">07.060060262</span> +<span class="number">0000</span></div><div class="line"><span class="meta">@@ -1371,6 +1371,8 @@</span></div><div class="line">         last_stat_print_time = datetime(<span class="number">2000</span>, <span class="number">1</span>, <span class="number">1</span>)</div><div class="line">         <span class="comment"># Last time that self.heartbeat() was called.</span></div><div class="line">         last_self_heartbeat_time = datetime.now()</div><div class="line">+        <span class="comment"># Last time that self.executor.heartbeat() was called.</span></div><div class="line">+        last_executor_heartbeat_time = datetime.now()</div><div class="line">         <span class="comment"># Last time that the DAG dir was traversed to look for files</span></div><div class="line">         last_dag_dir_refresh_time = datetime.now()</div><div class="line"></div><div class="line"><span class="meta">@@ -1436,9 +1438,14 @@</span></div><div class="line">                 self._execute_task_instances(simple_dag_bag,</div><div class="line">                                              (State.SCHEDULED,))</div><div class="line"></div><div class="line">-            <span class="comment"># Call hearbeats</span></div><div class="line">-            self.logger.info(<span class="string">"Heartbeating the executor"</span>)</div><div class="line">-            self.executor.heartbeat()</div><div class="line">+            <span class="comment"># Heartbeat the executor periodically</span></div><div class="line">+            time_since_last_heartbeat = (datetime.now() -</div><div class="line">+                                         last_executor_heartbeat_time).total_seconds()</div><div class="line">+            <span class="keyword">if</span> time_since_last_heartbeat &gt; self.heartrate:</div><div class="line">+                self.logger.info(<span class="string">"Heartbeating the executor"</span>)</div><div class="line">+                <span class="keyword">try</span>: self.executor.heartbeat()</div><div class="line">+                <span class="keyword">except</span> ConnectionResetError: <span class="keyword">pass</span>  <span class="comment"># RabbitMQ sometimes resets the socket connection</span></div><div class="line">+                last_executor_heartbeat_time = datetime.now()</div><div class="line"></div><div class="line">             <span class="comment"># Process events from the executor</span></div><div class="line">             self._process_executor_events()</div></pre></td></tr></table></figure>
<p><a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> çš„ä»‹ç»ä¸ä½¿ç”¨å°±å…ˆå†™åˆ°è¿™é‡Œï¼Œå¦‚æœè¯»è€…æœ‰ä¸æˆ‘ç±»ä¼¼æˆ–ç›¸åŒçš„é—®é¢˜ï¼Œæ¬¢è¿è¯„è®ºåŒºæ¢è®¨ã€‚</p>
<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul>
<li><a href="https://airflow.incubator.apache.org/" target="_blank" rel="external">Airflow å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="http://morefreeze.github.io/2016/12/airflow.html" target="_blank" rel="external">Airflow ç®€æ˜æŒ‡å—</a></li>
<li><a href="http://blog.genesino.com/2016/05/airflow/#%E9%85%8D%E7%BD%AEceleryexecutor-rabbitmq%E6%94%AF%E6%8C%81" target="_blank" rel="external">Airflow Useage</a></li>
<li><a href="https://issues.apache.org/jira/browse/AIRFLOW-342" target="_blank" rel="external">Exception in <a href="https://github.com/apache/incubator-airflow" target="_blank" rel="external">airflow</a> scheduler: Connection reset by peer</a></li>
</ul>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-07-26</span><i class="fa fa-comment-o"></i><a href="/2017/07/26/airflow+celeryè¸©å‘è®°å½•/#comments">è¯„è®º</a><i class="fa fa-tag"></i><a href="/categories/coding/" title="coding" class="tag">coding </a><a href="/tags/python-airflow-celery/" title="python, airflow, celery" class="tag">python, airflow, celery </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://blog.yinwoods.work/2017/07/26/airflow+celeryè¸©å‘è®°å½•/,yinwoods,airflow + celery è¸©å‘è®°å½•,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2017/08/02/druidå†…å­˜å ç”¨è¿‡å¤šé—®é¢˜æ’æŸ¥/" title="druidå†…å­˜å ç”¨è¿‡å¤šé—®é¢˜æ’æŸ¥" class="btn">ä¸Šä¸€ç¯‡</a></li><li class="next pagbuttons"><a role="navigation" href="/2017/07/25/fluent-python-è¯»ä¹¦ç¬”è®°/" title="ã€ŠFluent Pythonã€‹è¯»ä¹¦ç¬”è®°" class="btn">ä¸‹ä¸€ç¯‡</a></li></ul></div><a id="comments"></a><div id="disqus_thread"></div><script>var disqus_shortname = 'yinwoods';
var disqus_identifier = '2017/07/26/airflow+celeryè¸©å‘è®°å½•/';
var disqus_title = 'airflow + celery è¸©å‘è®°å½•';
var disqus_url = 'http://blog.yinwoods.work/2017/07/26/airflow+celeryè¸©å‘è®°å½•/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//yinwoods.disqus.com/count.js" async></script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>